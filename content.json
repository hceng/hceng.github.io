[{"title":"AM437xâ€”â€”I2Cé©±åŠ¨","date":"2017-09-11T06:30:36.000Z","path":"2017/09/11/AM437xâ€”â€”I2Cé©±åŠ¨/","text":"è®°å½•AM437xçš„I2Cé€‚é…å™¨é©±åŠ¨å’ŒI2Cè®¾å¤‡é©±åŠ¨ã€‚ 1.I2Cé©±åŠ¨åœ¨Linuxä¸­ï¼ŒI2Cé©±åŠ¨æœ‰I2Cé€‚é…å™¨é©±åŠ¨ï¼ˆå°±æ˜¯SOCçš„I2Cæ§åˆ¶å™¨é©±åŠ¨ï¼‰å’ŒI2Cè®¾å¤‡é©±åŠ¨ï¼ˆå°±æ˜¯I2Cè®¾å¤‡ï¼Œæ¯”å¦‚AT24C256ï¼‰ã€‚æœ¬æ¬¡å†™é©±åŠ¨çš„è¿‡ç¨‹ï¼Œå…ˆæ˜¯åˆ©ç”¨å†…æ ¸è‡ªå¸¦çš„I2Cé€‚é…å™¨é©±åŠ¨å†™äº†I2Cè®¾å¤‡é©±åŠ¨ï¼Œå¾…I2Cè®¾å¤‡é©±åŠ¨éªŒè¯å¥½äº†ï¼Œå†å†™çš„I2Cé€‚é…å™¨é©±åŠ¨ã€‚å› æ­¤è®°å½•çš„é¡ºåºä¹Ÿæ˜¯å…ˆæ˜¯I2Cè®¾å¤‡é©±åŠ¨ï¼Œå†æ˜¯I2Cé€‚é…å™¨é©±åŠ¨ã€‚ 2.I2Cè®¾å¤‡é©±åŠ¨çš„å››ç§æ–¹å¼2.I2Cé€‚é…å™¨é©±åŠ¨4.è¡¥å……ï¼šå»é™¤am437x EEPROMéªŒè¯IDåŠŸèƒ½å‰é¢è£¸æœºçš„å¯¹EEPROMéšæ„çš„æµ‹è¯•è¯»å†™ï¼Œæ”¹å˜äº†é‡Œé¢çš„ä¸€äº›æ•°æ®ã€‚Tiå‘å¸ƒçš„SDKéœ€è¦åœ¨ä¸æ›´æ”¹ä»£ç çš„æƒ…å†µä¸‹è¿è¡Œåœ¨Tiä¸åŒçš„EVMä¸Šï¼Œæ‰€ä»¥Tiåœ¨ä»£ç ä¸­ä¼šæ·»åŠ å¯¹EVMæ¿ä¸ŠEEPROMå†…éƒ¨IDçš„åˆ¤æ–­ã€‚è¿™å°±å°´å°¬äº†ï¼Œæ²¡äººç»™æˆ‘è¯´è¿‡ä¸èƒ½æ”¹å•Š = = ã€‚éªŒè¯IDçš„æ•°æ®è¢«æˆ‘æ”¹äº†ï¼Œç°åœ¨Ubootæ²¡æ³•å¼•å¯¼å†…æ ¸äº†ã€‚= = æ²¡åŠæ³•ï¼Œè¦ä¹ˆæ”¹å›EEPROMçš„æ•°æ®ï¼Œè¦ä¹ˆå»é™¤Ubootçš„éªŒè¯ï¼Œæƒè¡¡åï¼Œé€‰æ‹©äº†åè€…ã€‚é€šè¿‡æŸ¥é˜…å’Œæµ‹è¯•ï¼Œç›¸å…³ä»£ç åœ¨ï¼š~/ti-processor-sdk-linux-am437x-evm-01.00.00.03/board-support/u-boot-2014.07+gitAUTOINC+fb6ab76dad-gfb6ab76/board/ti/am43xx/è·¯å¾„ä¸‹çš„board.cå’Œboard.hã€‚ ä¿®æ”¹åŸç†æ˜¯ï¼Œå±è”½æ‰å»è¯»eepromçš„æ•°æ®ï¼Œæ‰‹åŠ¨æŒ‡å®šæ¿å­å’Œç‰ˆæœ¬ä¿¡æ¯ã€‚åœ¨read_eeprom()å‡½æ•°ä¸­,æ³¨é‡Šæ‰åŸæ¥çš„éªŒè¯ï¼Œåœ¨åé¢çš„strncpy()å‡½æ•°ä¸­æŒ‡å®šæ¿å­ä¿¡æ¯ã€‚ä¿®æ”¹åè¯¥éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/* * Read header information from EEPROM into global structure. */static int read_eeprom(struct am43xx_board_id *header)&#123;#if 0 /* Check if baseboard eeprom is available */ if (i2c_probe(CONFIG_SYS_I2C_EEPROM_ADDR)) &#123; printf(\"Could not probe the EEPROM at 0x%x\\n\", CONFIG_SYS_I2C_EEPROM_ADDR); return -ENODEV; &#125; /* read the eeprom using i2c */ if (i2c_read(CONFIG_SYS_I2C_EEPROM_ADDR, 0, 2, (uchar *)header, sizeof(struct am43xx_board_id))) &#123; printf(\"Could not read the EEPROM\\n\"); return -EIO; &#125; if (header-&gt;magic != 0xEE3355AA) &#123; /* * read the eeprom using i2c again, * but use only a 1 byte address */ if (i2c_read(CONFIG_SYS_I2C_EEPROM_ADDR, 0, 1, (uchar *)header, sizeof(struct am43xx_board_id))) &#123; printf(\"Could not read the EEPROM at 0x%x\\n\", CONFIG_SYS_I2C_EEPROM_ADDR); return -EIO; &#125; if (header-&gt;magic != 0xEE3355AA) &#123; printf(\"Incorrect magic number (0x%x) in EEPROM\\n\", header-&gt;magic); return -EINVAL; &#125; &#125;#endif //strncpy(am43xx_board_name, (char *)header-&gt;name, sizeof(header-&gt;name)); strncpy(am43xx_board_name, \"AM43__SK\", sizeof(header-&gt;name)); am43xx_board_name[sizeof(header-&gt;name)] = 0; //strncpy(am43xx_board_rev, (char *)header-&gt;version, sizeof(header-&gt;version)); strncpy(am43xx_board_rev, \"1.2\",sizeof(header-&gt;version)); am43xx_board_rev[sizeof(header-&gt;version)] = 0; return 0;&#125; æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"AM437X","slug":"AM437X","permalink":"http://yoursite.com/tags/AM437X/"},{"name":"Linuxé©±åŠ¨","slug":"Linuxé©±åŠ¨","permalink":"http://yoursite.com/tags/Linuxé©±åŠ¨/"}]},{"title":"AM437xâ€”â€”I2Cè£¸æœº","date":"2017-08-28T06:12:26.000Z","path":"2017/08/28/AM437xâ€”â€”I2Cè£¸æœº/","text":"è®°å½•AM437xçš„I2Cè£¸æœºè°ƒè¯•ï¼ŒåŒ…å«GPIOæ¨¡æ‹Ÿå’Œå¯„å­˜å™¨æ§åˆ¶ã€‚ 0.I2Cåè®®å…³é”®ç‚¹0.1 I2Cåè®®æƒ³è±¡æœ‰ä¸¤ä¸ªè®¾å¤‡ï¼Œä»–ä»¬ä¹‹é—´è¦ä¼ è¾“æ•°æ®ã€‚å‘æ•°æ®çš„å«ä¸»è®¾å¤‡ï¼Œæ¥æ”¶æ•°æ®çš„å«ä»è®¾å¤‡ã€‚ä¸¤ä¸ªè®¾å¤‡ä¹‹é—´ï¼Œåªæœ‰ä¸¤æ ¹çº¿ã€‚ä¸€æ ¹çº¿å¾—ä½œä¸ºæ—¶é’Ÿä¿¡å·çº¿ï¼Œè¿™æ ·ä¸¤ä¸ªè®¾å¤‡æ‰èƒ½ç»Ÿä¸€ä¸€ä¸ªä¿¡å·æ ‡å‡†ï¼Œå¦å¤–ä¸€ä¸ªè‡ªç„¶åªæœ‰ä½œä¸ºä¿¡å·çº¿ä¼ è¾“æ•°æ®ã€‚ ä¸»è®¾å¤‡è¦å‘é€æ•°æ®å‰ï¼Œå¾—å‘å‡ºä¸€ä¸ªç‰¹æ®Šçš„ä¿¡å·ï¼Œå‘Šè¯‰ä»è®¾å¤‡ï¼Œè¿™ä¸ªä¿¡å·å°±æ˜¯å¼€å§‹ä¿¡å·ã€‚åŒç†ï¼Œå‘é€å®Œåï¼Œæœ‰ä¸ªç‰¹æ®Šçš„ç»“æŸä¿¡å·ã€‚ä»¥åŠä»æœºåœ¨æ¥æ”¶åˆ°æ•°æ®åï¼Œç»™ä¸ªå“åº”ä¿¡å·è¡¨ç¤ºè‡ªå·±æ”¶åˆ°äº†ã€‚ å¼€å§‹ä¿¡å·sï¼šSCLä¸ºé«˜ï¼ŒSDAç”±é«˜å˜ä½ï¼Œå¼€å§‹ä¼ è¾“æ•°æ®ç»“æŸä¿¡å·pï¼šSCLä¸ºé«˜ï¼ŒSDAç”±ä½å˜é«˜ï¼Œç»“æŸä¼ è¾“æ•°æ®å“åº”ä¿¡å·aï¼šæ¥æ”¶å™¨åœ¨æ”¶åˆ°8ä½æ•°æ®åï¼Œåœ¨ç¬¬9ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œæ‹‰ä½SDAç”µå¹³ã€‚SDAçš„ä¿¡å·ï¼Œåªèƒ½åœ¨SCLä¸ºä½çš„æ—¶å€™å‘ç”Ÿå˜åŒ–ã€‚ å¦‚å›¾ï¼Œ SDAå’ŒSCLå¼€å§‹éƒ½ä¸ºé«˜ã€‚ç„¶åSDAæ‹‰ä½ï¼Œè¡¨ç¤ºå¼€å§‹ä¿¡å·ã€‚ åœ¨æ¥ä¸‹æ¥çš„8ä¸ªæ—¶é—´å‘¨æœŸé‡Œï¼Œä¸»æœºæ§åˆ¶SDAçš„é«˜ä½ï¼Œå‘å‡ºä¸€ä¸ª åŒ…å«ä»æœºåœ°å€ å’Œ æ˜¯è¯»æ“ä½œè¿˜æ˜¯å†™æ“ä½œ çš„æ•°æ®ã€‚ç¬¬9ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œä¸»è®¾å¤‡æ‹‰é«˜åé‡Šæ”¾æ‰SDAï¼Œå†å»è¯»å–å®ƒã€‚ä»è®¾å¤‡åº”è¯¥æ‹‰ä½SDAï¼Œç»™å‡ºå“åº”ä¿¡å·ã€‚ å†æ¥ä¸‹æ¥çš„8ä¸ªæ—¶é—´å‘¨æœŸé‡Œï¼Œä¸»æœºæ§åˆ¶SDAçš„é«˜ä½ï¼Œä¼ è¾¾æ•°æ®ã€‚ä»æœºå°±è¯»å–ç”µå¹³é«˜ä½ï¼Œå¾—åˆ°æ•°æ®ã€‚ç¬¬9ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œä»è®¾å¤‡ç»™ä¸»è®¾å¤‡ä¸€ä¸ªå“åº”ä¿¡å·ã€‚ æœ€åï¼Œä¸»æœºç»™ä¸ªåœæ­¢ä¿¡å·ï¼Œè¡¨ç¤ºä¼ è¾“ç»“æŸã€‚ 0.2 EEPROMä»¥CAT24C256è¿™ä¸ªEEPROMä½œä¸ºä»è®¾å¤‡ä¸ºä¾‹ã€‚ å…ˆçœ‹çœ‹CAT24C256çš„å¼•è„šæœ‰å“ªäº›ï¼šSCLå’ŒSDAï¼Œæ—¶é’Ÿå’Œæ•°æ®ã€‚A0,A1å’ŒA2ï¼Œç”¨æ¥è¡¨ç¤ºä»è®¾å¤‡çš„åœ°å€ï¼Œåœ¨ç¡¬ä»¶ç”µè·¯ä¸Šï¼Œè®¾ç½®è¿™3ä¸ªå¼•è„šçš„å€¼ã€‚WPï¼Œå†™ä¿æŠ¤å¼•è„šã€‚é«˜ç”µå¹³çš„æ—¶å€™å†™ä¿æŠ¤ï¼Œå› æ­¤åœ¨å†™EEPROMçš„æ—¶å€™å¾—å°†è¯¥å¼•è„šç½®ä½ã€‚ å†çœ‹çœ‹ï¼Œå‰é¢è¯´çš„ â€œä¸€ä¸ª åŒ…å«ä»æœºåœ°å€ å’Œ æ˜¯è¯»æ“ä½œè¿˜æ˜¯å†™æ“ä½œ çš„æ•°æ®â€ï¼šå¯ä»¥çœ‹åˆ°å‰4ä½å›ºå®šä¸ºâ€1010â€ï¼Œç„¶åæ˜¯3ä½åœ°å€ï¼Œæœ€åä½è¡¨ç¤ºæ˜¯è¯»æ“ä½œè¿˜æ˜¯å†™æ“ä½œã€‚ å†™æ“ä½œçš„æ—¶åºå…ˆæ¥ä¸ªå¼€å§‹ä¿¡å·ï¼Œç„¶åæ˜¯ä»æœºåœ°å€(å†™)ï¼Œç„¶åæ˜¯è¦å†™åœ°å€çš„é«˜8ä½ï¼Œå†æ˜¯ä½8ä½ï¼Œå†æ˜¯è¦å†™çš„8ä½æ•°æ®ï¼Œæœ€åæ˜¯åœæ­¢ä¿¡å·ã€‚æ¯æ¬¡ä¼ è¾“çš„åé¢éƒ½å¾—æœ‰ä¸ªå“åº”ä¿¡å·ã€‚ è¯»æ“ä½œçš„æ—¶åºå…ˆæ¥ä¸ªå¼€å§‹ä¿¡å·ï¼Œç„¶åæ˜¯ä»æœºåœ°å€(å†™)ï¼Œç„¶åæ˜¯è¦å†™åœ°å€çš„é«˜8ä½ï¼Œå†æ˜¯ä½8ä½ã€‚å†æ¥ä¸ªå¼€å§‹ä¿¡å·ï¼Œç„¶åæ˜¯ä»æœºåœ°å€(è¯»)ï¼Œè·å–8ä½æ•°æ®ï¼Œæœ€åæ˜¯åœæ­¢ä¿¡å·ã€‚æ¯æ¬¡ä¼ è¾“çš„åé¢éƒ½å¾—æœ‰ä¸ªå“åº”ä¿¡å·ï¼Œä½†å¦‚æœæ˜¯æœ€åä¸€æ¬¡æ¥æ”¶æ•°æ®å¯ä¸è¦ã€‚ 1.GPIOæ¨¡æ‹Ÿç‰ˆæœ¬1.1ç¡¬ä»¶ç»“æ„TI EVMå¼€å‘æ¿çš„EEPROMéƒ¨åˆ†ç”µè·¯å›¾ï¼š ç±³å°”ç§‘æŠ€å¼€å‘æ¿çš„EEPROMéƒ¨åˆ†ç”µè·¯å›¾ï¼š ä¸¤ä¸ªæ¿å­éƒ½æ˜¯ç”¨çš„I2C0ï¼Œå™¨ä»¶åœ°å€éƒ½æ˜¯000ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ç±³å°”çš„æ¿å­ç”¨äº†EMU0å¼•è„šæ§åˆ¶EEPROMçš„å†™ä¿æŠ¤ã€‚åé¢ä»¥ç±³å°”æ¿å­ä¸ºä¾‹ã€‚è¿™ä¸‰ä¸ªå¼•è„šåˆ†åˆ«æ˜¯ï¼š I2C0_SDA-&gt;gpio3_5;I2C0_SCL-&gt;gpio3_6; WP-&gt;gpio3_7; 1.2ç›¸å…³å‡½æ•° GPIOç›¸å…³ 1.å¯ç”¨GPIO3æ—¶é’Ÿï¼Œå¼•è„šæ§åˆ¶é»˜è®¤ä¸ºGPIOï¼Œå†è®¾ç½®ä¸ºè¾“å‡ºï¼Œæ‹‰é«˜å¼•è„šï¼Œåšå¥½å‡†å¤‡ï¼›123456789101112void i2c_init(void)&#123; PRCM_CM_PER_GPIO3_CLKCTRL |= (0x02&lt;&lt;0); //gpio3_5-&gt;I2C0_SDA;gpio3_6-&gt;I2C0_SCL;gpio3_7-&gt;WP //CTRL_CONF_I2C0_SDA ;//GPIOæ¨¡å¼I2Cï¼Œé»˜è®¤é…ç½®å³å¯ //CTRL_CONF_I2C0_SCL ;//GPIOæ¨¡å¼I2Cï¼Œé»˜è®¤é…ç½®å³å¯ GPIO3-&gt;OE &amp;= ~(0x01&lt;&lt;7 | 0x01&lt;&lt;6 | 0x01&lt;&lt;5);//è¾“å‡º GPIO3-&gt;DATAOUT |= (0x01&lt;&lt;7 | 0x01&lt;&lt;6 | 0x01&lt;&lt;5);//æ‹‰é«˜&#125; 2.å°è£…å¥½SDAå’ŒSCLçš„è¾“å‡ºé«˜ä½ç”µå¹³å‡½æ•°ï¼Œä»¥åŠè·å–SDAå¼•è„šæ•°æ®å‡½æ•°ï¼Œæœ€åè¿˜æœ‰ä½¿èƒ½å†™ä¿æŠ¤å¼•è„šå‡½æ•°ï¼›1234567891011121314151617181920212223242526272829303132333435363738static void SDA(char x)&#123; GPIO3-&gt;OE &amp;= ~(0x01&lt;&lt;5); if(x) &#123; GPIO3-&gt;DATAOUT |= (0x01&lt;&lt;5); &#125; else &#123; GPIO3-&gt;DATAOUT &amp;= ~(0x01&lt;&lt;5); &#125; &#125;static void SCL(char x)&#123; GPIO3-&gt;OE &amp;= ~(0x01&lt;&lt;6); if(x) &#123; GPIO3-&gt;DATAOUT |= (0x01&lt;&lt;6); &#125; else &#123; GPIO3-&gt;DATAOUT &amp;= ~(0x01&lt;&lt;6); &#125; &#125;static char GET_SDA(void)&#123; GPIO3-&gt;OE |= (0x01&lt;&lt;5); return (GPIO3-&gt;DATAIN &amp; (0x01&lt;&lt;5)?1:0);&#125;void eeprom_write_protect(char x)&#123; if(x) GPIO3-&gt;DATAOUT |= (0x01&lt;&lt;7); else GPIO3-&gt;DATAOUT &amp;= ~(0x01&lt;&lt;7);&#125; I2Cåè®®ç›¸å…³1.ä¸‰ä¸ªä¿¡å·å‡½æ•°ï¼šå¼€å§‹ä¿¡å·ã€åœæ­¢ä¿¡å·ã€å“åº”ä¿¡å·(åˆ¤æ–­æ˜¯å¦æ”¶åˆ°ä»è®¾å¤‡çš„å“åº”ä¿¡å·)ã€‚ç†è®ºä¸Šå¯ä»¥é€šè¿‡è°ƒèŠ‚å»¶æ—¶çš„é•¿çŸ­ï¼Œæ”¹å˜ä¼ è¾“é€Ÿåº¦ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657static void i2c_delay(volatile int time)&#123; time = time*1; for (; time &gt; 0; time--);&#125;static void i2c_start(void)&#123; SCL(1); i2c_delay(1); SDA(1); i2c_delay(1); SDA(0); i2c_delay(1); SCL(0); i2c_delay(1);&#125;static void i2c_stop(void)&#123; SDA(0); i2c_delay(1); SCL(1); i2c_delay(1); SDA(1); i2c_delay(1);&#125;static int i2c_ack(void)&#123; int pin_val; SCL(0); i2c_delay(1); SDA(1); i2c_delay(1); //å®æµ‹ä¸­ï¼Œam437xå¼•è„šç”±è¾“å‡ºè®¾ç½®ä¸ºè¾“å…¥çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ªé«˜ç”µå¹³ //å› æ­¤ï¼Œè¶ç°åœ¨SCLä¸ºä½ï¼Œå…ˆè®¾ç½®ä¸ºè¾“å…¥ GET_SDA(); SCL(1); i2c_delay(1); pin_val = GET_SDA(); i2c_delay(1); SCL(0); i2c_delay(1); return pin_val;&#125; 2.I2Cçš„è¯»å†™å‡½æ•°å†™å°±æ˜¯åœ¨8ä¸ªæ—¶é’Ÿå‘¨æœŸé‡Œï¼ŒSCLä½çš„æ—¶å€™ï¼Œæ”¹å˜SDAï¼ŒSCLé«˜çš„æ—¶å€™ï¼Œç¨³å®šSDAï¼Œä»è€Œå‘å‡º8ä½æ•°æ®ã€‚å†™å°±æ˜¯åœ¨8ä¸ªæ—¶é’Ÿå‘¨æœŸé‡Œï¼ŒSCLä½çš„æ—¶å€™ï¼Œä¸è¯»å¼•è„šï¼ŒSCLé«˜çš„æ—¶å€™ï¼Œè¯»å¼•è„šï¼Œä»è€Œå¾—åˆ°8ä½æ•°æ®ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455void eeprom_write(unsigned char addr, unsigned char data)&#123; eeprom_write_protect(0); i2c_start(); i2c_write(0xA0); while(i2c_ack()); i2c_write(addr&gt;&gt;8); while(i2c_ack()); i2c_write(addr); while(i2c_ack()); i2c_write(data); while(i2c_ack()); i2c_stop(); eeprom_write_protect(1);&#125;unsigned char eeprom_read(unsigned char addr)&#123; unsigned char data = 0; eeprom_write_protect(0); i2c_start(); i2c_write(0xA0); while(i2c_ack()); i2c_write(addr&gt;&gt;8); while(i2c_ack()); i2c_write(addr); while(i2c_ack()); i2c_stop(); i2c_delay(10); i2c_start(); i2c_write(0xA1); while(i2c_ack()); data = i2c_read(); i2c_stop(); eeprom_write_protect(1); return data;&#125; EEPROMç›¸å…³å†™æ“ä½œï¼šå…ˆå…³é—­å†™ä¿æŠ¤ï¼Œå‘å‡ºå¼€å§‹ä¿¡å·ï¼Œå‘å‡ºä»æœºåœ°å€(å†™)ï¼Œå‘å‡ºé«˜åœ°å€ã€ä½åœ°å€ï¼Œå‘å‡ºæ•°æ®ï¼Œå‘å‡ºåœæ­¢ä¿¡å·å’Œæ‰“å¼€å†™ä¿æŠ¤ã€‚è¯»æ“ä½œï¼šå…ˆå…³é—­å†™ä¿æŠ¤ï¼Œå‘å‡ºå¼€å§‹ä¿¡å·ï¼Œå‘å‡ºä»æœºåœ°å€(å†™)ï¼Œå‘å‡ºé«˜åœ°å€ã€ä½åœ°å€ã€‚å†å‘å‡ºå¼€å§‹ä¿¡å·ï¼Œå‘å‡ºä»æœºåœ°å€(å†™è¯»)ï¼Œè¯»å–æ•°æ®ï¼Œå‘å‡ºåœæ­¢ä¿¡å·å’Œæ‰“å¼€å†™ä¿æŠ¤ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455void eeprom_write(unsigned char addr, unsigned char data)&#123; eeprom_write_protect(0); i2c_start(); i2c_write(0xA0); while(i2c_ack()); i2c_write(addr&gt;&gt;8); while(i2c_ack()); i2c_write(addr); while(i2c_ack()); i2c_write(data); while(i2c_ack()); i2c_stop(); eeprom_write_protect(1);&#125;unsigned char eeprom_read(unsigned char addr)&#123; unsigned char data = 0; eeprom_write_protect(0); i2c_start(); i2c_write(0xA0); while(i2c_ack()); i2c_write(addr&gt;&gt;8); while(i2c_ack()); i2c_write(addr); while(i2c_ack()); i2c_stop(); i2c_delay(10); i2c_start(); i2c_write(0xA1); while(i2c_ack()); data = i2c_read(); i2c_stop(); eeprom_write_protect(1); return data;&#125; 1.3æµ‹è¯•æ•ˆæœ ä¸²å£æ‰“å°ï¼š å‘0x01åœ°å€å†™æ•°æ®2ï¼š è¯»0x01åœ°å€æ•°æ®ä¸º2ï¼š 2.I2Cå¯„å­˜å™¨ç‰ˆæœ¬2.1ç¡¬ä»¶ç»“æ„åŒä¸Šã€‚ 2.2ç›¸å…³å‡½æ•° åˆå§‹åŒ–ç›¸å…³1.åˆå§‹åŒ–ç›¸å…³çš„æ—¶é’Ÿå’Œé…ç½®å¤ç”¨åŠŸèƒ½ï¼› 12345678910111213141516static void i2c_gpio_init(void)&#123; PRCM_CM_WKUP_I2C0_CLKCTRL |= (0x02&lt;&lt;0); PRCM_CM_WKUP_CLKSTCTRL |= (0x01&lt;&lt;14); PRCM_CM_PER_L4LS_CLKSTCTRL|= (0x01&lt;&lt;27); PRCM_CM_PER_GPIO3_CLKCTRL |= (0x02&lt;&lt;0); //gpio3_5-&gt;I2C0_SDA;gpio3_6-&gt;I2C0_SCL;gpio3_7-&gt;WP CTRL_CONF_I2C0_SDA &amp;= ~(0x07&lt;&lt;0 | 0x01&lt;&lt;16 | 0x01&lt;&lt;19); CTRL_CONF_I2C0_SCL &amp;= ~(0x07&lt;&lt;0 | 0x01&lt;&lt;16 | 0x01&lt;&lt;19); //CTRL_CONF_EMU0 GPIO3-&gt;OE &amp;= ~(0x01&lt;&lt;7); GPIO3-&gt;DATAOUT |= (0x01&lt;&lt;7);&#125; 2.åˆå§‹åŒ–I2C0ï¼Œæ³¨å†Œä¸­æ–­ï¼›æ³¨æ„è¿™é‡Œçš„ä»æœºåœ°å€ä¸å«æœ€åçš„è¯»å†™æ“ä½œä½ã€‚ 123456789101112131415161718192021void i2c_init(void)&#123; i2c_gpio_init(); register_irq(IRQ_I2C0, i2c0_irq); interrupt_init(IRQ_I2C0); I2C0-&gt;CON &amp;= ~(0x01&lt;&lt;15);//reset I2C0-&gt;SYSC &amp;= ~(0x01&lt;&lt;0);//Auto Idle disabled. I2C0-&gt;PSC = 3;//the module divided by (PSC + 1) -&gt; 48M/(3+1)=12M I2C0-&gt;SCLL = 63;//tLOW = (SCLL + 7) * ICLK time period I2C0-&gt;SCLH = 65;//tHIGH = (SCLH + 5) * ICLK time period I2C0-&gt;SA = 0x50;//Slave address.1010 000 I2C0-&gt;CON |= (0x01&lt;&lt;15);//Module enabled &#125; ä¸­æ–­å¤„ç†å‡½æ•°ä¸­æ–­å¤„ç†å‡½æ•°æ˜¯ç¡¬ä»¶I2Cçš„æ ¸å¿ƒï¼Œæ ¹æ®ä¸­æ–­çŠ¶æ€æ ‡å¿—ä½å»è¿›è¡Œç›¸åº”çš„è¯»æˆ–å†™æ“ä½œã€‚ 12345678910111213141516171819202122232425262728293031323334void i2c0_irq(void)&#123; unsigned int status = 0; status = I2C0-&gt;IRQSTS; I2C0-&gt;IRQSTS = (status &amp; (0x01&lt;&lt;3 | 0x01&lt;&lt;4)); if(status &amp; (0x01&lt;&lt;3))//receive &#123; I2C0-&gt;IRQSTS |= (0x01&lt;&lt;3); if(r_count == num) &#123; I2C0-&gt;IRQEN_CLR |= (0x01&lt;&lt;3); I2C0-&gt;CON |= (0x01&lt;&lt;1);//stop &#125; else &#123; data_from_slave[r_count++] = (unsigned char)I2C0-&gt;DATA; &#125; &#125; if (status &amp; (0x01&lt;&lt;4))//send &#123; I2C0-&gt;DATA = data_to_slave[t_count++]; I2C0-&gt;IRQSTS |= (0x01&lt;&lt;4); if(t_count == num) &#123; I2C0-&gt;IRQEN_CLR |= (0x01&lt;&lt;4); &#125; &#125;&#125; EEPROMç›¸å…³å†™æ“ä½œï¼šå»å†™ä¿æŠ¤ï¼Œåˆ†è§£åœ°å€é«˜ä½ä½ï¼Œè®¾ç½®ä¼ è¾“æ•°æ®çš„ä½æ•°(åœ°å€æ˜¯ä¸¤ä½+æ•°æ®ä¸€ä½)ï¼Œæ¸…é™¤ä¸­æ–­ï¼Œè®¾ç½®ä¸ºä¸»æœºå‘é€æ¨¡å¼ï¼Œä½¿èƒ½å‘é€ä¸­æ–­ï¼Œå¼€å§‹ä¼ è¾“ï¼Œç›´åˆ°åœ°å€æ•°æ®ä¼ å®Œï¼Œå¼€å¯å†™ä¿æŠ¤ã€‚è¯»æ“ä½œï¼šå»å†™ä¿æŠ¤ï¼Œåˆ†è§£åœ°å€é«˜ä½ä½ï¼Œè®¾ç½®ä¼ è¾“æ•°æ®çš„ä½æ•°(åœ°å€æ˜¯ä¸¤ä½)ï¼Œæ¸…é™¤ä¸­æ–­ï¼Œè®¾ç½®ä¸ºä¸»æœºå‘é€æ¨¡å¼ï¼Œä½¿èƒ½å‘é€ä¸­æ–­ï¼Œå¼€å§‹ä¼ è¾“ï¼Œç›´åˆ°åœ°å€æ•°æ®ä¼ å®Œã€‚å†è®¾ç½®ä¼ è¾“ä½ï¼ˆæ¥æ”¶æ•°æ®ä¸€ä½ï¼‰ï¼Œæ¸…é™¤ä¸­æ–­ï¼Œè®¾ç½®ä½ä¸»æœºæ¥æ”¶æ¨¡å¼ï¼Œå¼€å§‹ä¼ è¾“ï¼Œç›´è‡³ä¼ è¾“å®Œæˆï¼Œå¼€å¯å†™ä¿æŠ¤ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687void eeprom_write(unsigned char addr, unsigned char data)&#123; eeprom_write_protect(0); data_to_slave[0] = addr&gt;&gt;8; data_to_slave[1] = (addr &amp; 0xFF); data_to_slave[2] = data; t_count = 0; I2C0-&gt;CNT = 0x03; num = I2C0-&gt;CNT; I2C0-&gt;IRQSTS |= 0x7FFF; I2C0-&gt;IRQEN_CLR |= 0x7FFF; I2C0-&gt;CON |= (0x01&lt;&lt;9 | 0x01&lt;&lt;10 | 0x01&lt;&lt;15); //MST=1 TRX=1 I2C0-&gt;IRQEN_SET |= (0x01&lt;&lt;4); I2C0-&gt;CON |= (0x01&lt;&lt;0); while(i2c_master_bus_busy() == 0); while(t_count != num); I2C0-&gt;CON |= (0x01&lt;&lt;1); //stop eeprom_write_protect(1);&#125;unsigned char eeprom_read(unsigned char addr)&#123; unsigned char data = 0; eeprom_write_protect(0); data_to_slave[0] = addr&gt;&gt;8; data_to_slave[1] = (addr &amp; 0xFF); t_count = 0; r_count = 0; I2C0-&gt;CNT = 0x02; num = I2C0-&gt;CNT; I2C0-&gt;IRQSTS |= 0x7FFF; I2C0-&gt;IRQEN_CLR |= 0x6FFF; I2C0-&gt;CON |= (0x01&lt;&lt;9 | 0x01&lt;&lt;10 | 0x01&lt;&lt;15); //MST=1 TRX=1 I2C0-&gt;IRQEN_SET |= (0x01&lt;&lt;4); I2C0-&gt;CON |= (0x01&lt;&lt;0); while(i2c_master_bus_busy() == 0); while(t_count != num); while(!(I2C0-&gt;IRQSTS_RAW &amp; (0x01&lt;&lt;2)));//----------------------------------------------------------------// I2C0-&gt;CNT = 0x01; num = I2C0-&gt;CNT; I2C0-&gt;IRQSTS |= 0x7FFF; I2C0-&gt;IRQEN_CLR |= 0x6FFF; I2C0-&gt;CON |= (0x01&lt;&lt;10 | (0x01&lt;&lt;15)); I2C0-&gt;CON &amp;= ~(0x01&lt;&lt;9); I2C0-&gt;IRQEN_SET |= (0x01&lt;&lt;3 | 0x01&lt;&lt;8); I2C0-&gt;CON |= (0x01&lt;&lt;0); while(i2c_master_bus_busy() == 0); while(r_count != num); data = data_from_slave[0]; eeprom_write_protect(1); return data;&#125; 2.3æµ‹è¯•æ•ˆæœ å‘0x01åœ°å€å†™æ•°æ®2ï¼š è¯»0x01åœ°å€æ•°æ®ä¸º2ï¼š 3.å®Œæ•´ä»£ç [main.c]link12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152/************************************************************************* &gt; File Name: main.c &gt; Author: hceng &gt; Description: AM437Xè£¸æœºi2c &gt; Created Time: 20170815*************************************************************************/#include \"AM437X/AM437X_SOC.h\"#include \"led.h\"#include \"delay.h\"#include \"uart.h\"#include \"printf.h\"#include \"key.h\"#include \"clkout.h\"#include \"int.h\"#include \"timer.h\"#include \"i2c.h\"int main()&#123; unsigned int i; uart_init(); gic_init(); timer2_init(); i2c_init(); printf(\"init ok.\\n\\r\"); //write eeprom. for(i=0; i&lt;5; i++) &#123; eeprom_write(i,2*i); delay_ms(4);//Must be delayed more than 4ms. &#125; delay_ms(10); //read eeprom. for(i=0; i&lt;5; i++) &#123; printf(\"read_data%d = %d\\n\\r\",i, eeprom_read(i)); delay_ms(4); &#125; while(1) &#123; &#125; return 0;&#125; [i2c.c]link123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461#include \"AM437X/AM437X_SOC.h\"#include \"i2c.h\"#include \"uart.h\"#include \"printf.h\"#include \"int.h\" #include \"delay.h\" #ifdef GPIO_I2Cstatic void i2c_delay(volatile int time)&#123; time = time*1; for (; time &gt; 0; time--);&#125;static void SDA(char x)&#123; GPIO3-&gt;OE &amp;= ~(0x01&lt;&lt;5); if(x) &#123; GPIO3-&gt;DATAOUT |= (0x01&lt;&lt;5); &#125; else &#123; GPIO3-&gt;DATAOUT &amp;= ~(0x01&lt;&lt;5); &#125; &#125;static void SCL(char x)&#123; GPIO3-&gt;OE &amp;= ~(0x01&lt;&lt;6); if(x) &#123; GPIO3-&gt;DATAOUT |= (0x01&lt;&lt;6); &#125; else &#123; GPIO3-&gt;DATAOUT &amp;= ~(0x01&lt;&lt;6); &#125; &#125;static char GET_SDA(void)&#123; GPIO3-&gt;OE |= (0x01&lt;&lt;5); return (GPIO3-&gt;DATAIN &amp; (0x01&lt;&lt;5)?1:0);&#125;void i2c_init(void)&#123; PRCM_CM_PER_GPIO3_CLKCTRL |= (0x02&lt;&lt;0); //gpio3_5-&gt;I2C0_SDA;gpio3_6-&gt;I2C0_SCL;gpio3_7-&gt;WP //CTRL_CONF_I2C0_SDA ;//GPIOæ¨¡å¼I2Cï¼Œé»˜è®¤é…ç½®å³å¯ //CTRL_CONF_I2C0_SCL ;//GPIOæ¨¡å¼I2Cï¼Œé»˜è®¤é…ç½®å³å¯ GPIO3-&gt;OE &amp;= ~(0x01&lt;&lt;7 | 0x01&lt;&lt;6 | 0x01&lt;&lt;5);//è¾“å‡º GPIO3-&gt;DATAOUT |= (0x01&lt;&lt;7 | 0x01&lt;&lt;6 | 0x01&lt;&lt;5);//æ‹‰é«˜&#125;static void i2c_start(void)&#123; SCL(1); i2c_delay(1); SDA(1); i2c_delay(1); SDA(0); i2c_delay(1); SCL(0); i2c_delay(1);&#125;static void i2c_stop(void)&#123; SDA(0); i2c_delay(1); SCL(1); i2c_delay(1); SDA(1); i2c_delay(1);&#125;static int i2c_ack(void)&#123; int pin_val; SCL(0); i2c_delay(1); SDA(1); i2c_delay(1); //å®æµ‹ä¸­ï¼Œam437xå¼•è„šç”±è¾“å‡ºè®¾ç½®ä¸ºè¾“å…¥çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ªé«˜ç”µå¹³ //å› æ­¤ï¼Œè¶ç°åœ¨SCLä¸ºä½ï¼Œå…ˆè®¾ç½®ä¸ºè¾“å…¥ GET_SDA(); SCL(1); i2c_delay(1); pin_val = GET_SDA(); i2c_delay(1); SCL(0); i2c_delay(1); return pin_val;&#125;static void i2c_write(unsigned char data)&#123; int i = 0; for(i=0; i&lt;8; i++) &#123; SCL(0); i2c_delay(1); if(data &amp; 0x80) SDA(1); else SDA(0); data = data&lt;&lt;1; i2c_delay(1); SCL(1); i2c_delay(1); &#125; SCL(0); i2c_delay(1);&#125;static unsigned char i2c_read(void)&#123; int i = 0; unsigned char data = 0; SCL(0); i2c_delay(1); SDA(1); GET_SDA();//åŒç† i2c_delay(1); for(i=0; i&lt;8; i++) &#123; SCL(1); i2c_delay(1); data = data&lt;&lt;1; if(GET_SDA()) data |= 0x01; SCL(0); i2c_delay(1); &#125; SCL(1);//å†ç»™eepromçš„ackæä¾›ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸ i2c_delay(1); SCL(0); i2c_delay(1); return data;&#125;static void eeprom_write_protect(char x)&#123; if(x) GPIO3-&gt;DATAOUT |= (0x01&lt;&lt;7); else GPIO3-&gt;DATAOUT &amp;= ~(0x01&lt;&lt;7);&#125;void eeprom_write(unsigned char addr, unsigned char data)&#123; eeprom_write_protect(0); i2c_start(); i2c_write(0xA0); while(i2c_ack()); i2c_write(addr&gt;&gt;8); while(i2c_ack()); i2c_write(addr); while(i2c_ack()); i2c_write(data); while(i2c_ack()); i2c_stop(); eeprom_write_protect(1);&#125;unsigned char eeprom_read(unsigned char addr)&#123; unsigned char data = 0; eeprom_write_protect(0); i2c_start(); i2c_write(0xA0); while(i2c_ack()); i2c_write(addr&gt;&gt;8); while(i2c_ack()); i2c_write(addr); while(i2c_ack()); i2c_stop(); i2c_delay(10); i2c_start(); i2c_write(0xA1); while(i2c_ack()); data = i2c_read(); i2c_stop(); eeprom_write_protect(1); return data;&#125;#endif#ifdef REG_I2Cvoid i2c0_irq(void)&#123; unsigned int status = 0; status = I2C0-&gt;IRQSTS; I2C0-&gt;IRQSTS = (status &amp; (0x01&lt;&lt;3 | 0x01&lt;&lt;4)); if(status &amp; (0x01&lt;&lt;3))//receive &#123; I2C0-&gt;IRQSTS |= (0x01&lt;&lt;3); if(r_count == num) &#123; I2C0-&gt;IRQEN_CLR |= (0x01&lt;&lt;3); I2C0-&gt;CON |= (0x01&lt;&lt;1);//stop &#125; else &#123; data_from_slave[r_count++] = (unsigned char)I2C0-&gt;DATA; &#125; &#125; if (status &amp; (0x01&lt;&lt;4))//send &#123; I2C0-&gt;DATA = data_to_slave[t_count++]; I2C0-&gt;IRQSTS |= (0x01&lt;&lt;4); if(t_count == num) &#123; I2C0-&gt;IRQEN_CLR |= (0x01&lt;&lt;4); &#125; &#125;&#125;void eeprom_write_protect(char x)&#123; if(x) GPIO3-&gt;DATAOUT |= (0x01&lt;&lt;7); else GPIO3-&gt;DATAOUT &amp;= ~(0x01&lt;&lt;7);&#125;static unsigned int i2c_master_bus_busy(void)&#123; if(I2C0-&gt;IRQSTS_RAW &amp; (0x01&lt;&lt;12)) &#123; return 1; &#125; else &#123; return 0; &#125;&#125;unsigned char eeprom_read(unsigned char addr)&#123; unsigned char data = 0; eeprom_write_protect(0); data_to_slave[0] = addr&gt;&gt;8; data_to_slave[1] = (addr &amp; 0xFF); t_count = 0; r_count = 0; I2C0-&gt;CNT = 0x02; num = I2C0-&gt;CNT; I2C0-&gt;IRQSTS |= 0x7FFF; I2C0-&gt;IRQEN_CLR |= 0x6FFF; I2C0-&gt;CON |= (0x01&lt;&lt;9 | 0x01&lt;&lt;10 | 0x01&lt;&lt;15); //MST=1 TRX=1 I2C0-&gt;IRQEN_SET |= (0x01&lt;&lt;4); I2C0-&gt;CON |= (0x01&lt;&lt;0); while(i2c_master_bus_busy() == 0); while(t_count != num); while(!(I2C0-&gt;IRQSTS_RAW &amp; (0x01&lt;&lt;2)));//----------------------------------------------------------------// I2C0-&gt;CNT = 0x01; num = I2C0-&gt;CNT; I2C0-&gt;IRQSTS |= 0x7FFF; I2C0-&gt;IRQEN_CLR |= 0x6FFF; I2C0-&gt;CON |= (0x01&lt;&lt;10 | (0x01&lt;&lt;15)); I2C0-&gt;CON &amp;= ~(0x01&lt;&lt;9); I2C0-&gt;IRQEN_SET |= (0x01&lt;&lt;3 | 0x01&lt;&lt;8); I2C0-&gt;CON |= (0x01&lt;&lt;0); while(i2c_master_bus_busy() == 0); while(r_count != num); data = data_from_slave[0]; eeprom_write_protect(1); return data;&#125;void eeprom_write(unsigned char addr, unsigned char data)&#123; eeprom_write_protect(0); data_to_slave[0] = addr&gt;&gt;8; data_to_slave[1] = (addr &amp; 0xFF); data_to_slave[2] = data; t_count = 0; I2C0-&gt;CNT = 0x03; num = I2C0-&gt;CNT; I2C0-&gt;IRQSTS |= 0x7FFF; I2C0-&gt;IRQEN_CLR |= 0x7FFF; I2C0-&gt;CON |= (0x01&lt;&lt;9 | 0x01&lt;&lt;10 | 0x01&lt;&lt;15); //MST=1 TRX=1 I2C0-&gt;IRQEN_SET |= (0x01&lt;&lt;4); I2C0-&gt;CON |= (0x01&lt;&lt;0); while(i2c_master_bus_busy() == 0); while(t_count != num); I2C0-&gt;CON |= (0x01&lt;&lt;1); //stop eeprom_write_protect(1);&#125;static void i2c_gpio_init(void)&#123; PRCM_CM_WKUP_I2C0_CLKCTRL |= (0x02&lt;&lt;0); PRCM_CM_WKUP_CLKSTCTRL |= (0x01&lt;&lt;14); PRCM_CM_PER_L4LS_CLKSTCTRL|= (0x01&lt;&lt;27); PRCM_CM_PER_GPIO3_CLKCTRL |= (0x02&lt;&lt;0); //gpio3_5-&gt;I2C0_SDA;gpio3_6-&gt;I2C0_SCL;gpio3_7-&gt;WP CTRL_CONF_I2C0_SDA &amp;= ~(0x07&lt;&lt;0 | 0x01&lt;&lt;16 | 0x01&lt;&lt;19); CTRL_CONF_I2C0_SCL &amp;= ~(0x07&lt;&lt;0 | 0x01&lt;&lt;16 | 0x01&lt;&lt;19); //CTRL_CONF_EMU0 GPIO3-&gt;OE &amp;= ~(0x01&lt;&lt;7); GPIO3-&gt;DATAOUT |= (0x01&lt;&lt;7);&#125;void i2c_init(void)&#123; i2c_gpio_init(); register_irq(IRQ_I2C0, i2c0_irq); interrupt_init(IRQ_I2C0); I2C0-&gt;CON &amp;= ~(0x01&lt;&lt;15);//reset I2C0-&gt;SYSC &amp;= ~(0x01&lt;&lt;0);//Auto Idle disabled. I2C0-&gt;PSC = 3;//the module divided by (PSC + 1) -&gt; 48M/(3+1)=12M I2C0-&gt;SCLL = 63;//tLOW = (SCLL + 7) * ICLK time period I2C0-&gt;SCLH = 65;//tHIGH = (SCLH + 5) * ICLK time period I2C0-&gt;SA = 0x50;//Slave address.1010 000 I2C0-&gt;CON |= (0x01&lt;&lt;15);//Module enabled &#125;void debug_i2c(char *str)&#123; printf(\"-------------------------%s---------------------------\\r\\n\",str); printf(\"I2C0-&gt;REVNB_HI = 0x%x\\r\\n\",I2C0-&gt;REVNB_HI ); printf(\"I2C0-&gt;REVNB_LO = 0x%x\\r\\n\",I2C0-&gt;REVNB_LO ); printf(\"I2C0-&gt;REVNB_HI = 0x%x\\r\\n\",I2C0-&gt;REVNB_HI ); printf(\"I2C0-&gt;SYSC = 0x%x\\r\\n\",I2C0-&gt;SYSC ); printf(\"I2C0-&gt;IRQSTS_RAW = 0x%x\\r\\n\",I2C0-&gt;IRQSTS_RAW ); printf(\"I2C0-&gt;IRQSTS = 0x%x\\r\\n\",I2C0-&gt;IRQSTS ); printf(\"I2C0-&gt;IRQEN_SET = 0x%x\\r\\n\",I2C0-&gt;IRQEN_SET ); printf(\"I2C0-&gt;IRQEN_CLR = 0x%x\\r\\n\",I2C0-&gt;IRQEN_CLR ); printf(\"I2C0-&gt;WE = 0x%x\\r\\n\",I2C0-&gt;WE ); printf(\"I2C0-&gt;DMARXEN_SET = 0x%x\\r\\n\",I2C0-&gt;DMARXEN_SET ); printf(\"I2C0-&gt;DMATXEN_SET = 0x%x\\r\\n\",I2C0-&gt;DMATXEN_SET ); printf(\"I2C0-&gt;DMARXEN_CLR = 0x%x\\r\\n\",I2C0-&gt;DMARXEN_CLR ); printf(\"I2C0-&gt;DMATXEN_CLR = 0x%x\\r\\n\",I2C0-&gt;DMATXEN_CLR ); printf(\"I2C0-&gt;DMARXWAKE_EN= 0x%x\\r\\n\",I2C0-&gt;DMARXWAKE_EN); printf(\"I2C0-&gt;DMATXWAKE_EN= 0x%x\\r\\n\",I2C0-&gt;DMATXWAKE_EN); printf(\"I2C0-&gt;SYSS = 0x%x\\r\\n\",I2C0-&gt;SYSS ); printf(\"I2C0-&gt;BUF = 0x%x\\r\\n\",I2C0-&gt;BUF ); printf(\"I2C0-&gt;CNT = 0x%x\\r\\n\",I2C0-&gt;CNT ); printf(\"I2C0-&gt;DATA = 0x%x\\r\\n\",I2C0-&gt;DATA ); printf(\"I2C0-&gt;CON = 0x%x\\r\\n\",I2C0-&gt;CON ); printf(\"I2C0-&gt;OA = 0x%x\\r\\n\",I2C0-&gt;OA ); printf(\"I2C0-&gt;SA = 0x%x\\r\\n\",I2C0-&gt;SA ); printf(\"I2C0-&gt;PSC = 0x%x\\r\\n\",I2C0-&gt;PSC ); printf(\"I2C0-&gt;SCLL = 0x%x\\r\\n\",I2C0-&gt;SCLL ); printf(\"I2C0-&gt;SCLH = 0x%x\\r\\n\",I2C0-&gt;SCLH ); printf(\"I2C0-&gt;SYSTEST = 0x%x\\r\\n\",I2C0-&gt;SYSTEST ); printf(\"I2C0-&gt;BUFSTAT = 0x%x\\r\\n\",I2C0-&gt;BUFSTAT ); printf(\"I2C0-&gt;OA1 = 0x%x\\r\\n\",I2C0-&gt;OA1 ); printf(\"I2C0-&gt;OA2 = 0x%x\\r\\n\",I2C0-&gt;OA2 ); printf(\"I2C0-&gt;OA3 = 0x%x\\r\\n\",I2C0-&gt;OA3 ); printf(\"I2C0-&gt;ACTOA = 0x%x\\r\\n\",I2C0-&gt;ACTOA ); printf(\"I2C0-&gt;SBLOCK = 0x%x\\r\\n\",I2C0-&gt;SBLOCK ); printf(\"******************************************************\\r\\n\");&#125;#endif [i2c.h]link12345678910111213141516171819202122232425262728293031323334#ifndef __I2C_H__#define __I2C_H__#define GPIO_I2C//#define REG_I2C#ifdef GPIO_I2Cextern void i2c_init(void);extern void eeprom_write(unsigned char addr, unsigned char data);extern unsigned char eeprom_read(unsigned char addr);#endif#ifdef REG_I2Cvolatile unsigned int t_count;volatile unsigned int r_count;volatile unsigned int num;volatile unsigned char data_to_slave[5];volatile unsigned char data_from_slave[5];extern void i2c_init(void);extern unsigned char eeprom_read(unsigned char addr);extern void eeprom_write(unsigned char addr, unsigned char data);extern void debug_i2c(char *str);#endif#endif 4.å¿ƒå¾—GPIOæ¨¡æ‹ŸI2Cä¼˜åŠ¿æ˜¯é€šç”¨æ€§é«˜ï¼Œç§»æ¤æ–¹ä¾¿ã€‚åˆ©ç”¨SOCè‡ªå¸¦çš„I2Cæ§åˆ¶çš„ä¼˜åŠ¿æ˜¯ç¨³å®šï¼Œé«˜æ•ˆã€‚ GPIOæ¨¡æ‹ŸI2Céœ€è¦å¯¹æ—¶åºçš„æ¯ä¸ªç»†èŠ‚éƒ½æ¯”è¾ƒæ¸…æ¥šæ‰è¡Œï¼Œéå¸¸é€‚åˆå»ç†è§£I2Cçš„åŸç†ã€‚ç¡¬ä»¶I2Cå‡ ä¹ä¸éœ€è¦è€ƒè™‘æ—¶åºï¼ŒæŒ‰é€»è¾‘è®¾ç½®å’Œè¯»å–ç›¸å…³å¯„å­˜å™¨å³å¯ã€‚è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹æ˜¯å»çœ‹ä»æœºI2Cè®¾å¤‡çš„æ—¶åºï¼Œä¸åŒçš„è®¾å¤‡ï¼Œå¯èƒ½ä¼šä¸ä¸€æ ·çš„ã€‚ä¸‹ä¸€æ­¥ï¼Œç»ˆäºè¦å¼€å§‹I2Cçš„é©±åŠ¨äº†~~~ æ•´ä¸ªè¿‡ç¨‹ï¼Œæœ€å¤§çš„åŠŸè‡£å°±æ˜¯é€»è¾‘åˆ†æä»ªï¼Œå¤ªå¥½ç”¨äº†ğŸ˜€ æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"AM437X","slug":"AM437X","permalink":"http://yoursite.com/tags/AM437X/"},{"name":"è£¸æœº","slug":"è£¸æœº","permalink":"http://yoursite.com/tags/è£¸æœº/"}]},{"title":"AM437xâ€”â€”RTCé©±åŠ¨","date":"2017-08-27T08:47:02.000Z","path":"2017/08/27/AM437xâ€”â€”RTCé©±åŠ¨/","text":"æœ¬æ–‡ä¸»è¦è®°å½•AM437Xé©±åŠ¨çš„RTCã€‚åŒ…å«ä¸€ä¸ªä¸æ ‡å‡†çš„RTCé©±åŠ¨ã€ä¸€ä¸ªè¿˜ç®—æœ‰ç‚¹æ ‡å‡†çš„RTCé©±åŠ¨ï¼Œä»¥åŠæ­£å¸¸çš„æµ‹è¯•æ–¹å¼ã€‚ 0.æœ¬æ¬¡å…³äºé©±åŠ¨çš„æ–°æ”¶è·å†™RTCé©±åŠ¨çš„æ—¶å€™ï¼Œæˆ‘å…ˆå°è¯•çš„æŒ‰æ ‡å‡†çš„RTCæ¡†æ¶æ¥ï¼Œå†™ç€å†™ç€ï¼Œæˆ‘æƒ³è¯•è¯•ä¹‹å‰çš„ä¸€ä¸ªçŒœæƒ³ã€‚ç†è®ºä¸Šä»»ä½•å­—ç¬¦é©±åŠ¨ï¼Œæˆ‘éƒ½å¯ä»¥é€šè¿‡å¡«å……file_operationsé‡Œé¢çš„å‡½æ•°ï¼Œå®ç°å¯¹ç¡¬ä»¶çš„æ“ä½œæ§åˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå†™å®Œè£¸æœºç¨‹åºï¼ŒæŒ‰ä¹‹å‰LEDé‚£å¥—æ ‡å‡†çš„å­—ç¬¦é©±åŠ¨æ¡†æ¶å»å†™é©±åŠ¨ï¼Œåœ¨åº”ç”¨å±‚é€šè¿‡open()ç­‰å‡½æ•°å»æ“ä½œ/dev/ä¸‹çš„è®¾å¤‡ï¼Œæ˜¯ä¸‡èƒ½çš„ã€‚å®é™…ä¸ŠRTCé©±åŠ¨ä¹Ÿæ˜¯è¿™æ ·åšçš„ï¼Œä½†å› ä¸ºRTCçš„ç‰¹æ®Šæ€§ï¼Œå†…æ ¸æä¾›çš„æ˜¯rtc_class_opsè¿™ä¸ªç»“æ„ä½“ï¼Œè€Œä¸æ˜¯file_operationsã€‚æ­£å¸¸æ‰€éœ€åšçš„å°±æ˜¯å»å¡«å……rtc_class_opsçš„å‡½æ•°ï¼Œç„¶åæ³¨å†Œç­‰ã€‚æƒ³æƒ³è¿™ä¸¤ä¸ªçš„åŒºåˆ«ï¼Œå‰é¢ä¸‡èƒ½é‚£ä¸ªï¼Œåº”ç”¨å±‚å°±æ²¡é‚£ä¹ˆå¥½å—äº†ï¼Œä¸é€šç”¨ï¼Œæ¯”å¦‚ä½¿ç”¨hwclockæ˜¯ä¸èƒ½è°ƒç”¨åˆ°é©±åŠ¨å‡½æ•°çš„ï¼Œå› æ­¤éœ€è¦è‡ªå·±å»å®ç°å»RTCçš„è®¿é—®ï¼Œå°±åƒè®¿é—®LEDé©±åŠ¨ä¸€æ ·ã€‚åé¢æ ‡å‡†RTCé‚£ä¸ªï¼Œå…¶æœ€åçš„å®è´¨ã€åŸç†æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æä¾›äº†ç»Ÿä¸€çš„æ¡†æ¶ï¼Œå¢å¼ºäº†é€šç”¨æ€§ã€‚ 1.ä¸æ ‡å‡†çš„RTCé©±åŠ¨1.1å…¥å£å‡½æ•°å’Œå‡ºå£å‡½æ•°å…ˆæ˜¯å…¥å£å‡½æ•°ï¼Œåœ¨insmodé©±åŠ¨çš„æ—¶å€™è°ƒç”¨ï¼Œåˆ†é…äº†ä¸»è®¾å¤‡å·ï¼Œæ³¨å†Œäº†å­—ç¬¦è®¾å¤‡é©±åŠ¨ï¼Œåˆ›å»ºäº†ä¸ªç±»ï¼Œä½¿ç”¨cdevæœºåˆ¶ï¼Œè‡ªåŠ¨åœ¨/dev/ç›®å½•ä¸‹åˆ›å»ºè®¾å¤‡ï¼Œåº”ç”¨å±‚å°±æ˜¯é€šè¿‡å¯¹è¿™ä¸ªè®¾å¤‡æ“ä½œï¼Œè°ƒç”¨é©±åŠ¨å®ç°å¯¹ç¡¬ä»¶çš„æ“ä½œã€‚å†ç”³è¯·äº†å†…å­˜ï¼Œæ˜ å°„äº†å¯„å­˜å™¨åœ°å€ï¼Œåé¢å¯¹è¿™äº›æ˜ å°„å‡ºæ¥çš„å¯„å­˜å™¨æ“ä½œï¼Œå°±å®ç°å¯¹ç¡¬ä»¶å±‚çš„å¯„å­˜å™¨æ“ä½œã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748static int rtc_drv_init(void)&#123; dev_t devid; printk(KERN_INFO\"%s OK.\\n\",__func__); if(alloc_chrdev_region(&amp;devid, 0, TI_RTC_CNT, \"ti_rtc\") &lt; 0) &#123; printk(KERN_INFO\"%s ERROR.\\n\",__func__); goto error; &#125; major = MAJOR(devid); cdev_init(&amp;rtc_cdev, &amp;rtc_fops); cdev_add(&amp;rtc_cdev, devid, TI_RTC_CNT); rtc_cls = class_create(THIS_MODULE, \"ti_rtc\"); device_create(rtc_cls, NULL, MKDEV(major, 0), NULL, \"ti_rts0\"); PRCM_CM_RTC_CLKSTCTRL = ioremap(0x44DF8500+0x00, 0x04*1); PRCM_CM_RTC_CLKCTRL = ioremap(0x44DF8500+0x20, 0x04*1); RTCSS_BASE = ioremap(0x44E3E000, 0xA0); RTCSS_SECONDS = RTCSS_BASE + 0; RTCSS_MINUTES = RTCSS_BASE + 1; RTCSS_HOURS = RTCSS_BASE + 2; RTCSS_DAYS = RTCSS_BASE + 3; RTCSS_WEEKS = RTCSS_BASE + 4; RTCSS_MONTHS = RTCSS_BASE + 5; RTCSS_YEARS = RTCSS_BASE + 6; RTCSS_ALARM_SECONDS = RTCSS_BASE + 8; RTCSS_ALARM_MINUTES = RTCSS_BASE + 9; RTCSS_ALARM_HOURS = RTCSS_BASE + 10; RTCSS_ALARM_DAYS = RTCSS_BASE + 11; RTCSS_ALARM_MONTHS = RTCSS_BASE + 12; RTCSS_ALARM_YEARS = RTCSS_BASE + 13; RTCSS_CTRL = RTCSS_BASE + 15; RTCSS_OSC = RTCSS_BASE + 20; RTCSS_KICK0R = RTCSS_BASE + 25; RTCSS_KICK1R = RTCSS_BASE + 26; error: unregister_chrdev_region(MKDEV(major, 0), TI_RTC_CNT); return 0;&#125; ç„¶åæ˜¯å‡ºå£å‡½æ•°ï¼Œæ³¨å†Œåšä»€ä¹ˆï¼Œè¿™é‡Œå°±åè¿‡æ¥åšä»€ä¹ˆã€‚æ¸…é™¤è®¾å¤‡ï¼Œæ¸…é™¤ç±»ï¼Œæ³¨é”€å­—ç¬¦è®¾å¤‡ï¼Œé‡Šæ”¾æ˜ å°„çš„å†…å­˜ã€‚1234567891011121314151617static void rtc_drv_exit(void)&#123; unsigned i; printk(KERN_INFO\"%s OK.\\n\",__func__); for(i=0;i&lt;TI_RTC_CNT;i++) &#123; device_destroy(rtc_cls, MKDEV(major, i)); &#125; class_destroy(rtc_cls); cdev_del(&amp;rtc_cdev); unregister_chrdev(major, \"ti_rtc\"); iounmap(PRCM_CM_RTC_CLKSTCTRL); iounmap(PRCM_CM_RTC_CLKCTRL); iounmap(RTCSS_BASE); &#125; ä¿®é¥°ä¸‹å…¥å£å‡½æ•°å’Œå‡ºå£å‡½æ•°ï¼Œè®©è¿™ä¸¤ä¸ªæ™®é€šå‡½æ•°ï¼Œèƒ½å¤Ÿé€šè¿‡insmodåŠ è½½çš„æ—¶å€™è¢«è°ƒç”¨ã€‚ä»¥åŠå¯¹è¯¥æ·»åŠ ç‰ˆæƒä¿¡æ¯ï¼Œé©±åŠ¨ä¿¡æ¯ç­‰ã€‚12345678module_init(rtc_drv_init);module_exit(rtc_drv_exit);MODULE_LICENSE(\"GPL\");MODULE_AUTHOR(\"hceng &lt;huangcheng.job@foxmail.com&gt;\");MODULE_DESCRIPTION(\"TI am437x board rtc drvice\");MODULE_ALIAS(\"character device:ti_rtc\");MODULE_VERSION(\"V1.0\"); 1.2å¡«å……æ„é€ å‡½æ•°è¿™é‡Œæ·»åŠ æ„é€ å‡½æ•°ï¼Œéœ€è¦ä»€ä¹ˆï¼ŒåŠ ä»€ä¹ˆï¼ŒåŠ äº†ä¹‹åï¼Œå†å»å®ç°ï¼Œåº”ç”¨å±‚å°±æ˜¯è°ƒç”¨åˆ°è¿™äº›å‡½æ•°çš„åŠŸèƒ½ã€‚è¿™é‡Œåªæ‰“å¼€è®¾å¤‡ã€è¯»å–å’Œè®¾ç½®æ—¶é—´æ“ä½œã€‚123456static struct file_operations rtc_fops = &#123; .owner = THIS_MODULE, .open = rtc_drv_open, .read = rtc_drv_read_time, .write = rtc_drv_set_time, &#125;; 1.3å®ç°æ„é€ å‡½æ•°ç°åœ¨å»å®ç°æ„é€ å‡½æ•°ã€‚è¿™éƒ¨åˆ†å’Œè£¸æœºçš„æ“ä½œæ˜¯ä¸€æ‘¸ä¸€æ ·çš„ï¼Œåœ¨open()å‡½æ•°é‡Œè¿›è¡Œåˆå§‹åŒ–ï¼Œåœ¨read()å‡½æ•°é‡Œå¯¹å¯„å­˜å™¨(æ˜ å°„åçš„)è¿›è¡Œè¯»å–ï¼Œä¼ è¾“ç»™åº”ç”¨å±‚ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647struct rtc_struct &#123; int year; int month; //int week; int day; int hour; int minute; int second;&#125;;static int rtc_drv_open(struct inode *inode, struct file *file)&#123; printk(KERN_INFO\"%s OK.\\n\",__func__); *PRCM_CM_RTC_CLKCTRL &amp;= ~(0x03&lt;&lt;0); *PRCM_CM_RTC_CLKCTRL |= (0x01&lt;&lt;1); *PRCM_CM_RTC_CLKSTCTRL &amp;= ~(0x03&lt;&lt;0); *RTCSS_CTRL &amp;= ~(0x01&lt;&lt;6); *RTCSS_KICK0R = (0x83E70B13); *RTCSS_KICK1R = (0x95A4F1E0); *RTCSS_OSC &amp;= ~(0x01&lt;&lt;3); *RTCSS_OSC |= (0x01&lt;&lt;6); *RTCSS_CTRL |= (0x01&lt;&lt;0); return 0; &#125;static ssize_t rtc_drv_read_time(struct file *file, char __user *user_buf, size_t size, loff_t *ppos)&#123; struct rtc_struct rtc_time; printk(KERN_INFO\"%s OK.\\n\",__func__); rtc_time.year = (((*RTCSS_YEARS &amp; (0x03&lt;&lt;4))&gt;&gt;4)*10 + (*RTCSS_YEARS &amp; (0x0F&lt;&lt;0))); rtc_time.month = (((*RTCSS_MONTHS &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (*RTCSS_MONTHS &amp; (0x0F&lt;&lt;0))); rtc_time.day = (((*RTCSS_DAYS &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (*RTCSS_DAYS &amp; (0x0F&lt;&lt;0))); rtc_time.hour = (((*RTCSS_HOURS &amp; (0x03&lt;&lt;4))&gt;&gt;4)*10 + (*RTCSS_HOURS &amp; (0x0F&lt;&lt;0))); rtc_time.minute = (((*RTCSS_MINUTES &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (*RTCSS_MINUTES &amp; (0x0F&lt;&lt;0))); rtc_time.second = (((*RTCSS_SECONDS &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (*RTCSS_SECONDS &amp; (0x0F&lt;&lt;0))); copy_to_user(user_buf, &amp;rtc_time, sizeof(rtc_time)); return 0; &#125; æ¥æ”¶åº”ç”¨å±‚çš„æ•°æ®ï¼Œå†™å…¥å¯„å­˜å™¨(æ˜ å°„åçš„)ï¼Œå®Œæˆå¯¹RTCçš„è®¾ç½®ã€‚å’Œè£¸æœºçš„æ“ä½œï¼Œæ˜¯ä¸€æ‘¸ä¸€æ ·çš„ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748static ssize_t rtc_drv_set_time(struct file *file, const char __user *user_buf, size_t count, loff_t * ppos)&#123; struct rtc_struct rtc_time; printk(KERN_INFO\"%s OK.\\n\",__func__); if(count != sizeof(rtc_time))&#123; printk(KERN_INFO\"write count != %d.\\n\",sizeof(rtc_time)); return 1; &#125; if (copy_from_user(&amp;rtc_time, user_buf, count)) return -EFAULT; *RTCSS_CTRL &amp;= ~(0x01&lt;&lt;0);//stop if((rtc_time.year-2000) &gt; 99 || (rtc_time.year-2000) &lt; 0) goto err; if(rtc_time.month &gt; 12 || rtc_time.month &lt; 0) goto err; *RTCSS_MONTHS = ((rtc_time.month/10) &lt;&lt; 4) | ((rtc_time.month%10) &lt;&lt; 0); if(rtc_time.day &gt; 32 || rtc_time.day &lt; 0) goto err; *RTCSS_DAYS = ((rtc_time.day/10) &lt;&lt; 4) | ((rtc_time.day%10) &lt;&lt; 0); if(rtc_time.hour &gt; 23 || rtc_time.hour &lt; 0) goto err; *RTCSS_HOURS = ((rtc_time.hour/10) &lt;&lt; 4) | ((rtc_time.hour%10) &lt;&lt; 0); if(rtc_time.minute &gt; 59 || rtc_time.minute &lt; 0) goto err; *RTCSS_MINUTES = ((rtc_time.minute/10) &lt;&lt; 4) | ((rtc_time.minute%10) &lt;&lt; 0); if(rtc_time.second &gt; 59 || rtc_time.second &lt; 0) goto err; *RTCSS_SECONDS = ((rtc_time.second/10) &lt;&lt; 4) | ((rtc_time.second%10) &lt;&lt; 0); *RTCSS_CTRL |= (0x01&lt;&lt;0);//start return 0; err: printk(KERN_INFO\"rtc_drv_set_time err.\\n\"); return 1; &#125; 1.4å®Œæ•´é©±åŠ¨ä»£ç [rtc_drv.c]link123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214#include &lt;linux/kernel.h&gt;#include &lt;linux/module.h&gt;#include &lt;linux/fs.h&gt;#include &lt;linux/init.h&gt;#include &lt;asm/uaccess.h&gt;#include &lt;asm/io.h&gt;#include &lt;linux/device.h&gt;#include &lt;linux/cdev.h&gt;#define TI_RTC_CNT 1int major;static struct cdev rtc_cdev;static struct class *rtc_cls;static volatile unsigned long *PRCM_CM_RTC_CLKCTRL = NULL; static volatile unsigned long *PRCM_CM_RTC_CLKSTCTRL = NULL; static volatile unsigned long *RTCSS_BASE = NULL;static volatile unsigned long *RTCSS_CTRL = NULL;static volatile unsigned long *RTCSS_KICK0R = NULL;static volatile unsigned long *RTCSS_KICK1R = NULL; static volatile unsigned long *RTCSS_OSC = NULL;static volatile unsigned long *RTCSS_YEARS = NULL; static volatile unsigned long *RTCSS_MONTHS = NULL;static volatile unsigned long *RTCSS_WEEKS = NULL; static volatile unsigned long *RTCSS_DAYS = NULL;static volatile unsigned long *RTCSS_HOURS = NULL; static volatile unsigned long *RTCSS_MINUTES = NULL;static volatile unsigned long *RTCSS_SECONDS = NULL; static volatile unsigned long *RTCSS_ALARM_YEARS = NULL; static volatile unsigned long *RTCSS_ALARM_MONTHS = NULL; static volatile unsigned long *RTCSS_ALARM_DAYS = NULL;static volatile unsigned long *RTCSS_ALARM_HOURS = NULL; static volatile unsigned long *RTCSS_ALARM_MINUTES = NULL;static volatile unsigned long *RTCSS_ALARM_SECONDS = NULL; struct rtc_struct &#123; int year; int month; //int week; int day; int hour; int minute; int second;&#125;;static int rtc_drv_open(struct inode *inode, struct file *file)&#123; printk(KERN_INFO\"%s OK.\\n\",__func__); *PRCM_CM_RTC_CLKCTRL &amp;= ~(0x03&lt;&lt;0); *PRCM_CM_RTC_CLKCTRL |= (0x01&lt;&lt;1); *PRCM_CM_RTC_CLKSTCTRL &amp;= ~(0x03&lt;&lt;0); *RTCSS_CTRL &amp;= ~(0x01&lt;&lt;6); *RTCSS_KICK0R = (0x83E70B13); *RTCSS_KICK1R = (0x95A4F1E0); *RTCSS_OSC &amp;= ~(0x01&lt;&lt;3); *RTCSS_OSC |= (0x01&lt;&lt;6); *RTCSS_CTRL |= (0x01&lt;&lt;0); return 0; &#125;static ssize_t rtc_drv_read_time(struct file *file, char __user *user_buf, size_t size, loff_t *ppos)&#123; struct rtc_struct rtc_time; printk(KERN_INFO\"%s OK.\\n\",__func__); rtc_time.year = (((*RTCSS_YEARS &amp; (0x03&lt;&lt;4))&gt;&gt;4)*10 + (*RTCSS_YEARS &amp; (0x0F&lt;&lt;0))); rtc_time.month = (((*RTCSS_MONTHS &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (*RTCSS_MONTHS &amp; (0x0F&lt;&lt;0))); rtc_time.day = (((*RTCSS_DAYS &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (*RTCSS_DAYS &amp; (0x0F&lt;&lt;0))); rtc_time.hour = (((*RTCSS_HOURS &amp; (0x03&lt;&lt;4))&gt;&gt;4)*10 + (*RTCSS_HOURS &amp; (0x0F&lt;&lt;0))); rtc_time.minute = (((*RTCSS_MINUTES &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (*RTCSS_MINUTES &amp; (0x0F&lt;&lt;0))); rtc_time.second = (((*RTCSS_SECONDS &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (*RTCSS_SECONDS &amp; (0x0F&lt;&lt;0))); copy_to_user(user_buf, &amp;rtc_time, sizeof(rtc_time)); return 0; &#125;static ssize_t rtc_drv_set_time(struct file *file, const char __user *user_buf, size_t count, loff_t * ppos)&#123; struct rtc_struct rtc_time; printk(KERN_INFO\"%s OK.\\n\",__func__); if(count != sizeof(rtc_time))&#123; printk(KERN_INFO\"write count != %d.\\n\",sizeof(rtc_time)); return 1; &#125; if (copy_from_user(&amp;rtc_time, user_buf, count)) return -EFAULT; *RTCSS_CTRL &amp;= ~(0x01&lt;&lt;0);//stop if((rtc_time.year-2000) &gt; 99 || (rtc_time.year-2000) &lt; 0) goto err; if(rtc_time.month &gt; 12 || rtc_time.month &lt; 0) goto err; *RTCSS_MONTHS = ((rtc_time.month/10) &lt;&lt; 4) | ((rtc_time.month%10) &lt;&lt; 0); if(rtc_time.day &gt; 32 || rtc_time.day &lt; 0) goto err; *RTCSS_DAYS = ((rtc_time.day/10) &lt;&lt; 4) | ((rtc_time.day%10) &lt;&lt; 0); if(rtc_time.hour &gt; 23 || rtc_time.hour &lt; 0) goto err; *RTCSS_HOURS = ((rtc_time.hour/10) &lt;&lt; 4) | ((rtc_time.hour%10) &lt;&lt; 0); if(rtc_time.minute &gt; 59 || rtc_time.minute &lt; 0) goto err; *RTCSS_MINUTES = ((rtc_time.minute/10) &lt;&lt; 4) | ((rtc_time.minute%10) &lt;&lt; 0); if(rtc_time.second &gt; 59 || rtc_time.second &lt; 0) goto err; *RTCSS_SECONDS = ((rtc_time.second/10) &lt;&lt; 4) | ((rtc_time.second%10) &lt;&lt; 0); *RTCSS_CTRL |= (0x01&lt;&lt;0);//start return 0; err: printk(KERN_INFO\"rtc_drv_set_time err.\\n\"); return 1; &#125;static struct file_operations rtc_fops = &#123; .owner = THIS_MODULE, .open = rtc_drv_open, .read = rtc_drv_read_time, .write = rtc_drv_set_time, &#125;;static int rtc_drv_init(void)&#123; dev_t devid; printk(KERN_INFO\"%s OK.\\n\",__func__); if(alloc_chrdev_region(&amp;devid, 0, TI_RTC_CNT, \"ti_rtc\") &lt; 0) &#123; printk(KERN_INFO\"%s ERROR.\\n\",__func__); goto error; &#125; major = MAJOR(devid); cdev_init(&amp;rtc_cdev, &amp;rtc_fops); cdev_add(&amp;rtc_cdev, devid, TI_RTC_CNT); rtc_cls = class_create(THIS_MODULE, \"ti_rtc\"); device_create(rtc_cls, NULL, MKDEV(major, 0), NULL, \"ti_rts0\"); PRCM_CM_RTC_CLKSTCTRL = ioremap(0x44DF8500+0x00, 0x04*1); PRCM_CM_RTC_CLKCTRL = ioremap(0x44DF8500+0x20, 0x04*1); RTCSS_BASE = ioremap(0x44E3E000, 0xA0); RTCSS_SECONDS = RTCSS_BASE + 0; RTCSS_MINUTES = RTCSS_BASE + 1; RTCSS_HOURS = RTCSS_BASE + 2; RTCSS_DAYS = RTCSS_BASE + 3; RTCSS_WEEKS = RTCSS_BASE + 4; RTCSS_MONTHS = RTCSS_BASE + 5; RTCSS_YEARS = RTCSS_BASE + 6; RTCSS_ALARM_SECONDS = RTCSS_BASE + 8; RTCSS_ALARM_MINUTES = RTCSS_BASE + 9; RTCSS_ALARM_HOURS = RTCSS_BASE + 10; RTCSS_ALARM_DAYS = RTCSS_BASE + 11; RTCSS_ALARM_MONTHS = RTCSS_BASE + 12; RTCSS_ALARM_YEARS = RTCSS_BASE + 13; RTCSS_CTRL = RTCSS_BASE + 15; RTCSS_OSC = RTCSS_BASE + 20; RTCSS_KICK0R = RTCSS_BASE + 25; RTCSS_KICK1R = RTCSS_BASE + 26; error: unregister_chrdev_region(MKDEV(major, 0), TI_RTC_CNT); return 0;&#125;static void rtc_drv_exit(void)&#123; unsigned i; printk(KERN_INFO\"%s OK.\\n\",__func__); for(i=0;i&lt;TI_RTC_CNT;i++) &#123; device_destroy(rtc_cls, MKDEV(major, i)); &#125; class_destroy(rtc_cls); cdev_del(&amp;rtc_cdev); unregister_chrdev(major, \"ti_rtc\"); iounmap(PRCM_CM_RTC_CLKSTCTRL); iounmap(PRCM_CM_RTC_CLKCTRL); iounmap(RTCSS_BASE); &#125;module_init(rtc_drv_init);module_exit(rtc_drv_exit);MODULE_LICENSE(\"GPL\");MODULE_AUTHOR(\"hceng &lt;huangcheng.job@foxmail.com&gt;\");MODULE_DESCRIPTION(\"TI am437x board rtc drvice\");MODULE_ALIAS(\"character device:ti_rtc\");MODULE_VERSION(\"V1.0\"); 1.5æµ‹è¯•ç¨‹åºåŠæ•ˆæœ[rtc_app.c]link12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970#include &lt;sys/types.h&gt;#include &lt;sys/stat.h&gt;#include &lt;fcntl.h&gt;#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;stdlib.h&gt;#define msleep(x) usleep(x*1000)/* * ./rtc_app w 2017 08 25 18 36 20 * ./rtc_app r [times]*/struct rtc_struct &#123; int year; int month; //int week; int day; int hour; int minute; int second;&#125;;struct rtc_struct set_time, rtc_time;int main(int argc, char **argv)&#123; int fd; int i; fd = open(\"/dev/ti_rts0\", O_RDWR); if (fd &lt; 0) &#123; printf(\"can't open /dev/ti_rts0.\\n\"); return 0; &#125; if(strcmp(argv[1], \"w\") == 0 &amp;&amp; argc == 8) &#123; set_time.year = atoi(argv[2]); set_time.month = atoi(argv[3]); set_time.day = atoi(argv[4]); set_time.hour = atoi(argv[5]); set_time.minute = atoi(argv[6]); set_time.second = atoi(argv[7]); write(fd, &amp;set_time, sizeof(set_time)); printf(\"write ok\\n\"); &#125; else if(strcmp(argv[1], \"r\") == 0) &#123; if(argv[2] == NULL) i = 999; else i = atoi(argv[2]); do&#123; read(fd, &amp;rtc_time, sizeof(rtc_time)); printf(\"\\n\\rcurrent_time is:\\n\\r\\%d-%d-%d %d:%d:%d\\n\\r\",\\ rtc_time.year+2000,rtc_time.month,rtc_time.day,rtc_time.hour,rtc_time.minute,rtc_time.second); printf(\"read ok\\n\"); msleep(1000); i--; &#125; while(i); &#125; close(fd); return 0;&#125; è¿™é‡Œé™¤äº†å¹´ï¼Œå…¶å®ƒéƒ½è¿˜OKï¼Œä¼°è®¡æ˜¯å’Œç³»ç»Ÿçš„ä¸€äº›è®¾ç½®å†²çªäº†ã€‚ 2.è¿˜ç®—æœ‰ç‚¹æ ‡å‡†çš„RTCé©±åŠ¨æœ¬æ¥è®¡åˆ’å®Œæ•´çš„å†™å¥½RTCé©±åŠ¨çš„ï¼Œå®é™…è¿‡ç¨‹ä¸­å‘ç°tiå®˜æ–¹å†…æ ¸çš„RTCä¸èƒ½å…³ï¼Œå…³äº†æ— æ³•æ­£å¸¸å¯åŠ¨ã€‚ç»éªŒä¸è¶³ï¼Œåˆæ— æ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªèƒ½åœ¨ä¿æŒä»–è¿œæ ·çš„åŸºç¡€ä¸Šï¼Œèƒ½å†™æˆä»€ä¹ˆç®—ä»€ä¹ˆã€‚å¤§éƒ¨åˆ†æ¡†æ¶ä¹Ÿç®—å†™äº†ï¼Œå‰©ä¸‹çš„æ„Ÿè§‰åº”è¯¥ä¹Ÿä¸éš¾äº†ã€‚è¿™æ¬¡ç”¨çš„è®¾å¤‡é©±åŠ¨æ¨¡å‹æ¥å†™çš„ã€‚ç”±rtc_dev.cå’Œrtc_drv.cç»„æˆã€‚ 2.1rtc_dev.cé¦–å…ˆæ˜¯åœ¨rtc_dev.cä¸­æ³¨å†Œå¹³å°è®¾å¤‡ï¼Œå¹¶è®¾ç½®ç¡¬ä»¶èµ„æºã€‚RTCæ‰€éœ€çš„ç¡¬ä»¶èµ„æºæ•™å°‘ï¼Œä¸»è¦æ˜¯RTCå¯„å­˜å™¨å’Œä¸­æ–­ã€‚12345678910111213141516171819202122static struct resource am437x_rtc_resource[] = &#123; [0] = &#123; .name = \"RTCSS\", .start = 0x44E3E000, .end = 0x44E3EFFF, .flags = IORESOURCE_MEM, &#125;, [1] = &#123; .name = \"RTCINT\", .start = 107, .end = 107, .flags = IORESOURCE_IRQ,//107 &#125;, [2] = &#123; .name = \"RTCALARMINT\", .start = 108, .end = 108, .flags = IORESOURCE_IRQ,//108 &#125;,&#125;; 2.2rtc_drv.crtc_drv.cå¼€å§‹è¦åšçš„ä¹Ÿå·®ä¸å¤šï¼Œæ³¨å†Œå¹³å°è®¾å¤‡ã€‚ç„¶åä¸¤ä¸ªåå­—ç›¸åŒï¼ŒåŒ¹é…æˆåŠŸåè°ƒç”¨probe()å‡½æ•°ã€‚è¿™é‡Œçš„probe()å…ˆè·å–rtc_dev.cé‡Œé¢çš„ä¸­æ–­å’ŒRTCç‰©ç†åŸºåœ°å€çš„èµ„æºã€‚éšå³æ˜ å°„RTCåŸºåœ°å€ã€‚åŒæ—¶åˆå§‹åŒ–RTCã€‚ç„¶åæ³¨å†ŒRTCè®¾å¤‡devm_rtc_device_register().è¿™é‡Œç»‘å®šçš„æ˜¯rtc_class_opsï¼Œè€Œä¸æ˜¯ä¹‹å‰çš„file_operationsã€‚è¿™é‡Œçš„rtc_class_opsæ˜¯ä¸ºRTCâ€œé‡èº«å®šåšâ€çš„æ“ä½œå‡½æ•°ï¼Œæ›´è®¾å¤‡RTCè®¾å¤‡ã€‚devm_rtc_device_register()é‡Œé¢çš„æ“ä½œä¹Ÿæ˜¯æ³¨å†Œå­—ç¬¦è®¾å¤‡é‚£ä¸€å¥—ï¼Œæœ¬è´¨è¿˜æ˜¯ä¸€æ ·çš„ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119static struct rtc_class_ops am437x_rtc_ops = &#123; .open = rtc_drv_open, .release = rtc_drv_release, .read_time = rtc_drv_read_time, .set_time = rtc_drv_set_time, .read_alarm = rtc_drv_read_alarm, .set_alarm = rtc_drv_set_alarm, .proc = rtc_drv_proc, .alarm_irq_enable = rtc_drv_alarm_irq_enable, &#125;; static void am437x_rtc_enable(struct platform_device *pdev, int en)&#123; void __iomem *rtc_base = am437x_rtc_base; unsigned int tmp; if (am437x_rtc_base == NULL) return; if (en) &#123; /* Enable the clock/module so that we can access the registers */ pm_runtime_get_sync(&amp;pdev-&gt;dev); //rtc init. tmp = readb(rtc_base + 0x40);//CTRL.Enable the RTC module writew(tmp &amp; ~(0x01&lt;&lt;6), rtc_base + 0x40); writel(0x83E70B13, rtc_base + 0x6C);//KICK0R.Write Project Disable writel(0x95A4F1E0, rtc_base + 0x70);//KICK1R tmp = readb(rtc_base + 0x54);//OSC.mode1:Internal clock writew(tmp &amp; ~(0x01&lt;&lt;3), rtc_base + 0x54); tmp = readb(rtc_base + 0x54); writew(tmp | (0x01&lt;&lt;6), rtc_base + 0x54); tmp = readb(rtc_base + 0x40);//run. writew(tmp | (0x01&lt;&lt;0), rtc_base + 0x40); &#125; else &#123; tmp = readb(rtc_base + 0x40);//stop. writew(tmp &amp; ~(0x01&lt;&lt;0), rtc_base + 0x40); tmp = readb(rtc_base + 0x40);//CTRL.Disable the RTC module writew(tmp | (0x01&lt;&lt;6), rtc_base + 0x40); /* Disable the clock/module */ pm_runtime_put_sync(&amp;pdev-&gt;dev); &#125;&#125;struct resource *am437x_rtc_mem;static int am437x_rtc_probe(struct platform_device *pdev) &#123; struct resource *res; int ret; printk(KERN_INFO\"%s OK.\\n\",__func__); /* find the IRQs */ am437x_rtc_timer_irq = platform_get_irq(pdev, 0); if (am437x_rtc_timer_irq &lt; 0) &#123; dev_err(&amp;pdev-&gt;dev, \"no irq for rtc tick\\n\"); return am437x_rtc_timer_irq; &#125; am437x_rtc_alarm_irq = platform_get_irq(pdev, 1); if (am437x_rtc_alarm_irq &lt; 0) &#123; dev_err(&amp;pdev-&gt;dev, \"no irq for alarm\\n\"); return am437x_rtc_alarm_irq; &#125; dev_dbg(&amp;pdev-&gt;dev, \"am437x_rtc: tick irq %d, alarm irq %d\\n\", am437x_rtc_timer_irq, am437x_rtc_alarm_irq); /*RTC*/ res = platform_get_resource(pdev, IORESOURCE_MEM, 0); if(res == NULL)&#123; dev_err(&amp;pdev-&gt;dev, \"RTC:failed to get memory regin resource.\\n\"); return -ENOENT; &#125; am437x_rtc_mem = request_mem_region(res-&gt;start, res-&gt;end - res-&gt;start+1, pdev-&gt;name); if (am437x_rtc_mem == NULL)&#123; dev_err(&amp;pdev-&gt;dev, \"RTC:failed to reserve memory region.\\n\"); return -ENOENT; goto err_nores; &#125; am437x_rtc_base = ioremap(res-&gt;start, res-&gt;end - res-&gt;start+1); if (am437x_rtc_mem == NULL)&#123; dev_err(&amp;pdev-&gt;dev, \"RTC:failed ioremap.\\n\"); return -EINVAL; goto err_nomap; &#125; am437x_rtc_enable(pdev, 1); rtc = devm_rtc_device_register(&amp;pdev-&gt;dev, pdev-&gt;name,&amp;am437x_rtc_ops, THIS_MODULE); if (IS_ERR(rtc)) &#123; pr_debug(\"%s: can't register RTC device, err %ld\\n\",pdev-&gt;name, PTR_ERR(rtc)); goto err_nortc; &#125; return 0; err_nortc: am437x_rtc_enable(pdev, 0); iounmap(am437x_rtc_base); err_nomap: release_resource(am437x_rtc_mem); err_nores: return ret;&#125; ç„¶åæ˜¯å¡«å……rtc_class_opsé‡Œé¢çš„æ“ä½œå‡½æ•°ï¼Œopen()æœ¬æ¥è®¡åˆ’ç”¨æ¥ç”³è¯·ä¸­æ–­çš„ï¼Œä½†ç”³è¯·çš„æ—¶å€™è¯´è¢«å ç”¨äº†ï¼Œè¿˜æ˜¯ä¹‹å‰æ²¡æœ‰å»æ‰å†…æ ¸RTCçš„åŸå› ã€‚è¿™é‡Œå°±å…ˆå±è”½äº†ã€‚read_time()å’Œset_time()é‡Œé¢è¿˜æ˜¯è¯»å–/è®¾ç½®å¯„å­˜å™¨ã€‚alarmçš„ä¹Ÿå·®ä¸å¤šï¼Œæ²¡æœ‰ä¸­æ–­ï¼Œå°±å…ˆæç½®äº†ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143static int rtc_drv_open(struct device *dev)&#123; struct platform_device *pdev = to_platform_device(dev); struct rtc_device *rtc_dev = platform_get_drvdata(pdev); int ret; printk(KERN_INFO\"%s OK.\\n\",__func__);/* if (devm_request_irq(&amp;pdev-&gt;dev, am437x_rtc_timer_irq, rtc_irq, 0, dev_name(&amp;rtc-&gt;dev), rtc)) &#123; pr_debug(\"%s: RTC timer interrupt IRQ%d already claimed\\n\",pdev-&gt;name, am437x_rtc_timer_irq); goto fail0; &#125; if ((am437x_rtc_timer_irq != am437x_rtc_alarm_irq) &amp;&amp; (devm_request_irq(&amp;pdev-&gt;dev, am437x_rtc_alarm_irq, rtc_irq, 0, dev_name(&amp;rtc-&gt;dev), rtc))) &#123; pr_debug(\"%s: RTC alarm interrupt IRQ%d already claimed\\n\",pdev-&gt;name, am437x_rtc_alarm_irq); goto fail0; &#125;*/ return 0;fail0: return -EIO;&#125;static int rtc_drv_release(struct device *dev)&#123; printk(KERN_INFO\"%s OK.\\n\",__func__); return 0;&#125;static int tm2bcd(struct rtc_time *tm)&#123; if (rtc_valid_tm(tm) != 0) return -EINVAL; tm-&gt;tm_sec = bin2bcd(tm-&gt;tm_sec); tm-&gt;tm_min = bin2bcd(tm-&gt;tm_min); tm-&gt;tm_hour = bin2bcd(tm-&gt;tm_hour); tm-&gt;tm_mday = bin2bcd(tm-&gt;tm_mday); tm-&gt;tm_mon = bin2bcd(tm-&gt;tm_mon + 1); /* epoch == 1900 */ if (tm-&gt;tm_year &lt; 100 || tm-&gt;tm_year &gt; 199) return -EINVAL; tm-&gt;tm_year = bin2bcd(tm-&gt;tm_year - 100); return 0;&#125;static void bcd2tm(struct rtc_time *tm)&#123; tm-&gt;tm_sec = bcd2bin(tm-&gt;tm_sec); tm-&gt;tm_min = bcd2bin(tm-&gt;tm_min); tm-&gt;tm_hour = bcd2bin(tm-&gt;tm_hour); tm-&gt;tm_mday = bcd2bin(tm-&gt;tm_mday); tm-&gt;tm_mon = bcd2bin(tm-&gt;tm_mon) - 1; /* epoch == 1900 */ tm-&gt;tm_year = bcd2bin(tm-&gt;tm_year) + 2000;&#125;static void rtc_wait_not_busy(void)&#123; int count = 0; u8 status; /* BUSY may stay active for 1/32768 second (~30 usec) */ for (count = 0; count &lt; 50; count++) &#123; status = readb(am437x_rtc_base + 0x44);//STS if ((status &amp; (0x01&lt;&lt;0)) == 0) break; udelay(1); &#125; /* now we have ~15 usec to read/write various registers */&#125;static int rtc_drv_read_time(struct device *dev, struct rtc_time *rtc_t)&#123; printk(KERN_INFO\"%s OK.\\n\",__func__); //local_irq_disable(); rtc_wait_not_busy(); rtc_t-&gt;tm_sec = readb(am437x_rtc_base + 0x00); rtc_t-&gt;tm_min = readb(am437x_rtc_base + 0x04); rtc_t-&gt;tm_hour = readb(am437x_rtc_base + 0x08); rtc_t-&gt;tm_mday = readb(am437x_rtc_base + 0x0C); rtc_t-&gt;tm_mon = readb(am437x_rtc_base + 0x10); rtc_t-&gt;tm_year = readb(am437x_rtc_base + 0x14); //local_irq_enable(); bcd2tm(rtc_t); printk(\"\\n\\rcurrent_time is:\\n\\r\\%d-%d-%d %d:%d:%d\\n\\r\",\\ rtc_t-&gt;tm_year,rtc_t-&gt;tm_mon,rtc_t-&gt;tm_mday,rtc_t-&gt;tm_hour,rtc_t-&gt;tm_min,rtc_t-&gt;tm_sec); return 0;&#125;static int rtc_drv_set_time(struct device *dev, struct rtc_time *rtc_t)&#123; if (tm2bcd(rtc_t) &lt; 0) return -EINVAL; //local_irq_disable(); rtc_wait_not_busy(); writeb(rtc_t-&gt;tm_sec, am437x_rtc_base + 0x00); writeb(rtc_t-&gt;tm_min, am437x_rtc_base + 0x04); writeb(rtc_t-&gt;tm_hour, am437x_rtc_base + 0x08); writeb(rtc_t-&gt;tm_mday, am437x_rtc_base + 0x0C); writeb(rtc_t-&gt;tm_mon, am437x_rtc_base + 0x10); writeb(rtc_t-&gt;tm_year, am437x_rtc_base + 0x14); //local_irq_enable(); return 0;&#125;static int rtc_drv_read_alarm(struct device *dev, struct rtc_wkalrm *alrm)&#123; printk(KERN_INFO\"%s OK.\\n\",__func__); return 0;&#125;static int rtc_drv_set_alarm(struct device *dev, struct rtc_wkalrm *alrm)&#123; printk(KERN_INFO\"%s OK.\\n\",__func__); return 0;&#125;static int rtc_drv_proc(struct device *dev, struct seq_file *seq)&#123; printk(KERN_INFO\"%s OK.\\n\",__func__); return 0;&#125;static int rtc_drv_alarm_irq_enable(struct device *dev, unsigned int enabled)&#123; printk(KERN_INFO\"%s OK.\\n\",__func__); return 0;&#125; 2.3ç›¸å…³ä»£ç åŠæµ‹è¯•æ•ˆæœrtc_dev.crtc_drv.cåœ¨ç³»ç»Ÿè¾“å…¥hwclock -f /dev/rtc1 3.æ­£å¸¸çš„æµ‹è¯•é©±åŠ¨é¢ï¼Œè™½ç„¶æ²¡æœ‰æ­£å¸¸è°ƒè¯•å‡ºRTCï¼Œä½†è¿˜æ˜¯è®°ä¸‹æ­£å¸¸è°ƒè¯•çš„æ–¹æ³•ï¼Œä¸‡ä¸€ä»¥åç”¨åˆ°äº†å‘¢ã€‚ Linuxä¸­æœ‰ä¸¤ä¸ªæ—¶é—´ï¼Œä¸€ä¸ªæ˜¯ç³»ç»Ÿæ—¶é—´ï¼Œé€šè¿‡å‘½ä»¤dateè·å–ï¼›ä¸€ä¸ªæ˜¯ç¡¬ä»¶æ—¶é—´ï¼Œé€šè¿‡å‘½ä»¤hwclockè·å–ï¼› RTCé©±åŠ¨çš„ä¸€èˆ¬æµ‹è¯•å¦‚ä¸‹ï¼š1.è·å–ç³»ç»Ÿæ—¶é—´1date å¦‚æœæ—¶é—´æ­£å¸¸ï¼Œåˆ™è¿›è¡Œç¬¬2æ­¥ï¼Œå¦‚æœä¸æ­£å¸¸ï¼Œä¿®æ”¹ç³»ç»Ÿæ—¶é—´ä¸ºæ­£å¸¸æ—¶é—´ï¼š1date 082316432017.00//2017-08-23 16:43:00 2.è·å–ç¡¬ä»¶æ—¶é—´1hwclock ç”±äºæ­¤å¤„æ˜¯RTCé©±åŠ¨ç¬¬ä¸€æ¬¡åŠ è½½ï¼Œè¿˜æ²¡è®¾ç½®æ­£ç¡®çš„æ—¶é—´ï¼Œæ‰€ä»¥æ­¤æ—¶æ˜¾ç¤ºçš„æ—¶é—´ï¼Œå¤šæ•°æ˜¯ä¸æ­£ç¡®çš„1970å¹´ã€‚ 3.åŒæ­¥ç¡¬ä»¶æ—¶é—´1hwclock -w ç¬¬ä¸€æ­¥è®¾ç½®å¥½äº†æ­£å¸¸çš„ç³»ç»Ÿæ—¶é—´ï¼Œç°åœ¨å°†ç³»ç»Ÿæ—¶é—´ä¸ç¡¬ä»¶æ—¶é—´è¿›è¡ŒåŒæ­¥ã€‚ 4.è‡ªåŠ¨åŒæ­¥ç¡¬ä»¶æ—¶é—´ç°åœ¨çš„ç³»ç»Ÿæ—¶é—´å’Œç¡¬ä»¶æ—¶é—´æ˜¯åŒæ­¥çš„ï¼Œå¦‚æœå…³æœºé‡å¯ï¼Œç³»ç»Ÿæ—¶é—´å°†ä¸ä¼šå®æ—¶åŒæ­¥ï¼Œè€Œç¡¬ä»¶æ—¶é—´æ˜¯ä¸€ç›´å®æ—¶åŒæ­¥çš„ï¼Œå› æ­¤éœ€è¦å°†ç¡¬ä»¶æ—¶é—´åŒæ­¥åˆ°ç³»ç»Ÿæ—¶é—´ã€‚ä¿®æ”¹å¯åŠ¨è„šæœ¬ï¼šetc/init.d/rcSï¼Œåœ¨æœ€åä¸€è¡ŒåŠ ä¸Šï¼š1/sbin/hwclock -s 4.éªŒè¯é‡å¯ï¼Œæ£€æŸ¥ç³»ç»Ÿæ—¶é—´å’Œç¡¬ä»¶æ—¶é—´æ˜¯ä¸æ˜¯å®æ—¶çš„ã€‚ æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"AM437X","slug":"AM437X","permalink":"http://yoursite.com/tags/AM437X/"},{"name":"Linuxé©±åŠ¨","slug":"Linuxé©±åŠ¨","permalink":"http://yoursite.com/tags/Linuxé©±åŠ¨/"}]},{"title":"AM437xâ€”â€”RTCè£¸æœº","date":"2017-08-23T08:46:58.000Z","path":"2017/08/23/AM437xâ€”â€”RTCè£¸æœº/","text":"AM437xçš„RTCæ¨¡å—è£¸æœºç¨‹åºã€‚ 0.ä¸ºä»€ä¹ˆè¦RTCåœ¨å®é™…å¼€å‘ä¸­ï¼Œå¾€å¾€éœ€è¦çŸ¥é“å½“å‰çš„æ—¶é—´ï¼Œæ¯”å¦‚ç°åœ¨çš„2017å¹´8æœˆ23æ—¥17ç‚¹02åˆ†ã€‚ç”±äºè®¾å¤‡ä¸ä½¿ç”¨çš„æ—¶å€™æˆ–è€…é‡åˆ°æ•…éšœæ—¶ï¼Œä¼šå‡ºç°å…³æœºæ“ä½œï¼Œè€Œå…³æœºçš„è¿™æ®µæ—¶é—´é•¿çŸ­ï¼Œè®¾å¤‡æ˜¯ä¸çŸ¥é“çš„ï¼Œå½“å†æ¬¡å¼€æœºæ—¶ï¼Œæ—¶é—´è¦ä¹ˆè¢«å½’é›¶ï¼Œè¦ä¹ˆæ˜¾ç¤ºä¸ºå…³æœºæ—¶çš„é‚£ä¸ªæ—¶é—´ã€‚ ä¸ºäº†åŒæ­¥åˆ°ç°åœ¨çš„å®æ—¶æ—¶é—´ï¼Œæˆ‘èƒ½æƒ³åˆ°ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆã€‚ 1.åˆ©ç”¨ç½‘ç»œï¼Œä»ç½‘ç»œä¸­è·å–å½“å‰æ—¶é—´ã€‚2.åˆ©ç”¨ä¸€ä¸ªè®¾å¤‡å…³æœºä»åœ¨è®¡æ—¶å·¥ä½œçš„æ¨¡å—ï¼Œå¼€æœºååŠ ä¸Šå…³æœºçš„è¿™æ®µæ—¶é—´ã€‚ ç¬¬ä¸€ä¸ªæ–¹æ¡ˆï¼Œéœ€è¦ç½‘ç»œï¼Œå¯¹äºå¤§å¤šæ•°å•ç‰‡æœºè®¾å¤‡æ˜¯ä¸ç°å®çš„ï¼Œé™„åŠ çš„æˆæœ¬å¤ªé«˜ã€‚ç¬¬äºŒä¸ªæ–¹æ¡ˆï¼Œå°±æ˜¯ç°åœ¨å¤§é‡ä½¿ç”¨çš„RTCï¼Œæœ‰çš„é›†æˆåˆ°SOCé‡Œé¢äº†ï¼Œæœ‰äº›ä»ä»¥å¤–éƒ¨èŠ¯ç‰‡çš„å½¢å¼å‡ºç°ã€‚ åœ¨è®¾å¤‡å…³æœºåï¼ŒRTCåœ¨å¤‡ç”¨ç”µæ± ï¼ˆä¸€èˆ¬æ˜¯çº½æ‰£ç”µæ± ï¼‰çš„æ”¯æŒä¸‹ï¼Œä»¥è¶…ä½åŠŸè€—çš„æ–¹å¼ç»§ç»­é»˜é»˜çš„å·¥ä½œï¼Œç›´åˆ°å¼€æœºï¼Œå°†æ—¶é—´åŒæ­¥ã€‚ è¿™å°±æ˜¯RTCå­˜åœ¨çš„ä¸»è¦æ„ä¹‰ã€‚ 1.AM437xçš„RTCAM437xçš„RTCä»‹ç»åœ¨å‚è€ƒæ‰‹å†Œ19ç« Timersçš„ç¬¬4éƒ¨åˆ†ï¼šReal-Time Clock (RTC)å¤§è‡´çš„ç‰¹æ€§æœ‰ï¼š æ€»è®¡æ•°æ—¶é—´ä¸º100å¹´ï¼› æä¾›ç§’ã€åˆ†ã€å°æ—¶ã€æ˜ŸæœŸã€æ—¥æœŸã€æœˆä»½ã€å¹´ç­‰ï¼› æ•°æ®ä»¥Binary-coded-decimal (BCD)è¡¨ç¤ºï¼› æ—¶é’Ÿæºå¯é€‰æ‹©å†…éƒ¨æˆ–å¤–éƒ¨ï¼› æœ‰ä¸¤ä¸ªé—¹é’Ÿï¼› æœ‰ä¸¤ç§ä¸­æ–­ï¼šæ—¶é—´ä¸­æ–­å’Œé—¹é’Ÿä¸­æ–­ï¼› å¾ˆè‰¯å¿ƒçš„æœ‰ä¸ªUse Casesï¼š The following list includes high-level steps to start using the RTC: Enable the module clock domains (for details on which clock domain, see Section 19.4.2, Integration). Enable the RTC module using CTRL_REG.RTC_disable. Enable the 32K clock from PER PLL, if using the internal RTC oscillator. Write to the kick registers (KICK0R, KICK1R) in the RTC. Configure the timer in RTCSS for desired application (set time and date, alarm wakeup, and so on). Start the RTC (in CTRL_REG.STOP_RTC). åŸºæœ¬æŠŠé…ç½®æ­¥éª¤å†™å¾—å¾ˆæ¸…æ¥šäº†ã€‚ å…³äºæ—¶é’Ÿå’Œä¸­æ–­ï¼šæ—¶é’Ÿæ¥è‡ªäºå¤–éƒ¨CLKIN32çš„CLK_32K_RTCæˆ–è€…å†…éƒ¨PRCMçš„CLK_32KHzï¼›å¯ä»¥äº§ç”Ÿä¸¤ç§ä¸­æ–­ï¼štimer_intr_pendå’Œalarm_intr_pendã€‚ å…³äºå†™ä¿æŠ¤å¦‚å›¾ä¸­çš„ä¸‰ä¸ªçŠ¶æ€ï¼Œå‘KICK0å’ŒKICK1å†™å…¥æŒ‡å®šçš„å€¼ï¼Œå³å¯å»å†™ä¿æŠ¤ã€‚ 2.RTCç¼–ç¨‹æœ¬æ¬¡è£¸æœºçš„ç›®çš„ï¼Œæ˜¯æƒ³å®ç°ä»¥ä¸‹ä¸¤ä¸ªåŠŸèƒ½ï¼š è®¾ç½®å’Œè¯»å–RTCçš„æ—¶é—´ï¼› è®¾ç½®å’Œè¯»å–RTCé—¹é’Ÿçš„æ—¶é—´ï¼Œåˆ©ç”¨ä¸­æ–­æ‰“å°é—¹é’Ÿï¼› æ¨¡å—åˆå§‹åŒ–ï¼šåŒ…å«æ—¶é’Ÿä½¿èƒ½ã€æ¨¡å—ä½¿èƒ½ã€æ—¶é’Ÿæºé€‰æ‹©ã€ä¸­æ–­æ³¨å†Œã€ä½¿èƒ½ä¸­æ–­ã€‚1234567891011121314151617181920212223242526272829303132333435363738void rtc_init(void)&#123; //1.set performing the System Clock configuration for RTC. PRCM_CM_RTC_CLKCTRL &amp;= ~(0x3&lt;&lt;0); PRCM_CM_RTC_CLKCTRL |= (0x01&lt;&lt;1); PRCM_CM_RTC_CLKSTCTRL &amp;= ~(0x3&lt;&lt;0); //Wait write is completed. while(!(PRCM_CM_RTC_CLKSTCTRL &amp; (0x01&lt;&lt;9 | 0x01&lt;&lt;8))); while(PRCM_CM_RTC_CLKCTRL &amp; (0x03&lt;&lt;16)); //2.Enable the RTC module; RTCSS-&gt;CTRL &amp;= ~(0x01&lt;&lt;6); //3.Write Project Disable; RTCSS-&gt;KICK0R = (0x83E70B13); RTCSS-&gt;KICK1R = (0x95A4F1E0); //4.Set clock Source; //mode1:Internal clock RTCSS-&gt;OSC &amp;= ~(0x01&lt;&lt;3); RTCSS-&gt;OSC |= (0x01&lt;&lt;6); //mode2:External clock //RTCSS-&gt;OSC &amp;= ~(0x01&lt;&lt;3); //RTCSS-&gt;OSC |= (0x01&lt;&lt;6 | 0x01&lt;&lt;3); register_irq(RTCALARMINT, alarm_irq); interrupt_init(RTCALARMINT); //5.Enable interrupt; rtc_int_enalbe(); //6.Run. //rtc_start();&#125; è¿™é‡Œå°†ä¸­æ–­çš„ä½¿èƒ½/å»èƒ½ã€RTCçš„å¯åŠ¨/åœæ­¢ï¼Œåˆ†åˆ«å°è£…æˆäº†å‡½æ•°ã€‚12345678910111213141516171819void rtc_start(void)&#123; RTCSS-&gt;CTRL |= (0x01&lt;&lt;0);&#125;void rtc_stop(void)&#123; RTCSS-&gt;CTRL &amp;= ~(0x01&lt;&lt;0);&#125;static void rtc_int_enalbe(void)&#123; RTCSS-&gt;INTRS |= (0x01&lt;&lt;3);//RTC_ALARM1&#125;static void rtc_int_clear(void)&#123; RTCSS-&gt;STS |= (0x01&lt;&lt;6);;//RTC_ALARM1&#125; è®¾ç½®æ—¶é—´å’Œè·å–æ—¶é—´ï¼šå°†æ‰€æœ‰æ—¶é—´å‚æ•°å°è£…æˆä¸€ä¸ªç»“æ„ä½“ï¼š1234567891011struct rtc_struct &#123; int year; int month; int week; int day; int hour; int minute; int second;&#125;;extern struct rtc_struct rtc_time, rtc_alarm; è®¾ç½®æ—¶é—´ä¸»è¦æ˜¯å°†å€¼åˆ†è§£æˆBCDçš„æ ¼å¼ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859int set_time(struct rtc_struct rtc_time)&#123; rtc_stop(); if((rtc_time.year-2000) &gt; 99 || (rtc_time.year-2000) &lt; 0) goto err; RTCSS-&gt;YEARS = (((rtc_time.year-2000)/10) &lt;&lt; 4) | (((rtc_time.year-2000)%10) &lt;&lt; 0); if(rtc_time.month &gt; 12 || rtc_time.month &lt; 0) goto err; RTCSS-&gt;MONTHS = ((rtc_time.month/10) &lt;&lt; 4) | ((rtc_time.month%10) &lt;&lt; 0); if(rtc_time.week &gt; 7 || rtc_time.week &lt; 0) //goto err; rtc_time.week = 1; RTCSS-&gt;WEEKS = rtc_time.week; if(rtc_time.day &gt; 32 || rtc_time.day &lt; 0) goto err; RTCSS-&gt;DAYS = ((rtc_time.day/10) &lt;&lt; 4) | ((rtc_time.day%10) &lt;&lt; 0); if(rtc_time.hour &gt; 23 || rtc_time.hour &lt; 0) goto err; RTCSS-&gt;HOURS = ((rtc_time.hour/10) &lt;&lt; 4) | ((rtc_time.hour%10) &lt;&lt; 0); if(rtc_time.minute &gt; 59 || rtc_time.minute &lt; 0) goto err; RTCSS-&gt;MINUTES = ((rtc_time.minute/10) &lt;&lt; 4) | ((rtc_time.minute%10) &lt;&lt; 0); if(rtc_time.second &gt; 59 || rtc_time.second &lt; 0) goto err; RTCSS-&gt;SECONDS = ((rtc_time.second/10) &lt;&lt; 4) | ((rtc_time.second%10) &lt;&lt; 0); rtc_start(); return 0; err: printf(\"set_time err.\\n\\r\"); return 1;&#125;struct rtc_struct get_time(void)&#123; struct rtc_struct current_time; current_time.year = (((RTCSS-&gt;YEARS &amp; (0x03&lt;&lt;4))&gt;&gt;4)*10 + (RTCSS-&gt;YEARS &amp; (0x0F&lt;&lt;0))); current_time.month = (((RTCSS-&gt;MONTHS &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (RTCSS-&gt;MONTHS &amp; (0x0F&lt;&lt;0))); current_time.week = ( RTCSS-&gt;WEEKS &amp; (0x0F&lt;&lt;0)); current_time.day = (((RTCSS-&gt;DAYS &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (RTCSS-&gt;DAYS &amp; (0x0F&lt;&lt;0))); current_time.hour = (((RTCSS-&gt;HOURS &amp; (0x03&lt;&lt;4))&gt;&gt;4)*10 + (RTCSS-&gt;HOURS &amp; (0x0F&lt;&lt;0))); current_time.minute = (((RTCSS-&gt;MINUTES &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (RTCSS-&gt;MINUTES &amp; (0x0F&lt;&lt;0))); current_time.second = (((RTCSS-&gt;SECONDS &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (RTCSS-&gt;SECONDS &amp; (0x0F&lt;&lt;0))); printf(\"\\n\\rcurrent_time is:\\n\\r\\%d-%d-%d %d:%d:%d\\n\\r\",\\current_time.year+2000,current_time.month,current_time.day,current_time.hour,current_time.minute,current_time.second); return current_time;&#125; è®¾ç½®é—¹é’Ÿå’Œè·å–é—¹é’Ÿï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849int set_alarm(struct rtc_struct alarm_time)&#123; if((alarm_time.year-2000) &gt; 99 || (alarm_time.year-2000) &lt; 0) goto err; RTCSS-&gt;ALARM_YEARS = (((alarm_time.year-2000)/10) &lt;&lt; 4) | (((alarm_time.year-2000)%10) &lt;&lt; 0); if(alarm_time.month &gt; 12 || alarm_time.month &lt; 0) goto err; RTCSS-&gt;ALARM_MONTHS = ((alarm_time.month/10) &lt;&lt; 4) | ((alarm_time.month%10) &lt;&lt; 0); if(alarm_time.day &gt; 32 || alarm_time.day &lt; 0) goto err; RTCSS-&gt;ALARM_DAYS = ((alarm_time.day/10) &lt;&lt; 4) | ((alarm_time.day%10) &lt;&lt; 0); if(alarm_time.hour &gt; 23 || alarm_time.hour &lt; 0) goto err; RTCSS-&gt;ALARM_HOURS = ((alarm_time.hour/10) &lt;&lt; 4) | ((alarm_time.hour%10) &lt;&lt; 0); if(alarm_time.minute &gt; 59 || alarm_time.minute &lt; 0) goto err; RTCSS-&gt;ALARM_MINUTES = ((alarm_time.minute/10) &lt;&lt; 4) | ((alarm_time.minute%10) &lt;&lt; 0); if(alarm_time.second &gt; 59 || alarm_time.second &lt; 0) goto err; RTCSS-&gt;ALARM_SECONDS = ((alarm_time.second/10) &lt;&lt; 4) | ((alarm_time.second%10) &lt;&lt; 0); return 0; err: printf(\"set_alarm err.\\n\\r\"); return 1;&#125;struct rtc_struct get_alarm(void)&#123; struct rtc_struct alarm_time; alarm_time.year = (((RTCSS-&gt;ALARM_YEARS &amp; (0x03&lt;&lt;4))&gt;&gt;4)*10 + (RTCSS-&gt;ALARM_YEARS &amp; (0x0F&lt;&lt;0))); alarm_time.month = (((RTCSS-&gt;ALARM_MONTHS &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (RTCSS-&gt;ALARM_MONTHS &amp; (0x0F&lt;&lt;0))); alarm_time.day = (((RTCSS-&gt;ALARM_DAYS &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (RTCSS-&gt;ALARM_DAYS &amp; (0x0F&lt;&lt;0))); alarm_time.hour = (((RTCSS-&gt;ALARM_HOURS &amp; (0x03&lt;&lt;4))&gt;&gt;4)*10 + (RTCSS-&gt;ALARM_HOURS &amp; (0x0F&lt;&lt;0))); alarm_time.minute = (((RTCSS-&gt;ALARM_MINUTES &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (RTCSS-&gt;ALARM_MINUTES &amp; (0x0F&lt;&lt;0))); alarm_time.second = (((RTCSS-&gt;ALARM_SECONDS &amp; (0x07&lt;&lt;4))&gt;&gt;4)*10 + (RTCSS-&gt;ALARM_SECONDS &amp; (0x0F&lt;&lt;0))); printf(\"\\n\\ralarm_time is:\\n\\r\\%d-%d-%d %d:%d:%d\\n\\r\",\\ alarm_time.year+2000,alarm_time.month,alarm_time.day,alarm_time.hour,alarm_time.minute,alarm_time.second); return alarm_time;&#125; ä¸­æ–­æœåŠ¡å‡½æ•°12345void alarm_irq(void)&#123; rtc_int_clear(); printf(\"\\n\\r----------------alarm_irq-----------------\\n\\r\");&#125; ä¸»å‡½æ•°123456789101112131415161718192021222324252627282930313233343536373839404142int main()&#123; rtc_time.year = 2017; rtc_time.month = 8; //rtc_time.week = 1; rtc_time.day = 24; rtc_time.hour = 10; rtc_time.minute = 42; rtc_time.second = 15; rtc_alarm.year = 2017; rtc_alarm.month = 8; rtc_alarm.day = 24; rtc_alarm.hour = 10; rtc_alarm.minute = 42; rtc_alarm.second = 20; uart_init(); printf(\"init ok.\\n\\r\"); gic_init(); timer2_init(); rtc_init(); set_time(rtc_time); set_alarm(rtc_alarm); printf(\"=====set time and alarm is:=====\\n\\r\"); get_time(); get_alarm(); printf(\"================================\\n\\r\"); while(1) &#123; delay_ms(1000); get_time(); &#125; return 0;&#125; 3.å®æµ‹ä¸æºç BUG:ä¸Šç”µåï¼Œset_alarm()æ˜¯æ²¡é—®é¢˜çš„ï¼Œset_time()æ˜¾ç¤ºæ²¡æœ‰è®¾ç½®æˆåŠŸï¼Œè¿™æ—¶æŒ‰é”®å¤ä½é‡å¯ä¸€ä¸‹ï¼Œå‘ç°è¿™æ—¶å°±è®¾ç½®æˆåŠŸäº†ã€‚ = = ? æºç â€”â€”&gt;GitHub 4.å¿ƒå¾—RTCæ„Ÿè§‰è¿˜æ˜¯æ¯”è¾ƒé‡è¦ï¼Œèƒ½å¤Ÿå®ç°å¾—åˆ°å®æ—¶çš„æ—¶é—´ã€‚æ•´ä¸ªè¿‡ç¨‹ï¼Œç¨å¾®éœ€è¦æ³¨æ„ç‚¹çš„å°±æ˜¯BCDçš„è½¬æ¢ï¼Œå®¹æ˜“å¼„é”™ã€‚ æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"AM437X","slug":"AM437X","permalink":"http://yoursite.com/tags/AM437X/"},{"name":"è£¸æœº","slug":"è£¸æœº","permalink":"http://yoursite.com/tags/è£¸æœº/"}]},{"title":"AM437xâ€”â€”LEDé©±åŠ¨","date":"2017-08-12T08:06:46.000Z","path":"2017/08/12/AM437xâ€”â€”LEDé©±åŠ¨/","text":"æœ¬æ–‡ä¸»è¦è®°å½•AM437Xé©±åŠ¨çš„LEDã€‚å«ç®€å•çš„å­—ç¬¦è®¾å¤‡é©±åŠ¨ã€è®¾å¤‡é©±åŠ¨æ¨¡å‹ã€è®¾å¤‡æ ‘ä»¥åŠLEDå­ç³»ç»Ÿã€‚ ç›®å‰å°±Linuxé©±åŠ¨çš„ç†è§£æ˜¯ï¼š Linuxé©±åŠ¨ = è£¸æœº + æ¡†æ¶ å…³äºæ¡†æ¶ï¼Œç›®å‰çš„ç†è§£æ˜¯ï¼š ä»¥LEDé©±åŠ¨ä¸ºä¾‹ï¼Œä¹‹å‰å°è±¡ä¸­å°±æ˜¯éŸ¦è€å¤§çš„æ€è·¯ï¼Œç°åœ¨inité‡Œæ³¨å†Œã€ç¡¬ä»¶åˆå§‹åŒ–ï¼Œç„¶ååº”ç”¨å±‚open()ã€read()å°±è°ƒç”¨äº†file_operationsé‡Œé¢çš„drv_open()ã€drv_write()ç­‰ï¼Œç®—æ˜¯æœ€ç®€å•çš„é©±åŠ¨æ¡†æ¶ã€‚ç„¶åéŸ¦è€å¤§åˆæåŠäº†æ€»çº¿è®¾å¤‡é©±åŠ¨æ¨¡å‹ï¼Œå°†è®¾å¤‡å’Œé©±åŠ¨åˆ†ç¦»ï¼Œæ„Ÿå—åˆ°äº†æ–°çš„æ¡†æ¶ã€‚ä¸ä¹…å‰ï¼Œç®€å•æ¥è§¦äº†ä¸‹è®¾å¤‡æ ‘ï¼Œæ„Ÿè§‰å°±æ˜¯æ€»çº¿è®¾å¤‡é©±åŠ¨æ¨¡å‹çš„ä¿®æ”¹ï¼ˆå‡çº§ï¼‰ï¼Œå°†åŸæ¥çš„è®¾å¤‡éƒ¨åˆ†ï¼Œä¸å†å•ç‹¬æ”¾åœ¨ä»£ç é‡Œï¼Œè€Œæ˜¯æ”¾åœ¨dtsé‡Œé¢ï¼Œå¼€æœºåŠ è½½ï¼Œç„¶åé©±åŠ¨åŒ¹é…è·å–ç¡¬ä»¶èµ„æºã€‚å› æ­¤ï¼Œæ„Ÿè§‰é©±åŠ¨çš„æ¡†æ¶åœ¨ä¸€æ­¥ä¸€æ­¥çš„å‘å±•ï¼Œä¼˜åŒ–ï¼Œæœ€åŸå§‹çš„æ³¨å†Œã€openç­‰æ¡†æ¶ï¼Œè¿˜æ˜¯ä¸å˜ã€‚åŒæ—¶ï¼Œäº†è§£åˆ°äº†é™¤è¾“å…¥å­ç³»ç»Ÿçš„å…¶å®ƒå­ç³»ç»Ÿï¼ŒåŠ æ·±äº†å¯¹è¿™ä¸€æ¨¡å¼çš„ç†è§£ã€‚æ„Ÿè§‰å°±æ˜¯ï¼Œå°†æŸä¸ªç¡¬ä»¶èµ„æºæ— ç¼çš„èå…¥ç°æœ‰çš„ç¯å¢ƒä¸­ï¼Œè€Œæ— é¡»æ”¹å˜åº”ç”¨å±‚çš„ç¨‹åºã€‚ è¿™å°±æ˜¯ç›®å‰çš„ä¸€ç‚¹å°å°ç†è§£å§ï¼Œç®—æ˜¯æ‰“å¼€äº†ä¸ªå…¥å£ï¼Œå¸Œæœ›ä»¥åäº†è§£å¾—æ›´åŠ å…¨é¢ã€ç»†è‡´ã€‚ 1.æ­å»ºå¼€å‘ç¯å¢ƒ1.1å®‰è£…TI_SDKå…ˆåœ¨TIå®˜ç½‘ä¸‹è½½ti-processor-sdk-linux-am437x-evm-01.00.00.03-Linux-x86-Install.binåœ¨Ubuntuï¼ˆonly Ubuntu 12.04 LTS and Ubuntu 14.04 LTS are supportedï¼‰ä¸‹ï¼Œå¯¹è¯¥æ–‡ä»¶åŠ å…¥å¯æ‰§è¡Œæƒé™ï¼Œç„¶åç›´æ¥è¿è¡Œã€‚å®‰è£…ç›®å½•é€‰æ‹©é»˜è®¤å³å¯ã€‚å®Œæˆä¹‹åï¼Œä¾¿åœ¨å½“å‰ç”¨æˆ·çš„homeç›®å½•ç”Ÿæˆäº†æ‰€æœ‰æ‰€éœ€æ–‡ä»¶ã€‚ 1.2ç¼–è¯‘å†…æ ¸åœ¨å½“å‰ç”Ÿæˆti-processor-sdk-linux-am437x-evm-01.00.00.03ç›®å½•ä¸‹ï¼Œæœ‰ä¸ªMakefileï¼Œæ‰“å¼€åå¯ä»¥çœ‹åˆ°ç›¸å…³çš„ç¼–è¯‘é€‰é¡¹ï¼Œå¦‚ï¼š ç¼–è¯‘å…¨éƒ¨æ–‡ä»¶ï¼šmake all ç¼–è¯‘å†…æ ¸ï¼šmake linux ç¼–è¯‘u-boot:make u-boot-spl ä»¥åŠmakeçš„ä¾èµ–ï¼š-include Rules.makeã€‚åœ¨æœ¬å±‚ç›®å½•é‡Œï¼Œæ‰“å¼€Rules.makeï¼Œå¯ä»¥çŸ¥é“å†…æ ¸çš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼š12#defconfigDEFCONFIG=tisdk_am437x-evm_defconfig é€šè¿‡æŸ¥æ‰¾ï¼Œtisdk_am437x-evm_defconfigåœ¨~/ti-processor-sdk-linux-am437x-evm-01.00.00.03/board-support/linux-3.14.43+gitAUTOINC+875c69b2c3-g875c69b/arch/arm/configsé‡Œã€‚è¿™é‡Œé€šè¿‡ä¿®æ”¹è¯¥é…ç½®æ–‡ä»¶ï¼Œç„¶åé‡æ–°ç¼–è¯‘å†…æ ¸ï¼Œå³å¯å…³é—­ç³»ç»ŸLEDç›¸å…³çš„é©±åŠ¨ï¼Œåœ¨åé¢è‡ªå·±å†™LEDé©±åŠ¨æ—¶ï¼Œé˜²æ­¢äº’ç›¸å¹²æ‰°ã€‚å› æ­¤å°†tisdk_am437x-evm_defconfigé…ç½®æ–‡ä»¶é‡Œçš„æ‰€æœ‰æœ‰å…³LEDçš„é…ç½®éƒ½å…³é—­æ‰ã€‚ æœ€ååœ¨é¡¶å±‚ç›®å½•æ‰§è¡Œmake linux,ç¼–è¯‘å®Œæˆåï¼Œç”Ÿæˆ~/ti-processor-sdk-linux-am437x-evm-01.00.00.03/board-support/linux-3.14.43+gitAUTOINC+875c69b2c3-g875c69b/arch/arm/boot/zImageæ–‡ä»¶ã€‚ 1.3çƒ§å†™SDå¡å›åˆ°~/ti-processor-sdk-linux-am437x-evm-01.00.00.03/binä¸‹ï¼ŒTIåˆ¶ä½œäº†å¾ˆå¤šè„šæœ¬ï¼Œå…¶ä¸­çš„create-sdcard.shå°±æ˜¯åˆ¶ä½œSDå¡çš„ã€‚Ubuntuæ’ä¸ŠSDå¡ï¼Œç„¶ååˆ‡æ¢æˆrootç”¨æˆ·ï¼Œæ‰§è¡Œè¯¥è„šæœ¬ï¼Œæ ¹æ®æç¤ºä¸€è·¯é€‰æ‹©ä¸‹å»å³å¯ã€‚ è¿™é‡Œçƒ§å†™å®Œäº†ï¼Œæµ‹è¯•å‘ç°å¹¶æ²¡æœ‰ä½¿ç”¨ä¹‹å‰ç¼–è¯‘çš„å†…æ ¸ï¼Œåˆ†æè„šæœ¬åå‘ç°ï¼Œè¯¥è„šæœ¬ç›´æ¥ä½¿ç”¨çš„~/ti-processor-sdk-linux-am437x-evm-01.00.00.03/filesystemä¸‹çš„tisdk-rootfs-image-am437x-evm.tar.gzã€‚è„šæœ¬å°†è¯¥æ–‡ä»¶ä½œä¸ºæ ¹æ–‡ä»¶ç³»ç»Ÿæ”¾å…¥SDå¡ï¼Œå› æ­¤å¹¶æ²¡æœ‰ä½¿ç”¨ä¹‹å‰ç¼–è¯‘çš„å†…æ ¸ã€‚è§£å†³æ–¹æ³•è¦ä¹ˆåœ¨æ‰§è¡Œè„šæœ¬çš„è¿‡ç¨‹ä¸­æ ¹æ®æç¤ºè¾“å…¥ç›¸å…³çš„è·¯å¾„ï¼Œè¦ä¹ˆåœ¨åˆ¶ä½œå¥½SDå¡åï¼Œå°†ç¼–è¯‘å¥½çš„å†…æ ¸è¦†ç›–æ‰SDå¡çš„å†…æ ¸å³å¯ã€‚æˆ‘é€‰æ‹©çš„åè€…ï¼šcp ~/ti-processor-sdk-linux-am437x-evm-01.00.00.03/board-support/linux-3.14.43+gitAUTOINC+875c69b2c3-g875c69b/arch/arm/boot/zImage /media/hceng/rootfs/boot/ã€‚ æœ€åå°†åˆ¶ä½œå¥½çš„SDå¡æ’ä¸Šå¼€å‘æ¿å¯åŠ¨å³å¯ã€‚ 2.ç®€å•çš„å­—ç¬¦é©±åŠ¨å…ˆè®°å½•ä¸‹å‡ ä¸ªé‡è¦ç±»å‹æˆ–ç»“æ„ä½“ï¼š è¡¨ç¤ºè®¾å¤‡å·(32ä½æœºä¸­ï¼šé«˜12ä½è¡¨ç¤ºä¸»è®¾å¤‡å·ï¼Œä½20ä½è¡¨ç¤ºæ¬¡è®¾å¤‡å·) 1typedef __kernel_dev_t dev_t; æè¿°å­—ç¬¦è®¾å¤‡ 12345678struct cdev &#123; struct kobject kobj; //å†…åµŒkobjectç»“æ„ä½“ï¼Œç”¨äºè®¾å¤‡é©±åŠ¨æ¨¡å‹ç®¡ç† struct module *owner; //åŒ…å«æŒ‡å‘è¯¥ç»“æ„çš„æ¨¡å—çš„æŒ‡é’ˆï¼Œç”¨äºå¼•ç”¨è®¡æ•° const struct file_operations *ops; //æŒ‡å‘å­—ç¬¦è®¾å¤‡æ“ä½œå‡½æ•°é›†çš„æŒ‡é’ˆ struct list_head list; //è¯¥ç»“æ„å°†ä½¿ç”¨è¯¥é©±åŠ¨çš„å­—ç¬¦è®¾å¤‡è¿æ¥æˆä¸€ä¸ªé“¾è¡¨ dev_t dev; //è¯¥å­—ç¬¦è®¾å¤‡çš„å…¶å®è®¾å¤‡å·ï¼Œä¸€ä¸ªè®¾å¤‡å¯èƒ½æœ‰å¤šä¸ªè®¾å¤‡å· unsigned int count; //ä½¿ç”¨è¯¥å­—ç¬¦è®¾å¤‡é©±åŠ¨çš„è®¾å¤‡æ•°é‡&#125;; æè¿°ç±» 12345678910111213struct class&#123; const char *name; //ç±»åç§° struct module *owner; //å¯¹åº”æ¨¡å— struct subsystem subsys; //å¯¹åº”çš„subsystem; struct list_head children; //class_deviceé“¾è¡¨ struct list_head interfaces; //class_interfaceé“¾è¡¨ struct semaphore sem; /ç”¨äºåŒæ­¥çš„ä¿¡å·é” struct class_attribute *class_attrs; //ç±»å±æ€§ int (*uevent)(struct class_device *dev,char **envp,int num_envp, char *buffer,int buffer_size); //äº‹ä»¶ void (*release)(struct class_device *dev); //é‡Šæ”¾ç±»è®¾å¤‡ void (*class_release)(struct class *class); //é‡Šæ”¾ç±»&#125; æ€»ç»“ä¸‹ï¼Œç›®å‰ç†è§£çš„å­—ç¬¦è®¾å¤‡ç¼–å†™æµç¨‹: 1)é©±åŠ¨åŠ è½½å‡½æ•°ï¼šxx_drv_init() 1.1)ç”³è¯·è®¾å¤‡å·ï¼šalloc_chrdev_region() 1.2)cdeåˆå§‹åŒ–(ç»‘å®šfops)ï¼šcdev_init() 1.3)æ³¨å†Œåˆ°å†…æ ¸ï¼šcdev_add() 1.4)åˆ›å»ºç±»ï¼šclass_create() 1.5)å‘ç±»ä¸­æ·»åŠ è®¾å¤‡(mdevè‡ªåŠ¨åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹)ï¼šdevice_create() 1.6)ç¡¬ä»¶ç›¸å…³(å†…å­˜æ˜ å°„)ï¼šioremap()2)é©±åŠ¨å¸è½½å‡½æ•°ï¼šxx_drv_exit() 2.1)ç§»é™¤è®¾å¤‡ï¼šdevice_destroy() 2.2)ç§»é™¤ç±»ï¼šclass_destroy() 2.3)æ³¨é”€cdevï¼šcdev_del() 2.4)é‡Šæ”¾è®¾å¤‡å·ï¼šunregister_chrdev() 2.5)é‡Šæ”¾å†…å­˜ï¼šiounmap()3)å¿…è¦ä¿®é¥°:module_init(xx_drv_init);module_exit(xx_drv_exit);MODULE_LICENSE(&quot;GPL&quot;);4)æ„é€ file_operations:struct file_operations xx_drv_fops;5)å®ç°file_operationsé‡Œæ¯ä¸ªå‡½æ•°:xx_open()ã€xx_write()â€¦â€¦ 2.1é©±åŠ¨ä»£ç [leds_drv.c]link123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143#include &lt;linux/kernel.h&gt;#include &lt;linux/module.h&gt;#include &lt;linux/fs.h&gt;#include &lt;linux/init.h&gt;#include &lt;asm/uaccess.h&gt;#include &lt;asm/io.h&gt;#include &lt;linux/device.h&gt;#include &lt;linux/cdev.h&gt;#define TI_LEDS_CNT 4int major;static struct cdev leds_cdev;static struct class *leds_cls;static volatile unsigned long *PRCM_CM_PER_GPIO5_CLKCTRL = NULL; static volatile unsigned long *CTRL_CONF_UART3_RXD = NULL; static volatile unsigned long *CTRL_CONF_UART3_TXD = NULL; static volatile unsigned long *CTRL_CONF_UART3_CTSN = NULL;static volatile unsigned long *CTRL_CONF_UART3_RTSN = NULL;static volatile unsigned long *GPIO_OE = NULL;static volatile unsigned long *GPIO_SETDATAOUT = NULL;static volatile unsigned long *GPIO_DATAOUT = NULL; static int leds_drv_open(struct inode *inode, struct file *file) &#123; int minor = iminor(file-&gt;f_inode); printk(KERN_INFO\"%s OK.\\n\",__func__); *PRCM_CM_PER_GPIO5_CLKCTRL = (0x01&lt;&lt;1); *CTRL_CONF_UART3_RXD &amp;= ~(0x7&lt;&lt;0 | 0x01&lt;&lt;16 | 0x01&lt;&lt;17 | 0x01&lt;&lt;18); *CTRL_CONF_UART3_RXD |= (0x7&lt;&lt;0 | 0x01&lt;&lt;17); *GPIO_OE &amp;= ~(0x01&lt;&lt;minor); *GPIO_SETDATAOUT |= (0x01&lt;&lt;minor); return 0; &#125; static ssize_t leds_drv_write(struct file *file, const char __user *user_buf, size_t count, loff_t * ppos) &#123; int minor = iminor(file-&gt;f_inode); char buf; printk(KERN_INFO\"%s OK.\\n\",__func__); if(count != 1)&#123; printk(KERN_INFO\"write count != 1.\\n\"); return 1; &#125; if (copy_from_user(&amp;buf, user_buf, count)) return -EFAULT; if (0x01 == buf) *GPIO_DATAOUT |= (0x01&lt;&lt;minor); else if(0x00 == buf) *GPIO_DATAOUT &amp;= ~(0x01&lt;&lt;minor); return 0; &#125; static struct file_operations leds_fops = &#123; .owner = THIS_MODULE, .open = leds_drv_open, .write = leds_drv_write, &#125;;static int leds_drv_init(void)&#123; //1.ç”³è¯·è®¾å¤‡å· dev_t devid; printk(KERN_INFO\"%s OK.\\n\",__func__); if(alloc_chrdev_region(&amp;devid, 0, TI_LEDS_CNT, \"ti_leds\") &lt; 0) &#123; printk(KERN_INFO\"%s ERROR.\\n\",__func__); goto error; &#125; major = MAJOR(devid); //2.æ³¨å†Œåˆ°ç³»ç»Ÿä¸­ cdev_init(&amp;leds_cdev, &amp;leds_fops); cdev_add(&amp;leds_cdev, devid, TI_LEDS_CNT); leds_cls = class_create(THIS_MODULE, \"ti_leds\"); device_create(leds_cls, NULL, MKDEV(major, 0), NULL, \"ti_led0\"); device_create(leds_cls, NULL, MKDEV(major, 1), NULL, \"ti_led1\"); device_create(leds_cls, NULL, MKDEV(major, 2), NULL, \"ti_led2\"); device_create(leds_cls, NULL, MKDEV(major, 3), NULL, \"ti_led3\"); //3.ç¡¬ä»¶ç›¸å…³ PRCM_CM_PER_GPIO5_CLKCTRL = ioremap(0x44DF8800+0x498, 0x04*1); CTRL_CONF_UART3_RXD = ioremap(0x44E10000+0xA28, 0x04*4); CTRL_CONF_UART3_TXD = CTRL_CONF_UART3_RXD + 1; CTRL_CONF_UART3_CTSN = CTRL_CONF_UART3_RXD + 2; CTRL_CONF_UART3_RTSN = CTRL_CONF_UART3_RXD + 3; GPIO_OE = ioremap(0x48322000+0x134, 0x04); GPIO_DATAOUT = ioremap(0x48322000+0x13C, 0x04); GPIO_SETDATAOUT = ioremap(0x48322000+0x194, 0x04);error: unregister_chrdev_region(MKDEV(major, 0), TI_LEDS_CNT); return 0;&#125;static void leds_drv_exit(void)&#123; unsigned i; printk(KERN_INFO\"%s OK.\\n\",__func__); for(i=0;i&lt;TI_LEDS_CNT;i++) &#123; device_destroy(leds_cls, MKDEV(major, i)); &#125; class_destroy(leds_cls); cdev_del(&amp;leds_cdev); unregister_chrdev(major, \"ti_leds\"); iounmap(PRCM_CM_PER_GPIO5_CLKCTRL); iounmap(CTRL_CONF_UART3_RXD); iounmap(GPIO_OE); iounmap(GPIO_DATAOUT); iounmap(GPIO_SETDATAOUT);&#125;module_init(leds_drv_init);module_exit(leds_drv_exit);MODULE_LICENSE(\"GPL\");MODULE_AUTHOR(\"hceng &lt;huangcheng.job@foxmail.com&gt;\");MODULE_DESCRIPTION(\"TI am437x board leds drvice\");MODULE_ALIAS(\"character device:ti_leds\");MODULE_VERSION(\"V1.0\"); 2.2æµ‹è¯•ä»£ç (è·‘é©¬ç¯)[leds_app.c]link12345678910111213141516171819202122232425262728293031323334353637383940414243#include &lt;sys/types.h&gt;#include &lt;sys/stat.h&gt;#include &lt;fcntl.h&gt;#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#define msleep(x) usleep(x*1000)int main(int argc, char **argv)&#123; int fd[4]; int val = 0; int i = 0; //const char *dev[] = &#123;\"/dev/ti_led0\", \"/dev/ti_led1\", \"/dev/ti_led2\", \"/dev/ti_led3\"&#125;; const char *dev[] = &#123;\"/dev/ti_led2\", \"/dev/ti_led0\", \"/dev/ti_led3\", \"/dev/ti_led1\"&#125;; for(i=0; i&lt;4; i++) &#123; fd[i] = open(dev[i], O_RDWR); if (fd[i] &lt; 0) &#123; printf(\"can't open %s\\n\", *dev[i]); return 0; &#125; &#125; //leds off all. for(i=0; i&lt;4; i++) &#123; write(fd[i], &amp;val, 1); &#125; //flicker leds. while(1) &#123; val = !val; for(i=0; i&lt;4; i++) &#123; write(fd[i], &amp;val, 1); msleep(300); &#125; &#125;&#125; 2.3å…³äºprintkè°ƒè¯•å†…æ ¸çš„printkå®šä¹‰äº†å¦‚ä¸‹çš„æ‰“å°ç­‰çº§ï¼š12345678#define KERN_EMERG &quot;&lt;0&gt;&quot; /* system is unusable */#define KERN_ALERT &quot;&lt;1&gt;&quot; /* action must be taken immediately */#define KERN_CRIT &quot;&lt;2&gt;&quot; /* critical conditions */#define KERN_ERR &quot;&lt;3&gt;&quot; /* error conditions */#define KERN_WARNING &quot;&lt;4&gt;&quot; /* warning conditions */#define KERN_NOTICE &quot;&lt;5&gt;&quot; /* normal but significant condition */#define KERN_INFO &quot;&lt;6&gt;&quot; /* informational */#define KERN_DEBUG &quot;&lt;7&gt;&quot; /* debug-level messages */ å¦‚æœä½¿ç”¨ä¸²å£ç™»é™†ï¼Œå¯é€šè¿‡ä¿®æ”¹/proc/sys/kernel/printké‡Œçš„å‚æ•°è¿›è¡Œè®¾ç½®ï¼š1echo &quot;8 4 1 7&quot; &gt;/proc/sys/kernel/printk ä¸Šé¢çš„å››ä¸ªæ•°å­—åˆ†åˆ«ä»£è¡¨ï¼šæ§åˆ¶å°æ—¥å¿—çº§åˆ«ï¼šä¼˜å…ˆçº§[s1] é«˜äºè¯¥å€¼çš„æ¶ˆæ¯å°†è¢«æ‰“å°è‡³æ§åˆ¶å°ï¼Œ[s1]æ•°å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼›é»˜è®¤çš„æ¶ˆæ¯æ—¥å¿—çº§åˆ«ï¼šå°†ç”¨è¯¥ä¼˜å…ˆçº§æ¥æ‰“å°æ²¡æœ‰ä¼˜å…ˆçº§çš„æ¶ˆæ¯ï¼›æœ€ä½çš„æ§åˆ¶å°æ—¥å¿—çº§åˆ«ï¼šæ§åˆ¶å°æ—¥å¿—çº§åˆ«å¯è¢«è®¾ç½®çš„æœ€å°å€¼(æœ€é«˜ä¼˜å…ˆçº§)ï¼›é»˜è®¤çš„æ§åˆ¶å°æ—¥å¿—çº§åˆ«ï¼šæ§åˆ¶å°æ—¥å¿—çº§åˆ«çš„ç¼ºçœå€¼ï¼› å¦‚æœä½¿ç”¨SSHç™»é™†ï¼Œæ˜¯æ— æ³•æ˜¾ç¤ºprintkçš„æ‰“å°ä¿¡æ¯çš„ï¼Œä½†æ‰“å°çš„æ•°æ®ä¼šè¢«æ”¾åœ¨/var/log/messageså’Œ/proc/kmsgä¸­ï¼Œåˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå¯ä»¥åå°è¿è¡Œtailå‘½ä»¤è¿›è¡Œä¾¦æµ‹ï¼š1tail -f /var/log/messages &amp; ç¼ºç‚¹æ˜¯ä¸èƒ½è®¾ç½®æ‰“å°ç­‰çº§ï¼ŒåŒæ—¶å†…æ ¸çš„å…¶å®ƒä¿¡æ¯ä¹Ÿä¼šè¢«æ‰“å°å‡ºæ¥ã€‚ 3.è®¾å¤‡é©±åŠ¨æ¨¡å‹é©±åŠ¨å…³äºè®¾å¤‡é©±åŠ¨æ¨¡å‹å‰é¢ä»¥åŠæœ‰ç‚¹äº†è§£ï¼Œåœ¨å†™é©±åŠ¨çš„æ—¶å€™ï¼Œä¸»è¦ä½“ç°åœ¨å°†åŸæœ¬çš„ç¡¬ä»¶èµ„æºä¿¡æ¯æŠ½å–äº†å‡ºæ¥ï¼Œå•ç‹¬æ”¾åœ¨äº†ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œå½“ä¸¤ä¸ªæ–‡ä»¶çš„åˆ†åˆ«åŠ è½½çš„æ—¶å€™ï¼Œæ ¹æ®åå­—åŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸåˆ™è°ƒç”¨probe()å‡½æ•°ï¼Œè¿›è¡Œç±»ä¼¼å‰é¢çš„init()è¿›è¡Œåˆå§‹åŒ–ã€‚å…¶å®ƒçš„å†…å®¹åŸºæœ¬ä¸€æ ·ï¼Œè¯¥å¹²å˜›å°±å¹²å˜›ã€‚ 3.1é©±åŠ¨ä»£ç [leds_dev.c]link123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990#include &lt;linux/init.h&gt;#include &lt;linux/module.h&gt;#include &lt;linux/kernel.h&gt;#include &lt;linux/fs.h&gt;#include &lt;linux/delay.h&gt;#include &lt;asm/uaccess.h&gt;#include &lt;asm/irq.h&gt;#include &lt;asm/io.h&gt;#include &lt;linux/device.h&gt;#include &lt;linux/platform_device.h&gt;/************************************************** TI_BOARD --------------------------------------------------- Ball Color Mode Pin --------------------------------------------------- H24 D7_Blue 0x07 uart3_txd(GPIO5_3) H25 D8_Blue 0x07 uart3_rxd(GPIO5_2) K24 D9_Green 0x07 uart3_rtsn(GPIO5_1) H22 D10_Red 0x07 uart3_ctsn(GPIO5_0) **************************************************/static struct resource leds_resource[] = &#123; //PRCM_CM_PER_GPIO5_CLKCTRL(498h) [0] = &#123; .start = 0x44DF8800, .end = 0x44DFFFFF, .name = \"CM_PER\", .flags = IORESOURCE_MEM, &#125;, //CTRL_CONF_UART3_RXD(A28h)ã€CTRL_CONF_UART3_TXD(A2Ch)ã€CTRL_CONF_UART3_CTSN(A30h)ã€CTRL_CONF_UART3_RTSN((A34h)) [1] = &#123; .start = 0x44E10000, .end = 0x44E1FFFF, .name = \"CONTROL_MODULE\", .flags = IORESOURCE_MEM, &#125;, //GPIO_OE(134h)ã€GPIO_SETDATAOUT(194h)ã€GPIO_DATAOUT(13Ch) [2] = &#123; .start = 0x48322000, .end = 0x48322FFF, .name = \"GOIP5\", .flags = IORESOURCE_MEM, &#125;, [3] = &#123; .start = 0, .end = 3, .name = \"GOIP5_PIN\", .flags = IORESOURCE_IO, &#125;&#125;; static void leds_release(struct device * dev) &#123; printk(KERN_INFO\"%s OK.\\n\",__func__);&#125;static struct platform_device leds_dev = &#123; .name = \"ti_am437x_leds_platform\", .id = -1, .num_resources = ARRAY_SIZE(leds_resource), .resource = leds_resource, .dev = &#123; .release = leds_release, &#125;, &#125;;static int leds_dev_init(void) &#123; printk(KERN_INFO\"%s OK.\\n\",__func__); return platform_device_register(&amp;leds_dev);; &#125; static void leds_dev_exit(void) &#123; printk(KERN_INFO\"%s OK.\\n\",__func__); platform_device_unregister(&amp;leds_dev); &#125; module_init(leds_dev_init);module_exit(leds_dev_exit);MODULE_LICENSE(\"GPL\");MODULE_AUTHOR(\"hceng &lt;huangcheng.job@foxmail.com&gt;\");MODULE_DESCRIPTION(\"TI am437x board leds drvice\");MODULE_ALIAS(\"platform:ti_leds\");MODULE_VERSION(\"V2.0\"); [leds_drv.c]link123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191#include &lt;linux/module.h&gt; #include &lt;linux/version.h&gt; #include &lt;linux/init.h&gt; #include &lt;linux/fs.h&gt; #include &lt;linux/interrupt.h&gt; #include &lt;linux/irq.h&gt; #include &lt;linux/sched.h&gt; #include &lt;linux/pm.h&gt; #include &lt;linux/sysctl.h&gt; #include &lt;linux/proc_fs.h&gt; #include &lt;linux/delay.h&gt; #include &lt;linux/platform_device.h&gt; #include &lt;linux/input.h&gt; #include &lt;linux/irq.h&gt; #include &lt;asm/uaccess.h&gt; #include &lt;asm/io.h&gt; #include &lt;linux/cdev.h&gt;#include &lt;asm/uaccess.h&gt;#define TI_LEDS_CNT 4int major;static struct cdev leds_cdev;static struct class *leds_cls;static volatile unsigned long *PRCM_CM_PER_GPIO5_CLKCTRL = NULL; static volatile unsigned long *CTRL_CONF_UART3_RXD = NULL; static volatile unsigned long *CTRL_CONF_UART3_TXD = NULL; static volatile unsigned long *CTRL_CONF_UART3_CTSN = NULL;static volatile unsigned long *CTRL_CONF_UART3_RTSN = NULL;static volatile unsigned long *GPIO_OE = NULL;static volatile unsigned long *GPIO_SETDATAOUT = NULL;static volatile unsigned long *GPIO_DATAOUT = NULL; static int leds_drv_open(struct inode *inode, struct file *file) &#123; int minor = iminor(file-&gt;f_inode); printk(KERN_INFO\"%s OK.\\n\",__func__); *PRCM_CM_PER_GPIO5_CLKCTRL = (0x01&lt;&lt;1); *CTRL_CONF_UART3_RXD &amp;= ~(0x7&lt;&lt;0 | 0x01&lt;&lt;16 | 0x01&lt;&lt;17 | 0x01&lt;&lt;18); *CTRL_CONF_UART3_RXD |= (0x7&lt;&lt;0 | 0x01&lt;&lt;17); *GPIO_OE &amp;= ~(0x01&lt;&lt;minor); *GPIO_SETDATAOUT |= (0x01&lt;&lt;minor); return 0; &#125; static ssize_t leds_drv_write(struct file *file, const char __user *user_buf, size_t count, loff_t * ppos) &#123; int minor = iminor(file-&gt;f_inode); char buf; printk(KERN_INFO\"%s OK.\\n\",__func__); if(count != 1)&#123; printk(KERN_INFO\"write count != 1.\\n\"); return 1; &#125; if (copy_from_user(&amp;buf, user_buf, count)) return -EFAULT; if (0x01 == buf) *GPIO_DATAOUT |= (0x01&lt;&lt;minor); else if(0x00 == buf) *GPIO_DATAOUT &amp;= ~(0x01&lt;&lt;minor); return 0; &#125; static struct file_operations leds_fops = &#123; .owner = THIS_MODULE, .open = leds_drv_open, .write = leds_drv_write, &#125;; static int leds_probe(struct platform_device *pdev) &#123; struct resource *res; dev_t devid; printk(KERN_INFO\"%s OK.\\n\",__func__); //1.ç”³è¯·è®¾å¤‡å· if(alloc_chrdev_region(&amp;devid, 0, TI_LEDS_CNT, \"ti_leds\") &lt; 0) &#123; printk(\"%s ERROR\\n\",__func__); goto error; &#125; major = MAJOR(devid); //2.æ³¨å†Œåˆ°ç³»ç»Ÿä¸­ cdev_init(&amp;leds_cdev, &amp;leds_fops); cdev_add(&amp;leds_cdev, devid, TI_LEDS_CNT); leds_cls = class_create(THIS_MODULE, \"ti_leds\"); device_create(leds_cls, NULL, MKDEV(major, 0), NULL, \"ti_led0\"); device_create(leds_cls, NULL, MKDEV(major, 1), NULL, \"ti_led1\"); device_create(leds_cls, NULL, MKDEV(major, 2), NULL, \"ti_led2\"); device_create(leds_cls, NULL, MKDEV(major, 3), NULL, \"ti_led3\"); //3.ç¡¬ä»¶ç›¸å…³ res = platform_get_resource_byname(pdev, IORESOURCE_MEM, \"CM_PER\"); if (!res) return -EINVAL; PRCM_CM_PER_GPIO5_CLKCTRL = ioremap(res-&gt;start+0x498, 0x04*1); res = platform_get_resource_byname(pdev, IORESOURCE_MEM, \"CONTROL_MODULE\"); if (!res) return -EINVAL; CTRL_CONF_UART3_RXD = ioremap(res-&gt;start+0xA28, 0x04*4); CTRL_CONF_UART3_TXD = CTRL_CONF_UART3_RXD + 1; CTRL_CONF_UART3_CTSN = CTRL_CONF_UART3_RXD + 2; CTRL_CONF_UART3_RTSN = CTRL_CONF_UART3_RXD + 3; res = platform_get_resource_byname(pdev, IORESOURCE_MEM, \"GOIP5\"); if (!res) return -EINVAL; GPIO_OE = ioremap(res-&gt;start+0x134, 0x04); GPIO_DATAOUT = ioremap(res-&gt;start+0x13C, 0x04); GPIO_SETDATAOUT = ioremap(res-&gt;start+0x194, 0x04); *PRCM_CM_PER_GPIO5_CLKCTRL = (0x01&lt;&lt;1);//ä½¿èƒ½GPIOå¤–è®¾æ—¶é’Ÿerror: unregister_chrdev_region(MKDEV(major, 0), TI_LEDS_CNT); return 0; &#125; static int leds_remove(struct platform_device *pdev) &#123; unsigned i; printk(KERN_INFO\"%s OK.\\n\",__func__); for(i=0;i&lt;TI_LEDS_CNT;i++) &#123; device_destroy(leds_cls, MKDEV(major, i)); &#125; class_destroy(leds_cls); cdev_del(&amp;leds_cdev); unregister_chrdev(major, \"ti_leds\"); iounmap(PRCM_CM_PER_GPIO5_CLKCTRL); iounmap(CTRL_CONF_UART3_RXD); iounmap(GPIO_OE); iounmap(GPIO_DATAOUT); iounmap(GPIO_SETDATAOUT); return 0; &#125;struct platform_driver leds_drv = &#123; .probe = leds_probe, .remove = leds_remove, .driver = &#123; .name = \"ti_am437x_leds_platform\", &#125; &#125;; static int leds_drv_init(void) &#123; printk(KERN_INFO\"%s OK.\\n\",__func__); return platform_driver_register(&amp;leds_drv); &#125; static void leds_drv_exit(void) &#123; printk(KERN_INFO\"%s OK.\\n\",__func__); platform_driver_unregister(&amp;leds_drv); &#125; module_init(leds_drv_init);module_exit(leds_drv_exit);MODULE_LICENSE(\"GPL\");MODULE_AUTHOR(\"hceng &lt;huangcheng.job@foxmail.com&gt;\");MODULE_DESCRIPTION(\"TI am437x board leds drvice\");MODULE_ALIAS(\"platform:ti_leds\");MODULE_VERSION(\"V2.0\"); æµ‹è¯•ç¨‹åºåŒå‰é¢çš„ä¸€æ ·ã€‚ 4.è®¾å¤‡æ ‘é©±åŠ¨4.1åˆè¯†è®¾å¤‡æ ‘ 1ï¼‰å‰é¢çš„æ€»çº¿è®¾å¤‡é©±åŠ¨æ¨¡å‹ä¸­ï¼Œç¡¬ä»¶èµ„æºæ¥è‡ªäºleds_dev.cé‡Œé¢çš„ä¿¡æ¯ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä¸åŒçš„æ¿å­ï¼Œä¼šæ·»åŠ ä¸åŒçš„ç¡¬ä»¶èµ„æºä¿¡æ¯ï¼Œé€ æˆå†…æ ¸çš„è‡ƒè‚¿ã€‚2ï¼‰ä½¿ç”¨è®¾å¤‡æ ‘åï¼Œå†…æ ¸ä¸å†åŒ…å«ç¡¬ä»¶çš„æè¿°ï¼Œç¡¬ä»¶æè¿°æ”¾åœ¨å•ç‹¬çš„DTSé‡Œé¢ï¼Œç„¶åç¼–è¯‘æˆäºŒè¿›åˆ¶çš„DTBï¼Œåœ¨U-Bootå¯åŠ¨çš„æ—¶å€™åŠ è½½è¿›å»ï¼Œç„¶åå†…æ ¸è¿›è¡Œè§£æã€‚3ï¼‰DTSã€DTCå’ŒDTBä¹‹é—´çš„å…³ç³»ï¼šDTSç»è¿‡DTCç¼–è¯‘å¾—åˆ°DTBï¼ŒDTBé€šè¿‡DTCåç¼–è¯‘å¾—åˆ°DTS. 4ï¼‰ARMä¸­ï¼Œæ‰€æœ‰çš„DTSæ–‡ä»¶æ”¾åœ¨arch/arm/boot/dtsç›®å½•ä¸­ï¼Œä¸ºäº†ç®€åŒ–ï¼Œå°†Socå…¬ç”¨éƒ¨åˆ†æå–äº†å‡ºæ¥ä½œä¸ºdtsiï¼Œç±»ä¼¼å¤´æ–‡ä»¶ã€‚5ï¼‰DTCç¼–è¯‘å·¥å…·çš„æºä»£ç åœ¨scripts/dtcç›®å½•ä¸­ï¼Œç¼–è¯‘å†…æ ¸æ—¶ï¼Œç¼–è¯‘å†…æ ¸æ—¶ï¼Œéœ€è¦ä½¿èƒ½æ‰èƒ½å°†æºç ç¼–è¯‘æˆå·¥å…·ï¼Œå¯¹åº”äºscripts/dtc/Makefileä¸­&quot;hostprogs-y:=dtc&quot;ã€‚Ubuntuä¹Ÿå¯ç›´æ¥å®‰è£…DTCå·¥å…·ï¼š1sudo apt-get install device-tree-compiler 6)å†…æ ¸çš„arch/arm/boot/dts/Makefileä¸­ï¼Œæè¿°äº†å½“æŸç§Socè¢«é€‰ä¸­åï¼Œå“ªäº›.dtbä¼šç¼–è¯‘å‡ºæ¥ã€‚æ‰§è¡Œmake dtbsï¼Œä¼šæ ¹æ®arch/arm/Makefileç¼–è¯‘æŒ‡å®šç›®æ ‡ã€‚7ï¼‰å•ç‹¬ç¼–è¯‘ä¸åç¼–è¯‘ï¼š12./scripts/dtc/dtc -I dts -O dtb -o xxx.dtb arch/arm/boot/dts/xxx.dts //dts-&gt;dtb./scripts/dtc/dtc -I dtb -O dts -o xxx.dts arch/arm/boot/dts/xxx.dtb //dtb-&gt;dts 8ï¼‰åé¢è®¤è¯†æ·±åˆ»äº†ï¼Œå†æ€»ç»“æ€»ç»“ã€‚ 4.2ä¿®æ”¹AM437xè®¾å¤‡æ ‘AM437xçš„è®¾å¤‡æ ‘æ–‡ä»¶åœ¨~/ti-processor-sdk-linux-am437x-evm-01.00.00.03/board-support/linux-3.14.43+gitAUTOINC+875c69b2c3-g875c69b/arch/arm/boot/dts/ä¸­ï¼Œä¸»è¦æ˜¯am4372.dtsiå’Œam437x-sk-evm.dtsã€‚æˆ‘çš„ç›®çš„æ˜¯å¸Œæœ›å†™ä¸ªè®¾å¤‡æ ‘æ¡†æ¶çš„LEDç¨‹åºï¼Œå› æ­¤æƒ³è®©am437x-sk-evm.dtså¹²å‡€ç‚¹ï¼ŒåªåŒ…å«LEDç¡¬ä»¶æè¿°ï¼Œå› æ­¤æˆ‘éœ€è¦åˆ é™¤am437x-sk-evm.dtsé‡Œé¢çš„å…¶å®ƒç¡¬ä»¶æè¿°ã€‚ç»è¿‡æµ‹è¯•ï¼Œam437x-sk-evm.dtsé‡Œé¢åŒ…å«éƒ¨åˆ†MMCçš„æè¿°ï¼Œä¸€æ—¦åˆ é™¤å°†ä¸èƒ½æˆåŠŸå¯åŠ¨å†…æ ¸ã€‚è€Œä¸”ï¼Œåé¢è°ƒè¯•çš„æ—¶å€™ï¼Œå¸Œæœ›å¼€å‘æ¿é€šè¿‡NFSæŒ‚è½½çš„æ–¹å¼ï¼Œç›´æ¥åŠ è½½ç¼–è¯‘çš„é©±åŠ¨æ¨¡å—ï¼Œå› æ­¤éœ€è¦ä¿ç•™ç½‘å¡æè¿°éƒ¨åˆ†ã€‚æœ€åï¼Œå°†MMCå’Œç½‘å¡å¿…é¡»çš„éƒ¨åˆ†ï¼Œæå–äº†å‡ºæ¥ï¼Œæ”¾åœ¨äº†am4372.dtsiä¸­ã€‚ç²¾ç®€åçš„am437x-sk-evm.dtså†…å®¹å¦‚ä¸‹ï¼š[am437x-sk-evm.dts]link1234567891011121314151617181920212223242526272829303132333435363738/* AM437x SK EVM *//dts-v1/;#include \"am4372.dtsi\"#include &lt;dt-bindings/pinctrl/am43xx.h&gt;#include &lt;dt-bindings/gpio/gpio.h&gt;/ &#123; model = \"TI AM437x SK EVM\"; compatible = \"ti,am437x-sk-evm\",\"ti,am4372\",\"ti,am43\"; led_pin &#123; compatible = \"ti_leds\"; pinctrl-names = \"default\"; pinctrl-0 = &lt;&amp;leds_pins&gt;; am437x,led_gpio0 = &lt;&amp;gpio5 0 GPIO_ACTIVE_HIGH&gt;; am437x,led_gpio1 = &lt;&amp;gpio5 1 GPIO_ACTIVE_HIGH&gt;; am437x,led_gpio2 = &lt;&amp;gpio5 2 GPIO_ACTIVE_HIGH&gt;; am437x,led_gpio3 = &lt;&amp;gpio5 3 GPIO_ACTIVE_HIGH&gt;; &#125;;&#125;;&amp;am43xx_pinmux &#123; leds_pins: leds_pins &#123; pinctrl-single,pins = &lt; 0x228 (PIN_OUTPUT | MUX_MODE7) /* uart3_rxd.gpio5_2 */ 0x22c (PIN_OUTPUT | MUX_MODE7) /* uart3_txd.gpio5_3 */ 0x230 (PIN_OUTPUT | MUX_MODE7) /* uart3_ctsn.gpio5_0 */ 0x234 (PIN_OUTPUT | MUX_MODE7) /* uart3_rtsn.gpio5_1 */ &gt;; &#125;;&#125;;&amp;gpio5 &#123; status = \"okay\";&#125;;é¢ï¼Œåœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¸æ–­ç¼–è¯‘æ–°çš„DTBå’Œå¤åˆ¶åˆ°SDå¡çš„rootfsåˆ†åŒºä¸­ï¼Œä»¿ç…§å‰é¢å†™äº†ä¸ªè„šæœ¬è¿›è¡Œè‡ªåŠ¨ç¼–è¯‘å’Œå¤åˆ¶ï¼ŒåŒæ—¶æ£€æŸ¥æ–‡ä»¶çš„ç”Ÿæˆæ—¶é—´é—´éš”ï¼Œå®é™…ä¸­ï¼Œç¡®å®å‡å°‘äº†ç„¦èºçš„é‡å¤æ“ä½œã€‚ 4.3é©±åŠ¨ä»£ç [leds_drv.c]link123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204#include &lt;linux/module.h&gt; #include &lt;linux/version.h&gt; #include &lt;linux/init.h&gt; #include &lt;linux/fs.h&gt; #include &lt;linux/interrupt.h&gt; #include &lt;linux/irq.h&gt; #include &lt;linux/sched.h&gt; #include &lt;linux/pm.h&gt; #include &lt;linux/sysctl.h&gt; #include &lt;linux/proc_fs.h&gt; #include &lt;linux/delay.h&gt; #include &lt;linux/platform_device.h&gt; #include &lt;linux/input.h&gt; #include &lt;linux/irq.h&gt; #include &lt;asm/uaccess.h&gt; #include &lt;asm/io.h&gt; #include &lt;linux/cdev.h&gt;#include &lt;asm/uaccess.h&gt;#include &lt;linux/gpio.h&gt;#include &lt;linux/of_gpio.h&gt;#define TI_LEDS_CNT 4int major;static struct cdev leds_cdev;static struct class *leds_cls;static int led0,led1,led2,led3; static int leds_drv_open(struct inode *inode, struct file *file) &#123; printk(KERN_INFO\"%s OK.\\n\",__func__); return 0; &#125; static ssize_t leds_drv_write(struct file *file, const char __user *user_buf, size_t count, loff_t * ppos) &#123; int minor = iminor(file-&gt;f_inode); char buf; printk(KERN_INFO\"%s OK.\\n\",__func__); if(count != 1)&#123; printk(KERN_INFO\"write count != 1.\\n\"); return 1; &#125; if (copy_from_user(&amp;buf, user_buf, count)) return -EFAULT; if(0x01 == buf) &#123; switch(minor)&#123; case 0: gpio_set_value(led0, 0); break; case 1: gpio_set_value(led1, 0); break; case 2: gpio_set_value(led2, 0); break; case 3: gpio_set_value(led3, 0); break; default: printk(KERN_INFO\"%s receive minor error.\\n\",__func__); &#125; &#125; else if(0x00 == buf) &#123; switch(minor)&#123; case 0: gpio_set_value(led0, 1); break; case 1: gpio_set_value(led1, 1); break; case 2: gpio_set_value(led2, 1); break; case 3: gpio_set_value(led3, 1); break; default: printk(KERN_INFO\"%s receive minor error\\n\",__func__); &#125; &#125; return 0; &#125; static struct file_operations leds_fops = &#123; .owner = THIS_MODULE, .open = leds_drv_open, .write = leds_drv_write, &#125;; static int leds_probe(struct platform_device *pdev) &#123; struct device *dev = &amp;pdev-&gt;dev; dev_t devid; printk(KERN_INFO\"%s OK.\\n\",__func__); //1.ç”³è¯·è®¾å¤‡å· if(alloc_chrdev_region(&amp;devid, 0, TI_LEDS_CNT, \"ti_leds\") &lt; 0) &#123; printk(KERN_INFO\"%s ERROR.\\n\",__func__); goto error; &#125; major = MAJOR(devid); //2.æ³¨å†Œåˆ°ç³»ç»Ÿä¸­ cdev_init(&amp;leds_cdev, &amp;leds_fops); cdev_add(&amp;leds_cdev, devid, TI_LEDS_CNT); leds_cls = class_create(THIS_MODULE, \"ti_leds\"); device_create(leds_cls, NULL, MKDEV(major, 0), NULL, \"ti_led0\"); device_create(leds_cls, NULL, MKDEV(major, 1), NULL, \"ti_led1\"); device_create(leds_cls, NULL, MKDEV(major, 2), NULL, \"ti_led2\"); device_create(leds_cls, NULL, MKDEV(major, 3), NULL, \"ti_led3\"); //3.ç¡¬ä»¶ç›¸å…³ led0 = of_get_named_gpio(dev-&gt;of_node, \"am437x,led_gpio0\", 0);; led1 = of_get_named_gpio(dev-&gt;of_node, \"am437x,led_gpio1\", 0);; led2 = of_get_named_gpio(dev-&gt;of_node, \"am437x,led_gpio2\", 0);; led3 = of_get_named_gpio(dev-&gt;of_node, \"am437x,led_gpio3\", 0); //printk(KERN_INFO\"led0 = %d\\n\",led0); //printk(KERN_INFO\"led1 = %d\\n\",led1); //printk(KERN_INFO\"led2 = %d\\n\",led2); //printk(KERN_INFO\"led3 = %d\\n\",led3); devm_gpio_request_one(dev, led0, GPIOF_OUT_INIT_HIGH, \"LED0\"); devm_gpio_request_one(dev, led1, GPIOF_OUT_INIT_HIGH, \"LED1\"); devm_gpio_request_one(dev, led2, GPIOF_OUT_INIT_HIGH, \"LED2\"); devm_gpio_request_one(dev, led3, GPIOF_OUT_INIT_HIGH, \"LED3\");error: unregister_chrdev_region(MKDEV(major, 0), TI_LEDS_CNT); return 0; &#125; static int leds_remove(struct platform_device *pdev) &#123; unsigned i; printk(KERN_INFO\"%s OK.\\n\",__func__); for(i=0;i&lt;TI_LEDS_CNT;i++) &#123; device_destroy(leds_cls, MKDEV(major, i)); &#125; class_destroy(leds_cls); cdev_del(&amp;leds_cdev); unregister_chrdev(major, \"ti_leds\"); return 0; &#125;static const struct of_device_id of_gpio_leds_match[] = &#123; &#123; .compatible = \"ti_leds\", &#125;, &#123;&#125;,&#125;;static struct platform_driver leds_drv = &#123; .probe = leds_probe, .remove = leds_remove, .driver = &#123; .name = \"ti_am437x_leds_platform\", .owner = THIS_MODULE, .of_match_table = of_match_ptr(of_gpio_leds_match), &#125;,&#125;;static int leds_drv_init(void) &#123; printk(KERN_INFO\"%s OK.\\n\",__func__); return platform_driver_register(&amp;leds_drv); &#125; static void leds_drv_exit(void) &#123; printk(KERN_INFO\"%s OK.\\n\",__func__); platform_driver_unregister(&amp;leds_drv); &#125; module_init(leds_drv_init);module_exit(leds_drv_exit);MODULE_LICENSE(\"GPL\");MODULE_AUTHOR(\"hceng &lt;huangcheng.job@foxmail.com&gt;\");MODULE_DESCRIPTION(\"TI am437x board leds drvice\");MODULE_ALIAS(\"platform:device tree:ti_leds\");MODULE_VERSION(\"V3.0\"); æµ‹è¯•ç¨‹åºåŒå‰é¢çš„ä¸€æ ·ã€‚ 5.LEDå­ç³»ç»Ÿé©±åŠ¨ç•™ä¸ªæŒ‚å¿µï¼Œä»¥åå†æ·»åŠ ã€‚ 6.å¿ƒå¾—åœ¨æˆ‘ç†è§£åˆ°é©±åŠ¨=è£¸æœº+è½¯ä»¶æ¡†æ¶çš„æ—¶å€™ï¼Œæˆ‘å¯¹ä¹‹å‰çš„è£¸æœºä¹Ÿå°±æ²¡é‚£ä¹ˆæ’æ–¥äº†ã€‚è€Œä¸”è¿™ä¸ªè½¯ä»¶æ¡†æ¶ï¼Œå°±ç°åœ¨æ¥çœ‹ï¼Œæ ¸å¿ƒçš„é‚£å‡ æ­¥åƒï¼šç”³è¯·è®¾å¤‡å·ã€æ³¨å†Œè®¾å¤‡ã€åˆ›å»ºç±»å’Œåˆ›å»ºèŠ‚ç‚¹è¿™äº›éƒ½ä¸å˜ï¼Œæ—©æ™šä¼šåšã€‚æ‰€ä»¥ï¼Œæˆ‘ç®—å…¥é—¨äº†å—ï¼ŸğŸ˜€ä¸‹ä¸€æ­¥ï¼Œå¼€å§‹å¦ä¸€ä¸ªé˜¶æ®µ~ æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"AM437X","slug":"AM437X","permalink":"http://yoursite.com/tags/AM437X/"},{"name":"Linuxé©±åŠ¨","slug":"Linuxé©±åŠ¨","permalink":"http://yoursite.com/tags/Linuxé©±åŠ¨/"}]},{"title":"Linuxå¼€å‘ç¯å¢ƒé…ç½®åŠshell script","date":"2017-08-05T03:37:41.000Z","path":"2017/08/05/Linuxå¼€å‘ç¯å¢ƒé…ç½®åŠshell-script/","text":"æœ¬æ–‡ä¸»è¦æ˜¯ä»¥å¿«é€Ÿæ­å»ºç¯å¢ƒä¸ºç›®æ ‡å­¦ä¹ shell scriptã€‚ ä¹‹å‰å†™è¿‡ä¸€ä¸ªLinuxåµŒå…¥å¼å¼€å‘ç¯å¢ƒæ­å»ºçš„åšå®¢ï¼Œåé¢æ¯æ¬¡æ­ç¯å¢ƒéƒ½ç¿»æ¥å¤åˆ¶ä¸Šé¢çš„ä»£ç ã€‚æ„Ÿè§‰å°±åƒè®°äº‹æœ¬ä¸€æ ·ï¼Œè¿˜æ˜¯æœ‰ç‚¹ç”¨ï¼Œè¿™ä¹Ÿæ˜¯å†™åšå®¢çš„ä¸€ç‚¹åŠ¨åŠ›å§ã€‚ç”¨äº†Linuxä¹Ÿæœ‰æ®µæ—¶é—´äº†ï¼Œå®ƒçš„é­…åŠ›ä¹Ÿé€æ¸å±•ç°å‡ºæ¥äº†ã€‚ä»¥å‰è¿˜åœ¨ç†Ÿæ‚‰Linuxå‘½ä»¤çš„è¿‡ç¨‹ä¸­ï¼Œshell scriptå°±æ˜¯ä¸ªè€è™ï¼Œè§‰å¾—æ²¡æ¥è§¦è¿‡ï¼Œå®³æ€•ï¼Œæ¯æ¬¡éƒ½ç»•å¼€å®ƒã€‚ç›´åˆ°è¿™å‘¨é‡åˆ°äº†tiçš„SDKï¼Œå°è¯•ä¸€è¾¹ç™¾åº¦ï¼Œä¸€è¾¹æµ‹å®ƒçš„è„šæœ¬ï¼Œæ„Ÿè§‰æœ‰ç‚¹å°å…¥é—¨äº†ï¼Œäºæ˜¯æƒ³ç»ƒä¹ ä¸‹ã€‚æƒ³åˆ°æ¯æ¬¡æ­å»ºç¯å¢ƒé‡å¤æ“ä½œçš„ç—›ç‚¹ï¼Œå°±æ‹¿å®ƒå¼€åˆ€å§ã€‚ 0.ç¯å¢ƒæ­å»ºçš„å‡ ä¸ªæ–¹é¢æ ¹æ®è¿‡å»çš„ç»éªŒï¼Œç”¨è™šæ‹Ÿæœºè£…å¥½Ubuntuåï¼Œä¸€èˆ¬ä¼šåšè¿™æ ·å‡ ä¸ªæ­¥éª¤ï¼š 1.å®‰è£…vmware tools,ä»¥ä¾¿å¤åˆ¶ç²˜è´´å’Œæ–‡ä»¶å…±äº«ï¼›2.æ›´æ–°è½¯ä»¶æºï¼Œä»¥ä¾¿æ›´å¿«çš„ä¸‹è½½è½¯ä»¶ï¼›3.å®‰è£…åŠé…ç½®å¸¸ç”¨è½¯ä»¶ï¼Œæ¯”å¦‚ï¼š 3-1.å®‰è£…git,æ–¹é¢åç»­çš„ä¸€äº›å®‰è£…ï¼› 3-2.å®‰è£…vimå’Œç®€å•é…ç½®ï¼› 3-3.å®‰è£…ftpå’Œç®€å•é…ç½®ï¼› 3-4.å®‰è£…ftpå’Œç®€å•é…ç½®ï¼› 3-5.å®‰è£…sambaå’Œç®€å•é…ç½®ï¼› 3-6.å®‰è£…tmuxã€htopç­‰ï¼›4.å®‰è£…å¼€å‘æ‰€éœ€çš„ g++ç­‰å·¥å…·ã€åº“ï¼› é™¤äº†ç¬¬ä¸€æ­¥ï¼Œå…¶å®ƒéƒ½è®¡åˆ’ç”¨è„šæœ¬å®ç°ã€‚ åœ¨å¼€å‘ä¸­ï¼ŒåŒçƒ¦äº†æ¯æ¬¡ç¼–è¾‘äº†é©±åŠ¨ï¼Œéƒ½è¦æ‹–è¿›Linuxä¸»æœºè¿›è¡Œç¼–è¯‘ï¼Œç„¶åè¿˜è¦å¤åˆ¶åˆ°å¼€å‘æ¿ã€‚é‡æ–°æ‰“é€ äº†å·¥ä½œæµï¼Œåªéœ€è¦åœ¨ç”µè„‘ä¸Šæ“ä½œä¸‰æ­¥ï¼šç¼–è¾‘-&gt;makeç¼–è¯‘-&gt;insmodåŠ è½½ 1.æ£€æµ‹å½“å‰ç¯å¢ƒåœ¨è¿è¡Œè„šæœ¬å‰ï¼Œéœ€è¦æ£€æµ‹ä¸€äº›ä¸œè¥¿ï¼š 1.1æ£€æµ‹ç½‘ç»œçŠ¶æ€å¦‚æœä¸èƒ½è”ç½‘ï¼Œåç»­çš„æ²¡å¿…è¦åšäº†ã€‚ä¹‹å‰æƒ³è¿‡è‡ªåŠ¨æ£€æµ‹ä¿®å¤ç½‘ç»œçš„ï¼Œä½†æƒ³äº†æƒ³ï¼Œç½‘ç»œçš„æƒ…å†µæ¯”è¾ƒå¤šï¼Œæš‚æ—¶æç½®ã€‚è€Œä¸”åˆšè£…å¥½è™šæ‹Ÿæœºè‚¯å®šæ˜¯è”ç½‘çš„ï¼Œå¦‚æœä¸èƒ½è”ç½‘è‚¯å®šæ˜¯è™šæ‹Ÿæœºè®¾ç½®çš„é—®é¢˜ï¼Œä¹Ÿä¸æ˜¯è„šæœ¬èƒ½è§£å†³çš„ã€‚ä¸ºäº†æ–¹ä¾¿æ‰“å°é†’ç›®å’Œæ›´æ”¹ç”¨æˆ·åï¼Œè¿™é‡Œå…ˆè®¾ç½®å‡ ä¸ªå˜é‡ï¼š12345678910#define echo print color.RED_COLOR='\\E[1;31m' PINK_COLOR='\\E[1;35m' YELOW_COLOR='\\E[1;33m' BLUE_COLOR='\\E[1;34m' GREEN_COLOR='\\E[1;32m' END_COLOR='\\E[0m' #set linux host user name.user_name=hceng æ£€æµ‹ç½‘ç»œå‡½æ•°ï¼š123456789check_network() &#123; ping -c 1 www.baidu.com &gt; /dev/null 2&gt;&amp;1 if [ $? -eq 0 ];then echo -e \"$&#123;GREEN_COLOR&#125;Network ok.$&#123;END_COLOR&#125;\" else echo -e \"$&#123;RED_COLOR&#125;Network failure!$&#123;END_COLOR&#125;\" exit 1 fi&#125;å…ˆpingä¸€æ¬¡ç™¾åº¦ï¼Œèƒ½å¤Ÿpingé€šå°±è¡¨ç¤ºç½‘ç»œæ²¡é—®é¢˜ã€‚ 1.2æ£€æµ‹æ˜¯å¦æ˜¯rootç”¨æˆ·å¾ˆå¤šæ“ä½œéƒ½éœ€è¦rootæƒé™ï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨rootç”¨æˆ·æƒé™è¿è¡Œè„šæœ¬ï¼Œè¿™é‡Œå…ˆæ£€æµ‹æ˜¯å¦æ˜¯rootç”¨æˆ·ï¼š1234567# Check user must root.check_root() &#123; if [ $(id -u) != \"0\" ]; then echo -e \"$&#123;RED_COLOR&#125;Error: You must be root to run this script, please use root.$&#123;END_COLOR&#125;\" exit 1 fi&#125; 1.3æ£€æµ‹è®¾ç½®çš„ç”¨æˆ·æ˜¯å¦å­˜åœ¨ç°åœ¨ç”¨çš„ç”¨æˆ·åæ˜¯hcengï¼Œåé¢ä¸ºäº†æ–¹ä¾¿å…¶å®ƒç”¨æˆ·ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨å‰é¢å®šä¹‰äº†ä¸ªå˜é‡ï¼Œæ”¹å˜å˜é‡å°±å¯ä»¥ä¿®æ”¹ç”¨æˆ·ã€‚ä½†ä¸ºäº†é˜²æ­¢è®¾ç½®çš„ç”¨æˆ·åœ¨ç³»ç»Ÿä¸­ä¸å­˜åœ¨ï¼Œè¿™é‡Œéœ€è¦è¿›è¡Œæ£€æµ‹ã€‚12345678910# Check set linux host user name.check_user_name() &#123; cat /etc/passwd|grep $user_name if [ $? -eq 0 ];then echo -e \"$&#123;GREEN_COLOR&#125;Check the set user name OK.$&#123;END_COLOR&#125;\" else echo -e \"$&#123;RED_COLOR&#125;Check the set user name failure!$&#123;END_COLOR&#125;\" exit 1 fi&#125; 1.4æ£€æµ‹è¿è¡Œç»“æœä¸ºæ£€æµ‹æŸäº›å‘½ä»¤ï¼Œæ˜¯å¦è¿è¡Œæ­£å¸¸ã€‚1234567check_status() &#123; ret=$? if [ \"$ret\" -ne \"0\" ]; then echo -e \"$&#123;RED_COLOR&#125;Failed setup, aborting..$&#123;END_COLOR&#125;\" exit 1 fi&#125; 1.5è·å–ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯åé¢æ›´æ–°æºå’Œè£…æŸäº›è½¯ä»¶éœ€è¦å½“å‰Ubuntuçš„ç‰ˆæœ¬ä»£å·ã€‚123456# Get the code name of the Linux host release to the caller.get_host_type() &#123; local __host_type=$1 local the_host=`lsb_release -a 2&gt;/dev/null | grep Codename: | awk &#123;'print $2'&#125;` eval $__host_type=\"'$the_host'\"&#125; 2.æ›´æ–°è½¯ä»¶æºè¿™é‡Œä½¿ç”¨äº†é˜¿é‡Œã€ç½‘æ˜“å’Œå®˜æ–¹çš„ä¸‰ä¸ªæºï¼Œåº”è¯¥æ²¡é—®é¢˜äº†ã€‚ä¿®æ”¹é…ç½®æ–‡ä»¶çš„åŸåˆ™å°±æ˜¯å…ˆå¤‡ä»½å†ä¿®æ”¹ã€‚åŒæ—¶ä¸ºäº†é˜²æ­¢è„šæœ¬å†æ¬¡è¿è¡Œè¦†ç›–æ‰å¤‡ä»½ï¼Œè¿˜éœ€è¦æ£€æµ‹æ˜¯å¦å·²ç»å­˜åœ¨äº†å¤‡ä»½ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263#This function will update the source of the software.update_software_source() &#123; local back_file=/etc/apt/sources.list.backup if [ ! -e \"$back_file\" ];then cp /etc/apt/sources.list $back_file fi check_status get_host_type host_release check_status echo \\ \"#Ali source. deb-src http://archive.ubuntu.com/ubuntu $host_release main restricted deb http://mirrors.aliyun.com/ubuntu/ $host_release main restricted deb-src http://mirrors.aliyun.com/ubuntu/ $host_release main restricted multiverse universe deb http://mirrors.aliyun.com/ubuntu/ $host_release-updates main restricted deb-src http://mirrors.aliyun.com/ubuntu/ $host_release-updates main restricted multiverse universe deb http://mirrors.aliyun.com/ubuntu/ $host_release universe deb http://mirrors.aliyun.com/ubuntu/ $host_release-updates universe deb http://mirrors.aliyun.com/ubuntu/ $host_release multiverse deb http://mirrors.aliyun.com/ubuntu/ $host_release-updates multiverse deb http://mirrors.aliyun.com/ubuntu/ $host_release-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ $host_release-backports main restricted universe multiverse deb http://archive.canonical.com/ubuntu $host_release partner deb-src http://archive.canonical.com/ubuntu $host_release partner deb http://mirrors.aliyun.com/ubuntu/ $host_release-security main restricted deb-src http://mirrors.aliyun.com/ubuntu/ $host_release-security main restricted multiverse universe deb http://mirrors.aliyun.com/ubuntu/ $host_release-security universe deb http://mirrors.aliyun.com/ubuntu/ $host_release-security multiverse #Netease source. deb http://mirrors.163.com/ubuntu/ $host_release main restricted universe multiverse deb http://mirrors.163.com/ubuntu/ $host_release-security main restricted universe multiverse deb http://mirrors.163.com/ubuntu/ $host_release-updates main restricted universe multiverse deb http://mirrors.163.com/ubuntu/ $host_release-proposed main restricted universe multiverse deb http://mirrors.163.com/ubuntu/ $host_release-backports main restricted universe multiverse deb-src http://mirrors.163.com/ubuntu/ $host_release main restricted universe multiverse deb-src http://mirrors.163.com/ubuntu/ $host_release-security main restricted universe multiverse deb-src http://mirrors.163.com/ubuntu/ $host_release-updates main restricted universe multiverse deb-src http://mirrors.163.com/ubuntu/ $host_release-proposed main restricted universe multiverse deb-src http://mirrors.163.com/ubuntu/ $host_release-backports main restricted universe multiverse #Official source deb http://archive.ubuntu.com/ubuntu/ $host_release main restricted universe multiverse deb http://archive.ubuntu.com/ubuntu/ $host_release-security main restricted universe multiverse deb http://archive.ubuntu.com/ubuntu/ $host_release-updates main restricted universe multiverse deb http://archive.ubuntu.com/ubuntu/ $host_release-proposed main restricted universe multiverse deb http://archive.ubuntu.com/ubuntu/ $host_release-backports main restricted universe multiverse deb-src http://archive.ubuntu.com/ubuntu/ $host_release main restricted universe multiverse deb-src http://archive.ubuntu.com/ubuntu/ $host_release-security main restricted universe multiverse deb-src http://archive.ubuntu.com/ubuntu/ $host_release-updates main restricted universe multiverse deb-src http://archive.ubuntu.com/ubuntu/ $host_release-proposed main restricted universe multiverse deb-src http://archive.ubuntu.com/ubuntu/ $host_release-backports main restricted universe multiverse\" \\ &gt; /etc/apt/sources.list check_status #apt-get update 1&gt;/dev/null apt-get update check_status echo -e \"$&#123;GREEN_COLOR&#125;Update source completed.$&#123;END_COLOR&#125;\" &#125; 3.å®‰è£…è½¯ä»¶åŠé…ç½®è½¯ä»¶ä¸»è¦åŒ…æ‹¬è‡ªå·±ä¸€èˆ¬å¸¸ç”¨çš„è½¯ä»¶ï¼Œåƒvimã€tmuxã€sambaç­‰ã€‚è¿˜æœ‰å°±æ˜¯å¼€å‘æ‰€éœ€çš„g++ã€å„ç§åº“ã€‚å…¶ä¸­gitè¦åœ¨vimå‰é¢ï¼Œå› ä¸ºvimçš„é…ç½®æ–‡ä»¶éœ€è¦gitä¸‹è½½ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081# Execute an action.FA_DoExec() &#123; echo -e \"$&#123;BLUE_COLOR&#125;==&gt; Executing: '$&#123;@&#125;'.$&#123;END_COLOR&#125;\" eval $@ || exit $?&#125;# Install list software.install_software() &#123; local install_software_list=(\"git\" \"vim\" \"tmux\" \"htop\" \"vsftpd\" \"openssh-server\" \"nfs-kernel-server\" \"portmap\" \"samba\") echo -e \"$&#123;PINK_COLOR&#125;install_software_list:$&#123;install_software_list[*]&#125;.$&#123;END_COLOR&#125;\" #install git if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"git\");then apt-get -y install git &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;git install completed.$&#123;END_COLOR&#125;\" fi #install and configure vim if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"vim\");then apt-get -y install vim &amp;&amp; vim_configure &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;vim install completed.$&#123;END_COLOR&#125;\" fi #install tmux if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"tmux\");then apt-get -y install tmux &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;tmux install completed.$&#123;END_COLOR&#125;\" fi #install htop if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"htop\");then apt-get -y install htop &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;htop install completed.$&#123;END_COLOR&#125;\" fi #install and configure vsftpd if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"vsftpd\");then apt-get -y install vsftpd &amp;&amp; ftp_configure &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;vsftpd install completed.$&#123;END_COLOR&#125;\" fi #install openssh-server if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"openssh-server\");then apt-get -y install openssh-server &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;openssh-server install completed.$&#123;END_COLOR&#125;\" fi #install and configure nfs-kernel-server if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"nfs-kernel-server\");then apt-get -y install nfs-kernel-server &amp;&amp; nfs_configure &amp;&amp; \\ /etc/init.d/nfs-kernel-server restart &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;nfs-kernel-server install completed.$&#123;END_COLOR&#125;\" fi #install portmap if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"portmap\");then apt-get -y install portmap &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;portmap install completed.$&#123;END_COLOR&#125;\" fi #install and configure samba if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"samba\");then apt-get -y install samba &amp;&amp; samba_configure &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;samba install completed.$&#123;END_COLOR&#125;\" fi #others get_host_type host_release FA_DoExec apt-get -y install \\ gnupg flex bison gperf build-essential \\ zip curl libc6-dev libncurses5-dev libncurses5-dev:i386 x11proto-core-dev \\ libx11-dev:i386 libreadline6-dev:i386 \\ libgl1-mesa-glx-lts-$host_release:i386 libgl1-mesa-dev-lts-$host_release \\ g++-multilib mingw32 tofrodos libncurses5-dev:i386 \\ python-markdown libxml2-utils xsltproc zlib1g-dev:i386 if [ ! -h /usr/lib/i386-linux-gnu/libGL.so ]; then FA_DoExec ln -s /usr/lib/i386-linux-gnu/mesa/libGL.so.1 \\ /usr/lib/i386-linux-gnu/libGL.so fi # Development support FA_DoExec apt-get -y install \\ dos2unix minicom gawk echo -e \"$&#123;GREEN_COLOR&#125;software install completed.$&#123;END_COLOR&#125;\"&#125; 3.1é…ç½®vimvimçš„é…ç½®æ–‡ä»¶æ¥è‡ªGitHubçš„Amir,æˆ‘å°±ä¸é‡å¤é€ è½®å­äº†ã€‚è¿™é‡Œåªæ˜¯å…ˆcloneä¸‹æ¥ï¼Œç„¶åæ‰§è¡Œå®‰è£…è„šæœ¬ã€‚è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯æ‰§è¡Œè„šæœ¬è¦æŒ‡å®šç”¨æˆ·è¿è¡Œï¼Œä¸ç„¶ä¼šä»¥rootç”¨æˆ·çš„è·¯å¾„è®¾ç½®ï¼Œå¯¼è‡´è„šæœ¬è¿è¡Œé”™è¯¯ã€‚1234567891011# Configure vim form github.vim_configure() &#123; git clone --depth=1 https://github.com/amix/vimrc.git /home/$user_name/.vim_runtime touch /home/$user_name/.vim_runtime/my_configs.vim echo \":set number\" &gt; /home/$user_name/.vim_runtime/my_configs.vim chown -R $user_name /home/$user_name/.vim_runtime chmod u+x /home/$user_name/.vim_runtime/install_awesome_vimrc.sh su - $user_name -s /home/$user_name/.vim_runtime/install_awesome_vimrc.sh&#125; 3.2é…ç½®ftpFTPä¸»è¦æ˜¯ä¿®æ”¹ä¸ºå¯å†™ã€‚åœ¨ä½¿ç”¨MobaXterm SSHç™»é™†åï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å·¦è¾¹çš„Sftpè¿›è¡Œæ–‡ä»¶çš„ä¼ è¾“ï¼Œè²Œä¼¼è¿™ä¸ªå¯ä»¥ä¸ç”¨é…ç½®äº†ã€‚12345# Configure ftp.ftp_configure() &#123; sed -i 's/#loacl_enable=YES/loacl_enable=YES/g' /etc/vsftpd.conf sed -i 's/#write_enable=YES/write_enable=YES/g' /etc/vsftpd.conf&#125; 3.3é…ç½®nfsåœ¨å‰é¢çš„å·¥ä½œæµä¸­ï¼Œå¼€å‘æ¿ç›´æ¥è¿è¡ŒLinuxä¸»æœºä¸­äº¤å‰ç¼–è¯‘å¥½çš„æ¨¡å—ï¼Œæ˜¯é€šè¿‡nfså®ç°çš„ã€‚å› æ­¤éœ€è¦å¼€å‘æ¿å¼€æœºåå°±æŒ‚è½½nfs.ä¹ æƒ¯åœ¨Linuxä¸»æœºä¸­å•ç‹¬å¼€è¾Ÿä¸€ä¸ªè·¯å¾„ä½œä¸ºå·¥ä½œç›®å½•ï¼Œå› æ­¤è¿™é‡Œæ˜¯è®¾ç½®çš„æ•´ä¸ªå·¥ä½œç›®å½•ã€‚12345678910111213# Configure nfs.nfs_configure() &#123; local work_file=/work if [ ! -d \"$work_file\" ];then mkdir /work fi check_status grep \"/work\" /etc/exports 1&gt;/dev/null if [ $? -ne 0 ];then sed -i '$a\\/work *(rw,sync,no_root_squash,no_subtree_check)' /etc/exports fi&#125; 3.4é…ç½®sambasambaä¹Ÿæ˜¯å®ç°å‰é¢å·¥ä½œæµä¸å¯ç¡®å°‘çš„ä¸€ç¯ã€‚è¿™æ ·å°±ä¸ç”¨æ¯æ¬¡ä¿®æ”¹ä»£ç åï¼Œé€šè¿‡ftpä¸Šä¼ åˆ°Linuxä¸»æœºã€‚sambaåœ¨Windowsä¸Šçš„ä½¿ç”¨æ˜¯ï¼šå…ˆWindows+rï¼Œæ‰“å¼€å‘½ä»¤çª—å£ï¼Œç„¶åè¾“å…¥ï¼š\\\\192.168.1.xxï¼Œæœ€åå»ºè®®å³é”®ï¼Œæ˜ å°„ç½‘ç»œé©±åŠ¨ï¼Œæ–¹é¢åç»­æ‰“å¼€ã€‚æµ‹è¯•ä¸­éœ€è¦é‡å¯ç”Ÿæ•ˆã€‚1234567891011121314151617181920212223# Configure samba.samba_configure() &#123; local back_file=/etc/samba/smb.conf.bakup if [ ! -e \"$back_file\" ];then cp /etc/samba/smb.conf $back_file fi check_status grep \"/work\" /etc/samba/smb.conf 1&gt;/dev/null if [ $? -ne 0 ];then sed -i \\ '$a[share_work]\\n\\ path = \\/work\\n\\ available = yes\\n\\ public = yes\\n\\ guest ok = yes\\n\\ read only = no\\n\\ writeable = yes\\n' /etc/samba/smb.conf fi /etc/init.d/samba restart chmod -R 777 /work&#125; 4.å®Œæ•´ä»£ç åŠå¿ƒå¾—[setup_ubuntu_host_env.sh]link123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306#!/bin/bash# -------------------------------------------------------------------------------# Filename: setup_ubuntu_host_env.sh# Revision: 1.0# Date: 2017/08/05# Author: hceng# Email: huangcheng.job@foxmail.com# Website: www.hceng.cn# Function: setup ubuntu host env.# Notes: learn# -------------------------------------------------------------------------------## Description: #1.check env.#1.1 check network #1.2 check use root #1.3 check set name #1.4 configure samba #2.update software sourcev. #3.install vim tmux htop ftp ssh nfs samba.#3.1 configure vim #3.2 configure ftp #3.3 configure nfs #3.4 configure samba #4.install system tool eg:g++ ...## -------------------------------------------------------------------------------#define echo print color.RED_COLOR='\\E[1;31m' PINK_COLOR='\\E[1;35m' YELOW_COLOR='\\E[1;33m' BLUE_COLOR='\\E[1;34m' GREEN_COLOR='\\E[1;32m' END_COLOR='\\E[0m' #Set linux host user name.user_name=hceng# Check network.check_network() &#123; ping -c 1 www.baidu.com &gt; /dev/null 2&gt;&amp;1 if [ $? -eq 0 ];then echo -e \"$&#123;GREEN_COLOR&#125;Network OK.$&#123;END_COLOR&#125;\" else echo -e \"$&#123;RED_COLOR&#125;Network failure!$&#123;END_COLOR&#125;\" exit 1 fi&#125;# Check user must root.check_root() &#123; if [ $(id -u) != \"0\" ]; then echo -e \"$&#123;RED_COLOR&#125;Error: You must be root to run this script, please use root.$&#123;END_COLOR&#125;\" exit 1 fi&#125;# Check set linux host user name.check_user_name() &#123; cat /etc/passwd|grep $user_name if [ $? -eq 0 ];then echo -e \"$&#123;GREEN_COLOR&#125;Check the set user name OK.$&#123;END_COLOR&#125;\" else echo -e \"$&#123;RED_COLOR&#125;Check the set user name failure!$&#123;END_COLOR&#125;\" exit 1 fi&#125;# Check the results of the operation.check_status() &#123; ret=$? if [ \"$ret\" -ne \"0\" ]; then echo -e \"$&#123;RED_COLOR&#125;Failed setup, aborting..$&#123;END_COLOR&#125;\" exit 1 fi&#125;# Get the code name of the Linux host release to the caller.get_host_type() &#123; local __host_type=$1 local the_host=`lsb_release -a 2&gt;/dev/null | grep Codename: | awk &#123;'print $2'&#125;` eval $__host_type=\"'$the_host'\"&#125;#This function will update the source of the software.update_software_source() &#123; local back_file=/etc/apt/sources.list.backup if [ ! -e \"$back_file\" ];then cp /etc/apt/sources.list $back_file fi check_status get_host_type host_release check_status echo \\ \"#Ali source. deb-src http://archive.ubuntu.com/ubuntu $host_release main restricted deb http://mirrors.aliyun.com/ubuntu/ $host_release main restricted deb-src http://mirrors.aliyun.com/ubuntu/ $host_release main restricted multiverse universe deb http://mirrors.aliyun.com/ubuntu/ $host_release-updates main restricted deb-src http://mirrors.aliyun.com/ubuntu/ $host_release-updates main restricted multiverse universe deb http://mirrors.aliyun.com/ubuntu/ $host_release universe deb http://mirrors.aliyun.com/ubuntu/ $host_release-updates universe deb http://mirrors.aliyun.com/ubuntu/ $host_release multiverse deb http://mirrors.aliyun.com/ubuntu/ $host_release-updates multiverse deb http://mirrors.aliyun.com/ubuntu/ $host_release-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ $host_release-backports main restricted universe multiverse deb http://archive.canonical.com/ubuntu $host_release partner deb-src http://archive.canonical.com/ubuntu $host_release partner deb http://mirrors.aliyun.com/ubuntu/ $host_release-security main restricted deb-src http://mirrors.aliyun.com/ubuntu/ $host_release-security main restricted multiverse universe deb http://mirrors.aliyun.com/ubuntu/ $host_release-security universe deb http://mirrors.aliyun.com/ubuntu/ $host_release-security multiverse #Netease source. deb http://mirrors.163.com/ubuntu/ $host_release main restricted universe multiverse deb http://mirrors.163.com/ubuntu/ $host_release-security main restricted universe multiverse deb http://mirrors.163.com/ubuntu/ $host_release-updates main restricted universe multiverse deb http://mirrors.163.com/ubuntu/ $host_release-proposed main restricted universe multiverse deb http://mirrors.163.com/ubuntu/ $host_release-backports main restricted universe multiverse deb-src http://mirrors.163.com/ubuntu/ $host_release main restricted universe multiverse deb-src http://mirrors.163.com/ubuntu/ $host_release-security main restricted universe multiverse deb-src http://mirrors.163.com/ubuntu/ $host_release-updates main restricted universe multiverse deb-src http://mirrors.163.com/ubuntu/ $host_release-proposed main restricted universe multiverse deb-src http://mirrors.163.com/ubuntu/ $host_release-backports main restricted universe multiverse #Official source deb http://archive.ubuntu.com/ubuntu/ $host_release main restricted universe multiverse deb http://archive.ubuntu.com/ubuntu/ $host_release-security main restricted universe multiverse deb http://archive.ubuntu.com/ubuntu/ $host_release-updates main restricted universe multiverse deb http://archive.ubuntu.com/ubuntu/ $host_release-proposed main restricted universe multiverse deb http://archive.ubuntu.com/ubuntu/ $host_release-backports main restricted universe multiverse deb-src http://archive.ubuntu.com/ubuntu/ $host_release main restricted universe multiverse deb-src http://archive.ubuntu.com/ubuntu/ $host_release-security main restricted universe multiverse deb-src http://archive.ubuntu.com/ubuntu/ $host_release-updates main restricted universe multiverse deb-src http://archive.ubuntu.com/ubuntu/ $host_release-proposed main restricted universe multiverse deb-src http://archive.ubuntu.com/ubuntu/ $host_release-backports main restricted universe multiverse\" \\ &gt; /etc/apt/sources.list check_status #apt-get update 1&gt;/dev/null apt-get update check_status echo -e \"$&#123;GREEN_COLOR&#125;Update source completed.$&#123;END_COLOR&#125;\" &#125;# Configure vim form github.vim_configure() &#123; git clone --depth=1 https://github.com/amix/vimrc.git /home/$user_name/.vim_runtime touch /home/$user_name/.vim_runtime/my_configs.vim echo \":set number\" &gt; /home/$user_name/.vim_runtime/my_configs.vim chown -R $user_name /home/$user_name/.vim_runtime chmod u+x /home/$user_name/.vim_runtime/install_awesome_vimrc.sh su - $user_name -s /home/$user_name/.vim_runtime/install_awesome_vimrc.sh&#125;# Configure ftp.ftp_configure() &#123; sed -i 's/#loacl_enable=YES/loacl_enable=YES/g' /etc/vsftpd.conf sed -i 's/#write_enable=YES/write_enable=YES/g' /etc/vsftpd.conf&#125;# Configure nfs.nfs_configure() &#123; local work_file=/work if [ ! -d \"$work_file\" ];then mkdir /work fi grep \"/work\" /etc/exports 1&gt;/dev/null if [ $? -ne 0 ];then sed -i '$a\\/work *(rw,sync,no_root_squash,no_subtree_check)' /etc/exports fi&#125;# Configure samba.samba_configure() &#123; local back_file=/etc/samba/smb.conf.bakup if [ ! -e \"$back_file\" ];then cp /etc/samba/smb.conf $back_file fi check_status grep \"/work\" /etc/samba/smb.conf 1&gt;/dev/null if [ $? -ne 0 ];then sed -i \\ '$a[share_work]\\n\\ path = \\/work\\n\\ available = yes\\n\\ public = yes\\n\\ guest ok = yes\\n\\ read only = no\\n\\ writeable = yes\\n' /etc/samba/smb.conf fi /etc/init.d/samba restart chmod -R 777 /work&#125;# Execute an action.FA_DoExec() &#123; echo -e \"$&#123;BLUE_COLOR&#125;==&gt; Executing: '$&#123;@&#125;'.$&#123;END_COLOR&#125;\" eval $@ || exit $?&#125;# Install list software.install_software() &#123; local install_software_list=\\ (\"git\" \"vim\" \"tmux\" \"htop\" \"vsftpd\" \"openssh-server\" \"nfs-kernel-server\" \"portmap\" \"samba\") echo -e \"$&#123;PINK_COLOR&#125;install_software_list:$&#123;install_software_list[*]&#125;.$&#123;END_COLOR&#125;\" #install git if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"git\");then apt-get -y install git &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;git install completed.$&#123;END_COLOR&#125;\" fi #install and configure vim if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"vim\");then apt-get -y install vim &amp;&amp; vim_configure &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;vim install completed.$&#123;END_COLOR&#125;\" fi #install tmux if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"tmux\");then apt-get -y install tmux &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;tmux install completed.$&#123;END_COLOR&#125;\" fi #install htop if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"htop\");then apt-get -y install htop &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;htop install completed.$&#123;END_COLOR&#125;\" fi #install and configure vsftpd if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"vsftpd\");then apt-get -y install vsftpd &amp;&amp; ftp_configure &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;vsftpd install completed.$&#123;END_COLOR&#125;\" fi #install openssh-server if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"openssh-server\");then apt-get -y install openssh-server &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;openssh-server install completed.$&#123;END_COLOR&#125;\" fi #install and configure nfs-kernel-server if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"nfs-kernel-server\");then apt-get -y install nfs-kernel-server &amp;&amp; nfs_configure &amp;&amp; \\ /etc/init.d/nfs-kernel-server restart &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;nfs-kernel-server install completed.$&#123;END_COLOR&#125;\" fi #install portmap if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"portmap\");then apt-get -y install portmap &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;portmap install completed.$&#123;END_COLOR&#125;\" fi #install and configure samba if (echo \"$&#123;install_software_list[@]&#125;\" | grep -wq \"samba\");then apt-get -y install samba &amp;&amp; samba_configure &amp;&amp; echo -e \"$&#123;BLUE_COLOR&#125;samba install completed.$&#123;END_COLOR&#125;\" fi #others get_host_type host_release FA_DoExec apt-get -y install \\ gnupg flex bison gperf build-essential \\ zip curl libc6-dev libncurses5-dev libncurses5-dev:i386 x11proto-core-dev \\ libx11-dev:i386 libreadline6-dev:i386 \\ libgl1-mesa-glx-lts-$host_release:i386 libgl1-mesa-dev-lts-$host_release \\ g++-multilib mingw32 tofrodos libncurses5-dev:i386 \\ python-markdown libxml2-utils xsltproc zlib1g-dev:i386 if [ ! -h /usr/lib/i386-linux-gnu/libGL.so ]; then FA_DoExec ln -s /usr/lib/i386-linux-gnu/mesa/libGL.so.1 \\ /usr/lib/i386-linux-gnu/libGL.so fi # Development support FA_DoExec apt-get -y install \\ dos2unix minicom gawk echo -e \"$&#123;GREEN_COLOR&#125;software install completed.$&#123;END_COLOR&#125;\"&#125;check_networkcheck_rootcheck_user_nameupdate_software_sourceinstall_softwareecho -e \"$&#123;GREEN_COLOR&#125;===================================================$&#123;END_COLOR&#125;\" echo -e \"$&#123;GREEN_COLOR&#125;============setup ubuntu host env ok!==============$&#123;END_COLOR&#125;\" echo -e \"$&#123;GREEN_COLOR&#125;===================================================$&#123;END_COLOR&#125;\"su $user_name exit 0 å°±ç›®å‰æ¥çœ‹ï¼Œshellè„šæœ¬è¿˜ä¸ç®—å¤ªéš¾ã€‚ä¸»è¦å°±æ˜¯æå–æŸä¸ªæ–‡æœ¬å†…å®¹ï¼Œç„¶ååšå‡ºåˆ¤æ–­ï¼Œå¯¹åº”æ‰§è¡Œã€‚æŠ€å·§æ€§è¿˜æ˜¯è›®å¤šçš„ï¼Œå¾ˆæœ‰ä¹è¶£ã€‚é‡åˆ°è¦å®ç°æŸä¸ªåŠŸèƒ½ï¼Œç™¾åº¦ä¸€ä¸‹ä¹ŸåŸºæœ¬æœ‰ã€‚è°ƒè¯•çš„æ—¶å€™ï¼Œèƒ½å¤Ÿæ‰“å°å‡ºå˜é‡ï¼Œæˆ–è€…æå‡ºå±€éƒ¨ä»£ç è¿›è¡Œè¿è¡Œæµ‹è¯•ï¼Œè¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚ æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"ç¯å¢ƒæ­å»º","slug":"ç¯å¢ƒæ­å»º","permalink":"http://yoursite.com/tags/ç¯å¢ƒæ­å»º/"},{"name":"shell script","slug":"shell-script","permalink":"http://yoursite.com/tags/shell-script/"}]},{"title":"AM437xâ€”â€”LEDè£¸æœº","date":"2017-07-28T15:09:15.000Z","path":"2017/07/28/AM437xâ€”â€”LEDè£¸æœº/","text":"æœ€è¿‘åœ¨ç©AM437Xï¼Œè®°å½•ä¸‹ä¸€äº›å­¦ä¹ è¿‡ç¨‹ã€‚åˆ†ä¸ºè£¸æœºå’Œé©±åŠ¨ã€‚ 0.å‡†å¤‡æ–‡ä»¶ AM437x EVM Schematicï¼ˆåç§°åŸç†å›¾YPï¼‰ am4378ï¼ˆåç§°èŠ¯ç‰‡æ‰‹å†ŒSPï¼‰ spruhl7gï¼ˆåç§°å‚è€ƒæ‰‹å†ŒCPï¼‰ 1.åˆ†æåŸç†å›¾å››ä¸ªLEDç¯ï¼Œå•ç‰‡æœºé€šè¿‡æ§åˆ¶ä¸‰æç®¡çš„é€šæ–­ï¼Œä»è€Œæ§åˆ¶ç¯çš„äº®ç­ã€‚å•ç‰‡æœºé«˜ç”µå¹³ï¼Œä¸‰æç®¡æ‰“é€šï¼Œç¯äº®ï¼Œåä¹‹ä½ç”µå¹³ï¼ŒLEDç­ã€‚D7_Blue å¯¹åº”uart3_txd(GPIO5_3)ï¼›D8_Blue å¯¹åº”uart3_rxd(GPIO5_2)ï¼›D9_Green å¯¹åº”uart3_rtsn(GPIO5_1)ï¼›D10_Red å¯¹åº”uart3_ctsn(GPIO5_0)ï¼› 2.ç¼–å†™ç¨‹åº1.ä½¿èƒ½GPIOå¤–è®¾æ—¶é’Ÿï¼›1PRCM_CM_PER_GPIO5_CLKCTRL = (0x01&lt;&lt;1); 2.è®¾ç½®GPIOæ¨¡å¼ï¼ˆé»˜è®¤ä½¿èƒ½äº†ä¸Šæ‹‰ï¼Œä¸”ä¸ºGPIOæ¨¡å¼ï¼‰ï¼›12345678CTRL_CONF_UART3_RXD &amp;= ~(0x7&lt;&lt;0 | 0x01&lt;&lt;16 | 0x01&lt;&lt;17 | 0x01&lt;&lt;18);//ä½¿èƒ½ä¸Š/ä¸‹æ‹‰ã€å…³é—­è¾“å…¥CTRL_CONF_UART3_RXD |= (0x7&lt;&lt;0 | 0x01&lt;&lt;17);//IOæ¨¡å¼ï¼Œè®¾ç½®ä¸Šæ‹‰CTRL_CONF_UART3_TXD &amp;= ~(0x7&lt;&lt;0 | 0x01&lt;&lt;16 | 0x01&lt;&lt;17 | 0x01&lt;&lt;18);//ä½¿èƒ½ä¸Š/ä¸‹æ‹‰ã€å…³é—­è¾“å…¥CTRL_CONF_UART3_TXD |= (0x7&lt;&lt;0 | 0x01&lt;&lt;17);//IOæ¨¡å¼ï¼Œè®¾ç½®ä¸Šæ‹‰CTRL_CONF_UART3_RTSN &amp;= ~(0x7&lt;&lt;0 | 0x01&lt;&lt;16 | 0x01&lt;&lt;17 | 0x01&lt;&lt;18);//ä½¿èƒ½ä¸Š/ä¸‹æ‹‰ã€å…³é—­è¾“å…¥CTRL_CONF_UART3_RTSN |= (0x7&lt;&lt;0 | 0x01&lt;&lt;17);//IOæ¨¡å¼ï¼Œè®¾ç½®ä¸Šæ‹‰CTRL_CONF_UART3_CTSN &amp;= ~(0x7&lt;&lt;0 | 0x01&lt;&lt;16 | 0x01&lt;&lt;17 | 0x01&lt;&lt;18);//ä½¿èƒ½ä¸Š/ä¸‹æ‹‰ã€å…³é—­è¾“å…¥CTRL_CONF_UART3_CTSN |= (0x7&lt;&lt;0 | 0x01&lt;&lt;17);//IOæ¨¡å¼ï¼Œè®¾ç½®ä¸Šæ‹‰ 3.è®¾ç½®ä¸ºè¾“å‡ºï¼›1GPIO5-&gt;OE &amp;= ~(0x01&lt;&lt;0 | 0x01&lt;&lt;1 | 0x01&lt;&lt;2 | 0x01&lt;&lt;3); 4.è®¾ç½®å…è®¸è¾“å‡ºä½;1GPIO5-&gt;SETDATAOUT |= (0x01&lt;&lt;0 | 0x01&lt;&lt;1 | 0x01&lt;&lt;2 | 0x01&lt;&lt;3); 5.è®¾ç½®è¾“å‡ºå€¼;12GPIO5-&gt;DATAOUT |= (0x01&lt;&lt;0 | 0x01&lt;&lt;1 | 0x01&lt;&lt;2 | 0x01&lt;&lt;3);//é«˜GPIO5-&gt;DATAOUT &amp;= ~(0x01&lt;&lt;0 | 0x01&lt;&lt;1 | 0x01&lt;&lt;2 | 0x01&lt;&lt;3);//ä½ 6.å°è£…æˆå‡½æ•°;å°†å‰é¢çš„1-4æ­¥ï¼Œå°è£…ä¸ºvoid led_init(void);1234567891011121314151617void led_init(void)&#123; PRCM_CM_PER_GPIO5_CLKCTRL = (0x01&lt;&lt;1); CTRL_CONF_UART3_RXD &amp;= ~(0x7&lt;&lt;0 | 0x01&lt;&lt;16 | 0x01&lt;&lt;17 | 0x01&lt;&lt;18); CTRL_CONF_UART3_RXD |= (0x7&lt;&lt;0 | 0x01&lt;&lt;17); CTRL_CONF_UART3_TXD &amp;= ~(0x7&lt;&lt;0 | 0x01&lt;&lt;16 | 0x01&lt;&lt;17 | 0x01&lt;&lt;18); CTRL_CONF_UART3_TXD |= (0x7&lt;&lt;0 | 0x01&lt;&lt;17); CTRL_CONF_UART3_RTSN &amp;= ~(0x7&lt;&lt;0 | 0x01&lt;&lt;16 | 0x01&lt;&lt;17 | 0x01&lt;&lt;18); CTRL_CONF_UART3_RTSN |= (0x7&lt;&lt;0 | 0x01&lt;&lt;17); CTRL_CONF_UART3_CTSN &amp;= ~(0x7&lt;&lt;0 | 0x01&lt;&lt;16 | 0x01&lt;&lt;17 | 0x01&lt;&lt;18); CTRL_CONF_UART3_CTSN |= (0x7&lt;&lt;0 | 0x01&lt;&lt;17); GPIO5-&gt;OE &amp;= ~(0x01&lt;&lt;0 | 0x01&lt;&lt;1 | 0x01&lt;&lt;2 | 0x01&lt;&lt;3); GPIO5-&gt;SETDATAOUT |= (0x01&lt;&lt;0 | 0x01&lt;&lt;1 | 0x01&lt;&lt;2 | 0x01&lt;&lt;3);&#125;å°†å‰é¢çš„ç¬¬5æ­¥æ ¹æ®éœ€æ±‚ï¼Œå°è£…æˆåˆ†åˆ«æ“ä½œæ¯ä¸ªç¯ï¼›æ€»å¼€å…³ï¼ˆ1å¼€0å…³ï¼‰ï¼š1234567void led_switch(unsigned char on_off)&#123; if(on_off) GPIO5-&gt;DATAOUT |= (0x01&lt;&lt;0 | 0x01&lt;&lt;1 | 0x01&lt;&lt;2 | 0x01&lt;&lt;3); else GPIO5-&gt;DATAOUT &amp;= ~(0x01&lt;&lt;0 | 0x01&lt;&lt;1 | 0x01&lt;&lt;2 | 0x01&lt;&lt;3);&#125; æ¯ä¸ªç¯çš„ç‹¬ç«‹å¼€å…³ï¼ˆ1å¼€0å…³ï¼‰ï¼š12345678910111213141516171819202122232425262728293031void led0_switch(unsigned char on_off)&#123; if(on_off) GPIO5-&gt;DATAOUT |= (0x01&lt;&lt;0); else GPIO5-&gt;DATAOUT &amp;= ~(0x01&lt;&lt;0);&#125;void led1_switch(unsigned char on_off)&#123; if(on_off) GPIO5-&gt;DATAOUT |= (0x01&lt;&lt;1); else GPIO5-&gt;DATAOUT &amp;= ~(0x01&lt;&lt;1);&#125;void led2_switch(unsigned char on_off)&#123; if(on_off) GPIO5-&gt;DATAOUT |= (0x01&lt;&lt;2); else GPIO5-&gt;DATAOUT &amp;= ~(0x01&lt;&lt;2);&#125;void led3_switch(unsigned char on_off)&#123; if(on_off) GPIO5-&gt;DATAOUT |= (0x01&lt;&lt;3); else GPIO5-&gt;DATAOUT &amp;= ~(0x01&lt;&lt;3);&#125; 3.ä¸‹è½½è®¾ç½®AM437Xæ”¯æŒå¤šç§æ–¹å¼å¯åŠ¨ï¼Œæ¯”å¦‚ï¼šflash memory, memory cards and UART, USB, or Ethernet.ä»¥åä¼°è®¡ä½¿ç”¨Uç›˜å’ŒSDå¡çš„æƒ…å†µå±…å¤šã€‚Uç›˜å’ŒSDå¡å¯åŠ¨å¯¹imageæœ‰ä¸€å®šçš„æ ¼å¼è¦æ±‚ï¼Œéœ€è¦åŠ ä¸ªå¤´ä¿¡æ¯ã€‚è¯¥éƒ¨åˆ†åœ¨å‚è€ƒæ‰‹å†Œ5.2.9 Image Formatæœ‰ä»‹ç»ï¼Œåé¢æœ‰æ—¶é—´å†åˆ†æã€‚ è¿™é‡Œç›´æ¥ç”¨ç°æˆçš„tiimage.cè¿›è¡ŒåŠ å¤´æ“ä½œã€‚tiimage.cå’Œç¨‹åºçš„äº¤å‰ç¼–è¯‘ï¼Œéƒ½æ˜¯åœ¨Linuxè¿›è¡Œçš„ï¼Œéœ€è¦åšå¦‚ä¸‹æ­¥éª¤ï¼š1.æ¸…ç†ï¼Œäº¤å‰ç¼–è¯‘ï¼›2.ç¼–è¯‘ï¼ŒåŠ å¤´ï¼›3.é‡å‘½åï¼›4.å¤åˆ¶åˆ°SDå¡ï¼ˆUç›˜ï¼‰ï¼› ä¸ºäº†æ–¹ä¾¿ï¼Œå†™äº†è„šæœ¬å®Œæˆä»¥ä¸Šæ“ä½œï¼Œåªéœ€è¦æ’ä¸ŠUç›˜ï¼ˆWindowsä¸‹ï¼‰ï¼Œç„¶åsshç™»é™†æ‰§è¡Œè„šæœ¬å³å¯ã€‚å…³äºå·¥ä½œæµçš„æƒ³æ³•ï¼Œåé¢æ‰¾ä¸ªæ—¶é—´å†™å†™ã€‚ [hceng_am437x_create_MLO.sh]link123456789101112131415161718192021222324252627282930313233#!/bin/bashmyPath=\"/mnt/hgfs/windows/\" #åˆ©ç”¨è™šæ‹Ÿæœº\"æ–‡ä»¶å…±äº«\"WindowsUç›˜çš„è·¯å¾„RED_COLOR='\\E[1;31m' #çº¢GREEN_COLOR='\\E[1;32m' #ç»¿YELOW_COLOR='\\E[1;33m' #é»„BLUE_COLOR='\\E[1;34m' #è“PINK='\\E[1;35m' #ç²‰çº¢RES='\\E[0m' #END#ç”ŸæˆMLOfunction creat_MLO()&#123; rm -f /mnt/hgfs/windows/MLO make clean make gcc ./image_tool/tiimage.c -o tiimage.out ./tiimage.out 0x40300000 MMCSD am437x_hardware.bin /mnt/hgfs/windows/MLO rm -f *.dis *.bin *.o *_elf tiimage.out ls /mnt/hgfs/windows/MLO -l &amp;&amp; echo -e \"$&#123;GREEN_COLOR&#125;======MLO OK!======$&#123;RES&#125;\"\\ || echo -e \"$&#123;RED_COLOR&#125;======MLO ERROR!======$&#123;RES&#125;\" sync&#125;#åˆ¤æ–­Uç›˜è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼›#å­˜åœ¨åˆ™ç”ŸæˆMLOã€æ‹·è´ï¼Œä¸å­˜åœ¨åˆ™æç¤ºæŠ¥é”™if [ ! -d \"$myPath\" ];then echo -e \"$&#123;RED_COLOR&#125;======Check USB Disk!======$&#123;RES&#125;\" else creat_MLO fi syncexit æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"AM437X","slug":"AM437X","permalink":"http://yoursite.com/tags/AM437X/"},{"name":"è£¸æœº","slug":"è£¸æœº","permalink":"http://yoursite.com/tags/è£¸æœº/"}]},{"title":"2017å¹´ä¸­","date":"2017-07-23T14:51:19.000Z","path":"2017/07/23/2017å¹´ä¸­/","text":"2017å¹´ä¸­ï¼Œæ¯•ä¸šã€å·¥ä½œä¹‹é™…ã€‚0x00:è·ç¦»ä¸Šæ¬¡åšå®¢ï¼Œè¿‡å»ä¸¤ä¸ªæœˆäº†ã€‚è¿”æ ¡ç­”è¾©åï¼Œä¸çŸ¥ä¸ºä½•ï¼Œæƒ…ç»ªä½è½äº†å°åŠä¸ªæœˆã€‚0x01:è¿‡å»çš„ä¸¤ä¸ªæœˆé‡Œï¼Œæ¬å‡ºäº†å…¬å¸ï¼Œæ¢äº†ä¸€ä¸ªæˆ‘è¿˜ç®—æ¯”è¾ƒå–œæ¬¢çš„æˆ¿å­ã€‚æ¥æ¥å¥³æœ‹å‹ï¼Œè¿‡ä¸Šäº†ä¸¤ä¸ªäººçš„å°æ—¥å­ã€‚è¶ç€618å…æ¯ï¼Œæ¢äº†ä¸ªå¿«ä¸€ä¸‡çš„ç¬”è®°æœ¬ã€‚æ”¶åˆ°äº†æ¯•ä¸šè¯å’Œå­¦ä½è¯ï¼Œæ‹¿åˆ°äº†è½¬æ­£åçš„ç¬¬ä¸€ä»½å·¥èµ„ã€‚æ­äº†æ¢¯å­ï¼Œç¿»äº†å¢™ï¼Œçœ‹äº†çœ‹å¤–é¢çš„ä¸–ç•Œâ€¦â€¦0x02:ä¹‹å‰ä¸€ç›´å‡†å¤‡æ›´æ–°åšå®¢ï¼Œä½†çªç„¶å‘ç°ä¸€äº›å›¾ç‰‡æŒ‚æ‰äº†ï¼Œé‡æ–°è§„åˆ’äº†ä¸€ä¸‹å›¾åºŠçš„æ–¹æ¡ˆï¼Œå´åˆçªç„¶å¥½äº†ã€‚ä½†ä¸ç®¡æ€æ ·ï¼Œåšå®¢è¿˜å¾—ç»§ç»­åšä¸‹å»ã€‚0x03:å·¥ä½œå†…å®¹æŒºæ‚çš„ï¼Œå”¯ä¸€æ„Ÿåˆ°æ»¡è¶³çš„ç»ˆäºå¼€å§‹ç‹¬ç«‹çš„å†™Linuxé©±åŠ¨äº†å’Œçœ‹è‹±æ–‡æ‰‹å†Œå†™è£¸æœºï¼Œè™½ç„¶æ‰æ˜¯å¼€å§‹ï¼Œè·¯è¿˜å¾ˆé•¿ï¼Œä½†è‡³å°‘å¼€äº†å¤´ã€‚0x04:ç¡®å®è¿˜åœ¨è¿·èŒ«ï¼Œå·¥ä½œè®©æˆ‘å·©å›ºåŸºç¡€ï¼Œä½†ä¹Ÿè®©æˆ‘è§‰å¾—æ²¡æœ‰è·¨è¶Šã€‚å…¶å®å¾ˆç®€å•ï¼Œæƒ³æ¸…æ¥šè‡ªå·±ç›®çš„æ˜¯ä»€ä¹ˆï¼Œéœ€è¦ä»€ä¹ˆï¼Œè¦åšä»€ä¹ˆï¼Œå…ˆåšä»€ä¹ˆï¼Œååšä»€ä¹ˆã€‚ç»™è‡ªå·±ç‚¹å‹åŠ›ï¼Œè®©è‡ªå·±è·‘èµ·æ¥ã€‚2017å¹´ä¸­ï¼Œæ–°çš„å¼€å§‹ã€‚0x05: æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"http://yoursite.com/tags/éšç¬”/"}]},{"title":"ç§»æ¤MiniGUIåˆ°JZ2440","date":"2017-05-26T01:46:37.000Z","path":"2017/05/26/ç§»æ¤MiniGUIåˆ°JZ2440/","text":"å°è¯•å°†MiniGUIåˆ°JZ2440ä¸Šã€‚ç§»æ¤æ‰€éœ€æ–‡ä»¶ï¼š æ–‡ä»¶åŒ…å ä½œç”¨ libminigui-1.6.10.tar.gz MiniGUIå¼€å‘åº“ minigui-res-1.6.10.tar.gz MiniGUIèµ„æºæ–‡ä»¶ mg-samples-1.6.10.tar.gz MiniGUIç¤ºä¾‹ç¨‹åº tslib-1.4.tar.gz è§¦æ‘¸å±åŠŸèƒ½ 1.ç§»æ¤MiniGUI1.1 è§£å‹ã€ç¼–è¯‘MiniGUIå¼€å‘åº“123456tar xzf libminigui-1.6.10.tar.gzcd libminigui-1.6.10/mkdir tmp./configure CC=arm-linux-gcc --prefix=$&#123;PWD&#125;/tmp --build=i386-linux --host=arm-linux --target=arm-linuxmakemake install å®Œæˆä¸Šé¢æ“ä½œï¼Œå³å¯åœ¨tmpç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š å°†ç”Ÿæˆçš„/libä¸‹æ‰€æœ‰æ–‡ä»¶(å’Œå…±äº«åº“ç›¸å…³)æ‹·è´åˆ°å¼€å‘æ¿/libç›®å½•ä¸‹ï¼Œå°†ç”Ÿæˆçš„/etcä¸‹çš„MiniGUI.cfgä¹Ÿæ‹·è´åˆ°å¼€å‘æ¿/etcç›®å½•ä¸‹:12cp â€“rfd ./lib/* /work/hceng/nfs_rootfs/libcp ./etc/* /work/hceng/nfs_rootfs/etc 1.2 è§£å‹MiniGUIèµ„æºæ–‡ä»¶12tar xzf minigui-res-1.6.10.tar.gzcd minigui-res-1.6.10/ ä¿®æ”¹config.linuxï¼ŒæŒ‡å®šç”Ÿæˆæ–‡ä»¶è·¯å¾„ï¼š ç¼–è¯‘ç”Ÿæˆï¼š1make install æ­¤æ—¶ä¼šåœ¨æŒ‡å®šçš„/tmpç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š è¿™äº›æ–‡ä»¶åŒ…å«äº†MiniGUIä¼šä½¿ç”¨åˆ°çš„èµ„æºï¼ŒåŒ…æ‹¬åŸºæœ¬å­—ä½“ã€å›¾æ ‡ã€ä½å›¾å’Œé¼ æ ‡å…‰æ ‡ç­‰ï¼Œå°†è¿™äº›æ–‡ä»¶å…¨éƒ¨å¤åˆ¶åˆ°å¼€å‘æ¿çš„/usr/local/lib/minigui/res/è·¯å¾„ä¸‹ï¼Œè¿™ä¸ªè·¯å¾„æ˜¯å‰é¢MiniGUI.cfgæŒ‡å®šçš„ã€‚ 1.3 ç¼–è¯‘MiniGUIç¤ºä¾‹ç¨‹åº è§£å‹ã€é…ç½®ã€ç¼–è¯‘ï¼š12345tar xzf mg-samples-1.6.10.tar.gzcd mg-samples-1.6.10.tar.gz/./configure CC=arm-linux-gcc --build=i386-linux --host=arm-linux -target=arm-linux CFLAGS=-I/work/minigui/libminigui-1.6.10/tmp/include LDFLAGS=-L/work/minigui/libminigui-1.6.10/tmp/libmakemake install æ­¤æ—¶ä¼šåœ¨/srcç›®å½•ä¸‹ç”Ÿæˆç¤ºä¾‹ç¨‹åºï¼š å¤åˆ¶ç¤ºä¾‹ç¨‹åºåˆ°å¼€å‘æ¿é‡Œé¢å»ï¼Œæ³¨æ„æœ‰äº›ç¨‹åºéœ€è¦æœ¬ç›®å½•ä¸‹çš„å›¾ç‰‡æ–‡ä»¶ï¼Œéœ€è¦ä¸€åŒæ‹·è´è¿‡å»ã€‚è¿™é‡Œä»¥helloworldä¸ºä¾‹ï¼š1cp helloworld /work/hceng/nfs_rootfs/ 1.4 å…¶ä»–ä¿®æ”¹ ä¿®æ”¹å‰é¢å¤åˆ¶åˆ°å¼€å‘æ¿/etcç›®å½•ä¸‹çš„MiniGUI.cfgä»¥é€‚åº”JZ2440ã€‚ åœ¨å¼€å‘æ¿çš„/etcç›®å½•ä¸‹å»ºç«‹ld.so.confæ–‡ä»¶ï¼Œå¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š123/usr/local/lib/usr/lib/lib åœ¨/etc/init.d/rcSè„šæœ¬æ–‡ä»¶é‡Œæ·»åŠ å¦‚ä¸‹å†…å®¹(éå¿…éœ€)ï¼š1/bin/ln â€“s /dev/vc/0 /dev/tty0 ç§»æ¤MiniGUIå®Œæˆï¼Œè¿è¡Œåº”ç”¨ç¨‹åºï¼š 2.ç§»æ¤tslib2.1 å®‰è£…ä¸€äº›å·¥å…·123sudo apt-get install autoconfsudo apt-get install automakesudo apt-get install libtool 2.2 è§£å‹ã€ç¼–è¯‘123456789tar xzf tslib-1.4.tar.gzcd tslib./autogen.sh mkdir tmpecho &quot;ac_cv_func_malloc_0_nonnull=yes&quot; &gt;arm-linux.cache./configure --host=arm-linux --cache-file=arm-linux.cache --prefix=$(pwd)/tmpmakemake install 2.3 å®‰è£…12cd tmpcp * -rfd /work/hceng/nfs_rootfs 2.4 ä¿®æ”¹/etc/ts.confç¬¬1è¡Œ(å»æ‰#å·å’Œç¬¬ä¸€ä¸ªç©ºæ ¼)1# module_raw input æ”¹ä¸ºï¼š1module_raw input 2.5 åœ¨å¼€å‘æ¿è®¾ç½®ç¯å¢ƒå˜é‡123456export TSLIB_TSDEVICE=/dev/event0export TSLIB_CALIBFILE=/etc/pointercalexport TSLIB_CONFFILE=/etc/ts.confexport TSLIB_PLUGINDIR=/lib/tsexport TSLIB_CONSOLEDEVICE=noneexport TSLIB_FBDEVICE=/dev/fb0 2.6 è¿è¡Œæ ¡å‡†ç¤ºä¾‹ç¨‹åº1ts_calibrate å¦‚æœåœ¨è¿è¡Œç¨‹åºçš„æ—¶å€™ï¼Œå‡ºç°æç¤ºï¼š1selected device is not a touchscreen I understand æœ‰æ˜¾ç¤ºï¼Œä½†æ— æ³•è§¦å±ï¼Œå¯èƒ½æ˜¯ç¼–è¯‘å™¨ç‰ˆæœ¬å’Œå†…æ ¸ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š ä¿®æ”¹ç¼–è¯‘å™¨çš„input.hï¼š12cd /usr/local/arm/4.3.2/arm-none-linux-gnueabi/libc/usr/include/linuxsudo vim input.h å°†1#define EV_VERSION 0x010000 æ”¹ä¸ºï¼š1#define EV_VERSION 0x010001 é‡æ–°è¿›è¡Œå‰é¢çš„ç¼–è¯‘å³å¯ï¼Œç¼–è¯‘åï¼Œè®°å¾—æ”¹å›ç¼–è¯‘å™¨çš„ç‰ˆæœ¬ã€‚ 3.MiniGUIå’Œtslibé“¾æ¥ æ­¤æ—¶è™½ç„¶åˆ†åˆ«ç§»æ¤å¥½äº†MiniGUIå’Œtslibï¼Œä½†è§¦å±å¹¶ä¸èƒ½æ­£å¸¸çš„æ§åˆ¶GUIï¼Œéœ€è¦è¿›è¡Œå°†MiniGUIå’Œtslibè¿›è¡Œé“¾æ¥ã€‚ ä½¿ç”¨MiniGUI çš„ IAL å¼•æ“ï¼Œä¿®æ”¹/libminigui-1.6.10/src/ial/ä¸‹çš„dummy.cæˆå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;unistd.h&gt;#include &lt;fcntl.h&gt;#include \"common.h\"#include \"tslib.h\"#ifdef _DUMMY_IAL#include &lt;sys/ioctl.h&gt;#include &lt;sys/poll.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/stat.h&gt;#include &lt;linux/kd.h&gt;#include \"ial.h\"#include \"dummy.h\"#ifndef _DEBUG#define _DEBUG // for debugging#endif/* for storing data reading from /dev/touchScreen/0raw */typedef struct &#123; unsigned short pressure; unsigned short x; unsigned short y; unsigned short pad;&#125; TS_EVENT;static unsigned char state [NR_KEYS];static int mousex = 0;static int mousey = 0;static TS_EVENT ts_event;static struct tsdev *ts;/************************ Low Level Input Operations **********************//** Mouse operations -- Event*/static int mouse_update(void)&#123; return 1;&#125;static void mouse_getxy(int *x, int* y)&#123; if (mousex &lt; 0) mousex = 0; if (mousey &lt; 0) mousey = 0; if (mousex &gt; 639) mousex = 639; if (mousey &gt; 479) mousey = 479;#ifdef _DEBUG // printf (\"mousex = %d, mousey = %d/n\", mousex, mousey);#endif *x = mousex; *y = mousey;&#125;static int mouse_getbutton(void)&#123; return ts_event.pressure;&#125;#ifdef _LITE_VERSIONstatic int wait_event (int which, int maxfd, fd_set *in, fd_set *out, fd_set *except, struct timeval *timeout)#elsestatic int wait_event (int which, fd_set *in, fd_set *out, fd_set *except, struct timeval *timeout)#endif&#123; struct ts_sample sample; int ret = 0; int fd; fd_set rfds; int e; if (!in) &#123; in = &amp;rfds; FD_ZERO (in); &#125;fd = ts_fd(ts); if ((which &amp; IAL_MOUSEEVENT) &amp;&amp; fd &gt;= 0) &#123; FD_SET (fd, in);#ifdef _LITE_VERSION if (fd &gt; maxfd) maxfd = fd;#endif &#125;#ifdef _LITE_VERSION e = select (maxfd + 1, in, out, except, timeout) ;#else e = select (FD_SETSIZE, in, out, except, timeout) ;#endif if (e &gt; 0) &#123; // input events is coming if (fd &gt; 0 &amp;&amp; FD_ISSET (fd, in)) &#123; FD_CLR (fd, in); ts_event.x=0; ts_event.y=0; ret = ts_read(ts, &amp;sample, 1); if (ret &lt; 0) &#123; perror(\"ts_read()\"); exit(-1); &#125; ts_event.x = sample.x; ts_event.y = sample.y; ts_event.pressure = (sample.pressure &gt; 0 ? 4:0); // if (ts_event.pressure &gt; 0 &amp;&amp; if((ts_event.x &gt;= 0 &amp;&amp; ts_event.x &lt;= 639) &amp;&amp; (ts_event.y &gt;= 0 &amp;&amp; ts_event.y &lt;= 479)) &#123; mousex = ts_event.x; mousey = ts_event.y; // printf(\"ts_event.x is %d, ts_event.y is %d-------------------------------------&gt;/n\",ts_event.x ,ts_event.y); &#125;//#ifdef _DEBUG // if (ts_event.pressure &gt; 0) &#123; // printf (\"mouse down: ts_event.x = %d, ts_event.y = %d,ts_event.pressure = %d/n\",ts_event.x,ts_event.y,ts_event.pressure); // &#125;//#endif ret |= IAL_MOUSEEVENT; return (ret); &#125; &#125; else if (e &lt; 0) &#123; return -1; &#125; return (ret);&#125;BOOL InitDummyInput(INPUT* input, const char* mdev, const char* mtype)&#123; char *ts_device = NULL; if ((ts_device = getenv(\"TSLIB_TSDEVICE\")) != NULL) &#123; // open touch screen event device in blocking mode ts = ts_open(ts_device, 0); &#125; else &#123;#ifdef USE_INPUT_API ts = ts_open(\"/dev/input/0raw\", 0);#else ts = ts_open(\"/dev/touchscreen/ucb1x00\", 0);#endif &#125;#ifdef _DEBUG printf (\"TSLIB_TSDEVICE is open!!!!!!!!!!!/n\");#endif if (!ts) &#123; perror(\"ts_open()\"); exit(-1); &#125; if (ts_config(ts)) &#123; perror(\"ts_config()\"); exit(-1); &#125; input-&gt;update_mouse = mouse_update; input-&gt;get_mouse_xy = mouse_getxy; input-&gt;set_mouse_xy = NULL; input-&gt;get_mouse_button = mouse_getbutton; input-&gt;set_mouse_range = NULL; input-&gt;wait_event = wait_event; mousex = 0; mousey = 0; ts_event.x = ts_event.y = ts_event.pressure = 0; return TRUE;&#125;void TermDummyInput(void)&#123; if (ts) ts_close(ts);&#125;#endif /* _DUMMY_IAL */ æŒ‡å®štslib ç›¸å…³çš„å¤´æ–‡ä»¶å’Œå…±äº«åº“æ–‡ä»¶é‡æ–°ç¼–è¯‘libminigui: 12cd /work/minigui/libminigui-1.6.10/./configure CC=arm-linux-gcc --prefix=$&#123;PWD&#125;/tmp --build=i386-linux --host=arm-linux --target=arm-linux CFLAGS=&quot;-I/work/minigui/tslib/tmp/include -L/work/minigui/tslib/tmp/lib -lts&quot; å°†æ–°ç”Ÿæˆçš„/tmp/libä¸‹çš„æ–‡ä»¶è¦†ç›–æ‰å¼€å‘æ¿åŸæ¥çš„æ–‡ä»¶ï¼š 1cp â€“rfd ./lib/* /work/hceng/nfs_rootfs/lib å› ä¸ºå…±äº«æ–‡ä»¶å˜äº†ï¼Œè¿™é‡Œé‡æ–°ç¼–è¯‘ç¤ºä¾‹ç¨‹åºlibminigui: 1./configure CC=arm-linux-gcc --build=i386-linux --host=arm-linux -target=arm-linux CFLAGS=-I/work/minigui/libminigui-1.6.10/tmp/include LDFLAGS=-L/work/minigui/libminigui-1.6.10/tmp/lib å†å°†ç”Ÿæˆçš„åº”ç”¨ç¨‹åºå¤åˆ¶åˆ°å¼€å‘æ¿é‡æ–°è¿è¡Œï¼š 1cp painter /work/hceng/nfs_rootfs/ åœ¨å¼€å‘æ¿è¿è¡Œï¼š 1./ painter æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"ç¯å¢ƒæ­å»º","slug":"ç¯å¢ƒæ­å»º","permalink":"http://yoursite.com/tags/ç¯å¢ƒæ­å»º/"}]},{"title":"PCB_Ruler","date":"2017-05-18T13:48:04.000Z","path":"2017/05/18/PCB-Ruler/","text":"è¿™æ˜¯ä¸€ä¸ªæ¯•ä¸šçš„æ•…äº‹ã€‚0x00 åˆè¡·ï¼š å³å°†å¤§å­¦æ¯•ä¸šï¼Œå¤§å®¶åœ¨ä¸€èµ·äº†å››å¹´ï¼Œæ‰€ä»¥æƒ³åœ¨æ¯•ä¸šä¹‹é™…å‡†å¤‡ä¸ªå°ä¸œè¥¿ä½œä¸ºçºªå¿µå“ã€‚åœ¨è€ƒè™‘ä¸“ä¸šç‰¹è‰²ã€æœ‰æ„ä¹‰ï¼ˆæœ‰ä¸€å®šå®ç”¨æ€§ï¼‰ä¸”ä»·æ ¼ä¸è´µè¿™äº›å› ç´ åï¼Œæˆ‘æƒ³åˆ°åšè¿™ä¸ªPCB_Rulerä¹Ÿè®¸å¯ä»¥ã€‚ 0x01 è¿‡ç¨‹ï¼š æ•´ä¸ªè¿‡ç¨‹ ä¸¤ä¸ªäººåˆ©ç”¨ç©ºé—²æ—¶é—´åˆ¶ä½œï¼Œè¿›è¡Œäº†ä¸€ä¸ªå¤šæœˆï¼Œè¿›è¡Œäº†ä¸‰æ¬¡å¤§ä¿®æ”¹å’ŒPCBæ‰“æ ·ï¼ŒæŠ•å…¥1000å¤šå…ƒã€‚æœ€ååšäº†150å—ï¼Œåˆ†åˆ«é€ç»™äº†ä¸¤ä¸ªç­87ååŒå­¦ã€è‹¥å¹²æœ¬ä¸“ä¸šçš„ä»»è¯¾è€å¸ˆå’Œè¡Œæ”¿è€å¸ˆç­‰ã€‚ 0x02 åŠŸèƒ½ï¼š ä¸»è¦åŠŸèƒ½æ˜¯æµ‹é‡ï¼Œæœ‰cmå’Œmilä¸¤ç§ï¼Œå…¶ä¸­cmæ˜¯æ—¥å¸¸å¸¸ç”¨çš„ï¼Œmilæ˜¯pcbåˆ¶ä½œä¸­ä¸€ç§æ¯”è¾ƒé€šç”¨çš„å•ä½ã€‚ æ­£é¢ï¼šç›´å°ºåŠŸèƒ½ã€æœ‰å¸¸è§çš„ç”µé˜»ç”µå®¹ã€å…ƒå™¨ä»¶çš„å°è£…å‚è€ƒï¼›è¿‡å­”çš„å­”å¾„å¤§å°å‚è€ƒï¼› èƒŒé¢ï¼šèµ°çº¿çº¿å®½å‚è€ƒï¼›å…ƒå™¨ä»¶çš„è„šé—´è·å‚è€ƒï¼›çºªå¿µä¿¡æ¯ï¼› 0x03 æ•ˆæœï¼š 0x04 è‡´è°¢ï¼š æ„Ÿè°¢å’Œæˆ‘ä¸€èµ·åˆ¶ä½œçš„åŒå­¦@å°å†²å†²ï¼ŒæŠ½å‡ºç©ºä½™æ—¶é—´ï¼Œä¸€åŒå®Œæˆæœ¬è®¾è®¡ã€‚ 0x05 æƒé™ï¼šä¸œè¥¿å¼€æºå•¦ï¼Œå¼€æºåœ°å€ï¼šhttps://github.com/hceng/learn/tree/master/PCB_Ruler 0x06 æ¯•ä¸šç…§ï¼š æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"http://yoursite.com/tags/éšç¬”/"},{"name":"PCB","slug":"PCB","permalink":"http://yoursite.com/tags/PCB/"}]},{"title":"Linuxç¯å¢ƒç¼–ç¨‹å­¦ä¹ ","date":"2017-04-30T15:55:30.000Z","path":"2017/04/30/Linuxç¯å¢ƒç¼–ç¨‹/","text":"è®°å½•Linuxç¯å¢ƒä¸‹çš„ç¼–ç¨‹ï¼Œ0åŸºç¡€å¼€å§‹ï¼Œä¸æ–­æ›´æ–°ã€‚æœ€è¿‘åœ¨å­¦ä¹ Linuxç¯å¢ƒç¼–ç¨‹ï¼Œä»¿ä½›æ‰“å¼€äº†æ–°ä¸–ç•Œçš„å¤§é—¨ã€‚åˆå­¦ï¼Œè®¤çŸ¥æœ‰å±€é™ï¼Œä¸æ–­ä¿®æ­£ã€‚ æ–‡ä»¶ç›¸å…³1.fopen[1-fopen.c]link1234567891011121314151617181920212223#include &lt;stdio.h&gt;int main(int argc, const char *argv[])&#123; FILE * fp; unsigned int i = 0; fp = fopen(argv[1], \"w\"); if(fp == NULL) &#123; printf(\"Unable to fopen \\n\"); return -1; &#125;/* printf(\"argc = %d\\n\",argc); for(i; i&lt;argc; i++) &#123; printf(\"argv[%d]=%s\\n\",i,argv[i]); &#125;*/ printf(\"read success \\n\"); fclose(fp); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š fopençš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼šargv[1]ï¼Œæ˜¯è¿è¡Œfopenæ—¶ä¼ å…¥çš„å‚æ•° hceng.txt.fopenå¯¹å…¶å†™æ“ä½œï¼Œä½†æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œå°±è‡ªåŠ¨åˆ›å»ºäº†è¯¥æ–‡ä»¶ã€‚ 2.fopen_max[2-fopen_max.c]link1234567891011121314#include &lt;stdio.h&gt;int main(int argc, const char *argv[])&#123; FILE * fp; int count = 0; fclose(stdin); while((fp = fopen(argv[1], \"r\")) != NULL) count++; printf(\"count = %d \\n\", count); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š æ„å‘³ç€ä¸€ä¸ªæ–‡ä»¶æœ€å¤šè¢«æ‰“å¼€1022æ¬¡ã€‚ 3. fgetc[3-fgetc.c]link123456789101112131415161718192021222324#include &lt;stdio.h&gt;int main(int argc, const char *argv[])&#123; FILE * fp; fp = fopen(argv[1], \"r\"); if(fp == NULL) &#123; printf(\"Unable to fopen\\n\"); return -1; &#125; char ch = fgetc(fp); ch = fgetc(fp); ch = fgetc(fp); //printf(\"ch = %c \\n\", ch); fputc(ch, stdout); putchar(10); fclose(fp); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š fgetcæ¯æ¬¡å¾—åˆ°ä¸€ä¸ªå­—ç¬¦ï¼ˆä¸”è‡ªåŠ¨è·³åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼‰ï¼Œfputcè¿™é‡ŒæŒ‡å®šchå†™åˆ°æ ‡å‡†è¾“å‡ºæµã€‚putcharæ˜¯è¾“å‡ºä¸€ä¸ªå­—ç¬¦çš„æ„æ€ï¼Œè¿™é‡Œå‚æ•°10æ¢æˆasciiç æ˜¯æ¢è¡Œã€‚ 4. cat[4-cat.c]link1234567891011121314151617181920212223#include &lt;stdio.h&gt;int main(int argc, const char *argv[])&#123; FILE *fp_r; char ch; fp_r = fopen(argv[1], \"r\"); if(fp_r == NULL) &#123; // printf(\"Unable to fopen \\n\"); fprintf(stdout, \"Unable to fopen \\n\"); return -1; &#125; while((ch = fgetc(fp_r)) != EOF) &#123; //printf(\"%c\",ch); fputc(ch, stdout); &#125; fclose(fp_r); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š å®ç°ç±»ä¼¼catçš„å‘½ä»¤ï¼Œfgetcä¸€ç›´è·å–å­—ç¬¦åˆ°ç»“å°¾ï¼Œç„¶åfputcä¾æ¬¡æ‰“å°å‡ºæ¥ã€‚ 5. cp[5-cp.c]link123456789101112131415161718192021222324252627282930#include &lt;stdio.h&gt;int main(int argc, const char *argv[])&#123; FILE *fp_r, *fp_w; char ch; fp_r = fopen(argv[1], \"r\"); if(fp_r == NULL) &#123; fprintf(stdout,\"Unable to fopen fp_r\\n\"); return -1; &#125; fp_w = fopen(argv[2], \"w\"); if(fp_w == NULL) &#123; fprintf(stdout, \"Unable to fopen fp_w \\n\"); &#125; while((ch = fgetc(fp_r)) != EOF) &#123; fputc(ch, fp_w); &#125; fclose(fp_r); fclose(fp_w); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š å®ç°ç±»ä¼¼cpçš„å‘½ä»¤ï¼Œfgetcä¸€ç›´è·å–argv[1]å­—ç¬¦åˆ°ç»“å°¾ï¼Œç„¶åfputcå†™åˆ°argv[2]ã€‚ 6. line[6-line.c]link1234567891011121314151617181920212223242526#include &lt;stdio.h&gt;int main(int argc, const char *argv[])&#123; FILE *fp_r; char ch; int line = 0; fp_r = fopen(argv[1], \"r\"); if(fp_r == NULL) &#123; fprintf(stdout, \"Unable to fopen \\n\"); return -1; &#125; while((ch = fgetc(fp_r)) != EOF) &#123; if(ch == '\\n') line++; &#125; printf(\"line = %d \\n\",line); fclose(fp_r); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š è·å–æ–‡ä»¶è¡Œæ•°ï¼Œfgetcä¸€ç›´è¯»åˆ°ç»“å°¾ï¼Œé‡åˆ°\\nåˆ™è¡¨ç¤ºæ¢è¡Œï¼Œå³è¡Œæ•°+1ã€‚ 7. fgets[7-fgets.c]link1234567891011121314151617181920212223#include &lt;stdio.h&gt;#define N 32int main(int argc, const char *argv[])&#123; FILE *fp_r; char buf[N] = &#123;0&#125;; fp_r = fopen(argv[1], \"r\"); if(fp_r == NULL) &#123; fprintf(stdout, \"Unable to fopen fp_r \\n\"); return -1; &#125; fgets(buf, 32, fp_r); fputs(buf, stdout); fclose(fp_r); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š è·å–æ–‡ä»¶å­—ç¬¦ä¸²ï¼Œè¿™é‡Œè¦è®¾ç½®è¯»å–çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ„Ÿè§‰æœ‰ç‚¹å±€é™ã€‚åº”è¯¥æ˜¯è¯†åˆ«ä»¥\\nç»“å°¾ï¼Œè¿™é‡Œä¸€æ¬¡åªè¯»å–äº†ä¸€è¡Œã€‚ 8. fgets_cp[8-fgets_cp.c]link123456789101112131415161718192021222324252627282930#include &lt;stdio.h&gt;#define N 32int main(int argc, const char *argv[])&#123; FILE *fp_r, *fp_w; char buf[N] = &#123;0&#125;; fp_r = fopen(argv[1], \"r\"); if(fp_r == NULL) &#123; fprintf(stdout, \"Unable to fopen fp_r \\n\"); return -1; &#125; fp_w = fopen(argv[2], \"w\"); if(fp_w == NULL) &#123; fprintf(stdout, \"Unable to fopen fp_w \\n\"); return -1; &#125; while(fgets(buf, 16, fp_r) != NULL) fputs(buf, fp_w); fclose(fp_r); fclose(fp_w); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š ä»¥fgetsçš„æ–¹å¼è·å–ä¸€è¡Œï¼Œå†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œä»¥å®ç°cpçš„åŠŸèƒ½ã€‚åˆ¤æ–­çš„ä¾æ®æ˜¯fgetsè·å–çš„æ˜¯éç©º 9. fread_fwrite[9-fread_fwrite.c]link12345678910111213141516171819202122232425262728#include &lt;stdio.h&gt;#define N 32int main(int argc, const char *argv[])&#123; FILE *fp_r, *fp_w; char buf[N] = &#123;0&#125;; fp_r = fopen(argv[1], \"r\"); if(fp_r == NULL) &#123; fprintf(stdout, \"Unable to fopen fp_r\\n\"); return -1; &#125; fp_w = fopen(argv[2], \"w\"); if(fp_w == NULL) &#123; fprintf(stdout, \"Unable to fopen fp_w\\n\"); return -1; &#125; size_t bytes = fread(buf, 5, 3, fp_r); fwrite(buf, 5, 2, fp_w); //printf(\"bytes = %d \\n\",bytes); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š fread/ fwriteç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æŒ‡å‘è¯»å–/å†™å…¥çš„ç¼“å†²æ•°æ®ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å®šä¹‰æ¯ä¸ªæ•°æ®ç±»å‹çš„å¤§å°ï¼Œç¬¬ä¸‰ä¸ªæ˜¯å®šä¹‰çš„æ•°æ®ç±»å‹ä¸ªæ•°ï¼Œæœ€åæ˜¯æŒ‡å‘æ“ä½œçš„æ–‡ä»¶æŒ‡é’ˆã€‚ 10.å®ä¾‹ æ—¶é—´ç¼–ç¨‹é¢˜ç›®è¦æ±‚ï¼šç¼–ç¨‹è¯»å†™ä¸€ä¸ªæ–‡ä»¶test.txtï¼Œæ¯éš”1ç§’å‘æ–‡ä»¶ä¸­å†™å…¥ä¸€è¡Œæ•°æ®ï¼Œç±»ä¼¼è¿™æ ·ï¼š1, 2007-7-30 15:16:422, 2007-7-30 15:16:43è¯¥ç¨‹åºåº”è¯¥æ— é™å¾ªç¯ï¼Œç›´åˆ°æŒ‰Ctrl-Cä¸­æ–­ç¨‹åºã€‚å†æ¬¡å¯åŠ¨ç¨‹åºå†™æ–‡ä»¶æ—¶å¯ä»¥è¿½åŠ åˆ°åŸæ–‡ä»¶ä¹‹åï¼Œå¹¶ä¸”åºå·èƒ½å¤Ÿæ¥ç»­ä¸Šæ¬¡çš„åºå·ï¼Œæ¯”å¦‚ï¼š1, 2007-7-30 15:16:422, 2007-7-30 15:16:433, 2007-7-30 15:19:024, 2007-7-30 15:19:035, 2007-7-30 15:19:04 æç¤ºï¼šè¦è¿½åŠ å†™å…¥æ–‡ä»¶ï¼ŒåŒæ—¶è¦è¯»å–è¯¥æ–‡ä»¶çš„å†…å®¹ä»¥å†³å®šä¸‹ä¸€ä¸ªåºå·æ˜¯å‡ ï¼Œåº”è¯¥ç”¨ä»€ä¹ˆæ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼Ÿé¦–å…ˆåˆ¤æ–­ä¸€ä¸‹æ‰“å¼€çš„æ–‡ä»¶æ˜¯å¦ä¸ºæ–°æ–‡ä»¶ï¼Œå¦‚æœæ˜¯æ–°æ–‡ä»¶ï¼Œå°±ä»åºå·1å¼€å§‹å†™å…¥ï¼›å¦‚æœä¸æ˜¯æ–°æ–‡ä»¶ï¼Œåˆ™ç»Ÿè®¡åŸæ¥æœ‰å¤šå°‘è¡Œï¼Œæ¯”å¦‚æœ‰nè¡Œï¼Œç„¶åä»åºå·n+1å¼€å§‹å†™å…¥ã€‚ä»¥åæ¯å†™ä¸€è¡Œå°±æŠŠè¡Œå·åŠ 1ã€‚è·å–å½“å‰çš„ç³»ç»Ÿæ—¶é—´éœ€è¦è°ƒç”¨å‡½æ•°time()ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ä¸€ä¸ªtime_tç±»å‹ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå¤§æ•´æ•°ï¼Œå…¶å€¼è¡¨ç¤ºä»UTCæ—¶é—´1970å¹´1æœˆ1æ—¥00:00:00ï¼ˆç§°ä¸ºUNIXçš„Epochæ—¶é—´ï¼‰åˆ°å½“å‰æ—¶åˆ»çš„ç§’é’Ÿæ•°ã€‚ç„¶åè°ƒç”¨localtime()å°†time_tæ‰€è¡¨ç¤ºçš„UTCæ—¶é—´è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´ï¼ˆæˆ‘ä»¬æ˜¯+8åŒºï¼Œæ¯”UTCå¤š8ä¸ªå°æ—¶ï¼‰å¹¶è½¬æˆstruct tmç±»å‹ï¼Œè¯¥ç±»å‹çš„å„æ•°æ®æˆå‘˜åˆ†åˆ«è¡¨ç¤ºå¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼Œè¯·è‡ªå·±å†™å‡ºè½¬æ¢æ ¼å¼çš„ä»£ç ï¼Œä¸è¦ä½¿ç”¨ctime()æˆ–asctime()å‡½æ•°ã€‚å…·ä½“ç”¨æ³•è¯·æŸ¥é˜…man pageã€‚timeå’Œlocaltimeå‡½æ•°éœ€è¦å¤´æ–‡ä»¶time.hã€‚è°ƒç”¨sleep(n)å¯ä½¿ç¨‹åºç¡çœ nç§’ï¼Œè¯¥å‡½æ•°éœ€è¦å¤´æ–‡ä»¶unistd.h [hceng_time.c]link1234567891011121314151617181920212223242526272829303132333435363738394041424344454647/************************************************************************* &gt; File Name: hceng_time.c &gt; Author:hceng &gt; Mail: huangcheng.job@foxmail.com &gt; Created Time: Wed 26 Apr 2017 06:48:22 AM UTC ************************************************************************/#include &lt;stdio.h&gt;#include &lt;time.h&gt;#include &lt;unistd.h&gt;int main(int argc, const char *argv[])&#123; FILE *fd; char ch; unsigned int line = 0; time_t *get_time; struct tm *local_time; //add data to file fd = fopen(argv[1], \"a+\"); if(fd == NULL) &#123; fprintf(stderr,\"can't open file!\"); return -1; &#125; //get line while((ch = fgetc(fd)) != EOF) &#123; if(ch == '\\n') ++line; &#125; //show while(1) &#123; time(get_time); local_time = localtime(get_time); fprintf(fd,\"%d. %d-%d-%d %d:%d:%d\\n\",++line,local_time-&gt;tm_year+1900,local_time-&gt;tm_mon,local_time-&gt;tm_mday,local_time-&gt;tm_hour,local_time-&gt;tm_min,local_time-&gt;tm_sec); printf(\"%d. %d-%d-%d %d:%d:%d\\n\",line,local_time-&gt;tm_year+1900,local_time-&gt;tm_mon,local_time-&gt;tm_mday,local_time-&gt;tm_hour,local_time-&gt;tm_min,local_time-&gt;tm_sec); fflush(fd); sleep(1); &#125; fclose(fd); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š å…ˆä»¥è¿½åŠ çš„æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼ˆæ²¡æœ‰åˆ™åˆ›å»ºï¼‰ï¼Œç„¶åè·å–æ–‡ä»¶è¡Œæ•°ï¼Œå†è·å–æ—¶é—´ä¸”è½¬æ¢æˆæœ¬åœ°æ—¶é—´ï¼Œç„¶åæŒ‰æ ¼å¼è¦æ±‚æ‰“å°ä¿¡æ¯ã€‚ è¿›ç¨‹ç›¸å…³1.fork1[fork.c]link12345678910111213141516171819202122232425262728293031#include &lt;unistd.h&gt;#include &lt;stdio.h&gt;int main(int argc, const char *argv[])&#123; pid_t pid; printf(\"hello world\\n\"); pid = fork(); printf(\"pid = %d\\n\",pid); if(pid &lt; 0) &#123; perror(\"Unable to fork\"); return -1; &#125; if(pid == 0) &#123; //å­è¿›ç¨‹ printf(\"child process parent %d ,child = %d\\n\",getppid(), getpid()); &#125; else &#123; //çˆ¶è¿›ç¨‹: printf(\"parent process = %d, child = %d\\n\", getpid(), pid); &#125; while(1); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š é¦–å…ˆçˆ¶è¿›ç¨‹forkäº†è‡ªå·±ï¼Œè¿”å›äº†å­è¿›ç¨‹çš„PIDï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚ç„¶åç»§ç»­æ‰§è¡Œï¼Œæ‰“å°å‡ºè‡ªå·±çš„PIDå’Œå­è¿›ç¨‹PIDã€‚å­è¿›ç¨‹äº§ç”Ÿäº†å’Œçˆ¶è¿›ç¨‹ä¸€æ¨¡ä¸€æ ·çš„ä»£ç ï¼Œç„¶åä»forkå¤„å¼€å§‹æ‰§è¡Œï¼Œå­è¿›ç¨‹forkè¿”å›çš„çš„å›ºå®šä¸º0ï¼Œç„¶ågetppiæ‰“å°å‡ºçˆ¶è¿›ç¨‹PIDï¼Œgetpidæ‰“å°å‡ºè‡ªå·±çš„PIDã€‚ ä»PSå¯ä»¥çœ‹åˆ°çˆ¶è¿›ç¨‹PIDä¸ºï¼š11370ï¼Œå­è¿›ç¨‹ä¸ºï¼š11371. æ³¨ï¼šä¸€èˆ¬forkåæ˜¯çˆ¶è¿›ç¨‹ç»§ç»­è¿è¡Œï¼Œä½†å¦‚æœçˆ¶è¿›ç¨‹æ—¶é—´ç‰‡ç”¨å®Œäº†ï¼Œåˆ™å­è¿›ç¨‹ä¼šå…ˆè¿›è¡Œï¼Œæ‰€ä»¥è¿™é‡Œçš„æ‰“å°é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œå¦‚æœè¦ç¡®å®šï¼Œéœ€è¦åŒæ­¥ã€‚ 2.fork2[fork_1.c]link12345678910111213141516171819202122232425262728#include &lt;unistd.h&gt;#include &lt;stdio.h&gt;int main(int argc, const char *argv[])&#123; pid_t pid; pid = fork(); if(pid &lt; 0) &#123; perror(\"Unable to fork\"); return -1; &#125; if(pid == 0) &#123; //å­è¿›ç¨‹ printf(\"child process parent %d ,child = %d\\n\",getppid(), getpid()); &#125; else &#123; //çˆ¶è¿›ç¨‹: printf(\"parent process = %d, child = %d\\n\", getpid(), pid); while(1); &#125; return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š è¿™é‡Œçˆ¶è¿›ç¨‹æœ‰ä¸ªwhilehä¼šä¸€ç›´æ‰§è¡Œï¼ŒäºŒå­ç¨‹åºæ²¡æœ‰ã€‚åœ¨PSä¸­å¯ä»¥çœ‹åˆ°å­è¿›ç¨‹ï¼ˆ12173ï¼‰è¢«æ ‡è®°ä¸ºdefunct(åƒµå°¸è¿›ç¨‹)ã€‚ åœ¨Linuxç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹ç»“æŸäº†ï¼Œä½†æ˜¯ä»–çš„çˆ¶è¿›ç¨‹æ²¡æœ‰ç­‰å¾…(è°ƒç”¨wait / waitpid)ä»–ï¼Œé‚£ä¹ˆä»–å°†å˜æˆä¸€ä¸ªåƒµå°¸è¿›ç¨‹ã€‚å½“ç”¨pså‘½ä»¤è§‚å¯Ÿè¿›ç¨‹çš„æ‰§è¡ŒçŠ¶æ€æ—¶ï¼Œçœ‹åˆ°è¿™äº›è¿›ç¨‹çš„çŠ¶æ€æ ä¸ºdefunctã€‚åƒµå°¸è¿›ç¨‹æ˜¯ä¸€ä¸ªæ—©å·²æ­»äº¡çš„è¿›ç¨‹ï¼Œä½†åœ¨è¿›ç¨‹è¡¨ï¼ˆprocesss tableï¼‰ä¸­ä»å äº†ä¸€ä¸ªä½ç½®ï¼ˆslotï¼‰ã€‚ ä½†æ˜¯å¦‚æœè¯¥è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å·²ç»å…ˆç»“æŸäº†ï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹å°±ä¸ä¼šå˜æˆåƒµå°¸è¿›ç¨‹ã€‚å› ä¸ºæ¯ä¸ªè¿›ç¨‹ç»“æŸçš„æ—¶å€™,ç³»ç»Ÿéƒ½ä¼šæ‰«æå½“å‰ç³»ç»Ÿä¸­æ‰€è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å“ªä¸ªè¿›ç¨‹æ˜¯åˆšåˆšç»“æŸçš„è¿™ä¸ªè¿›ç¨‹çš„å­è¿›ç¨‹ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°±ç”±Initè¿›ç¨‹æ¥æ¥ç®¡ä»–ï¼Œæˆä¸ºä»–çš„çˆ¶è¿›ç¨‹ï¼Œä»è€Œä¿è¯æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ã€‚è€ŒInitè¿›ç¨‹ä¼šè‡ªåŠ¨waitå…¶å­è¿›ç¨‹,å› æ­¤è¢«Initæ¥ç®¡çš„æ‰€æœ‰è¿›ç¨‹éƒ½ä¸ä¼šå˜æˆåƒµå°¸è¿›ç¨‹ã€‚ 3.fork3[fork_2.c]link123456789101112131415161718192021222324252627282930313233343536#include &lt;unistd.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;wait.h&gt;int main(int argc, const char *argv[])&#123; pid_t pid; pid = fork(); if(pid &lt; 0) &#123; perror(\"Unable to fork\"); return -1; &#125; if(pid == 0) &#123; //å­è¿›ç¨‹ printf(\"child process parent %d ,child = %d\\n\",getppid(), getpid()); exit(0); &#125; else &#123; //çˆ¶è¿›ç¨‹: int status; sleep(4); wait(&amp;status); printf(\"child exit\\n\"); sleep(4); printf(\"parent status = %d\\n\", status); &#125; return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š è¿™é‡Œå¤šäº†ä¸ªwaitæ¥ç›‘æ§å­è¿›ç¨‹ã€‚å½“çˆ¶è¿›ç¨‹æ‰§è¡Œwaitæ—¶ï¼Œç«‹å³è¢«é˜»å¡ï¼Œç›´åˆ°å­è¿›ç¨‹é€€å‡ºï¼Œæ‰ç»§ç»­æ‰§è¡Œåç»­çš„ã€‚ç¬¬ä¸€ä¸ªsleep(4)æ—¶ï¼ŒPSçœ‹åˆ°çˆ¶è¿›ç¨‹ä¸º15167,å­è¿›ç¨‹15168ä¸ºåƒµå°¸çŠ¶æ€ï¼Œæ‰§è¡Œwaitæ—¶ï¼Œè‡ªåŠ¨å›æ”¶åƒµå°¸è¿›ç¨‹ã€‚ç­‰å›æ”¶å®Œäº†ï¼Œçˆ¶è¿›ç¨‹ç»“æŸé˜»å¡ï¼Œç»§ç»­æ‰§è¡Œåˆ°ç»“æŸã€‚ 4.exitå’Œ_exit12345678910111213#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;//#include &lt;stdlib.h&gt;int main(int argc, const char *argv[])&#123; printf(\"hello world\"); _exit(5); //exit(5); printf(\"hello Shenzhen\\n\"); return 0;&#125; 123456789101112#include &lt;stdio.h&gt;//#include &lt;unistd.h&gt;#include &lt;stdlib.h&gt;int main(int argc, const char *argv[])&#123; printf(\"hello world\"); //_exit(5); exit(5); printf(\"hello Shenzhen\\n\"); return 0;&#125; 123456789101112#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;//#include &lt;stdlib.h&gt;int main(int argc, const char *argv[])&#123; printf(\"hello world\\n\"); _exit(5); //exit(5); printf(\"hello Shenzhen\\n\"); return 0;&#125; åˆ†æï¼š _exit()æ‰§è¡Œåç«‹å³è¿”å›ç»™å†…æ ¸ï¼Œè€Œexit()è¦å…ˆæ‰§è¡Œä¸€äº›æ¸…é™¤æ“ä½œï¼Œç„¶åå°†æ§åˆ¶æƒäº¤ç»™å†…æ ¸ã€‚è°ƒç”¨_exitå‡½æ•°æ—¶ï¼Œå…¶ä¼šå…³é—­è¿›ç¨‹æ‰€æœ‰çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ¸…ç†å†…å­˜ä»¥åŠå…¶ä»–ä¸€äº›å†…æ ¸æ¸…ç†å‡½æ•°ï¼Œä½†ä¸ä¼šåˆ·æ–°æµ(stdin, stdout, stderr â€¦)ã€‚exitå‡½æ•°æ˜¯åœ¨_exitå‡½æ•°ä¹‹ä¸Šçš„ä¸€ä¸ªå°è£…ï¼Œå…¶ä¼šè°ƒç”¨_exitï¼Œå¹¶åœ¨è°ƒç”¨ä¹‹å‰å…ˆåˆ·æ–°æµã€‚å› æ­¤æ‰ä¼šçœ‹åˆ°é‡åˆ°_exitå¹¶ä¸ä¼šæ‰“å°ï¼Œå› ä¸ºæ•°æ®åœ¨â€œIOç¼“å­˜â€ï¼Œè€Œexitä¼šåˆ·æ–°æµï¼Œå¯¼è‡´æ‰“å°è¾“å‡ºã€‚ å¸¦ä¸‰ä¸ªä¾‹å­åŠ ä¸ª\\nï¼Œä½¿ç”¨_exitä¹Ÿæ‰“å°å‡ºæ¥äº†ï¼Œ printfå‡½æ•°å°±æ˜¯ä½¿ç”¨ç¼“å†²I/Oçš„æ–¹å¼ï¼Œè¯¥å‡½æ•°åœ¨é‡åˆ°â€œ\\nâ€æ¢è¡Œç¬¦æ—¶è‡ªåŠ¨çš„ä»ç¼“å†²åŒºä¸­å°†è®°å½•è¯»å‡ºã€‚ å‚è€ƒæ–‡ç«  5.daemon1ã€ä½•ä¸ºå®ˆæŠ¤è¿›ç¨‹ï¼Ÿï¼ˆ1ï¼‰daemon:å®ˆæŠ¤è¿›ç¨‹ã€ åå°ç¨‹åºç®€ç§°æ˜¯dï¼Œï¼ˆä¸€èˆ¬å¸¦æœ‰dçš„éƒ½æ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼ˆ2ï¼‰é•¿æœŸè¿è¡Œï¼š ä»ç³»ç»Ÿå¯åŠ¨æ—¶å¼€å§‹è¿è¡Œï¼Œåˆ°ç³»ç»Ÿå…³é—­æ—¶ç»“æŸ(è¿è¡Œå‘¨æœŸ)ï¼ˆ3ï¼‰ä¸æ§åˆ¶å°è„±ç¦»ï¼ˆç»ˆç«¯ï¼‰ï¼šå®ˆæŠ¤è¿›ç¨‹å¯åŠ¨åï¼Œè„±ç¦»æ§åˆ¶å°ï¼Œä¸å—ç»ˆç«¯æ§åˆ¶ï¼ŒèƒŒåçš„é—®é¢˜æ˜¯ä¼šè¯ï¼ˆ4ï¼‰æœåŠ¡å™¨ï¼šæ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œä½¿ç”¨æ—¶ç›´æ¥è°ƒç”¨å®šä¹‰ï¼š æ˜¯ä¸€ä¸ªåœ¨åå°è¿è¡Œï¼Œå¹¶ä¸”ä¸å—ç»ˆç«¯æ§åˆ¶çš„æœåŠ¡ç¨‹åºï¼2ã€ç¼–å†™å®ˆæŠ¤è¿›ç¨‹ï¼ˆ1ï¼‰åˆ›å»ºçˆ¶å­è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹é€€å‡º ï¼ˆå­¤å„¿è¿›ç¨‹ï¼‰ï¼ˆ2ï¼‰åœ¨å­è¿›ç¨‹ä¸­è®¾ç½®æ–°çš„ä¼šè¯ ï¼ˆsetsidï¼‰ï¼ˆ3ï¼‰æ”¹å˜å½“å‰ç›®å½•ä¸ºæ ¹ç›®å½•ï¼ˆ4ï¼‰é‡è®¾æ–‡ä»¶æƒé™æ©ç  ï¼ˆå¢åŠ å¯¹æ–‡ä»¶æ“ä½œçµæ´»æ€§ï¼‰ï¼ˆ5ï¼‰å…³é—­æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦åˆ›å»ºå®Œå®ˆæŠ¤è¿›ç¨‹ä¹‹åï¼Œè¦åŠ å…¥æœåŠ¡ç¨‹åºï¼Œå¹¶ä¸”è¦åœ¨whileå¾ªç¯ä¹‹ä¸­å®ç°ã€‚å‚è€ƒæ–‡ç« 1ï¼›å‚è€ƒæ–‡ç« 2ï¼› [dameon.c]link12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/stat.h&gt;#include &lt;fcntl.h&gt;#include &lt;stdlib.h&gt;int main(int argc, const char *argv[])&#123; pid_t pid; pid = fork(); if(pid &lt; 0) &#123; perror(\"Unable to fork\"); exit(1); &#125; if(pid == 0) &#123; //åˆ›å»ºæ–°çš„ä¼šè¯ï¼Œè®©å­è¿›ç¨‹æˆä¸ºä¼šè¯ç»„çš„é¢†å¯¼è€…ï¼Œä¸å—ç»ˆç«¯æ§åˆ¶ setsid(); //æ”¹å˜å½“å‰ç›®å½•ä¸ºæ ¹ç›®å½• chdir(\"/\"); //é‡è®¾æ–‡ä»¶æƒé™æ©ç  umask(0); //å…³é—­æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ int i, fd_w; char buf[] = &#123;\"hello world\\n\"&#125;; //getdtablesize()è¿”å›è¿™ä¸ªè¿›ç¨‹çš„æ–‡ä»¶æè¿°è¡¨çš„é¡¹æ•° for(i = 0; i &lt; getdtablesize(); i++) close(i); fd_w = open(\"/test123.txt\", O_CREAT | O_WRONLY | O_APPEND, 0666); if(fd_w &lt; 0) &#123; perror(\"Unalbe to open\"); exit(1); &#125; while(1) &#123; write(fd_w, buf, 20); sleep(1); &#125; close(fd_w); &#125; else &#123; exit(0); &#125; return 0;&#125; æµ‹è¯•ç»“æœï¼šps -ajxåˆ†æï¼š å®ˆæŠ¤è¿›ç¨‹ç”¨äºä¸€ç›´åå°è¿è¡Œï¼Œä¸”ä¸å—ç»ˆç«¯æ§åˆ¶ã€‚ç¼–å†™å®ˆæŠ¤ç¨‹åºæœ‰5æ­¥ï¼Œå‚è€ƒå‰é¢çš„ä»‹ç»ã€‚ 6.exec[exec.c]link12345678910111213141516171819202122232425262728293031323334#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;stdlib.h&gt;int main(int argc, const char *argv[])&#123; printf(\"hello start \\n\");#if 1 if(execl(\"/bin/ls\", \"ls\", \"-l\", \"-a\", NULL) &lt; 0) &#123; perror(\"Unable to execl\"); exit(1); &#125;#endif#if 0 if(execlp(\"ls\", \"ls\", \"-l\", \"-a\", NULL) &lt; 0) &#123; perror(\"Unable to execl\"); exit(1); &#125;#endif#if 0 char *arg[] = &#123;\"ls\", \"-la\", NULL&#125;; if(execv(\"/bin/ls\", arg) &lt; 0) &#123; perror(\"Unable to execl\"); exit(1); &#125;#endif printf(\"hello end \\n\"); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š è¿™é‡Œçš„ä¸‰ä¸ªexecç³»åˆ—å‡½æ•°çš„æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ã€‚è°ƒç”¨æŸä¸ªæ–°ç¨‹åºåï¼Œå°±æŠŠè‡ªå·±è¦†ç›–äº†ï¼Œæ‰€ä»¥æœ€åçš„hello endæ‰æ²¡æ‰“å°ã€‚ åŒºåˆ«å¦‚ä¸‹ï¼š å¸¦â€œpâ€çš„è¡¨ç¤ºPATHæœ‰å…³ï¼› å¸¦â€œlâ€çš„è¡¨ç¤ºlist,ä¸æ•°ç»„æœ‰å…³ï¼› å¸¦â€œvâ€çš„è¡¨ç¤ºvectorï¼› å¸¦â€œeâ€çš„è¡¨ç¤ºenvironmentï¼Œå°†ä½¿ç”¨è°ƒç”¨è€…çš„environï¼› çº¿ç¨‹ç›¸å…³ çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿçº¿ç¨‹æ˜¯ä¸€ä¸ªè½»é‡çº§çš„è¿›ç¨‹ï¼Œå†…æ ¸ä¹Ÿä¼šè°ƒåº¦çº¿ç¨‹ï¼Œçº¿ç¨‹åœ¨è¿›ç¨‹å½“ä¸­åˆ›å»ºã€‚ è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿçº¿ç¨‹æ²¡æœ‰è‡ªå·±ç‹¬äº«çš„èµ„æºï¼Œå› æ­¤æ²¡æœ‰è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œä»–è¦ä¾é™„åœ¨è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­å€ŸåŠ©è¿›ç¨‹çš„èµ„æºè¿è¡Œã€‚çº¿ç¨‹ä¼˜ç‚¹ï¼šæ•°æ®å…±äº«å¾ˆç®€å•ï¼Œåˆ›å»ºçº¿ç¨‹çš„è¦å¿«äºåˆ›å»ºè¿›ç¨‹ï¼›çº¿ç¨‹ç¼ºç‚¹ï¼šå®‰å…¨æ€§ã€ç›¸äº’ä¹‹é—´å®¹æ˜“å½±å“ã€æœ‰é™çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼› çº¿ç¨‹é—´å¦‚ä½•å®ç°é€šä¿¡ï¼Ÿ å…¨å±€å˜é‡ã€æ•°ç»„ çº¿ç¨‹æ ‡è¯†ç¬¦ï¼šç”¨æ¥å”¯ä¸€çš„è¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹ï¼Œé€šè¿‡è°ƒç”¨çº¿ç¨‹åº“æ¥å®ç°å¯¹çº¿ç¨‹çš„è®¿é—®æ“ä½œã€‚ çº¿ç¨‹ç›¸å…³å‡½æ•°ï¼š1ã€åˆ›å»º â€“ã€‹ pthread_create2ã€å›æ”¶çº¿ç¨‹ â€“ã€‹ pthread_join3ã€ç»“æŸçº¿ç¨‹ â€“ã€‹ pthread_exit4ã€çº¿ç¨‹é”€æ¯ â€“ã€‹ pthread_destroy 1.pthread1234567891011int pthread_create(pthread_t *thread, const pthread_attr_t *attr, void *(*start_routine) (void *), void *arg);åŠŸèƒ½ï¼šåˆ›å»ºçº¿ç¨‹å‚æ•°ï¼šthread çº¿ç¨‹å¯¹è±¡attr çº¿ç¨‹å±æ€§é»˜è®¤ä¸ºNULLï¼Œæ ˆçš„ç©ºé—´å¤§å°æ˜¯8Mstart_routine å‡½æ•°æŒ‡é’ˆï¼Œç”¨æ¥æŒ‡å‘å‡½æ•°åarg å‚æ•°ï¼Œä½œä¸ºå‡½æ•°æŒ‡é’ˆçš„å‚æ•°è¿”å›å€¼ï¼šæˆåŠŸï¼š 0å¤±è´¥ï¼š é”™è¯¯ç  123void pthread_exit(void *arg)åŠŸèƒ½ï¼š çº¿ç¨‹ç»“æŸå‡½æ•°å‚æ•°ï¼š ä¼ é€’çº¿ç¨‹é€€å‡ºæ—¶çš„çŠ¶æ€å€¼ 12345pthread_joinï¼ˆpthread_t pthreadï¼Œ void**retvalï¼‰åŠŸèƒ½ï¼šçº¿ç¨‹å›æ”¶å‡½æ•°ï¼ˆé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°ç­‰åˆ°çº¿ç¨‹é€€å‡ºäº†ï¼Œä¼šç«‹å³é‡Šæ”¾ï¼‰å‚æ•°ï¼š pthread çº¿ç¨‹å¯¹è±¡retval çº¿ç¨‹é€€å‡ºæ—¶çš„çŠ¶æ€å€¼ [pthread.c]link12345678910111213141516171819202122232425262728293031323334#include &lt;stdio.h&gt;#include &lt;pthread.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;void *pthread_fun(void * arg)&#123; int i = 20; printf(\"*arg = %d \\n\", *(int *)arg); while(i--) &#123; printf(\"pthread i = %d \\n\", i); sleep(1); if(i == 10) pthread_exit(\"pthread exit\"); &#125;&#125;int main(int argc, const char *argv[])&#123; pthread_t tid; int num = 18; if(pthread_create(&amp;tid, NULL, pthread_fun, &amp;num) != 0) &#123; perror(\"Unable to pthread_create\"); exit(1); &#125; printf(\"pthread start \\n\"); void * ret; pthread_join(tid, &amp;ret); printf(\"pthread end %s \\n\", (char *)ret); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š pthread_createåˆ›å»ºçº¿ç¨‹pthread_funï¼Œå¹¶ä¼ å…¥å‚æ•°&amp;numï¼Œç„¶åä¸»è¿›ç¨‹è°ƒç”¨pthread_joinç­‰å¾…çº¿ç¨‹ã€‚çº¿ç¨‹æ¯éš”1sæ‰“å°è¾“å‡ºï¼Œç›´åˆ°i = 10æ—¶ï¼Œè°ƒç”¨pthread_exitç»“æŸçº¿ç¨‹ï¼ŒåŒæ—¶ä¼ é€’çŠ¶æ€å€¼pthread exitåˆ°pthread_joinã€‚ä¸»è¿›ç¨‹å†æ‰“å°å‡ºçŠ¶æ€å€¼åé€€å‡ºã€‚ æ³¨æ„ï¼šç¼–è¯‘çš„æ—¶å€™åŠ ä¸Š-pthread 2.mutexä¸åŠ äº’æ–¥é”ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#include &lt;stdio.h&gt;#include &lt;pthread.h&gt;#include &lt;stdlib.h&gt;#include &lt;errno.h&gt;pthread_mutex_t lock;int value_1, value_2;void *pthread_fun(void * arg)&#123; while(1) &#123; //pthread_mutex_lock(&amp;lock); if(value_1 == value_2) &#123; printf(\"value_1 = %d, value_2 = %d\\n\", value_1, value_2); &#125; //pthread_mutex_unlock(&amp;lock); &#125;&#125;int main(int argc, const char *argv[])&#123; int count = 0; pthread_t pthread; if(pthread_mutex_init(&amp;lock, NULL) &lt; 0) &#123; perror(\"fail to pthread_mutex_init \"); exit(1); &#125; if(pthread_create(&amp;pthread, NULL, pthread_fun, NULL) &lt; 0) &#123; perror(\"fail to pthread_create \"); exit(1); &#125; while(1) &#123; count++; //pthread_mutex_lock(&amp;lock); value_1 = count; value_2 = count; //pthread_mutex_unlock(&amp;lock); &#125; pthread_join(pthread, NULL); return 0;&#125;æµ‹è¯•ç»“æœï¼š åŠ ä¸Šäº’æ–¥é”ï¼š[pthread_mutex.c]link12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#include &lt;stdio.h&gt;#include &lt;pthread.h&gt;#include &lt;stdlib.h&gt;#include &lt;errno.h&gt;pthread_mutex_t lock;int value_1, value_2;void *pthread_fun(void * arg)&#123; while(1) &#123; pthread_mutex_lock(&amp;lock); if(value_1 == value_2) &#123; printf(\"value_1 = %d, value_2 = %d\\n\", value_1, value_2); &#125; pthread_mutex_unlock(&amp;lock); &#125;&#125;int main(int argc, const char *argv[])&#123; int count = 0; pthread_t pthread; if(pthread_mutex_init(&amp;lock, NULL) &lt; 0) &#123; perror(\"fail to pthread_mutex_init \"); exit(1); &#125; if(pthread_create(&amp;pthread, NULL, pthread_fun, NULL) &lt; 0) &#123; perror(\"fail to pthread_create \"); exit(1); &#125; while(1) &#123; count++; pthread_mutex_lock(&amp;lock); value_1 = count; value_2 = count; pthread_mutex_unlock(&amp;lock); &#125; pthread_join(pthread, NULL); return 0;&#125;æµ‹è¯•ç»“æœï¼šåˆ†æï¼š å‡å¦‚ä¸åŠ äº’æ–¥é”ï¼Œå¯èƒ½å‡ºç°è¿™ç§æƒ…å†µï¼šä¸»è¿›ç¨‹é‡Œå°†countèµ‹å€¼ç»™value_1å’Œvalue_2ï¼Œæ­¤æ—¶value_1=value_2ï¼Œçº¿ç¨‹é‡Œé¢çš„if(value_1 == value_2)é€šè¿‡äº†ï¼Œè¿™æ—¶çº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œï¼Œä¸»è¿›ç¨‹æ‰§è¡Œcount++å’Œvalue_1 = countï¼Œæ­¤æ—¶ä¸»è¿›ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œï¼Œçº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œæ‰“å°å‡ºvalue_1å’Œvalue_2ï¼Œå°±ä¼šå‘ç°value_1ä¸ç­‰äºvalue_2ã€‚ ç°åœ¨åŠ ä¸Šäº’æ–¥é”ï¼Œä¸»è¿›ç¨‹count++,ç„¶åä¸Šé”ï¼Œæ­¤æ—¶ä¸èƒ½ç³»ç»Ÿä¸­æ–­åç»­çš„countèµ‹å€¼ç»™value_1å’Œvalue_2ï¼Œç„¶åä¸»çº¿ç¨‹å†è§£é”ã€‚çº¿ç¨‹åœ¨if(value_1 == value_2)ä¹Ÿä¸Šé”ï¼Œä¿è¯åé¢çš„ä¸è¢«ä¸­æ–­ï¼Œæ‰“å°å‡ºvalue_1å’Œvalue_2ï¼Œå†è§£é”ï¼Œæ•´ä¸ªè¿‡ç¨‹ï¼Œvalue_1ä¸€ç›´value_2ã€‚ 3.syns[pthread_syns.c]link1234567891011121314151617181920212223242526272829303132333435#include &lt;stdio.h&gt;#include &lt;pthread.h&gt;#include &lt;stdlib.h&gt;#include &lt;semaphore.h&gt;#define N 32char buf[N] = &#123;0&#125;;sem_t mysem;void *pthread_fun(void * arg)&#123; while(1) &#123; sem_wait(&amp;mysem); printf(\"--&gt; %s\\n\",buf); &#125;&#125;int main(int argc, const char *argv[])&#123; pthread_t tid; sem_init(&amp;mysem, 0, 0); if(pthread_create(&amp;tid, NULL, pthread_fun, NULL) != 0) &#123; perror(\"Unable to pthread_create\"); exit(1); &#125; while(1) &#123; fgets(buf, 32, stdin); sem_post(&amp;mysem); &#125; return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š è¿™é‡Œåˆ©ç”¨äº†ä¿¡å·åŒæ­¥ã€‚ä¸»çº¿ç¨‹è°ƒç”¨fgetsç­‰å¾…è¾“å…¥ï¼Œè¾“å…¥å®Œæˆåä½¿ç”¨sem_postå‘é€mysemä¿¡å·ï¼Œçº¿ç¨‹ä¸€ç›´è°ƒç”¨sem_waitç­‰å¾…ä¿¡å·ï¼Œä¸€æ—¦ä¿¡å·åˆ°æ¥ï¼Œå°±æ‰“å°å‡ºbuf. è¿›ç¨‹é€šä¿¡ æ¡ä»¶å˜é‡ï¼š å®šä¹‰ï¼šä¸€ä¸ªçº¿ç¨‹ä¸´ç•Œèµ„æºçŠ¶æ€çš„å˜åŒ–ï¼Œä¼šé€šçŸ¥å¦å¤–ä¸€ä¸ªçº¿ç¨‹å»åšç›¸åº”çš„åŠŸèƒ½å¤„ç†ï¼›æ¡ä»¶å˜é‡è·Ÿäº’æ–¥é”é…åˆä½¿ç”¨ï¼› ç‰¹ç‚¹:å…·æœ‰é˜»å¡åŠŸèƒ½ã€å”¤é†’ï¼›ä¸ºä»€ä¹ˆéœ€è¦è¿›ç¨‹é—´é€šä¿¡ï¼Ÿ 1ã€æ•°æ®äº¤äº’ 2ã€å…±äº«èµ„æº 3ã€ä¿¡å·é€šçŸ¥ 4ã€åŒæ­¥æˆ–è€…äº’æ–¥è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ä»‹ç»ï¼š 1ã€ä¼ ç»Ÿçš„è¿›ç¨‹é—´é€šä¿¡ æ— åç®¡é“ã€æœ‰åç®¡é“ã€ä¿¡å·é€šçŸ¥ 2ã€sytem V â€“ IPC å…±äº«å†…å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·é‡ å‰é¢å…­ç§åªèƒ½ç”¨äºå•å°çš„è®¡ç®—æœºä¸­ä½¿ç”¨ 3ã€å¥—æ¥å­— 1.kill[kill.c]link12345678910111213#include &lt;signal.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;int main(int argc, const char *argv[])&#123; if(kill(atoi(argv[1]), atoi(argv[2])) &lt; 0) &#123; perror(\"Unable to kill\"); exit(1); &#125; return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š kill()æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ“ä½œè¿›ç¨‹çš„PIDï¼Œç¬¬äºŒä¸ªæ˜¯ä¿¡å·ç§ç±»çš„ç¼–å·ã€‚å…¶ä¸­2æ˜¯SIGINTç»“æŸè¿›ç¨‹ï¼Œæ‰€ä»¥å‘é€è¿™ä¸ªä¿¡å·åï¼Œsignalå°±æ‰“å°hello worldã€‚ç»“æŸè¿›ç¨‹ã€‚ 2.raise[raise.c]link123456789101112131415#include &lt;signal.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;int main(int argc, const char *argv[])&#123; printf(\"hello wrold.\\n\"); if(raise(atoi(argv[1])) &lt; 0) &#123; perror(\"Unable to raise\"); exit(1); &#125;while(1); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š raise()åªèƒ½ç»™è‡ªå·±å‘é€ä¿¡å·ï¼Œè€Œä¸”è¿˜ä¸èƒ½å‘é€SIGQUITã€‚è¿™é‡Œraiseè‡ªå·±å‘é€SIGINTç»“æŸäº†è‡ªå·±ã€‚ 3.signal12345678signalï¼ˆint signumï¼Œ sighandler_t handlerï¼‰åŠŸèƒ½ï¼šä¿¡å·å“åº”å‡½æ•°å‚æ•°ï¼š1. signumï¼šä¿¡å·ç§ç±»ä¸­çš„ä¸€ç§ï¼Œè·Ÿhandlerå…³è”èµ·æ¥ï¼Œæ‰§è¡Œç›¸åº”çš„å¤„ç†æ–¹å¼2. å¿½ç•¥ SIG_IGNã€ é»˜è®¤ SIG_DFLã€ æ•æ‰ --&gt;è‡ªå·±å®šä¹‰ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œç±»å‹è·Ÿsighandler_tçš„å½¢å¼ä¸€è‡´ æŠŠlinuxä¸­å·²ç»å®šä¹‰å¥½çš„62ç§ä¿¡å·ä¸­çš„ä¸€ç§ä¿¡å·è·Ÿlinuxä¼ é€’ç»™è¿›ç¨‹çš„ä¿¡å·signoåšåˆ¤æ–­ï¼Œçœ‹æ˜¯é‚£ç§ä¿¡å·ï¼Œå†åšç›¸åº”çš„å¤„ç† å¸¸ç”¨ä¿¡å·ç¼–å· ç§ç±» é»˜è®¤æ“ä½œï¼šç»“æŸè¿›ç¨‹2 SIGINT ctrl+c ç»“æŸè¿›ç¨‹3 SIGQUIT ctrl+\\ ç»“æŸè¿›ç¨‹9 SIGKILL ç»“æŸè¿›ç¨‹10 SIGUSR1 ç»“æŸè¿›ç¨‹12 SIGUSR2 ç»“æŸè¿›ç¨‹14 SIGALRM ç»“æŸè¿›ç¨‹19 SIGSTOP æš‚åœè¿›ç¨‹20 SIGTSTP ctrl+z æš‚åœè¿›ç¨‹æ³¨ï¼šSIGKILL å’ŒSIGSTOPä¸èƒ½è¢«å¿½ç•¥æˆ–è€…æ•æ‰[signal.c]link12345678910111213141516171819202122#include &lt;signal.h&gt;#include &lt;stdio.h&gt;//signoä»£è¡¨å†…æ ¸ç›¸å½“å‰è¿›ç¨‹å‘é€çš„ä¿¡å·æ—¶ä»€ä¹ˆ,è€Œæˆ‘ä»¬åˆä¸æ¸…æ¥šæ—¶é‚£ä¸ªä¿¡å·//éœ€è¦ç”¨ifè¯­å¥åšåˆ¤æ–­void fun(int signo)&#123; if(signo == SIGINT) &#123; printf(\"hello world \\n\"); &#125;&#125;int main(int argc, const char *argv[])&#123; //ä¿¡å·å¤„ç†å‡½æ•°ï¼Œæœ¬èº«ä¸å…·æœ‰é˜»å¡ä½œç”¨ //ç¬¬ä¸€ä¸ªå‚æ•°ï¼š è¦å‡ºé‡Œçš„ä¿¡å·æ˜¯ä»€ä¹ˆï¼Ÿ62ä¸­çš„ä¸€ç§ //ç¬¬äºŒä¸ªå‚æ•°ï¼š ä¸‰ç§ç›¸åº”æ–¹å¼ï¼š //å¿½ç•¥ï¼ˆSIG_IGNï¼‰ã€é»˜è®¤(SIG_DFL)ã€æ•æ‰(ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°) signal(SIGINT, fun); pause(); return 0;&#125;æµ‹è¯•ç»“æœï¼šåˆ†æï¼š ä¸»å‡½æ•°è°ƒç”¨signalå®‰è£…ä¿¡å·ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šäº†ä¿¡å·ç±»å‹ä¸ºæŒ‰ä¸‹CTRL+Cäº§ç”Ÿï¼Œç¬¬äºŒä¸ªä¸ºæ•æ‰åˆ°ä¿¡å·åç›¸åº”æ“ä½œã€‚ç„¶åä¿¡å·çš„å¤„ç†å‡½æ•°åˆ¤æ–­å‡ºä¿¡å·ç±»å‹åæ‰§è¡Œå¯¹åº”çš„æ“ä½œã€‚ pause()åŠŸèƒ½ï¼šå¼•èµ·è°ƒç”¨è¿›ç¨‹è¿›ç¨‹é˜»å¡ï¼ŒçŸ¥é“æ”¶åˆ°ä¿¡å·æ‰ä¼šç«‹å³ç»“æŸ 4.alarm[alarm.c]link1234567891011121314151617#include &lt;unistd.h&gt;#include &lt;stdio.h&gt;int main(int argc, const char *argv[])&#123; int ret = -1; ret = alarm(9); printf(\"ret = %d \\n\", ret); sleep(3); ret = alarm(10); printf(\"ret = %d \\n\", ret); pause(); printf(\"hello world \\n\"); //while(1); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š å…ˆç»™retèµ‹å€¼ä¸ª-1ï¼Œç„¶åè°ƒç”¨alarmè®¾ç½®ä¸º9ï¼Œå› ä¸ºä¹‹å‰æ²¡æœ‰è®¾ç½®è¿‡alarmï¼Œæ‰€ä»¥è¿”å›0.ç„¶åä¼‘çœ 3ç§’åï¼Œæœ‰èµ‹å€¼ä¸º10ï¼Œæ­¤æ—¶è¿”å›çš„ä¸º6ï¼Œå³ä¸Šæ¬¡è®¾ç½®åå‰©ä¸‹çš„æ—¶é—´9-3=6.ç„¶åç¨‹åºè°ƒç”¨pauseæŒ‚èµ·ç¨‹åºï¼Œç›´åˆ°10ç§’åï¼Œé—¹é’Ÿåˆ°äº†ï¼Œå‘é€SIGALRMä¿¡å·ç»“æŸè¿›ç¨‹ã€‚ 5.pipe[pipe.c]link123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172#include &lt;stdio.h&gt;#include &lt;unistd.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;sys/wait.h&gt;int main(int argc, const char *argv[])&#123; int fd[2]; pid_t pid; char buf[1024] = &#123;0&#125;; int count = 0; if(pipe(fd) &lt; 0) &#123; perror(\"Unable to pipe\"); exit(1); &#125;#if 1 pid = fork(); if(pid &lt; 0) &#123; perror(\"Unable to fork\"); exit(1); &#125; if(pid == 0) &#123;// printf(\"fd[0] = %d , fd[1] = %d \\n\", fd[0], fd[1]); while(1) &#123; read(fd[0], buf, 32);//å¦‚æœç®¡é“ä¸­æ²¡æœ‰æ•°æ®ï¼Œè¯»æ“ä½œä¼šé˜»å¡ if(strncmp(buf, \"quit\", 4) == 0) break; printf(\"--&gt; %s \\n\", buf); &#125; &#125; else &#123;// printf(\"fd[0] = %d , fd[1] = %d \\n\", fd[0], fd[1]); while(1) &#123; fgets(buf, 32, stdin); write(fd[1], buf, strlen(buf) + 1); if(strncmp(buf, \"quit\", 4) == 0) break; &#125; wait(NULL); &#125;#endif#if 0 while(1) &#123;//å¦‚æœç¼“å†²åŒºæ…¢ï¼Œåˆ™ä¼šé˜»å¡åœ¨writeå‡½æ•° write(fd[1], buf, 1024); count++; if(count == 64) &#123; read(fd[0], buf, 1024); read(fd[0], buf, 1024); read(fd[0], buf, 1024); read(fd[0], buf, 1024); &#125; printf(\"count = %d \\n\", count); &#125;#endif close(fd[0]); write(fd[1], buf, 1024); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š è¿™é‡Œåˆ›å»ºä¸€ä¸ªç®¡é“å®Œæˆè¿›ç¨‹é—´çš„é€šä¿¡ï¼Œçˆ¶è¿›ç¨‹è´Ÿè´£å†™æ•°æ®ï¼Œå­è¿›ç¨‹è´Ÿè´£è¯»æ•°æ®ã€‚ é¦–å…ˆæ˜¯pipe()åˆ›å»ºäº†ä¸€ä¸ªç®¡é“ï¼Œå…¶ä¸­fd[0]æ˜¯æ ‡å‡†è¾“å…¥ï¼Œfd[1]æ˜¯æ ‡å‡†è¾“å‡ºã€‚ç„¶ååœ¨fork()åˆ›å»ºäº†ä¸ªå­è¿›ç¨‹ã€‚ çˆ¶è¿›ç¨‹çš„å·¥ä½œï¼šä¸æ–­ä»é”®ç›˜è·å¾—æ•°æ®ï¼Œå­˜å…¥bufã€‚ç„¶åå°†bufæ•°æ®å†™å…¥fd[1]ã€‚å¦‚æœæ”¶åˆ°â€œquitâ€å­—ç¬¦å³é€€å‡ºï¼Œè°ƒç”¨wait()ç­‰å¾…å­è¿›ç¨‹ç»“æŸã€‚ å­è¿›ç¨‹çš„å·¥ä½œï¼šä¸æ–­ä»fd[0]è¯»å–æ•°æ®åˆ°bufï¼Œæ‰“å°bufï¼Œå¦‚æœé‡åˆ°â€œquitâ€å­—ç¬¦å³é€€å‡ºã€‚ ç®¡é“çš„æ„ä¹‰å°±æ˜¯ï¼Œè¿é€šäº†fb[0]å’Œfb[1]ï¼Œå®ç°äº†è¿›ç¨‹é—´æ•°æ®/ä¿¡å·çš„å•å‘ä¼ è¾“ã€‚ 6.fifo[mkfifo_w.c]link123456789101112131415161718192021222324252627282930313233343536373839#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/stat.h&gt;#include &lt;stdlib.h&gt;#include &lt;fcntl.h&gt;#include &lt;unistd.h&gt;#include &lt;string.h&gt;#define N 32int main(int argc, const char *argv[])&#123; int fd_r, fd_w; size_t bytes = 0; char buf[N] = &#123;0&#125;; if(mkfifo(\"myfifo\", 0666) &lt; 0) &#123; perror(\"Unable to mkfifo\"); // exit(1); &#125; fd_w = open(\"myfifo\", O_WRONLY); if(fd_w &lt; 0) &#123; perror(\"Unable to open fd_w.\"); exit(1); &#125; printf(\"fifo write\\n\"); while(1) &#123; fgets(buf, 32, stdin); write(fd_w, buf, strlen(buf) + 1); if(strncmp(buf, \"quit\", 4) == 0) break; &#125; return 0;&#125; [mkfifo_r.c]link12345678910111213141516171819202122232425262728293031323334#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/stat.h&gt;#include &lt;stdlib.h&gt;#include &lt;fcntl.h&gt;#include &lt;unistd.h&gt;#include &lt;string.h&gt;#define N 32int main(int argc, const char *argv[])&#123; int fd_r; size_t bytes = 0; char buf[N] = &#123;0&#125;; fd_r = open(\"myfifo\", O_RDONLY); if(fd_r &lt; 0) &#123; perror(\"Unable to open fd_r\"); exit(1); &#125; while(1) &#123; read(fd_r, buf, 32); if(strncmp(buf, \"quit\", 4) == 0) break; printf(\"--&gt; %s \\n\", buf); &#125; return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š FIFOçš„åŠŸèƒ½ä¸ç®¡é“å·®ä¸å¤šï¼Œä½†FIFOåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ‹¥æœ‰ä¸€ä¸ªåç§°ï¼Œå…¶æ‰“å¼€æ–¹å¼å’Œæ‰“å¼€æ™®é€šæ–‡ä»¶æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°éç›¸å…³çš„è¿›ç¨‹é€šä¿¡ã€‚ å†™å…¥ç«¯/å‘é€ç«¯ï¼šé¦–å…ˆåˆ›å»ºä¸€ä¸ªåå«â€œmyfifoâ€œï¼Œæƒé™ä¸º666çš„FIFOã€‚ç„¶åæ‰“å¼€è¿™ä¸ªFIFOï¼Œä¸æ–­ä»é”®ç›˜è·å¾—æ•°æ®å†™å…¥FIFOé‡Œé¢ï¼Œç›´åˆ°é‡åˆ°â€quitâ€œé€€å‡ºã€‚ è¯»å‡ºç«¯/æ¥æ”¶ç«¯ï¼šæ‰“å¼€åŒåFIFOï¼Œä¸æ–­ä»ä¸­è¯»å–æ•°æ®æ‰“å°å‡ºæ¥ï¼Œç›´åˆ°é‡åˆ°â€quitâ€œé€€å‡ºã€‚ 7.ftok[ftok.c]link1234567891011121314151617#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/ipc.h&gt;#include &lt;stdlib.h&gt;int main(int argc, const char *argv[])&#123; key_t key; key = ftok(\".\", 'a'); if(key &lt; 0) &#123; perror(\"Unable to ftok\"); exit(1); &#125; printf(\"key = %#x \\n\", key); return 0;&#125; æµ‹è¯•ç»“æœï¼š åˆ†æï¼š è¿™é‡Œftokåº”è¯¥æ˜¯äº§ç”Ÿä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ï¼Œå› ä¸ºè·¯å¾„æ˜¯å”¯ä¸€çš„ï¼Œå¯¹åº”çš„keyæœ‰æ˜¯å”¯ä¸€çš„ã€‚åé¢çš„IPCå¯¹è±¡ï¼šå…±äº«å†…å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·ç¯ï¼Œé€šè¿‡keyæ‰¾åˆ°å†…æ ¸å¯¹è±¡ã€‚é€šè¿‡shellå‘½ä»¤ipcsæ¥æŸ¥çœ‹å¯¹è±¡ä¿¡æ¯ã€‚ ç¼–ç¨‹æ¡†æ¶ï¼š1ã€é€šè¿‡ftokå‡½æ•°å¾—åˆ°keyå€¼ï¼Œè®©ä¸åŒçš„è¿›ç¨‹æ‰¾åˆ°å†…æ ¸å¯¹è±¡2ã€åˆ›å»ºæˆ–è€…æ‰“å¼€å†…æ ¸å¯¹è±¡ï¼ˆå…±äº«å†…å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·ç¯é›†ï¼‰3ã€æ“ä½œå†…æ ¸å¯¹è±¡ å…±äº«å†…å­˜ ï¼šé€šè¿‡shmatæ˜ å°„å†…æ ¸ä¸­çš„å…±äº«å†…å­˜åˆ°ç”¨æˆ·ç©ºé—´ï¼Œ è§£é™¤æ˜ å°„shmdtï¼Œä¸èƒ½å†æ“ä½œå…±äº«å†…å­˜ã€‚ æ¶ˆæ¯é˜Ÿåˆ—ï¼šé€šè¿‡msgsndå‘é€æ¶ˆæ¯ï¼Œmsgrcvæ¥æ”¶æ¶ˆæ¯4ã€åˆ é™¤å†…æ ¸å¯¹è±¡ åˆ é™¤å…±äº«å†…å­˜shmctl åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—msgctl 8.msgã€1ã€‘æ¶ˆæ¯é˜Ÿåˆ—æœºåˆ¶1234ç‰¹ç‚¹ï¼š 1ã€å…ˆè¿›å…ˆå‡º 2ã€æŒ‰ç…§ç±»å‹å‘é€ã€è¯»å–æ¶ˆæ¯ ä½¿ç”¨ipcs -qæŸ¥çœ‹ç³»ç»Ÿä¸­çš„æ¶ˆæ¯ ã€2ã€‘å¦‚ä½•åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—1234567msggetint msgget(key_t key, int msgflg);åŠŸèƒ½ï¼šåˆ›å»ºæˆ–è€…æ‰“å¼€æ¶ˆæ¯é˜Ÿåˆ—key:è®©ä¸åŒçš„è¿›ç¨‹æ‰¾åˆ°åŒä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—msgflgï¼š IPC_CREAT | IPC_EXCL | 0666 åˆ›å»º é˜²æ­¢é‡å¤åˆ›å»º æƒé™ ã€3ã€‘å‘é€æ¶ˆæ¯/æ¥æ”¶æ¶ˆæ¯123456789101112131415161718192021ç»“æ„ä½“ï¼š struct msgbuf &#123; long mtype; /* message type, must be &gt; 0 */æ¶ˆæ¯ç±»å‹ char mtext[1]; /* message data */æ¶ˆæ¯æ­£æ–‡ &#125;;msgsnd/msgrcv:int msgsnd(int msqid, const void *msgp, size_t msgsz, int msgflg); åŠŸèƒ½ï¼š msgidï¼š æ¶ˆæ¯é˜Ÿåˆ—æ ‡ç¤ºç¬¦ ï¼ˆç”¨äºæ“ä½œæ¶ˆæ¯é˜Ÿåˆ—å‘é€æˆ–è€…æ¥æ”¶æ¶ˆæ¯ï¼‰ msgpï¼šé¦–å…ˆå®šä¹‰ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„ç»“æ„ä½“ï¼Œç±»å‹å¦‚ä¸Šæ‰€ç¤ºç»“æ„ä½“1 msgszï¼šæ¶ˆæ¯é˜Ÿåˆ—æ­£æ–‡ï¼ˆtextï¼‰çš„å¤§å° msgflgï¼šè®¾ç½®ä¸ºé˜»å¡çš„æ–¹å¼0 éé˜»å¡çš„æ–¹å¼ IPC_NOWAITssize_t msgrcv(int msqid, void *msgp, size_t msgsz, long msgtyp, int msgflg); msgidï¼š æ¶ˆæ¯é˜Ÿåˆ—æ ‡ç¤ºç¬¦ ï¼ˆç”¨äºæ“ä½œæ¶ˆæ¯é˜Ÿåˆ—å‘é€æˆ–è€…æ¥æ”¶æ¶ˆæ¯ï¼‰ msgpï¼šé¦–å…ˆå®šä¹‰ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„ç»“æ„ä½“ï¼Œç±»å‹å¦‚ä¸Šæ‰€ç¤ºç»“æ„ä½“1 msgszï¼šæ¶ˆæ¯é˜Ÿåˆ—æ­£æ–‡ï¼ˆtextï¼‰çš„å¤§å° msgtypï¼šæ¶ˆæ¯çš„ç±»å‹ï¼ˆå¿…é¡»æ˜¯å¤§äº0çš„æ•´æ•°ï¼‰ msgflgï¼šè®¾ç½®ä¸ºé˜»å¡çš„æ–¹å¼0 éé˜»å¡çš„æ–¹å¼ IPC_NOWAIT ã€4ã€‘æ§åˆ¶(åˆ é™¤)æ¶ˆæ¯é˜Ÿåˆ—msgctl1234 int msgctl(int msqid, int cmd, struct msqid_ds *buf); msgidï¼š æ¶ˆæ¯é˜Ÿåˆ—æ ‡ç¤ºç¬¦ ï¼ˆç”¨äºæ“ä½œæ¶ˆæ¯é˜Ÿåˆ—å‘é€æˆ–è€…æ¥æ”¶æ¶ˆæ¯ï¼‰ cmdï¼šæ“ä½œæ¶ˆæ¯é˜Ÿåˆ—çš„å‘½ä»¤ IPC_STAT è·å–æ¶ˆæ¯é˜Ÿåˆ—å±æ€§ä¿¡æ¯çš„å‘½ä»¤ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªstruct msqid_dsç»“æ„ä½“ [msg_w.c]link123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/ipc.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;errno.h&gt;#include &lt;sys/msg.h&gt;struct msgbuf&#123; long type; char text[32];&#125;;#define MSG_SIZE (sizeof(struct msgbuf) - sizeof(long))int main(int argc, const char *argv[])&#123; key_t key; int msgid; struct msgbuf mymsg; char buf[32] = &#123;0&#125;; key = ftok(\".\", 'a'); if(key &lt; 0) &#123; perror(\"Unable to ftok\"); exit(1); &#125; msgid = msgget(key, IPC_CREAT | IPC_EXCL | 0666); if(msgid &lt; 0) &#123; if(errno == EEXIST) &#123; msgid = msgget(key, 0666); &#125; else &#123; perror(\"Unable to msgget\"); exit(1); &#125; &#125; system(\"ipcs -q\"); mymsg.type = 100; //strcpy(mymsg.text,\"hello world\"); while(1) &#123; fgets(buf, 32, stdin); strcpy(mymsg.text, buf); if(msgsnd(msgid, &amp;mymsg, MSG_SIZE, 0) &lt; 0) &#123; perror(\"Unable to msgsnd\"); exit(1); &#125; &#125; system(\"ipcs -q\"); return 0;&#125; [msg_r.c]link12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061#include &lt;errno.h&gt;#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/ipc.h&gt;#include &lt;stdlib.h&gt;#include &lt;sys/msg.h&gt;#include &lt;string.h&gt;struct msgbuf&#123; long type; char text[32];&#125;;#define MSG_SIZE (sizeof(struct msgbuf) - sizeof(long))int main(int argc, const char *argv[])&#123; key_t key; int msgid; struct msgbuf mymsg; key = ftok(\".\", 'a'); if(key &lt; 0) &#123; perror(\"Unable to ftok\"); exit(1); &#125; msgid = msgget(key, IPC_CREAT | IPC_EXCL | 0666); if(msgid &lt; 0) &#123; if(errno == EEXIST) &#123; msgid = msgget(key, 0666); &#125; else &#123; perror(\"Unable to msgget\"); exit(1); &#125; &#125; while(1) &#123; if(msgrcv(msgid, &amp;mymsg, MSG_SIZE, 100, 0) &lt; 0) &#123; perror(\"Unable to msgsnd\"); exit(1); &#125; system(\"ipcs -q\"); printf(\"--&gt;%ld %s \\n\", mymsg.type, mymsg.text); &#125; if(msgctl(msgid, IPC_RMID, NULL) &lt; 0) &#123; perror(\"Unable to msgctl\"); exit(1); &#125; system(\"ipcs -q\"); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š æ¶ˆæ¯é˜Ÿåˆ—æ˜¯è®©è¿›ç¨‹ä»¥æ¶ˆæ¯çš„å½¢å¼äº¤æ¢æ•°æ®ã€‚ å†™å…¥ç«¯/å‘é€ç«¯ï¼šå®šä¹‰ä¸€ä¸ªæ¶ˆæ¯msgbufçš„ç»“æ„ä½“ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯ç±»å‹ï¼Œä¸€ä¸ªæ˜¯æ•°æ®ã€‚è°ƒç”¨ftok()åˆ›å»ºå”¯ä¸€çš„keyã€‚è°ƒç”¨msgget()åˆ›å»ºæˆ–æ‰“å¼€æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè°ƒç”¨shellæ˜¾ç¤ºå½“å‰çš„ipcä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—ä¿¡æ¯ã€‚è®¾ç½®ç±»å‹ä¸º100ï¼Œä¸æ–­ä»é”®ç›˜è·å–æ•°æ®å¤åˆ¶åˆ°mymsg.textï¼Œå¹¶è°ƒç”¨msgsnd()å‘é€å‡ºå»ã€‚ è¯»å‡ºç«¯/æ¥æ”¶ç«¯ï¼šä½¿ç”¨è°ƒç”¨ftok()ä¼ å…¥ç›¸åŒçš„å‚æ•°ï¼Œå¾—åˆ°ç›¸åŒçš„keyï¼Œè°ƒç”¨msgget()æ‰“å¼€åŒä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚è°ƒç”¨msgcrv()æ¥æ”¶æ¶ˆæ¯ï¼Œæ¥æ”¶åˆ°åˆ™æ‰“å°ä¹¦ç±»å‹å’Œæ•°æ®ã€‚åé¢çš„æ¶ˆæ¯é˜Ÿåˆ—æ§åˆ¶å‡½æ•°å¹¶æ²¡æœ‰è°ƒç”¨åˆ°ï¼Œç¬¬äºŒä¸ªå‚æ•°IPC_RMIDè¡¨ç¤ºç«‹å³åˆ é™¤é˜Ÿåˆ—æ¶ˆæ¯ã€‚è¿™é‡Œä½¿ç”¨shellå‘½ä»¤ï¼šipcrm -q [msgid]æ‰‹åŠ¨åˆ é™¤ã€‚ 9.sem[1]ä¿¡å·ç¯æœºåˆ¶123ä¿¡å·é‡çš„é›†åˆï¼ˆä¸€ä¸ªæˆ–è€…å¤šä¸ªä¿¡å·é‡ï¼Œä¿¡å·é‡æ˜¯ä¸€ç±»èµ„æºï¼Œèµ„æºçš„å€¼ä»£è¡¨äº†èµ„æºçš„æ•°é‡ï¼‰ å®ç°åŒæ­¥ï¼šæŒ‰ç…§çº¦å®šçš„å…ˆåé¡ºåºæ‰§è¡Œ äº’æ–¥ï¼š å¯ä»¥ç”¨ä¸¤ä¸ªä¿¡å·é‡å®ç°äº’æ–¥æ“ä½œ [2]æ‰“å¼€æˆ–è€…åˆ›å»ºä¿¡å·ç¯semget123456789101112int semget(key_t key, int nsems, int semflg);åŠŸèƒ½ï¼šæ‰“å¼€æˆ–è€…åˆ›å»ºä¿¡å·é‡å‚æ•° nsemsï¼š ä¿¡å·é‡çš„æ•°é‡æ˜¯å¤šå°‘ä¸ªï¼Ÿç³»ç»Ÿä»0å¼€å§‹åˆ†é… ä¸¾ä¾‹ï¼šå½“nsems = 1åˆ™ä¿¡å·é‡æ˜¯0 å½“nsems = 2åˆ™ä¿¡å·é‡åˆ†åˆ«æ˜¯ 0 å’Œ 1 å½“nsems = 3åˆ™ä¿¡å·é‡åˆ†åˆ«æ˜¯ 0 å’Œ 1 å’Œ 2 semflgï¼šè®¾ç½®semgetå‡½æ•°çš„åŠŸèƒ½ï¼š IPC_CREAT | IPC_EXCL | 0666 åˆ›å»º é˜²æ­¢é‡å¤åˆ›å»º æœ‰æ•ˆæƒé™ä½è¿”å›å€¼ï¼š æˆåŠŸè¿”å›ä¿¡å·é‡æ“ä½œè¡¨ç¤ºç¬¦ å¤±è´¥ -1 [3]ä¿¡å·ç¯åˆå§‹åŒ–semctl12345678910111213141516171819 int semctl(int semid, int semnum, int cmd, ...); åŠŸèƒ½ï¼šä¿¡å·é‡æ§åˆ¶å‡½æ•° å‚æ•°ï¼š semnum æ“ä½œç¬¬å‡ ä¸ªä¿¡å·é‡ ä¸¾ä¾‹ semnum æ˜¯ 0ï¼Œè¡¨ç¤ºæ“ä½œç¬¬0ä¸ªä¿¡å·é‡ ä¸¾ä¾‹ semnum æ˜¯ 1ï¼Œè¡¨ç¤ºæ“ä½œç¬¬1ä¸ªä¿¡å·é‡ cmdï¼š å¯¹ä¿¡å·é‡ä½¿ç”¨çš„å‘½ä»¤ IPC_STAT è·å–ä¿¡å·é‡çš„å±æ€§ä¿¡æ¯ SETVAL åˆå§‹åŒ–ä¿¡å·é‡çš„å€¼ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªè”åˆä½“ ç±»å‹å¦‚ä¸‹æ‰€ç¤ºï¼šunion semun &#123; int val; /* Value for SETVAL */ struct semid_ds *buf;/* Buffer for IPC_STAT, IPC_SET */ unsigned short *array;/* Array for GETALL, SETALL */struct seminfo *__buf;/* Buffer for IPC_INFO(Linux-specific) */&#125;; â€¦ï¼šè¡¨ç¤ºå‚æ•°ä¸ç¡®å®šå¦‚æœä½¿ç”¨IPC_STATã€SETVALå‘½ä»¤ï¼Œå¿…é¡»ä½¿ç”¨ç¬¬å››ä¸ªå‚æ•°å®šä¹‰ä¸€ä¸ªè”åˆä½“å˜é‡æ¥æ¥æ”¶å¦‚æœå®šä¹‰IPC_RMIDåˆ™ä¸ç”¨ä½¿ç”¨ç¬¬å››ä¸ªå‚æ•° [4]ä¿¡å·é‡æ“ä½œæ–¹å¼123456789int semop(int semid, struct sembuf *sops, unsigned nsops); åŠŸèƒ½ï¼šä¿¡å·é‡çš„pvæ“ä½œ sopsï¼šå¯¹ä¿¡å·é‡çš„æ“ä½œæ–¹å¼ unsigned short sem_num; /* ç¬¬å‡ ä¸ªä¿¡å·é‡*/ short sem_op; /* ä¿¡å·é‡çš„PVæ“ä½œ,æ­£æ•°è¡¨ç¤ºé‡Šæ”¾æ“ä½œã€è´Ÿæ•°è¡¨ç¤ºç”³è¯·æ“ä½œ */ short sem_flg; /*0è¡¨ç¤ºé˜»å¡æ–¹å¼,IPC_NOWAITè¡¨ç¤ºéé˜»å¡æ–¹å¼*/ nsopsï¼šè¡¨ç¤ºæ“ä½œå‡ ä¸ªä¿¡å·é‡ï¼Œä»0å¼€å§‹ Pç”³è¯·æ“ä½œ Vé‡Šæ”¾æ“ä½œ [sem_w.c]link12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/ipc.h&gt;#include &lt;stdlib.h&gt;#include &lt;errno.h&gt;#include &lt;string.h&gt;#include &lt;sys/sem.h&gt;#include &lt;sys/shm.h&gt;union semun&#123; int val;&#125;;int main(int argc, const char *argv[])&#123; key_t key; int semid; union semun mysem; struct sembuf mybuf; char buf1[32] = &#123;0&#125;; key = ftok(\".\", 'a'); if(key &lt; 0) &#123; perror(\"fail to ftok\"); exit(1); &#125; semid = semget(key, 2, IPC_CREAT | IPC_EXCL | 0666); if(semid &lt; 0) &#123; if(errno == EEXIST) semid = semget(key, 2, 0666); else &#123; perror(\"fail to semget\"); exit(1); &#125; &#125; else &#123; mysem.val = 0; semctl(semid, 0, SETVAL, mysem); mysem.val = 1; semctl(semid, 1, SETVAL, mysem); &#125; int shmid = shmget(key, 128, IPC_CREAT | 0666); if(shmid &lt; 0) &#123; if(errno == EEXIST) &#123; shmid = shmget(key, 128, 0666); &#125; else&#123; perror(\"fail to shmget\"); exit(1); &#125; &#125; char *buf = (char *)shmat(shmid, NULL, 0); if(buf == (char *)-1) &#123; perror(\"fail to shmat\"); exit(1); &#125; while(1) &#123; fgets(buf1, 32, stdin); mybuf.sem_num = 1; mybuf.sem_op = -1; mybuf.sem_flg = 0; semop(semid, &amp;mybuf, 1); strcpy(buf,buf1); mybuf.sem_num = 0; mybuf.sem_op = 1; mybuf.sem_flg = IPC_NOWAIT; semop(semid, &amp;mybuf, 1); &#125; system(\"ipcs -s\"); return 0;&#125; [sem_rw.c]link123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/ipc.h&gt;#include &lt;stdlib.h&gt;#include &lt;errno.h&gt;#include &lt;string.h&gt;#include &lt;sys/shm.h&gt;#include &lt;sys/sem.h&gt;union semun&#123; int val;&#125;;int main(int argc, const char *argv[])&#123; key_t key; int semid; union semun mysem; struct sembuf mybuf; key = ftok(\".\", 'a'); if(key &lt; 0) &#123; perror(\"fail to ftok\"); exit(1); &#125; semid = semget(key, 2, IPC_CREAT | IPC_EXCL | 0666); if(semid &lt; 0) &#123; if(errno == EEXIST) semid = semget(key, 2, 0666); else &#123; perror(\"fail to semget\"); exit(1); &#125; &#125; else &#123; mysem.val = 0; semctl(semid, 0, SETVAL, mysem); mysem.val = 1; semctl(semid, 1, SETVAL, mysem); &#125; int shmid = shmget(key, 128, IPC_CREAT | 0666); if(shmid &lt; 0) &#123; if(errno == EEXIST) &#123; shmid = shmget(key, 128, 0666); &#125; else&#123; perror(\"fail to shmget\"); exit(1); &#125; &#125; char *buf = (char *)shmat(shmid, NULL, 0); if(buf == (char *)-1) &#123; perror(\"fail to shmat\"); exit(1); &#125; while(1) &#123; mybuf.sem_num = 0; mybuf.sem_op = -1; mybuf.sem_flg = 0; semop(semid, &amp;mybuf, 1); printf(\"--&gt; %s \\n\", buf); mybuf.sem_num = 1; mybuf.sem_op = 1; mybuf.sem_flg = IPC_NOWAIT; semop(semid, &amp;mybuf, 1); &#125; system(\"ipcs -s\"); return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š ä¿¡å·é‡ä¸æ˜¯ç”¨æ¥åœ¨è¿›ç¨‹é—´ä¼ è¾“æ•°æ®çš„ï¼Œè€Œæ˜¯ç”¨æ¥åŒæ­¥æ•°æ®çš„ã€‚è¿™é‡Œé‡Œå…±äº«å†…å­˜ä¸ºä¾‹ï¼Œå®Œæˆä¸¤ä¸ªè¿›ç¨‹çš„åŒæ­¥ã€‚ å†™å…¥ç«¯/å‘é€ç«¯ï¼šé¦–å…ˆè°ƒç”¨ftok()åˆ›å»ºå”¯ä¸€çš„keyã€‚è°ƒç”¨semget ()åˆ›å»ºæˆ–æ‰“å¼€ä¿¡å·é‡é›†ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºåˆ›å»ºä¸¤ä¸ªä¿¡å·é‡ã€‚ç„¶åè°ƒç”¨æ§åˆ¶å‡½æ•°semctl()åˆ†åˆ«è®¾ç½®ä¸¤ä¸ªçš„å€¼ä¸º0å’Œ1ã€‚ç„¶ååˆ›å»ºä¸€ä¸ªå…±äº«å†…å­˜ï¼Œæ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ï¼Œä¸æ–­ä»é”®ç›˜è·å¾—è¾“å…¥ã€‚mybuf.sem_numè¡¨ç¤ºè®¾ç½®ç¬¬1ä¸ªä¿¡å·é‡ï¼Œmybuf.sem_opä¸ºè´Ÿè¡¨ç¤ºæœŸæœ›å‡ï¼Œmybuf.sem_flgä¸º0ä¸ºé˜»å¡ï¼ŒIPC_NOWAITä¸ºéé˜»å¡ã€‚ç„¶ååœ¨è°ƒç”¨semop()è¿›è¡Œè®¾ç½®åˆšæ‰åˆå§‹åŒ–çš„sembufã€‚å³è¯»å»åˆ°æ•°æ®åˆ™æ¬²å°†ç¬¬ä¸€ä¸ªä¿¡å·é‡å‡1ã€‚å¤åˆ¶å¥½åï¼Œå†å°†ç¬¬0ä¸ªä¿¡å·é‡æ¬²åŠ 1. è¯»å‡ºç«¯/æ¥æ”¶ç«¯ï¼šå‰é¢éƒ¨åˆ†éƒ½æ˜¯å¯¹åº”çš„ï¼Œåœ¨å¾ªç¯éƒ¨åˆ†ï¼Œå…ˆæ¬²æŠŠç¬¬0ä¸ªä¿¡å·é‡å‡1ï¼Œç­‰æ‰“å°å®Œåï¼Œå†æ¬²æŠŠç¬¬1ä¸ªä¿¡å·é‡è®¾ç½®ä¸º1ã€‚ å³æ•´ä¸ªæµç¨‹ï¼Œå…ˆä¿¡å·é‡0å’Œ1åˆ†åˆ«ä¸º0å’Œ1ã€‚sem.wæ”¶åˆ°æ•°æ®ï¼Œåˆ™æ¬²å°†ç¬¬1ä¸ªä¿¡å·é‡å‡1ï¼ŒæˆåŠŸï¼Œç»§ç»­æ‰§è¡Œæ‰§è¡Œstrcpy()ï¼Œç„¶åå°†ä¿¡å·é‡0è®¾ç½®ä¸º1ã€‚è¿™æ—¶sem.rä¸­ï¼Œä¹‹å‰æ¬²å°†ç¬¬0ä¸ªå‚æ•°å‡1ï¼Œä½†ä¸º0ï¼Œå‡ä¸åŠ¨ï¼Œé˜»å¡ç€ï¼Œç°åœ¨å‘ç°ç¬¬0ä¸ªä¿¡å·é‡è¢«è®¾ç½®ä¸º1ï¼Œäºæ˜¯ç»§ç»­æ‰§è¡Œï¼Œæ‰“å°äº†å‡ºæ¥ã€‚ç„¶åè®¾ç½®ç¬¬1ä¸ªå‚æ•°ä¸º1ã€‚è¿™æ—¶ï¼Œsem.wä¸­åˆšèµ°å®Œä¸€ä¸ªå¾ªç¯ï¼Œä¸”æ”¶åˆ°äº†é”®ç›˜æ•°æ®ï¼Œä½†ç°åœ¨ç¬¬1ä¸ªä¿¡å·é‡æ˜¯0ï¼Œæ— æ³•æ‹·è´ï¼Œç°åœ¨å‘ç°ç¬¬1ä¸ªå‚æ•°è¢«è®¾ç½®ä¸ºäº†1ï¼Œäºæ˜¯åˆç»§ç»­æ‰§è¡Œåç»­çš„æ‹·è´å’Œè®¾ç½®ä¿¡å·é‡ã€‚å¦‚æ­¤å¾€å¤ã€‚ 10.shm å…±äº«å†…å­˜ï¼šå†…æ ¸ç©ºé—´ä¸­çš„ä¸€å—åŒºåŸŸï¼Œç”±ç”¨æˆ·åˆ›å»ºï¼Œç³»ç»Ÿç»´æŠ¤é‡Œé¢çš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡è·å–åˆ°çš„æè¿°ç¬¦shmgetçš„è¿”å›å€¼ï¼Œå¯¹å…±äº«å†…å­˜è¿›è¡Œæ“ä½œï¼› ç‰¹ç‚¹ï¼š 1ã€é«˜æ•ˆï¼Œå› ä¸ºç”¨æˆ·å¯ä»¥ç›´æ¥å¯¹å†…å’Œå¯¹è±¡è¿›è¡Œæ“ä½œï¼Œå¹¶ä¸éœ€è¦æŠŠæ•°æ®åœ¨å†™åˆ°è‡ªå·±çš„ç”¨æˆ·ç©ºé—´é‡Œï¼Œåœ¨æ‰€æœ‰çš„è¿›ç¨‹é—´é€šä¿¡å¯¹è±¡ä¸­æ˜¯æœ€å¿«çš„ã€‚ æ³¨æ„ï¼š 1ã€æ˜ å°„ï¼Œå…±äº«å†…å­˜çš„æ˜ å°„ï¼Œå°±æ˜¯æŠŠå…±äº«å†…å­˜æ®µçš„åœ°å€ä¼ é€’ç»™ç”¨æˆ·ç©ºé—´ç›¸åº”æ•°æ®ç±»å‹çš„æŒ‡é’ˆå˜é‡ã€‚ 2ã€åŒæ­¥å’Œäº’æ–¥ï¼šå¯¹å…±äº«å†…å­˜è¿›è¡Œå¾ªç¯æ“ä½œçš„æ—¶å€™ï¼Œå®¹æ˜“å‡ºç°ä¸€ä¸ªè¿›ç¨‹åœ¨å†™æ“ä½œçš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªå·²ç»æ‰“è¯»äº†å¥½å¤šæ¬¡ï¼Œä¸ºäº†èƒ½å¤Ÿå®Œæˆå†™ä¸€æ¬¡è¯»ä¸€æ¬¡æ“ä½œï¼Œéœ€è¦è¿›è¡ŒåŒæ­¥æˆ–è€…äº’æ–¥ã€‚ æ­¥éª¤ï¼šã€1ã€‘å…±äº«å†…å­˜åˆ›å»º 1234567shmgetint shmget(key_t key, size_t size, int shmflg);åŠŸèƒ½ï¼š åˆ›å»ºæˆ–è€…æ‰“å¼€å…±äº«å†…å­˜keyï¼š é€šè¿‡ftokå‡½æ•°è¿”å›ï¼Œç”¨äºè®©ä¸åŒçš„è¿›ç¨‹æ‰¾åˆ°å†…æ ¸åŒºåŸŸä¸­çš„å†…æ ¸å¯¹è±¡ï¼ˆå…±äº«å†…å­˜ï¼‰sizeï¼šæŒ‡å®šå…±äº«å†…å­˜çš„å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½shmflgï¼šæŒ‡å®šåˆ›å»ºçš„å…±äº«å†…å­˜å…·æœ‰ä»€ä¹ˆæƒé™ IPC_CREAT | IPC_EXCL | ï¼ï¼–ï¼–ï¼– ã€2ã€‘æ˜ å°„å…±äº«å†…å­˜1234567shmatvoid *shmat(int shmid, const void *shmaddr, int shmflg);åŠŸèƒ½ï¼šæŠŠå†…æ ¸ç©ºé—´çš„å…±äº«å†…å­˜æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ï¼Œï¼ˆå› ä¸ºç”¨æˆ·ç©ºé—´æ ¹å†…æ ¸ç©ºé—´ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œæ‰€ä»¥é€šè¿‡æ˜ å°„çš„æ–¹å¼ï¼Œç®€ä»‹å¾—åˆ°è¿™å—å…±äº«å†…å­˜åœ°å€ï¼‰shmid:ã€æ“ä½œã€‘å…±äº«å†…å­˜çš„è¡¨ç¤ºç¬¦shmaddrï¼š NULLæœ‰ç³»ç»Ÿæ¥åˆ†é…ä¸€å—å…±äº«å†…å­˜shmflgï¼š 0 ã€3ã€‘è§£é™¤æ˜ å°„1shmdt ã€4ã€‘åˆ é™¤å…±äº«å†…å­˜12345678shmctlint shmctl(int shmid, int cmd, struct shmid_ds *buf);åŠŸèƒ½ï¼šå…±äº«å†…å­˜å¯¹è±¡æ§åˆ¶å‡½æ•°é€šè¿‡å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ï¼šIPC_STATç”¨æ¥è·å–å…±äº«å†…å­˜çš„ä¸€äº›å±æ€§ä¿¡æ¯IPC_RMIDç”¨æ¥åˆ é™¤å…±äº«å†…å­˜å¯¹è±¡bufï¼šç”¨æ¥å­˜å‚¨å…±äº«å†…å­˜çš„å±æ€§ä¿¡æ¯çš„ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªstruct shmid_ds çš„ç»“æ„ä½“ [shm_w.c]link1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/ipc.h&gt;#include &lt;stdlib.h&gt;#include &lt;sys/shm.h&gt;#include &lt;string.h&gt;#include &lt;errno.h&gt;int main(int argc, const char *argv[])&#123; key_t key; int shmid; char * ptr; key = ftok(\".\", 'a'); if(key &lt; 0) &#123; perror(\"Unable to ftok\"); exit(1); &#125; printf(\"key = %#x \\n\", key); shmid = shmget(key, 128, IPC_CREAT | IPC_EXCL | 0666); if(shmid &lt; 0) &#123; if(errno == EEXIST) &#123; shmid = shmget(key, 128, 0666); &#125; else &#123; perror(\"Unable to shmget\"); exit(1); &#125; &#125; if((ptr = shmat(shmid, NULL, 0)) == (char *)-1) &#123; perror(\"Unable to shmat\"); exit(1); &#125; strcpy(ptr, \"hello world\"); if(shmdt(ptr) &lt; 0) &#123; perror(\"Unable to shmdt\"); exit(1); &#125;#if 0 if(shmctl(shmid, IPC_RMID, NULL) &lt; 0) &#123; perror(\"Unable to shmctl\"); exit(1); &#125;#endif return 0;&#125; [shm_r.c]link12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/ipc.h&gt;#include &lt;stdlib.h&gt;#include &lt;sys/shm.h&gt;#include &lt;string.h&gt;#include &lt;errno.h&gt;int main(int argc, const char *argv[])&#123; key_t key; int shmid; char * ptr; key = ftok(\".\", 'a'); if(key &lt; 0) &#123; perror(\"Unable to ftok\"); exit(1); &#125; shmid = shmget(key, 128, IPC_CREAT | IPC_EXCL | 0666); if(shmid &lt; 0) &#123; if(errno == EEXIST) &#123; shmid = shmget(key, 128, 0666); &#125; else &#123; perror(\"Unable to shmget\"); exit(1); &#125; &#125; if((ptr = shmat(shmid, NULL, 0)) == (char *)-1) &#123; perror(\"Unable to shmat\"); exit(1); &#125; printf(\"--&gt; %s \\n\",ptr); if(shmdt(ptr) &lt; 0) &#123; perror(\"Unable to shmdt\"); exit(1); &#125; if(shmctl(shmid, IPC_RMID, NULL) &lt; 0) &#123; perror(\"Unable to shmctl\"); exit(1); &#125; return 0;&#125; æµ‹è¯•ç»“æœï¼šåˆ†æï¼š å†™å…¥ç«¯å†™å…¥æ•°æ®åˆ°å…±äº«å†…å­˜ï¼Œè¯»å–ç«¯è¯»å‡ºå¹¶é‡Šæ”¾ã€‚ å†™å…¥ç«¯/å‘é€ç«¯ï¼šé¦–å…ˆè°ƒç”¨ftok()åˆ›å»ºä¸€ä¸ªkeyï¼Œè°ƒç”¨shmget()åˆ†é…ä¸€ä¸ªæ‰€éœ€å…±äº«å†…å­˜ï¼Œå¾—åˆ°shmidã€‚ç„¶åè°ƒç”¨shmat()å†å°†å†…æ ¸ä¸­çš„å…±äº«å†…å­˜æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ï¼Œæœ€åè°ƒç”¨strcpy()å°†â€œhello worldâ€œå†™å…¥åˆ°è¿™ä¸ªç©ºé—´ï¼Œå¹¶é‡Šæ”¾ç”¨æˆ·ç©ºé—´ã€‚ è¯»å‡ºç«¯/æ¥æ”¶ç«¯ï¼šä½¿ç”¨è°ƒç”¨ftok()ä¼ å…¥ç›¸åŒçš„å‚æ•°ï¼Œå¾—åˆ°ç›¸åŒçš„keyï¼Œè°ƒç”¨shmgetä¹Ÿå¾—åˆ°åŒæ ·çš„shmidï¼Œå†è°ƒç”¨shmat()æ˜ å°„ï¼Œæ‰“å°å‡ºä¹‹å‰çš„æ•°æ®ã€‚æœ€å è°ƒç”¨shmdt()å’Œshmctl()é‡Šæ”¾ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ã€‚ æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"Linuxç¯å¢ƒç¼–ç¨‹","slug":"Linuxç¯å¢ƒç¼–ç¨‹","permalink":"http://yoursite.com/tags/Linuxç¯å¢ƒç¼–ç¨‹/"}]},{"title":"Linuxè‡ªåŠ¨æŒ‚è½½/å¸è½½Uç›˜","date":"2017-04-22T03:10:55.000Z","path":"2017/04/22/Linuxè‡ªåŠ¨æŒ‚è½½å¸è½½Uç›˜/","text":"è®°å½•åœ¨mdevæœºåˆ¶ä¸‹ä¸èƒ½è‡ªåŠ¨å¸è½½Uç›˜çš„è§£å†³æ–¹æ³•ã€‚ åŠ è½½USBé©±åŠ¨æœ‰ä¸¤ç§æ–¹å¼ï¼š ä¸€æ˜¯å°†æ¨¡å—ç¼–è¯‘åˆ°å†…æ ¸ï¼Œå†æŠŠæ–°å†…æ ¸ä¸‹è½½åˆ°å¼€å‘æ¿ã€‚ äºŒæ˜¯å°†é©±åŠ¨ä½œä¸ºæ¨¡å—ï¼Œå†…æ ¸å¯åŠ¨åå†åŠ è½½é©±åŠ¨æ¨¡å—ã€‚ åœ¨ä¸»æœºä¸­ç¼–è¯‘æ¨¡å—ï¼Œåœ¨Linuxä¸­çš„/work/hceng/linux-3.4.2ç›®å½•ä¸‹æ‰§è¡Œï¼š1$ make moudles å¤åˆ¶ä¸»æœºç”Ÿæˆçš„drivers/usb/storage/usb-storage.koåˆ°å¼€å‘æ¿ä¸­:1cp drivers/usb/storage/usb-storage.ko /work/hceng/nfs_rootfs åœ¨å¼€å‘æ¿ä¸­ï¼ŒåŠ è½½USBé©±åŠ¨æ¨¡å—ï¼š1$ insmod usb-storage.ko ç„¶ååœ¨å¼€å‘æ¿æ’ä¸ŠUç›˜åï¼Œå†æ‰‹åŠ¨æŒ‚è½½Uç›˜å³å¯è®¿é—®æ•°æ®:1$ mount /dev/sda1 /mnt è¿™é‡Œå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€æ˜¯éœ€è¦æ‰‹åŠ¨åŠ è½½usb-storage.koï¼ŒäºŒæ˜¯éœ€è¦æ‰‹åŠ¨æŒ‚è½½Uç›˜ã€‚ ç¬¬ä¸€ä¸ªé—®é¢˜é€šè¿‡å°†æ¨¡å—åŠ è½½å‘½ä»¤æ”¾åœ¨å¯åŠ¨è„šæœ¬é‡Œå®ç°å¼€æœºè‡ªåŠ¨åŠ è½½ï¼Œ/etc/init.d/rcS,åŠ å…¥å¦‚ä¸‹å‘½ä»¤ï¼š1insmod usb-storage.ko ç¬¬äºŒä¸ªé—®é¢˜åˆ©ç”¨mdevæœºåˆ¶è¿›è¡Œè‡ªåŠ¨æŒ‚è½½Uç›˜ï¼Œé¦–å…ˆä¿®æ”¹/etc/medv.confï¼Œå°†ä¸‹é¢ä»£ç åŠ å…¥è¡Œåº•ï¼š12sd[a-z][0-9] 0:0 666 @/etc/mdev/udisk_insert sd[a-z] 0:0 666 $/etc/mdev/udisk_remove åœ¨/bin/hotplug.shä¸­æŠŠ â€œcase $MDEV inâ€ä¿®æ”¹æˆå¦‚ä¸‹ï¼š123456789case $MDEV insd[a-z][0-9]) DEVNAME=udisk MOUNTPOINT=/udisk ;;sda1) DEVNAME=udisk MOUNTPOINT=/udisk ;; å®Œæˆä¸Šé¢çš„è®¾ç½®åï¼ŒUç›˜ç¡®å®èƒ½å¤Ÿè‡ªåŠ¨æŒ‚è½½ï¼Œä½†æ‹”Uç›˜å´ä¸èƒ½è‡ªåŠ¨å¸è½½ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä¸‹æ¬¡æ’å…¥Uç›˜ç›¸åº”çš„èŠ‚ç‚¹ä¼šè‡ªåŠ¨å¢åŠ ï¼Œä¸”è®¿é—®åŸæ¥çš„èŠ‚ç‚¹æŠ¥é”™ã€‚ æŸ¥é˜…ç›¸å…³èµ„æ–™å¹¶æ— è§£å†³æ–¹æ¡ˆï¼Œå¤šæ¬¡å®éªŒåï¼Œå‘ç°æ’ä¸ŠUç›˜åä¼šè‡ªåŠ¨åœ¨/sys/bus/usb/devices/1-1:1.0ä¸‹ç”ŸæˆUç›˜çš„ä¿¡æ¯æ–‡ä»¶ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹è¿›è¡Œæ£€æµ‹Uç›˜ï¼Œåœ¨æ— å¥ˆçš„æƒ…å†µä¸‹å†™äº†ä¸ªç¨‹åºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»£ç å¦‚ä¸‹ï¼š[usb.c]link1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/*æ£€æŸ¥æ˜¯å¦æœ‰Uç›˜æ’ä¸Šï¼Œæ²¡æœ‰åˆ™å¸è½½ä¸€æ¬¡/media/sda1ï¼Œä¿è¯ä¸‹æ¬¡è‡ªåŠ¨æŒ‚è½½Uç›˜æ­£å¸¸*//*å®šæ—¶å™¨ç›¸å…³*/static int count = 0; static struct itimerval oldtv; static unsigned char usb_umount_ok = 0;void set_timer() &#123; struct itimerval itv; itv.it_interval.tv_sec = 1; itv.it_interval.tv_usec = 0; itv.it_value.tv_sec = 1; itv.it_value.tv_usec = 0; setitimer(ITIMER_REAL, &amp;itv, &amp;oldtv); &#125; /*æŸ¥çœ‹/sys/bus/usb/devices/ç›®å½•ä¸‹æ˜¯å¦æœ‰1-1ï¼Œæœ‰åˆ™è¡¨ç¤ºæœ‰Uç›˜*/static unsigned int judge_usb(void) &#123; FILE *fd; fd = fopen(\"/sys/bus/usb/devices/1-1/version\",\"r\"); if(fd == NULL) return 0; else fclose(fd); usb_umount_ok = 0; return 1;&#125;/*æ£€æŸ¥usbæ˜¯å¦æ‹”å‡ºï¼Œä»è€Œç¡®å®šæ˜¯å¦å¸è½½*/static void colse_usb(void)&#123; if(!judge_usb() &amp;&amp; usb_umount_ok==0) &#123; system(\"cd /;umount /media/sda1;rm -r /media/sd*;echo umount usb ok!\"); usb_umount_ok = 1; &#125; &#125;void signal_handler(int m) &#123; colse_usb(); &#125; int main(void)&#123; signal(SIGALRM, signal_handler); set_timer(); while(1); return 0;&#125; ç¼–è¯‘åï¼Œè¿è¡Œæµ‹è¯•ï¼Œæœ€åå†æ”¾åœ¨ä¸Šè¿°å¯åŠ¨è„šæœ¬é‡Œï¼š12arm-linux-gcc -o usb usb.c./app/usb&amp; æœ€åæ•ˆæœï¼š æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"é©±åŠ¨ç›¸å…³","slug":"é©±åŠ¨ç›¸å…³","permalink":"http://yoursite.com/tags/é©±åŠ¨ç›¸å…³/"},{"name":"USB","slug":"USB","permalink":"http://yoursite.com/tags/USB/"}]},{"title":"è‡ªå·±å†™bootloader","date":"2017-04-13T00:35:55.000Z","path":"2017/04/13/è‡ªå·±å†™bootloader/","text":"å‚è€ƒå†™äº†ä¸ªbootloaderã€‚ 0.ç¼–å†™bootloaderæ­¥éª¤ åˆå§‹åŒ–ç¡¬ä»¶ï¼šå…³çœ‹é—¨ç‹—ã€è®¾ç½®æ—¶é’Ÿã€è®¾ç½®SDRAMã€åˆå§‹åŒ–NAND FLASH; å› ä¸ºbootloaderæ¯”è¾ƒå¤§ï¼ˆå¤§äº4Kï¼‰ï¼Œéœ€è¦é‡å®šä½åˆ°SDRAM; æŠŠå†…æ ¸ä»NAND FLASHè¯»åˆ°SDRAM; è®¾ç½®â€œè¦ä¼ ç»™å†…æ ¸çš„å‚æ•°â€; è·³è½¬å¯åŠ¨å†…æ ¸; 1.åˆå§‹åŒ–ç¡¬ä»¶1.1 å…³çœ‹é—¨ç‹—[start.S]1234567.text.global _start_start:/* 1. å…³çœ‹é—¨ç‹— ï¼šå‘å¯„å­˜å™¨WTCON(0x53000000)å†™0å³å¯ï¼›P462ï¼›*/ ldr r0, =0x53000000 //å°†0x53000000æ”¾å…¥r0ï¼› mov r1, #0 //å°†0æ”¾å…¥r1ä¸­ï¼› str r1, [r0] //å°†r1ä¸­çš„0æ”¾å…¥r0æ‰€æŒ‡çš„å­˜å‚¨å™¨ä¸­ï¼› 1.2 è®¾ç½®æ—¶é’Ÿ[start.S]1234567891011121314151617/* 2. è®¾ç½®æ—¶é’Ÿï¼šé…ç½®å¯„å­˜å™¨CLKDIVN(0x4C000014)è®¾ç½®åˆ†é¢‘ï¼›P260ï¼› */ ldr r0, =0x4c000014 mov r1, #0x05; //FCLK:HCLK:PCLK=1:4:8 str r1, [r0]/* å¦‚æœHDIVNé0ï¼ŒCPUçš„æ€»çº¿æ¨¡å¼åº”è®¾ç½®ä¸ºâ€œasynchronous bus modeâ€;P244 */ mrc p15, 0, r1, c1, c0, 0 //è¯»å‡ºæ§åˆ¶å¯„å­˜å™¨ï¼› orr r1, r1, #0xc0000000 //è®¾ç½®ä¸ºâ€œasynchronous bus modeâ€ï¼› mcr p15, 0, r1, c1, c0, 0 //å†™å…¥æ§åˆ¶å¯„å­˜å™¨ï¼› /* è®¾ç½®MPLLCON = S3C2440_MPLL_400MHZ; P256 */ ldr r0, =0x4c000004 ldr r1, =(0x5c&lt;&lt;12)|(0x01&lt;&lt;4)|(0x01) str r1, [r0] /*ä¼˜åŒ–é€Ÿåº¦ï¼š å¯åŠ¨ICACHE */ mrc p15, 0, r0, c1, c0, 0 @ read control reg orr r0, r0, #(1&lt;&lt;12) mcr p15, 0, r0, c1, c0, 0 @ write it back 1.3 åˆå§‹åŒ–SDRAM[start.S]12345678910111213141516171819202122232425 /*åˆå§‹åŒ–SDRAMï¼šä¾æ¬¡å‘SDRAMå¯„å­˜å™¨ å†™å…¥sdram_configä¸­çš„å€¼*/ ldr r0, = 0x48000000 //å°†SDRAMå¯„å­˜å™¨åŸºåœ°å€å†™å…¥r0ï¼› adr r1, sdram_config //å°†sdram_configçš„å½“å‰åœ°å€å†™å…¥r1; add r3, r0, #(13*4) //r3=r0+13*4,å³ä¸ºSDRAMå¯„å­˜å™¨ç»“å°¾åœ°å€ï¼›1: ldr r2, [r1], #4 //å°†r1å¯„å­˜å™¨çš„å€¼æ”¾å…¥r2ï¼Œå¹¶å°†r1çš„åœ°å€+4; str r2, [r0], #4 //å°†r2çš„å€¼å†™å…¥r0ï¼Œå¹¶å°†r0çš„åœ°å€+4; cmp r0, r3 //æ¯”è¾ƒr0å’Œr3ï¼Œåˆ¤æ–­æ˜¯å¦è®¾ç½®åˆ°äº†æœ€åä¸€ä¸ªå¯„å­˜å™¨ï¼›bne 1b //ä¸ç›¸ç­‰å³æ²¡æœ‰è®¾ç½®å®Œï¼Œè·³åˆ°å‰é¢(b)çš„1å¤„ï¼› â€¦ â€¦ â€¦ â€¦sdram_config: //æŠŠè¦è®¾ç½®çš„å€¼ï¼Œå­˜åœ¨è¿™é‡Œï¼›P56; .long 0x22011110 //BWSCON .long 0x00000700 //BANKCON0 .long 0x00000700 //BANKCON1 .long 0x00000700 //BANKCON2 .long 0x00000700 //BANKCON3 .long 0x00000700 //BANKCON4 .long 0x00000700 //BANKCON5 .long 0x00018005 //BANKCON6 .long 0x00018005 //BANKCON7 .long 0x008C04F4 //REFRESH .long 0x000000B1 //BANKSIZE .long 0x00000030 //MRSRB6 .long 0x00000030 //MRSRB7 2.é‡å®šä½[start.S]123456789101112/*æŠŠbootloaderæœ¬èº«çš„ä»£ç ä»flashå¤åˆ¶åˆ°å®ƒçš„é“¾æ¥åœ°å€å»*/ ldr sp, =0x34000000 //åœ¨è°ƒç”¨Cè¯­è¨€å‰ï¼Œéœ€è¦å…ˆè®¾ç½®æ ˆï¼Œå³SPæŒ‡å‘ä¸€ä¸ªåœ°å€ï¼›[1] bl nand_init //åˆå§‹åŒ–nand flashï¼›[2] mov r0, #0 //è®¾ç½®copy_code_to_sdramä¼ å…¥å‚æ•°ï¼›å‚æ•°1ï¼šr0=0ï¼› ldr r1, =_start //å‚æ•°2ï¼šr1=_startï¼› ldr r2, =__bss_start //r2=__bss_start sub r2, r2, r1 //å‚æ•°3ï¼šr2=r2-r1 å³é™¤å»_bssæ®µçš„éƒ¨åˆ†ï¼› bl copy_code_to_sdram //æ‰§è¡Œå¤åˆ¶ä»£ç åˆ°SDRAMçš„å‡½æ•°ï¼›[3] bl clear_bss //æ‰§è¡Œæ¸…ç†_bssæ®µå‡½æ•°ï¼›[4] [1]:ä¸ºä»€ä¹ˆæ˜¯0x34000000ï¼Ÿ æ ˆæ˜¯ç”±ä¸Šå‘ä¸‹å¢åŠ çš„ï¼Œåªè¦SPæŒ‡å‘SDRAMæœ€é«˜å¤„å°±è¡Œã€‚ [2]:ä¸ºä½•åœ¨è¿™é‡Œåˆå§‹åŒ–Nand Flashï¼Ÿ ä¸ç®¡åé¢çš„copy_code_to_sdramæ˜¯Nandå¯åŠ¨è¿˜æ˜¯Norå¯åŠ¨ï¼Œæœ€åéƒ½ä¼šæ‹·è´Nandä¸Šé¢çš„å†…æ ¸åˆ°SDRAMï¼Œæ‰€ä»¥æ—©æ™šéƒ½å¾—åˆå§‹åŒ–ã€‚ [init.c]12345678void nand_init(void)&#123; #define TACLS 0 #define TWRPH0 1 #define TWRPH1 0 NFCONF = (TACLS&lt;&lt;12)|(TWRPH0&lt;&lt;8)|(TWRPH1&lt;&lt;4); //è®¾ç½®æ—¶åºï¼›P225; NFCONT = (1&lt;&lt;4)|(1&lt;&lt;1)|(1&lt;&lt;0); //ä½¿èƒ½NAND Flashæ§åˆ¶å™¨, åˆå§‹åŒ–ECC, ç¦æ­¢ç‰‡é€‰ï¼›P226;&#125; [3]: copy_code_to_sdramå…·ä½“å®ç°ï¼Ÿ start.Sä¸­çš„æ‰€æœ‰çš„Cå‡½æ•°éƒ½åœ¨init.cä¸­(é™¤äº†æœ€åçš„main)ï¼Œcopy_code_to_sdram()å…ˆåˆ¤æ–­æ˜¯Norå¯åŠ¨è¿˜æ˜¯Nandå¯åŠ¨ã€‚ å¦‚æœæ˜¯Norå¯åŠ¨ï¼šç”±äºNor Flashç‰¹æ€§ï¼ˆå¯ä»¥åƒå†…å­˜ä¸€æ ·è¯»ï¼Œä½†ä¸èƒ½åƒå†…å­˜ä¸€æ ·å†™ï¼‰ï¼Œç›´æ¥å¤åˆ¶ä¸Šé¢çš„ä»£ç åˆ°SDRAMä¸­çš„é“¾æ¥åœ°å€å³å¯ï¼› å¦‚æœæ˜¯Nandå¯åŠ¨ï¼š2440ä¸Šç”µåï¼Œç¡¬ä»¶ä¸Šå°†Nandä¸Šå‰4kæ‹·è´åˆ°å†…éƒ¨RAMä¸­è¿è¡Œï¼Œè¿™4kä»£ç å†å°†åç»­çš„æ•´ä¸ªä»£ç æ‹·è´åˆ°SDRAMä¸­çš„é“¾æ¥åœ°å€ã€‚ [init.c]123456789101112131415161718//ä¼ å…¥å‚æ•°ï¼š*srcæºåœ°å€ï¼›*destç›®çš„åœ°åœ°å€ï¼›lenæ•°æ®é•¿åº¦ï¼›void copy_code_to_sdram(unsigned char *src, unsigned char *dest, unsigned int len)&#123; int i = 0; if (isBootFromNorFlash()) //å¦‚æœæ˜¯NORå¯åŠ¨ï¼› &#123; while (i &lt; len) //å°†lené•¿åº¦çš„æ•°æ®ï¼Œä»æºåœ°å€å¤åˆ¶åˆ°ç›®æ ‡åœ°å€ä¸Šå»ï¼› &#123; dest[i] = src[i]; i++; &#125; &#125; else &#123; nand_read((unsigned int)src, dest, len); //nand_readè¾ƒéº»çƒ¦ï¼Œå†åé¢ä»‹ç»ï¼› &#125;&#125; åˆ¤æ–­æ˜¯Nandè¿˜æ˜¯Norï¼šï¼ˆåˆ©ç”¨Nor Flashå¯ä»¥åƒå†…å­˜ä¸€æ ·è¯»ï¼Œä½†ä¸èƒ½åƒå†…å­˜ä¸€æ ·å†™çš„ç‰¹æ€§ï¼‰[init.c]1234567891011121314151617int isBootFromNorFlash(void)&#123; volatile int *p = (volatile int *)0; int val; val = *p; //å¤‡ä»½åŸæ¥0åœ°å€çš„å€¼ï¼› *p = 0x12345678; //å‘0åœ°å€å†™å€¼ï¼› if (*p == 0x12345678) //åˆ¤æ–­æ˜¯å¦å†™å…¥æˆåŠŸï¼› &#123; *p = val; //å†™æˆåŠŸ, æ˜¯nandå¯åŠ¨ï¼Œæ¢å¤åŸæ¥çš„å€¼ï¼› return 0; &#125; else &#123; return 1; //NORä¸èƒ½åƒå†…å­˜ä¸€æ ·å†™ï¼› &#125;&#125;Nand Flashç»“æ„ï¼šNand Flashè¯»æ“ä½œï¼š[init.c]12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576void nand_read(unsigned int addr, unsigned char *buf, unsigned int len)&#123; int col = addr % 2048; int i = 0; /* 1. é€‰ä¸­ */ nand_select(); while (i &lt; len) &#123; /* 2. å‘å‡ºè¯»å‘½ä»¤00h */ nand_cmd(0x00); /* 3. å‘å‡ºåœ°å€(åˆ†5æ­¥å‘å‡º) */ nand_addr(addr); /* 4. å‘å‡ºè¯»å‘½ä»¤30h */ nand_cmd(0x30); /* 5. åˆ¤æ–­çŠ¶æ€ */ nand_wait_ready(); /* 6. è¯»æ•°æ® */ for (; (col &lt; 2048) &amp;&amp; (i &lt; len); col++) //å¤„ç†æ²¡æœ‰ä»æœ€å·¦è¾¹å¼€å§‹çš„æƒ…å†µï¼› &#123; buf[i] = nand_data(); i++; addr++; &#125; col = 0; &#125; /* 7. å–æ¶ˆé€‰ä¸­ */ nand_deselect();&#125;/* nand_read æ¶‰åŠçš„å­å‡½æ•°*//* 1.é€‰ä¸­Nandï¼›P226*/ void nand_select(void)&#123; NFCONT &amp;= ~(1&lt;&lt;1); &#125;/* 2.å–æ¶ˆé€‰ä¸­Nand */ void nand_deselect(void)&#123; NFCONT |= (1&lt;&lt;1); &#125;/* 3.nandå‘½ä»¤ */ void nand_cmd(unsigned char cmd)&#123; volatile int i; NFCMMD = cmd; for (i = 0; i &lt; 10; i++);&#125;/* 4.nandåœ°å€ */ void nand_addr(unsigned int addr)&#123; unsigned int col = addr % 2048; //å¯¹2kå–ä½™ï¼Œå¾—åˆ°åˆ—ï¼› unsigned int page = addr / 2048; //å¯¹2kå–æ•´ï¼Œå¾—åˆ°è¡Œï¼› volatile int i; NFADDR = col &amp; 0xff; //åˆ—çš„7-0ä½ï¼› for (i = 0; i &lt; 10; i++); NFADDR = (col &gt;&gt; 8) &amp; 0xff; //åˆ—çš„15-8ä½ï¼› for (i = 0; i &lt; 10; i++); NFADDR = page &amp; 0xff; //è¡Œçš„7-0ä½ï¼› for (i = 0; i &lt; 10; i++); NFADDR = (page &gt;&gt; 8) &amp; 0xff; //è¡Œçš„15-8ä½ï¼› for (i = 0; i &lt; 10; i++); NFADDR = (page &gt;&gt; 16) &amp; 0xff; //è¡Œçš„23-16ä½ï¼› for (i = 0; i &lt; 10; i++); &#125;/* 5.ç­‰å¾…è¯»ç»“æŸ */ void nand_wait_ready(void)&#123; while (!(NFSTAT &amp; 1));&#125;/* 6.nandæ•°æ® */ unsigned char nand_data(void)&#123; return NFDATA;&#125; æ¸…ç†_bssæ®µï¼š åœ¨start.Sè·³è½¬åˆ°mainå‰ï¼Œè¿˜éœ€è¦æ¸…ç†_bssæ®µã€‚_bssæ®µå­˜æ”¾çš„æ˜¯æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡æˆ–è€…åˆå§‹åŒ–ä¸º0çš„å…¨å±€å˜é‡ï¼Œç”¨äºå¤„ç†å¯èƒ½è¿‡å¤š0å ç”¨è¿‡å¤šç©ºé—´çš„æƒ…å†µã€‚ç°åœ¨æ¸…0ï¼Œåç»­è¦ä½¿ç”¨æ—¶ï¼Œå†èµ‹0ä½¿ç”¨ã€‚[init.c]12345678void clear_bss(void)&#123; extern int __bss_start, __bss_end; //å£°æ˜é“¾æ¥è„šæœ¬çš„é“¾æ¥åœ°å€; int *p = &amp;__bss_start; for (; p &lt; &amp;__bss_end; p++) //ä»¥_bss_startå¼€å§‹ï¼Œæ¸…ç†åˆ°_bss_end; *p = 0;&#125; é“¾æ¥è„šæœ¬ï¼š[boot.lds]123456789101112131415SECTIONS &#123; . = 0x33f80000; .text : &#123; *(.text) &#125; //ä»£ç æ®µåœ¨0x33f80000ï¼Œå³é“¾æ¥åœ°å€ï¼Œé‡å®šä½åç¨‹åºè¿è¡Œçš„åœ°å€ï¼› . = ALIGN(4); //å››å­—èŠ‚å¯¹é½ï¼ˆ32ä½ï¼‰ï¼› .rodata : &#123;*(.rodata*)&#125; //åªè¯»æ•°æ®æ®µ . = ALIGN(4); .data : &#123; *(.data) &#125; //æ•°æ®æ®µ . = ALIGN(4); __bss_start = .; //_bsså¼€å§‹ .bss : &#123; *(.bss) *(COMMON) &#125; __bss_end = .; //_bssç»“æŸ&#125; 3.æŠŠå†…æ ¸è¯»åˆ°SDRAM å‰é¢start.Sä¸­è°ƒç”¨init.cä¸­çš„nand_initåˆå§‹åŒ–äº†Nand Flahshå’Œå†™å¥½äº†nand_read()å‡½æ•°ã€‚start.Sæœ€åè·³åˆ°mainå‡½æ•°ä¸­ï¼Œè€Œmianå‡½æ•°boot.cä¸­ã€‚[boot.c]12/* 0. å¸®å†…æ ¸è®¾ç½®ä¸²å£: å†…æ ¸å¯åŠ¨çš„å¼€å§‹éƒ¨åˆ†ä¼šä»ä¸²å£æ‰“å°ä¸€äº›ä¿¡æ¯,ä½†æ˜¯å†…æ ¸ä¸€å¼€å§‹æ²¡æœ‰åˆå§‹åŒ–ä¸²å£ */ uart0_init(); //ç•¥ï¼Œçœ‹ç›¸åº”ç« èŠ‚è®¾ç½®ï¼›æŠŠå†…æ ¸è¯»åˆ°SDRAM:[boot.c]12/* 1. ä»NAND FLASHé‡ŒæŠŠå†…æ ¸è¯»å…¥å†…å­˜ */ nand_read(0x60000+64, (unsigned char *)0x30008000, 0x400000); ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæºåœ°å€ï¼š0x60000+64 Nand Flashä¸€èˆ¬åˆ†åŒºæƒ…å†µå¦‚å›¾ï¼Œkernelè®¾è®¡çš„ä½ç½®åœ¨0x60000ï¼Œè¿™é‡ŒåŠ 64æ˜¯å› ä¸ºå†…æ ¸æ ¼å¼ä¸ºuImageï¼ŒuImageç»“æ„æ˜¯64å­—èŠ‚å¤´+zImageã€‚ ç¬¬äºŒä¸ªå‚æ•°ï¼šç›®çš„åœ°å€ï¼š0x3000 8000 å³ä¸ºNand Flashçš„èµ·å§‹åœ°å€ã€‚ ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šé•¿åº¦ï¼š0x200000 å†…æ ¸å¤§å°ï¼Œåé¢å†…æ ¸å¤§äº2Mï¼Œè¿™é‡Œä¸º0x4000 0000ã€‚ 4.è®¾ç½®è¦ä¼ ç»™å†…æ ¸çš„å‚æ•°[boot.c]12345 /* 2. è®¾ç½®å‚æ•° */ setup_start_tag(); setup_memory_tags(); setup_commandline_tag(\"noinitrd root=/dev/mtdblock3 init=/linuxrc console=ttySAC0,115200 rootfstype=yaffs2\");setup_end_tag(); ä¸»è¦åˆ†å››éƒ¨åˆ†ï¼šå¼€å§‹ã€å†…å­˜ä¿¡æ¯ã€å‘½ä»¤ä¿¡æ¯ã€ç»“æŸã€‚ 5.è·³è½¬å¯åŠ¨å†…æ ¸[boot.c]123/* 3. è·³è½¬æ‰§è¡Œ */ theKernel = (void (*)(int, int, unsigned int))0x30008000; theKernel(0, 362, 0x30000100); å‡½æ•°æŒ‡é’ˆæŒ‡å‘0x3000 8000,å³æŒ‡å‘å†…æ ¸ä½ç½®ï¼Œè·³è½¬åˆ°å†…æ ¸ã€‚theKernel()å‚æ•°ï¼š ç¬¬ä¸€ä¸ªå‚æ•°ï¼šå›ºå®šçš„0ï¼› ç¬¬äºŒä¸ªå‚æ•°ï¼šæœºå™¨IDï¼› ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šè¦ä¼ å…¥ç»™å†…æ ¸çš„å‚æ•°ä½ç½®ï¼› 6.æµ‹è¯•ç›¸å…³æºç å‚è€ƒï¼šéŸ¦ä¸œå±±è€å¸ˆæ¯•ä¸šç­è§†é¢‘ï¼› æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"é©±åŠ¨ç›¸å…³","slug":"é©±åŠ¨ç›¸å…³","permalink":"http://yoursite.com/tags/é©±åŠ¨ç›¸å…³/"},{"name":"bootloader","slug":"bootloader","permalink":"http://yoursite.com/tags/bootloader/"}]},{"title":"è½¯ä»¶ç™–","date":"2017-04-06T03:06:19.000Z","path":"2017/04/06/è½¯ä»¶ç™–/","text":"è½¯ä»¶â€œæ´ç™–â€ã€‚ æŠ˜è…¾Windowsä¹…äº†ï¼Œæ¸æ¸çš„å¯¹è½¯ä»¶æœ‰äº†â€œæ´ç™–â€ã€‚å¸¦å¹¿å‘Šçš„è¦æƒ³åŠæ³•å»æ‰å¹¿å‘Šï¼Œæœ‰ç»¿è‰²ç‰ˆçš„è¦ç»¿è‰²ç‰ˆæœ¬ä¼˜å…ˆï¼Œèƒ½ç²¾ç®€çš„å¿…é¡»ç²¾ç®€ï¼Œæ”¶è´¹çš„ä¹Ÿæ— è€»çš„å»ç™¾åº¦äº‘æ‰¾æ‰¾ï¼Œæœ‰åŠŸèƒ½é™åˆ¶ä¸€å®šè¦æƒ³åŠæ³•å»æ‰é™åˆ¶ï¼Œæœ‰æœ€æ–°ç‰ˆçš„ç¨³å®šæƒ…å†µä¸‹ä¸€å®šä½¿ç”¨æœ€æ–°çš„ã€‚ ç»è¿‡æ—¶é—´çš„è¿‡æ»¤ï¼Œæœ‰äº›è½¯ä»¶å¿å—ä½äº†æˆ‘çš„â€œæ´ç™–â€ï¼Œå¹¸å­˜äº†ä¸‹æ¥ï¼Œä»–ä»¬æœ‰çš„å ªç§°â€œç¥å™¨â€ï¼Œæœ‰çš„è‰¯å¿ƒæ— æ¯”è®©äººæ•¬ä½©ã€‚è°¨ä»¥æ­¤æ–‡æ„Ÿè°¢è¿™äº›æé«˜å·¥ä½œæ•ˆç‡å’Œåˆ›é€ å®‰é™çš„ç¯å¢ƒçš„è½¯ä»¶ï¼Œå¯¹ä½œè€…æ·±æ„Ÿæ•¬ä½©ã€‚ Chrome:Windowsç«¯çš„ä¸»åŠ›æµè§ˆå™¨ï¼Œå¹²å‡€ç®€æ´çš„ç•Œé¢ã€å¼ºå¤§çš„æ’ä»¶ï¼Œä¸€ç›´åœ¨å¿ƒä¸­éƒ½æ˜¯æ— å¯æ›¿ä»£çš„å­˜åœ¨ã€‚ SoureInsight:Windowsç«¯ä»£ç ç¥å™¨ï¼Œæœ€å¼€å§‹ä½¿ç”¨çš„æ—¶å€™æ˜¯æ‹’ç»çš„ï¼Œxpæ—¶ä»£çš„å®¡ç¾é£æ ¼ï¼Œéå¸¸æŠµè§¦ï¼Œé™¤å»å¤–è§‚ï¼Œå®ç”¨æ€§ä¸Šæ— è¯å¯è¯´ï¼Œå‡ ä¹æˆä¸ºæ¯å¤©å¿…å¼€çš„è½¯ä»¶ã€‚æœ€è¿‘å‡çº§åˆ°4.0ï¼Œç•Œé¢æ²¡ä»€ä¹ˆå¤§å˜åŒ–ï¼ŒåŠŸèƒ½ä¸Šä¹Ÿå°‘æœ‰çœ¼å‰ä¸€äº®çš„æ›´æ–°ï¼Œç«™åœ¨é¡¶ç«¯ï¼Œéš¾æœ‰è¿›æ­¥ã€‚ OneNote:ç¬”è®°è½¯ä»¶ç¥å™¨ï¼Œé…åˆæ•°ä½æ¿æ‰‹å†™ç¬”è®°ï¼Œç¥å™¨ä¸­çš„ç¥å™¨ã€‚æœ€è¿‘çœ‹Datasheetï¼Œæ‰‹å†™ç¬”è¿¹æ³¨é‡Šï¼Œçœ‹è‹±è¯­éƒ½æ²¡é‚£ä¹ˆæ’æ–¥äº†ï¼Œå”¯ä¸€ä¸è¶³æ˜¯æ’å…¥ä»»ä½•æ ¼å¼çš„æ–‡æ¡£ï¼Œéƒ½æ˜¯ä»¥å›¾ç‰‡çš„å½¢å¼æ‰“å°è¾“å‡ºï¼ŒæŸ¥å•è¯æ²¡æˆäº†ã€‚ PowerPoint:ä¼°è®¡æ˜¯å¤§å­¦ç©å¾—æœ€å¤šçš„è½¯ä»¶ï¼Œå‡ ä¹å¯ä»¥èƒŒåˆ°ä»»ä½•ä¸€ä¸ªæŒ‰é’®çš„ä½ç½®ã€‚ä¸Šå¯é…åˆPråšè§†é¢‘ï¼Œä¸‹å¯å½“Psä¿®å›¾/åšå›¾ã€‚ç°åœ¨åŸºæœ¬æ²¡åšPPTï¼Œä½†ä½œä¸ºåšå›¾ç¥å™¨ï¼Œç°åœ¨æ‰€æœ‰çš„å¹³é¢å›¾éƒ½æ˜¯åœ¨è¿™ä¸Šé¢åšï¼Œèƒœä»»äº†Pså’ŒVisioçš„åŠŸèƒ½ã€‚ Adobe Photoshop:Adobeï¼Œè®¾è®¡é¢†åŸŸçš„è€å¤§ã€‚Photoshopåšå¤§ç²¾æ·±ï¼Œä¼šç‚¹å°æ“ä½œï¼Œå°±åŸºæœ¬æ»¡è¶³æ—¥å¸¸æ‰€æœ‰çš„éœ€æ±‚äº†ã€‚PSå¯¹æˆ‘è¿˜æ˜¯å¾ˆæœ‰å¸å¼•åŠ›çš„ï¼Œæˆ‘åœ¨è€ƒè™‘è¦ä¸è¦åœ¨åšå®¢ä¸Šä¹ŸåŠ ä¸ªPSç›¸å…³çš„æ¿å— = = Adobe Acrobat DC:åœ¨å°è¯•ä½¿ç”¨å…¶ä»–PDFæŸ¥çœ‹è½¯ä»¶åï¼Œæœ€ç»ˆè¿˜æ˜¯è§‰å¾—Adobe Acrobat DCæ˜¯æœ€å¥½ç”¨çš„ï¼Œæ‰€æœ‰å¯¹PDFçš„â€œéæƒ³â€ï¼Œå‡ ä¹éƒ½å¯ä»¥å®Œæˆï¼Œæ¯”å¦‚ï¼šåˆ†å‰²/åˆå¹¶PDFã€æ·»åŠ é¡µçœ‰/é¡µç ã€è®¾ç½®æ˜¯å¯¼å‡ºPDFçš„è¡¨æ ¼åˆ°Excelï¼Œæ€»æ˜¯ä¸€ç§æ·±è—ä¸éœ²çš„æ„Ÿè§‰ï¼Œåªè¦æ˜¯æˆ‘èƒ½æƒ³åˆ°çš„ï¼Œç”¨å¿ƒå»æ‰¾ï¼Œæ€»èƒ½æ‰¾åˆ°è§£å†³æ–¹æ³•ã€‚ WePE:è¿™ä¸ªçœŸçš„æ˜¯æƒ…æ€€ï¼Œåœ¨é‚£ä¸ªä»¥è£…ç³»ç»Ÿä¸ºå®¶å¸¸ä¾¿é¥­çš„æ—¶å…‰é‡Œï¼Œè€æ¯›æ¡ƒå¸¦æ¥çš„é™¤äº†ä¾¿åˆ©è¿˜æœ‰æ†ç»‘è½¯ä»¶å’Œç»‘å®šé¦–é¡µï¼Œå°½ç®¡å…³æ‰äº†æ†ç»‘è½¯ä»¶ï¼Œç»‘å®šé¦–é¡µä¹Ÿæ˜¯ä¸èƒ½å¿çš„ã€‚ä¸€ç›´å¸Œæœ›æ‰¾åˆ°ä¸€ä¸ªå¹²å‡€çš„PEï¼Œç°åœ¨ç»ˆäºæ‰¾åˆ°äº†ï¼Œæ„Ÿè°¢UEPONã€‚ Everything:ç§¯ç´¯çš„æ–‡ä»¶èµ„æ–™è¶Šæ¥è¶Šå¤šï¼Œæ—¶é—´ä¹…äº†ï¼Œè®°ä¸åˆ°æ”¾åœ¨å“ªäº†ã€‚Windowsè‡ªå¸¦çš„æœç´¢åŸºæœ¬æ˜¯åºŸçš„ï¼Œå°±æ²¡è§åˆ°è¿‡è¿›åº¦æ¡èµ°å®Œè¿‡ã€‚ç›´åˆ°ä½¿ç”¨Everythingæ‰æˆåŠŸè§£å†³è¿™ä¸€é—®é¢˜ï¼Œç°åœ¨ä½¿ç”¨ï¼Œä»æœ‰é‚£ç§ä¸å¯æ€è®®çš„æ„Ÿè§‰ã€‚ huorong:ä¸€ç›´éƒ½æ²¡æ€ä¹ˆç”¨è¿‡ç¬¬ä¸‰æ–¹çš„æ€æ¯’è½¯ä»¶ï¼ŒWindows DefenderåŸºæœ¬å¤Ÿç”¨äº†ã€‚å‡ºäºå¯¹åƒåœ¾æ¸…ç†å’Œæµé‡çŠ¶æ€æ˜¾ç¤ºçš„éœ€æ±‚ï¼Œåœ¨ç»å†å¤šç§æ›¿ä»£æ–¹æ¡ˆåï¼Œæœ€ç»ˆå†³å®šä½¿ç”¨huorongï¼Œå¹²å‡€ã€ç®€æ´ã€‚æˆ‘éœ€è¦çš„åŠŸèƒ½éƒ½æœ‰ï¼Œé™„åŠ ç‚¹å¯èƒ½éœ€è¦çš„ï¼Œæˆ‘ä¸æƒ³çš„ç»å¯¹ä¸è¦å‡ºç°ï¼ŒæŒºç¬¦åˆè¦æ±‚çš„ã€‚ Bandzip:ç”¨äº†å¾ˆä¹…çš„å¥½å‹ï¼Œä¹‹å‰ä¹Ÿæ²¡æ€ä¹ˆè§‰å¾—æœ‰é—®é¢˜ï¼Œåæ¥æœ‰æ¬¡å‘ç°Edegé¦–é¡µè¢«åŠ«æŒäº†ï¼Œæœ€åå‘ç°æ˜¯å®ƒæçš„â€œé¬¼â€ã€‚ä¸€ç›´å¯¹2345è¿™ç§é—¨æˆ·ç½‘ç«™æ²¡ä»€ä¹ˆå¥½æ„Ÿï¼Œè¿™æ¬¡ç®—å½»åº•å¤±æœ›äº†ã€‚Bandzipè¿˜æ˜¯å¾ˆä¸é”™çš„ï¼Œé™¤äº†å¹²å‡€ï¼Œå¯ä»¥é¢„è§ˆå‹ç¼©åŒ…çš„å›¾ç‰‡ï¼Œè¿™ä¸ªè¿˜æ˜¯æŒºå®ç”¨çš„ã€‚è¿˜æœ‰å°±æ˜¯å›¾æ ‡æŒºæ–°é²œçš„ã€‚ Snipaste:å¹³æ—¶åŸºæœ¬ä½¿ç”¨Ctrl+Alt+Qçš„QQæˆªå›¾ï¼ŒæŒºæ–¹ä¾¿çš„ï¼Œä½†æœ‰äº›å°åŠŸèƒ½QQæ²¡æœ‰ï¼Œè¿™ä¸ªç®—äº’è¡¥ï¼Œè½¯ä»¶ä¹Ÿå¾ˆè‰¯å¿ƒã€‚ MobaXterm:ä¹‹å‰ä¸€ç›´æƒ³æ‰¾ä¸ªä¸²å£ã€SSHã€FTPä¸‰åˆä¸€çš„è½¯ä»¶ï¼Œæ‰¾äº†å¾ˆä¹…ï¼Œç›´åˆ°ç”¨åˆ°è¿™ä¸ªï¼Œå‡ ä¹å®Œç¾ã€‚å‡ ä¹æ”¯æŒæ‰€æœ‰çš„ä¼ è¾“åè®®ï¼Œè¿˜æœ‰æ–‡ä»¶å¤¹åŒæ­¥ã€å½•åˆ¶å‘½ä»¤ã€è‡ªå®šä¹‰ä¸»é¢˜è‰²å½©ç­‰ã€‚å…è´¹ç‰ˆå‡ ä¹å°±å®Œå…¨å°±å¤Ÿäº†ï¼Œä¹Ÿç®—è‰¯å¿ƒ~ æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"http://yoursite.com/tags/éšç¬”/"}]},{"title":"Linuxå¹¶å‘æ§åˆ¶æœºåˆ¶","date":"2017-04-05T15:55:00.000Z","path":"2017/04/05/Linuxå¹¶å‘æ§åˆ¶/","text":"æœ¬æ–‡ä¸»è¦æ˜¯ç®€å•è®°å½•ä¸‹é©±åŠ¨ä¸­çš„å¹¶å‘æ§åˆ¶ã€‚ 1.å¹¶å‘æ§åˆ¶ 2.åŸå­å˜é‡æ“ä½œæµ‹è¯•ä»£ç ï¼š[atomic_drv.c]link12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#include &lt;linux/module.h&gt; #include &lt;linux/init.h&gt; #include &lt;asm/atomic.h&gt;//åŸå­å˜é‡æ“ä½œçš„å¤´æ–‡ä»¶#include &lt;asm/bitops.h&gt;//åŸå­ä½æ“ä½œçš„å¤´æ–‡ä»¶atomic_t a1 = ATOMIC_INIT(1);//å®šä¹‰å’Œè®¾ç½®åŸå­é‡ï¼›unsigned long int a2;//æ“ä½œå‡½æ•°ä¼ å…¥å‚æ•°çš„æ•°æ®ç±»å‹æ˜¯unsigned long intï¼›static int test_drv_init(void)&#123; //æµ‹è¯•åŸå­å˜é‡æ“ä½œï¼š printk(\"test a1\\nKERN_INFO:atomic_read(): a1 = %d\\n\", a1); atomic_add(4, &amp;a1); printk(\"KERN_INFO:atomic_add(): a1 = %d\\n\", a1); atomic_dec(&amp;a1); printk(\"KERN_INFO:atomic_dec(): a1 = %d\\n\", a1); printk(\"KERN_INFO:atomic_dec_and_test(): judge_a1 = %d, new_a1 = %d\\n\",\\ atomic_dec_and_test(&amp;a1),atomic_read(&amp;a1)); //æµ‹è¯•åŸå­ä½æ“ä½œï¼š set_bit(0,&amp;a2);//è®¾ç½®açš„0ä½ä¸º1; printk(\"test a2\\nKERN_INFO:set_bit(): a2 = %ld\\n\", a2); printk(\"KERN_INFO:test_and_clear_bit(): return_a2 = %d, new_a2 = %ld\\n\",\\ test_and_clear_bit(0, &amp;a2), a2); printk(\"KERN_INFO:test_and_set_bit(): return_a2 = %d, new_a2 = %ld\\n\",\\ test_and_set_bit(0, &amp;a2), a2); return 0;&#125;static void test_drv_exit(void)&#123; &#125;module_init(test_drv_init);module_exit(test_drv_exit);MODULE_LICENSE(\"GPL\"); MODULE_AUTHOR(\"hceng\"); MODULE_DESCRIPTION(\"Learn for atomic\"); æµ‹è¯•ç»“æœï¼š 3.è‡ªæ—‹é”æµ‹è¯•ä»£ç ï¼š[lock_drv.c]link123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081/*è®¾å¤‡é©±åŠ¨ä¸­ï¼Œæœ‰äº›è®¾å¤‡åªå…è®¸æ‰“å¼€ä¸€æ¬¡ï¼Œè¿™é‡Œç”¨countè®¡æ•°ï¼Œlockå¯¹countè¿›è¡Œä¿æŠ¤*/#include &lt;linux/module.h&gt; #include &lt;linux/init.h&gt; #include &lt;linux/kernel.h&gt;#include &lt;linux/fs.h&gt;#include &lt;asm/uaccess.h&gt;#include &lt;linux/of.h&gt;#include &lt;linux/of_device.h&gt;#include &lt;linux/spinlock.h&gt;//è‡ªæ—‹é”å¤´æ–‡ä»¶static struct class *testdrv_class;static struct class_device *testdrv_class_dev;int count = 0 ;spinlock_t lock;static int test_drv_open(struct inode *inode, struct file *file)&#123; spin_lock(&amp;lock); if(count) &#123; spin_unlock(&amp;lock); printk(\"kernel: open fail! count = %d\\n\",count); return -EBUSY; &#125; count++; spin_unlock(&amp;lock); printk(\"kernel: open ok! count = %d\\n\",count); return 0;&#125;static int test_drv_release(struct inode *inode, struct file *file)&#123; spin_lock(&amp;lock); count--; spin_unlock(&amp;lock); printk(\"kernel: release ok! count = %d\\n\",count); return 0;&#125;static struct file_operations test_drv_fops = &#123; .owner = THIS_MODULE, .open = test_drv_open, .release = test_drv_release, &#125;;int major;static int test_drv_init(void)&#123; major = register_chrdev(0, \"test_drv\", &amp;test_drv_fops); testdrv_class = class_create(THIS_MODULE, \"testdrv\"); testdrv_class_dev = device_create(testdrv_class, NULL, MKDEV(major, 0), NULL, \"locktest\"); spin_lock_init(&amp;lock); printk(\"kernel: init ok!\\n\"); return 0;&#125;static void test_drv_exit(void)&#123; unregister_chrdev(major, \"test_drv\"); device_destroy(testdrv_class, MKDEV(major, 0)); class_destroy(testdrv_class); printk(\"kernel: exit ok!\\n\");&#125;module_init(test_drv_init);module_exit(test_drv_exit);MODULE_LICENSE(\"GPL\"); MODULE_AUTHOR(\"hceng\"); MODULE_DESCRIPTION(\"Learn for lock\");[lock_test.c]link123456789101112131415161718192021#include &lt;sys/types.h&gt;#include &lt;sys/stat.h&gt;#include &lt;fcntl.h&gt;#include &lt;stdio.h&gt;int main(int argc, char **argv)&#123; int fd; fd = open(\"/dev/locktest\", O_RDWR); if (fd &lt; 0) &#123; printf(\"app: can't open!\\n\"); &#125; else printf(\"app: open ok!\\n\"); while(1); return 0;&#125; æµ‹è¯•ç»“æœï¼š 4.ä¿¡å·é‡[semaphore_drv.c]link12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273/*è®¾å¤‡é©±åŠ¨ä¸­ï¼Œæœ‰äº›èµ„æºåªèƒ½è¢«å•ä¸€è¿›ç¨‹è®¿é—®ï¼Œè¿™é‡Œç”¨semç¡®ä¿å•ä¸€è®¿é—®*/#include &lt;linux/module.h&gt; #include &lt;linux/init.h&gt; #include &lt;linux/kernel.h&gt;#include &lt;linux/fs.h&gt;#include &lt;asm/uaccess.h&gt;#include &lt;linux/of.h&gt;#include &lt;linux/of_device.h&gt;#include &lt;linux/semaphore.h&gt;//ä¿¡å·é‡å¤´æ–‡ä»¶static struct class *testdrv_class;static struct class_device *testdrv_class_dev;struct semaphore sem;static int test_drv_open(struct inode *inode, struct file *file)&#123; printk(\"kernel:down before sem.count = %d \\n\", sem.count); down(&amp;sem); /*ä¸´ç•Œèµ„æº*/ printk(\"kernel:down after sem.count = %d \\n\", sem.count); return 0;&#125;static int test_drv_release(struct inode *inode, struct file *file)&#123; printk(\"kernel:up before sem.count = %d \\n\", sem.count); up(&amp;sem); printk(\"kernel:up after sem.count = %d \\n\", sem.count); return 0;&#125;static struct file_operations test_drv_fops = &#123; .owner = THIS_MODULE, .open = test_drv_open, .release = test_drv_release, &#125;;int major;static int test_drv_init(void)&#123; major = register_chrdev(0, \"test_drv\", &amp;test_drv_fops); testdrv_class = class_create(THIS_MODULE, \"testdrv\"); testdrv_class_dev = device_create(testdrv_class, NULL, MKDEV(major, 0), NULL, \"semaphoretest\"); sema_init(&amp;sem, 2);//å…è®¸åŒæ—¶2ä¸ªè¿›ç¨‹è®¿é—®ä¸´ç•Œèµ„æº printk(\"kernel: init ok!\\n\"); return 0;&#125;static void test_drv_exit(void)&#123; unregister_chrdev(major, \"test_drv\"); device_destroy(testdrv_class, MKDEV(major, 0)); class_destroy(testdrv_class); printk(\"kernel: exit ok!\\n\");&#125;module_init(test_drv_init);module_exit(test_drv_exit);MODULE_LICENSE(\"GPL\"); MODULE_AUTHOR(\"hceng\"); MODULE_DESCRIPTION(\"Learn for semaphore\"); [semaphore_test.c]link123456789101112131415161718192021#include &lt;sys/types.h&gt;#include &lt;sys/stat.h&gt;#include &lt;fcntl.h&gt;#include &lt;stdio.h&gt;int main(int argc, char **argv)&#123; int fd; fd = open(\"/dev/semaphoretest\", O_RDWR); if (fd &lt; 0) &#123; printf(\"app: can't open!\\n\"); &#125; else printf(\"app: open ok!\\n\"); while(1); return 0;&#125; æµ‹è¯•ç»“æœï¼š 5.å®Œæˆé‡ æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"Linuxé©±åŠ¨","slug":"Linuxé©±åŠ¨","permalink":"http://yoursite.com/tags/Linuxé©±åŠ¨/"},{"name":"é©±åŠ¨ç›¸å…³","slug":"é©±åŠ¨ç›¸å…³","permalink":"http://yoursite.com/tags/é©±åŠ¨ç›¸å…³/"}]},{"title":"ç»ˆç«¯å¤ç”¨è½¯ä»¶-Tmux","date":"2017-03-31T11:50:00.000Z","path":"2017/03/31/ç»ˆç«¯å¤ç”¨è½¯ä»¶â€”â€”Tmux/","text":"æœ¬æ–‡ä¸»è¦è®°å½•ç»ˆç«¯å¤ç”¨è½¯ä»¶â€”â€”Tmuxçš„ç®€å•ä½¿ç”¨ã€‚ Tmuxæ˜¯ä¸€ä¸ªå¯ä»¥æŠŠç»ˆç«¯åˆ†å±çš„è½¯ä»¶ï¼Œæœ€å¼€å§‹çŸ¥é“è¿™è´§æ˜¯åœ¨é…·å®‰ä¸‹äº†Termuxï¼Œé…·å®‰å¤§ä½¬ä»¬çœŸä¼šå®Œï¼Œåˆ·Termuä¸‹é¢çš„è¯„è®ºä¸­çœ‹åˆ°äº†Tmuxï¼Œè§‰å¾—è¿˜æŒºå¥½ç©çš„ã€‚æœ€è¿‘Linuxç»ˆç«¯ç”¨å¾—æ¯”è¾ƒå¤šï¼Œå°è¯•å®‰è£…ç©ç©ï¼Œè®°å½•ä¸‹ã€‚ 1.å®‰è£…tmuxåœ¨ubuntuç»ˆç«¯ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š1$ sudo apt-get install tmux 2.åŸºæœ¬ä½¿ç”¨Tmuxä¸ºäº†ä¸å’Œå…¶å®ƒè½¯ä»¶çš„å¿«æ·é”®å½±å“ï¼Œæ‰€ä»¥å®ƒçš„å‘½ä»¤å…¨è¦åŠ å‰ç¼€Ctrl+båå†æ“ä½œï¼Œä¾‹å¦‚æ–°å»ºä¸ªçª—å£çš„æ“ä½œæ­¥éª¤ï¼š æŒ‰ä¸‹ç»„åˆé”® Ctrl+b; æ”¾å¼€ç»„åˆé”® Ctrl+b; æŒ‰ä¸‹ c é”®; Tmuxçš„æ“ä½œå¾ˆå¤šï¼Œè¿™é‡Œæˆ‘åªè®°å½•å‡ ä¸ªæˆ‘å¸¸ç”¨çš„ï¼Œåç»­è‡ªå·±æœ‰éœ€æ±‚å†å¢åŠ ï¼š åŠŸèƒ½ å‰ç¼€æ“ä½œ ç»„åˆé”® åˆ›å»ºæ–°çª—å£ Ctrl+b-&gt;æ¾å¼€ c æ°´å¹³åˆ’åˆ†çª—å£ Ctrl+b-&gt;æ¾å¼€ â€œ å‚ç›´åˆ’åˆ†çª—å£ Ctrl+b-&gt;æ¾å¼€ % è°ƒæ•´çª—å£å¤§å° Ctrl+b-&gt;ä¸æ¾ä½ æ–¹å‘é”® åˆ‡æ¢çª—å£ Ctrl+b-&gt;æ¾å¼€ æ–¹å‘é”® æ˜¾ç¤ºçª—å£æ ‡å· Ctrl+b-&gt;æ¾å¼€ q å…³é—­çª—å£ Ctrl+b-&gt;æ¾å¼€ x-&gt;y å…³é—­Tmux Ctrl+b-&gt;æ¾å¼€ &amp;-&gt;y 3.å…¶å®ƒä¼˜åŒ–ç¾åŒ–çš„è¯å‚è€ƒåé¢ç»™çš„åšå®¢é“¾æ¥ï¼Œè¿™é‡Œæˆ‘åªç¾åŒ–äº†åº•è¾¹çŠ¶æ€æ ï¼šè¿›å…¥homeç›®å½•ï¼Œæ–°å»º.tmux.conf12$ cd ~$ vi ~/.tmux.confåŠ å…¥ä»¥ä¸‹ä»£ç ï¼š 12345678910111213141516171819# çŠ¶æ€æ # é¢œè‰²set -g status-bg blackset -g status-fg white # å¯¹é½æ–¹å¼set-option -g status-justify centre # å·¦ä¸‹è§’set-option -g status-left &apos;#[bg=black,fg=green][#[fg=cyan]#S#[fg=green]]&apos;set-option -g status-left-length 20 # çª—å£åˆ—è¡¨setw -g automatic-rename onset-window-option -g window-status-format &apos;#[dim]#I:#[default]#W#[fg=grey,dim]&apos;set-window-option -g window-status-current-format &apos;#[fg=cyan,bold]#I#[fg=blue]:#[fg=cyan]#W#[fg=dim]&apos; # å³ä¸‹è§’set -g status-right &apos;#[fg=green][#[fg=cyan]%Y-%m-%d#[fg=green]]&apos; æœ€ç»ˆæ•ˆæœå›¾ï¼š å‚è€ƒåšå®¢ï¼šTmux é€Ÿæˆæ•™ç¨‹ï¼šæŠ€å·§å’Œè°ƒæ•´Tmuxç®€å•æ•™ç¨‹ æœ€åä¿®æ”¹æ—¶é—´ï¼š2017/3/31 19:51:36 æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"é©±åŠ¨ç›¸å…³","slug":"é©±åŠ¨ç›¸å…³","permalink":"http://yoursite.com/tags/é©±åŠ¨ç›¸å…³/"},{"name":"LinuxåŸºç¡€","slug":"LinuxåŸºç¡€","permalink":"http://yoursite.com/tags/LinuxåŸºç¡€/"}]},{"title":"U-Bootåˆ†æã€ç§»æ¤åŠä½¿ç”¨","date":"2017-03-26T10:39:00.000Z","path":"2017/03/26/U-Bootåˆ†æã€ç§»æ¤åŠä½¿ç”¨/","text":"è¯¥ç³»åˆ—ä¸»è¦æ˜¯ä¸ºé©±åŠ¨å­¦ä¹ æä¾›åŸºçŸ³ï¼Œä»0åˆ°Qtã€‚æœ¬æ–‡æ˜¯è¯¥ç³»åˆ—çš„ç¬¬äºŒç¯‡:å¯¹U-Bootè¿›è¡Œåˆ†æåŠç§»æ¤. 1.U-Bootç»“æ„åˆ†æBootloaderä¸€èˆ¬å¯ä»¥åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼š ç¬¬ä¸€ä¸ªé˜¶æ®µé€šå¸¸ä½¿ç”¨æ±‡ç¼–è¿›è¡Œå¿…è¦çš„ç¡¬ä»¶åˆå§‹åŒ–ï¼Œä¾‹å¦‚ï¼šå…³çœ‹é—¨ç‹—ã€å…³ä¸­æ–­ã€è®¾ç½®æ—¶é’Ÿé¢‘ç‡ã€RAMåˆå§‹åŒ–ç­‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜è¦å°†ç¬¬äºŒé˜¶æ®µçš„ä»£ç å¤åˆ¶åˆ°RAMä¸­ï¼Œè®¾ç½®å¥½æ ˆï¼Œç„¶åè·³åˆ°ç¬¬äºŒé˜¶æ®µï¼Œè¯¥é˜¶æ®µä¸»è¦æ˜¯ä¸SOCå¹³å°ç›¸å…³ã€‚ ç¬¬äºŒé˜¶æ®µä¸€èˆ¬æ˜¯ç”¨cè¯­è¨€ç¼–å†™ï¼Œè¯¥é˜¶æ®µä¸»è¦å’Œå¼€å‘æ¿æ¿è½½èµ„æºç›¸å…³ã€‚è¯¥é˜¶æ®µä¸»è¦åˆå§‹åŒ–åç»­çš„ç¡¬ä»¶ï¼Œå¤„ç†å†…å­˜æ˜ å°„ã€ä»¥åŠå°†å†…æ ¸å’Œæ ¹æ–‡ä»¶ç³»ç»Ÿä»Flashâ€œæ¬è¿â€åˆ°RAMä¸­è¿è¡Œï¼Œç„¶åä¼ å…¥å¯åŠ¨å‚æ•°ï¼Œæœ€åå¯åŠ¨å¼•å¯¼å†…æ ¸ï¼Œå®Œæˆä½¿å‘½ã€‚ Linuxä¸­ç³»ç»Ÿä¸€èˆ¬çš„åˆ†åŒºç»“æ„ï¼Œå¦‚ä¸‹å›¾ï¼š åˆ†åŒºä¸»è¦åˆ†ä¸ºå››ä¸ªåˆ†åŒºï¼šBootloaderã€Boot parametersã€Kernelã€Root filesystemã€‚å…¶ä¸­Boot parametersæ˜¯å¾…ä¼ å…¥å†…æ ¸çš„å‚æ•°ï¼ŒKernelå³å†…æ ¸ã€Root filesystemæ˜¯æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚Bootloaderåœ¨ç¬¬ä¸€ä¸ªåˆ†åŒº(å‡è®¾è¯¥å‚¨å­˜ä»‹è´¨ä¸ºNand Flash)ï¼Œåˆ™åœ¨Nand Flashçš„åœ°å€ä¸º0x0000 0000ï¼ŒS3C2440ä¸Šç”µåï¼Œç¡¬ä»¶è‡ªåŠ¨æŠŠNand Flashä¸Šå‰4kä»£ç å¤æ‚åˆ°è‡ªå·±å†…éƒ¨RAMä¸­è¿è¡Œã€‚è¯¥4kä»£ç å…ˆè¦åˆå§‹åŒ–ä¸€äº›å¿…è¦çš„ç¡¬ä»¶ï¼Œå¦‚çœ‹é—¨ç‹—ï¼Œä¸­æ–­ç­‰ï¼Œç„¶åå‡†å¤‡å¥½SRAMï¼Œå¹¶å°†åç»­çš„ä»£ç å¤åˆ¶åˆ°SDRAMä¸­ï¼Œå†è·³åˆ°SDRAMä¸­è¿è¡Œï¼Œå®ŒæˆBootloaderç¬¬ä¸€é˜¶æ®µã€‚æ­¤æ—¶åœ¨SDRAMä¸­çš„ç¬¬äºŒé˜¶æ®µä»£ç å¼€å§‹å·¥ä½œï¼Œé¦–å…ˆè¿˜æ˜¯åˆå§‹åŒ–ç¡¬ä»¶ï¼Œå¤„ç†å†…å­˜æ˜ å°„ï¼ŒæŠŠNand Flashä¸Šå†…æ ¸å’Œæ ¹æ–‡ä»¶ç³»ç»Ÿâ€œæ¬è¿â€åˆ°SDRAMå‡†å¤‡è¿è¡Œï¼Œç„¶åæ ¹æ®ç”¨æˆ·é€šè¿‡ä¸²å£ä¼ å…¥çš„å¯åŠ¨å‚æ•°æ”¾åœ¨Boot parametersï¼Œç„¶åå†…æ ¸å¯åŠ¨ï¼Œå®Œæˆä½¿å‘½ã€‚å†…æ ¸å¯åŠ¨åï¼Œå¼€å§‹å»Boot parameterså¯»æ‰¾å¯åŠ¨å‚æ•°ï¼Œæ ¹æ®å¯åŠ¨å‚æ•°åšå‡ºç›¸åº”çš„æ“ä½œï¼Œå¦‚ï¼šæ§åˆ¶å°è¾“å‡ºã€ä¸²å£æ³¢ç‰¹ç‡ã€æ ¹æ–‡ä»¶ç³»ç»Ÿä½ç½®ã€‚ 2.U-Bootæºç åˆ†æ è¿™é‡Œæ ¹æ®u-boot-1.1.6çš„æºç è¿›è¡Œåˆ†æï¼Œï¼Œä¸»è¦å·¥ä½œæœ‰ï¼š ç¬¬ä¸€é˜¶æ®µçš„ç¡¬ä»¶åˆå§‹åŒ–(CPUæ¨¡å¼ã€çœ‹é—¨ç‹—ã€ä¸­æ–­) å‡†å¤‡SDRAM è®¾ç½®å †æ ˆ æ¬è¿FLASHä¸­çš„ä»£ç åˆ°SDRAM æ¸…é™¤.bssæ®µå¹¶è·³è½¬è‡³ç¬¬äºŒé˜¶æ®µ ç¬¬äºŒé˜¶æ®µçš„ç¡¬ä»¶åˆå§‹åŒ–ï¼ˆæ—¶é’Ÿã€ä¸²å£ï¼‰ å†…å­˜æ˜ å°„ æ ¹æ®ä¼ å…¥å‚æ•°å¯åŠ¨å†…æ ¸ 2.1ç¬¬ä¸€é˜¶æ®µ è¯¥é˜¶æ®µçš„æºç åœ¨/arch/cpu/arm920t/start.Sä¸­ï¼šé¦–å…ˆè¿›è¡Œç¡¬ä»¶åˆå§‹åŒ–ï¼ŒåŒ…æ‹¬è®¾ç½®CPUæ¨¡å¼ï¼Œå…³é—­çœ‹é—¨ç‹—ã€å…³é—­ä¸­æ–­ã€‚è¿™é‡ŒæŠŠæ—¶é’Ÿé…ç½®æ”¾åœ¨äº†ç¬¬äºŒé˜¶æ®µã€‚ è®¾ç½®CPUæ¨¡å¼ æŠŠCPUè®¾ç½®ä¸ºSVCæ¨¡å¼ï¼Œå°†å½“å‰ç¨‹åºçŠ¶æ€è®¡æ•°å™¨CPSRçš„å€¼ä¿å­˜åˆ°r0ä¸­ï¼Œåˆ©ç”¨bicæŒ‡ä»¤æ¸…é™¤r0çš„0x1få¹¶å­˜å…¥r0ä¸­ï¼Œå†åˆ©ç”¨orræŒ‡ä»¤æˆ–è¿ç®—ä¸Š0xd3å¹¶å­˜å…¥r0ï¼Œæœ€år0å†™å›CPSR,è¿™ä¸€è¿‡ç¨‹å°±æŠŠCPSRè®¾ç½®ä¸ºSVCæ¨¡å¼ï¼š[start.S]123456reset:/* set the cpu to SVC32 mode*/ mrs r0,cpsr bic r0,r0,#0x1f orr r0,r0,#0xd3 msr cpsr,r0 è®¾ç½®çœ‹é—¨ç‹—å’Œå…³é—­ä¸­æ–­ æ ¹æ®S3C2440çš„datasheetï¼Œå°†0x00å†™å…¥pWTCONå¯¹åº”å¯„å­˜å™¨çš„åœ°å€ï¼Œå®Œæˆçœ‹é—¨ç‹—çš„å…³é—­ã€‚ä¸­æ–­éƒ¨åˆ†ä¹Ÿç±»ä¼¼ï¼Œå°†INTMSKå¯„å­˜å™¨è®¾ç½®ä¸º0xffff ffffå³å¯ï¼š[start.S]12345678910111213/* turn off the watchdog */# define pWTCON 0x53000000# define INTMOD 0X4A000004# define INTMSK 0x4A000008 /* Interupt-Controller base addresses */# define INTSUBMSK 0x4A00001C# define CLKDIVN 0x4C000014 /* clock divisor register */ ldr r0, =pWTCON mov r1, #0x0 str r1, [r0]/* turn off the int */ ldr r1, =0x3ff ldr r0, =INTSUBMSK str r1, [r0] å‡†å¤‡SDRAMstart.Sä¸­æ²¡æœ‰åˆå§‹åŒ–SDRAMï¼Œè€Œæ˜¯å…ˆè·³è½¬åˆ°å‡½æ•°cpu_init_critä¸­ï¼Œå†è·³è½¬è‡³lowlevel_init.Sä¸­è¿›è¡Œåˆå§‹åŒ–SDRAMã€‚adræ˜¯ä¸€ä¸ªä½ç½®æ— å…³æŒ‡ä»¤ï¼Œå°†_startçš„åœ°å€è¯»å–åˆ°r0ä¸­ï¼Œä¸Šç”µåï¼ŒFlashä¸­çš„å‰4kå°±è¢«æ‹·åˆ°S3C2440å†…éƒ¨RAMï¼Œåˆ™è¿™é‡Œr0=0ã€‚ç„¶åå†ç”¨ldræŒ‡ä»¤å°†_TEXT_BASEè¿™ä¸ªåœ°å€ï¼ˆæ¥è‡ªé“¾æ¥è„šæœ¬ï¼Œä»£è¡¨è¿è¡Œåœ°å€ï¼‰çš„å€¼æ”¾åœ¨r1ä¸­ã€‚ç„¶åæ¯”è¾ƒr0å’Œr1çš„å€¼ï¼Œå¦‚æœæ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆè¯æ˜è¿™ä¸ªæ—¶å€™ä»£ç å·²ç»ä½äºäº†å…¶åº”è¯¥ä½äºçš„åœ°æ–¹ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¸å†éœ€è¦åˆå§‹åŒ–SDRAMå»é‡å®šä½äº†ã€‚å¦‚æœr1å’Œr0çš„å€¼ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆå°†ç›´æ¥è·³è½¬cpu_init_critä¸­ã€‚[start.S]1234adr r0, _start /* r0 &lt;- current position of code */ldr r1, _TEXT_BASE /* test if we run from flash or RAM */cmp r0, r1 /* don&apos;t reloc during debug */blne cpu_init_crit [start.S]12345678910111213141516171819202122cpu_init_crit: /*flush v4 I/D caches*/ mov r0, #0 mcr p15, 0, r0, c7, c7, 0 /* flush v3/v4 cache */ mcr p15, 0, r0, c8, c7, 0 /* flush v4 TLB */ /*disable MMU stuff and caches*/ mrc p15, 0, r0, c1, c0, 0 bic r0, r0, #0x00002300 @ clear bits 13, 9:8 (--V- --RS) bic r0, r0, #0x00000087 @ clear bits 7, 2:0 (B--- -CAM) orr r0, r0, #0x00000002 @ set bit 2 (A) Align orr r0, r0, #0x00001000 @ set bit 12 (I) I-Cache mcr p15, 0, r0, c1, c0, 0 /* * before relocating, we have to setup RAM timing * because memory timing is board-dependend, you will * find a lowlevel_init.S in your board directory. */ mov ip, lr bl lowlevel_init mov lr, ip è®¾ç½®æ ˆ é€šå¸¸ä¸ºäº†ä¿å­˜è°ƒç”¨Cè¯­è¨€æ—¶ä¼ é€’å‚æ•°å’Œä¿å­˜CPUè¿è¡Œæ—¶çš„ç°åœºï¼Œéœ€è¦è®¾ç½®æ ˆï¼Œæ ¹æ®å®šä¹‰_TEXT_BASEDä¸ºä»£ç æ®µçš„å¼€å§‹åœ°å€ï¼Œç„¶ååœ¨ä»£ç æ®µçš„ä¸‹é¢ç•™å‡ºä¸€æ®µå†…å­˜å®ç°mallocå’Œå…¨å±€å‚æ•°ï¼Œå†ç•™å‡ºä¸€ç‚¹ç»™ä¸­æ–­æ¨¡å¼çš„æ ˆå’Œabortå¼‚å¸¸çš„æ ˆï¼Œå‰©ä¸‹çš„å°±æ˜¯æ ˆäº†ï¼š[start.S]12345678910/* Set up the stack */stack_setup: ldr r0, _TEXT_BASE /* upper 128 KiB: relocated uboot */ sub r0, r0, #CFG_MALLOC_LEN /* malloc area */ sub r0, r0, #CFG_GBL_DATA_SIZE /* bdinfo */#ifdef CONFIG_USE_IRQ sub r0, r0, #(CONFIG_STACKSIZE_IRQ+CONFIG_STACKSIZE_FIQ)#endif sub sp, r0, #12 /* leave 3 words for abort-stack */ æ¬è¿FLASHä¸­çš„ä»£ç åˆ°SDRAM ç°åœ¨å°†Bootloaderçš„å…¨éƒ¨ä»£ç å¤åˆ¶åˆ°RAMä¸­è¿è¡Œï¼š [lowlevel_init.S]1234567891011121314151617relocate: /* relocate U-Boot to RAM */ adr r0, _start /* r0 &lt;- current position of code */ ldr r1, _TEXT_BASE /* test if we run from flash or RAM */ cmp r0, r1 /* don&apos;t reloc during debug */ beq clear_bss ldr r2, _armboot_start ldr r3, _bss_start sub r2, r3, r2 /* r2 &lt;- size of armboot */ bl CopyCode2Ram /* r0: source, r1: dest, r2: size */copy_loop: ldmia r0!, &#123;r3-r10&#125; /* copy from source address [r0] */ stmia r1!, &#123;r3-r10&#125; /* copy to target address [r1] */ cmp r0, r2 /* until source end addreee [r2] */ ble copy_loop æ¸…é™¤.bssæ®µå¹¶è·³è½¬è‡³ç¬¬äºŒé˜¶æ®µ bssæ®µéƒ¨åˆ†ä¿å­˜æœ‰é™æ€å˜é‡ã€æ²¡æœ‰åˆå§‹åŒ–æˆ–åˆå§‹åŒ–å€¼ä¸º0çš„å…¨å±€å˜é‡ï¼Œä¸ºäº†å‡å°ä½“ç§¯å’Œé˜²æ­¢ç¨‹åºåœ¨è¯»å–å®ƒä»¬æ—¶ï¼Œè¯»å–çš„æ—¶ä¸Šæ¬¡çš„å€¼ï¼Œæ‰€ä»¥éœ€è¦å…ˆæ¸…0ï¼š [start.S]12345678910clear_bss: ldr r0, _bss_start /* find start of bss segment */ ldr r1, _bss_end /* stop here */ mov r2, #0x00000000 /* clear */clbss_l:str r2, [r0] /* clear loop... */ add r0, r0, #4 cmp r0, r1 ble clbss_lldr pc, _start_armboot 2.2ç¬¬äºŒé˜¶æ®µ ç¬¬äºŒé˜¶æ®µçš„ä»£ç åœ¨lib_arm/board.cä¸­çš„start_armboot()å‡½æ•°å¼€å§‹ï¼Œåœ¨å†…éƒ¨è°ƒç”¨å„è‡ªå‡½æ•°è¿›è¡Œè®¾ç½®ï¼š è®¾ç½®æ—¶é’Ÿ[smdk2410.c]123456789101112131415161718192021222324252627282930313233343536373839404142434445464748int board_init (void)&#123; S3C24X0_CLOCK_POWER * const clk_power = S3C24X0_GetBase_CLOCK_POWER(); S3C24X0_GPIO * const gpio = S3C24X0_GetBase_GPIO(); /* to reduce PLL lock time, adjust the LOCKTIME register */ clk_power-&gt;LOCKTIME = 0xFFFFFF; /* configure MPLL */ clk_power-&gt;MPLLCON = ((M_MDIV &lt;&lt; 12) + (M_PDIV &lt;&lt; 4) + M_SDIV); /* some delay between MPLL and UPLL */ delay (4000); /* configure UPLL */ clk_power-&gt;UPLLCON = ((U_M_MDIV &lt;&lt; 12) + (U_M_PDIV &lt;&lt; 4) + U_M_SDIV); /* some delay between MPLL and UPLL */ delay (8000); /* set up the I/O ports */ gpio-&gt;GPACON = 0x007FFFFF; gpio-&gt;GPBCON = 0x00044555; gpio-&gt;GPBUP = 0x000007FF; gpio-&gt;GPCCON = 0xAAAAAAAA; gpio-&gt;GPCUP = 0x0000FFFF; gpio-&gt;GPDCON = 0xAAAAAAAA; gpio-&gt;GPDUP = 0x0000FFFF; gpio-&gt;GPECON = 0xAAAAAAAA; gpio-&gt;GPEUP = 0x0000FFFF; gpio-&gt;GPFCON = 0x000055AA; gpio-&gt;GPFUP = 0x000000FF; gpio-&gt;GPGCON = 0xFF95FFBA; gpio-&gt;GPGUP = 0x0000FFFF; gpio-&gt;GPHCON = 0x002AFAAA; gpio-&gt;GPHUP = 0x000007FF; /* arch number of SMDK2410-Board */ gd-&gt;bd-&gt;bi_arch_number = MACH_TYPE_SMDK2410; /* adress of boot parameters */ gd-&gt;bd-&gt;bi_boot_params = 0x30000100; icache_enable(); dcache_enable(); return 0;&#125; åˆå§‹åŒ–ä¸²å£[serial.c]1234567891011121314151617181920int serial_init (void)&#123; serial_setbrg (); return (0);&#125;/* * Read a single byte from the serial port. Returns 1 on success, 0 * otherwise. When the function is succesfull, the character read is * written into its argument c. */int serial_getc (void)&#123; S3C24X0_UART * const uart = S3C24X0_GetBase_UART(UART_NR); /* wait for character to arrive */ while (!(uart-&gt;UTRSTAT &amp; 0x1)); return uart-&gt;URXH &amp; 0xff;&#125; ç›‘å†…å­˜æ˜ å°„ åœ¨smdk2410.cé‡Œçš„å‡½æ•°dram_initä¸­è®¾ç½®çš„å†…å­˜èµ·å§‹åœ°å€ä¸º0x3000 0000,å¤§å°ä¸º0x4000 0000:[smdk2410.c]1234567int dram_init (void)&#123; gd-&gt;bd-&gt;bi_dram[0].start = PHYS_SDRAM_1; gd-&gt;bd-&gt;bi_dram[0].size = PHYS_SDRAM_1_SIZE; return 0;&#125; è‡³æ­¤ï¼ŒU-Bootçš„å¯åŠ¨è¿‡ç¨‹åŸºæœ¬åˆ†æå®Œäº†ï¼Œåœ¨å¯åŠ¨U-Bootåï¼Œé€šè¿‡lib_arm/armlinux.cä¸­çš„do_boot_linuxæ¥å¯åŠ¨å†…æ ¸ã€‚è¿™é‡Œæ€»ç»“ç”»ä¸ªå›¾æ¥è®°å½•ä¸‹ï¼Œä¸­é—´çš„é¡ºåºå¯èƒ½æœ‰ç‚¹å°å·®å¼‚ï¼Œä½†å¤§è‡´æ²¡é—®é¢˜ï¼š3.U-Bootç§»æ¤å¾…è¡¥å……ã€‚4.U-Bootä½¿ç”¨è®°å½•ä¸‹å¹³æ—¶ä½¿ç”¨U-Bootçƒ§å†™å†…æ ¸/æ ¹æ–‡ä»¶ç³»ç»Ÿå’ŒæŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™é‡Œå‡è®¾å¦‚ä¸‹ï¼š Ubuntuä¸­å¾…ä½œä¸ºnfsæŒ‚è½½çš„è·¯å¾„ï¼š/work/hceng/nfs_rootfsUbuntu IPï¼š192.168.1.141å¼€å‘æ¿ IPï¼š192.168.1.142ç½‘å…³ IPï¼š192.168.1.1 è¿™é‡Œè¦æå‰åœ¨Ubuntuè™šæ‹Ÿæœºä¸­è¿›è¡ŒNFSé…ç½®ï¼Œå‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„ï¼š2.3å®‰è£…ã€ é…ç½®ç½‘ç»œæœåŠ¡ï¼› å¯åŠ¨U-Bootåï¼Œè¿…é€ŸæŒ‰ä»»æ„é”®è¿›å…¥U-Bootçš„ä¸‹è½½æ¨¡å¼ï¼Œå†è¾“å…¥â€qâ€é€€å‡ºèœå•ã€‚ è®¾ç½®å¼€å‘æ¿ipå’ŒnfsæŒ‚è½½çš„æœåŠ¡ipï¼š 123setenv serverip 192.168.1.141 //è®¾ç½®æœåŠ¡å™¨ubuntu ipsetenv ipaddr 192.168.1.142 //è®¾ç½®å¼€å‘æ¿ipsaveenv è®¾ç½®u-bootå„åˆ†åŒºå¤§å°ï¼ˆå†…æ ¸ä¹Ÿè¦ç›¸åº”è®¾ç½®åŒ¹é…ï¼Œåœ¨Linux-3.4.2å†…æ ¸ä¸­ï¼Œæ–‡ä»¶åœ¨arch/arm/mach-s3c24xx/common-smdk.cä¸­ï¼‰: 12setenv mtdparts mtdparts=nandflash0:256k@0(bootloader),128k(params),4m(kernel),-(root)saveenv ä¸‹è½½ã€æ“¦é™¤ã€çƒ§å†™å†…æ ¸ï¼š 123nfs 30000000 192.168.1.141:/work/hceng/nfs_rootfs/uImagenand erase kernelnand write.jffs2 30000000 kernel ä¸‹è½½ã€æ“¦é™¤ã€çƒ§å†™æ ¹æ–‡ä»¶ç³»ç»Ÿï¼š 123nfs 30000000 192.168.1.141:/work/hceng/nfs_rootfs/fs_mini_mdev_new.yaffs2nand erase rootnand write.yaffs 30000000 4a0000 $(filesize) æ ¹æ–‡ä»¶ç³»ç»Ÿé‡‡ç”¨nandå¯åŠ¨ï¼š 12set bootargs noinitrd root=/dev/mtdblock3 rootfstype=yaffs2 init=/linuxrc console=ttySAC0,115200saveenv å¯åŠ¨åï¼Œå¯¹åº”çš„NFSæŒ‚è½½ï¼š 1mount -t nfs 192.168.1.141:/work/hceng/nfs_rootfs /tmp æ ¹æ–‡ä»¶ç³»ç»Ÿé‡‡ç”¨nfså¯åŠ¨ï¼š 12set bootargs root=/dev/nfs nfsroot=192.168.1.141:/work/hceng/nfs_rootfs ip=192.168.1.142:192.168.1.141:192.168.1.1:255.255.255.0::eth0:off init=/linuxrc console=ttySAC0,115200 saveenv æœ€åå¯åŠ¨ï¼š1boot æœ€åä¿®æ”¹æ—¶é—´ï¼š2017/4/1 17:06:08 æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"é©±åŠ¨ç›¸å…³","slug":"é©±åŠ¨ç›¸å…³","permalink":"http://yoursite.com/tags/é©±åŠ¨ç›¸å…³/"},{"name":"ç¯å¢ƒæ­å»º","slug":"ç¯å¢ƒæ­å»º","permalink":"http://yoursite.com/tags/ç¯å¢ƒæ­å»º/"}]},{"title":"æ­å»ºåµŒå…¥å¼Linuxå¼€å‘ç¯å¢ƒ","date":"2017-03-23T09:19:00.000Z","path":"2017/03/23/æ­å»ºåµŒå…¥å¼Linuxå¼€å‘ç¯å¢ƒ/","text":"æœ¬æ–‡ä¸»è¦è®°å½•åœ¨æ­å»ºåµŒå…¥å¼Linuxå¼€å‘ç¯å¢ƒè¿‡ç¨‹ä¸­çš„. æ‰€éœ€ææ–™ï¼š è™šæ‹Ÿæœºï¼šVMware-workstation-full-12.0.0-2985596.exe Ubuntuç³»ç»Ÿé•œåƒï¼šubuntu-16.04.1-desktop-amd64.iso äº¤å‰å·¥å…·é“¾ï¼šarm-linux-gcc-4.4.3.tar.gz å®‰è£…è„šæœ¬ï¼šinstall-devel-packages.shæˆ–install-devel-packages-for-16.sh 1.å®‰è£…Ubuntu-16.04.1 æ‰“å¼€å®‰è£…å¥½çš„è™šæ‹Ÿæœºï¼Œé€‰æ‹©åˆ›å»ºæ–°çš„è™šæ‹Ÿæœºï¼š é€‰æ‹©å…¸å‹é…ç½®ï¼š é€‰æ‹©æµè§ˆæ‰¾åˆ°ubuntu-16.04.1-desktop-amd64.isoå¹¶é€‰ä¸­ï¼š å¡«å…¥ç”¨æˆ·åã€å¯†ç ï¼ˆæœ¬æœºå¯†ç ï¼š123456ï¼‰ï¼š è®¾ç½®è™šæ‹Ÿæœºåç§°å’Œä¿å­˜è·¯å¾„ï¼š è®¾ç½®è™šæ‹Ÿæœºæœ€å¤§å®¹é‡ï¼ˆ60Gå·®ä¸å¤šäº†ï¼‰ï¼š åœ¨å¼¹å‡ºçš„å‘å¯¼ä¸­é€‰æ‹©è‡ªå®šä¹‰ç¡¬ä»¶ï¼Œè®¾ç½®å†…å­˜ã€CPUã€ç½‘ç»œï¼š ç­‰å¾…ä¸€ä¼šåï¼Œå®‰è£…å®Œæ¯•ï¼Œè¾“å…¥ä¹‹å‰è®¾ç½®çš„å¯†ç è¿›å…¥ç³»ç»Ÿï¼š ç‚¹å·¦ä¸Šè§’çš„Ubuntuæœç´¢å›¾æ ‡ï¼Œï¼Œè¾“å…¥tï¼Œå°†å‡ºç°çš„Terminalæ§åˆ¶å°ï¼š 2.å®‰è£…ã€é…ç½®å¿…è¦è½¯ä»¶2.1æ£€æŸ¥è™šæ‹Ÿæœºç½‘ç»œè®¾ç½® æ‰“å¼€ç¼–è¾‘-&gt;è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ï¼š æ›´æ”¹è®¾ç½®ï¼š æ£€æŸ¥è¿™ä¸‰ä¸ªé…ç½®ï¼š è¾“å…¥ifconfigæŸ¥çœ‹ç½‘ç»œé…ç½®ï¼Œå†ping www.baidu.comæµ‹è¯•ï¼š 2.2ä¿®æ”¹è½¯ä»¶æº é¦–å…ˆå¤‡ä»½åŸæ¥çš„æ–‡ä»¶ï¼š1$ sudo cp /etc/apt/sources.list /etc/apt/sources.list.backup ç”¨viç¼–è¾‘å™¨æ‰“å¼€ç¼–è¾‘ï¼š1$ sudo vi /etc/apt/sources.list åˆ æ‰æ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œæ›¿æ¢ä¸ºä»¥ä¸‹æ–‡æœ¬ï¼š123456789101112131415161718# deb cdrom:[Ubuntu 16.04 LTS _Xenial Xerus_ - Release amd64 (20160420.1)]/ xenial main restricteddeb-src http://archive.ubuntu.com/ubuntu xenial main restricted #Added by software-propertiesdeb http://mirrors.aliyun.com/ubuntu/ xenial main restricteddeb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe #Added by software-propertiesdeb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricteddeb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe #Added by software-propertiesdeb http://mirrors.aliyun.com/ubuntu/ xenial universedeb http://mirrors.aliyun.com/ubuntu/ xenial-updates universedeb http://mirrors.aliyun.com/ubuntu/ xenial multiversedeb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiversedeb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse #Added by software-propertiesdeb http://archive.canonical.com/ubuntu xenial partnerdeb-src http://archive.canonical.com/ubuntu xenial partnerdeb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricteddeb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe #Added by software-propertiesdeb http://mirrors.aliyun.com/ubuntu/ xenial-security universedeb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse æ³¨ï¼š æ­¤æ—¶viæ˜¯ä¸å®Œå…¨ç‰ˆçš„ï¼Œå¾ˆéš¾ç”¨ï¼Œç¼–è¾‘æ¨¡å¼ä¸‹æ–¹å‘é”®æ˜¯ä¹±çš„ï¼Œä½¿ç”¨geditæ‰“å¼€ç¼–è¾‘ï¼Œåé¢å†æ›´æ–°viï¼š1$ sudo gedit /etc/apt/sources.list æ­¤æ—¶Ubuntué»˜è®¤è£…äº†VMware Toolsï¼Œå¯ä»¥å¤åˆ¶windowsä¸‹çš„æ–‡æœ¬ï¼Œç„¶åctrl+shift+våœ¨Ubuntué‡Œé¢ç²˜è´´æ–‡æœ¬ã€‚ä¹Ÿæ”¯æŒwindowsé‡Œæ–‡ä»¶å’ŒUbuntuçš„ç›´æ¥æ‹–æ‹½å¤åˆ¶ã€‚ å®Œæˆä¸Šé¢çš„ä¿®æ”¹åï¼Œå†æ›´æ–°è½¯ä»¶åˆ—è¡¨å’Œå®‰è£…å®Œæ•´çš„vimï¼š12$ sudo apt-get update$ sudo apt-get install vim å®‰è£…è¿‡ç¨‹ä¸­æ ¹æ®æç¤ºè¾“å…¥yesç¡®è®¤ï¼Œä¸‹åŒã€‚ 2.3å®‰è£…ã€ é…ç½®ç½‘ç»œæœåŠ¡ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… ftpã€sshã€nfsæœåŠ¡ï¼š1$ sudo apt-get install vsftpd openssh-server nfs-kernel-server portmap é…ç½® FTP æœåŠ¡ï¼šä¿®æ”¹ vsftpd çš„é…ç½®æ–‡ä»¶/etc/vsftpd.confï¼Œæ£€æŸ¥ä¸‹é¢ä¸¤è¡Œå‰é¢çš„â€œ#â€å·æ˜¯å¦å»æ‰ã€‚ç¬¬28è¡Œï¼Œé»˜è®¤æ²¡æœ‰#ï¼š1local_enable=YES ç¬¬31è¡Œï¼Œé»˜è®¤æœ‰#ï¼Œå»æ‰#ï¼š1# write_enable=YES æ³¨ï¼š ä¸Šé¢ç¬¬ä¸€ä¸ªè¡¨ç¤ºæ˜¯å¦å…è®¸æœ¬åœ°ç”¨æˆ·ç™»å½•ï¼Œç¬¬äºŒè¡Œä¸ªç¤ºæ˜¯å¦å…è®¸ä¸Šä¼ æ–‡ä»¶ã€‚ åœ¨vimçš„å‘½ä»¤æ¨¡å¼è¾“å…¥å¦‚ä¸‹å‘½ä»¤å³å¯æ˜¾ç¤ºè¡Œå·ï¼š1:set nu ä¿®æ”¹å®Œåä¹‹åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡å¯ ftp æœåŠ¡ï¼š1$ sudo /etc/init.d/vsftpd restart é…ç½® NFS æœåŠ¡ä¿®æ”¹/etc/exportsï¼Œå¢åŠ ä»¥ä¸‹å†…å®¹ï¼Œä»¥åå¼€å‘æ¿å¯ä»¥é€šè¿‡ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿè®¿é—®/work ç›®å½•å’Œä¸“é—¨ç”¨æ¥ä½œä¸ºæ ¹æ–‡ä»¶ç³»ç»ŸæŒ‚è½½çš„/work/hceng/nfs_rootfsç›®å½•ï¼š 12/work *(rw,sync,no_root_squash,no_subtree_check)/work/hceng/nfs_rootfs *(rw,sync,no_root_squash,no_subtree_check) ä¿®æ”¹å®Œåä¹‹åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡å¯ nfs æœåŠ¡ï¼š 1$ sudo /etc/init.d/nfs-kernel-server restart æœ€åï¼Œå…³é—­Ubuntuçš„é˜²ç«å¢™ï¼š1$ sudo ufw disable 4.å®‰è£…åŸºæœ¬å¼€å‘ç¯å¢ƒï¼š è¿™é‡Œä½¿ç”¨éŸ¦ä¸œå±±è€å¸ˆç¬¬å››æœŸå®‰å“è§†é¢‘ç¯å¢ƒæ­å»ºæä¾›çš„è„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨å®‰è£…è¯¸å¦‚ g++ç­‰å·¥å…·ã€ åº“ã€‚ä½†è¯¥è„šæœ¬æ˜¯ä¸ºUbuntu12åˆ¶ä½œçš„ï¼ŒUbuntu16ä½¿ç”¨éœ€è¦åšä¸€äº›ä¿®æ”¹ï¼Œä¸»è¦æ˜¯åå­—å˜äº†ã€‚ä¿®æ”¹å˜åŒ–å¦‚ä¸‹ï¼š1libgl1-mesa-glx-lts-quantal:i386 libgl1-mesa-dev-lts-quantal \\ æ”¹ä¸ºï¼š1libgl1-mesa-glx-lts-xenial:i386 libgl1-mesa-dev-lts-xenial \\ å°†ä¿®æ”¹åçš„è„šæœ¬æ–‡ä»¶æ”¹ä¸ºï¼šinstall-devel-packages-for-16.sh æ‹–æ‹½åˆ°è‡ªå·±å»ºçš„/work/toolé‡Œé¢ï¼ŒåŠ å…¥å¯æ‰§è¡Œæƒé™ï¼Œç„¶åæ‰§è¡Œï¼š12$ sudo chmod +x install-devel-packages-for-16.sh$ sudo ./install-devel-packages-for-16.sh ç„¶åæŠ¥é”™,æç¤ºå·®mingw32ï¼š è§£å†³ï¼šåœ¨æºä¸­åŠ å…¥å¦‚ä¸‹éƒ¨åˆ†ï¼š1deb http://cz.archive.ubuntu.com/ubuntu trusty main universe å†æ›´æ–°åˆ—è¡¨ï¼Œå†æ‰§è¡Œå°±æ²¡é—®é¢˜äº†ï¼š12$ sudo apt-get update$ sudo ./install-devel-packages-for-16.sh 3.å®‰è£…åŸºæœ¬å¼€å‘ç¯å¢ƒ è¿™é‡Œä½¿ç”¨arm-linux-gcc-4.4.3.tar.gzï¼Œä¹‹å‰ç”¨çš„4.5å‡ºäº†é—®é¢˜ï¼Œæ¢æˆè¿™ä¸ªå°±å¥½äº†ï¼Œæš‚æ—¶ç”¨è¿™ä¸ªç‰ˆæœ¬ã€‚æŠŠæ–‡ä»¶æ‹–è¿›/work/toolï¼Œè§£å‹åˆ°æ ¹ç›®å½•ï¼š1$ sudo tar xzf arm-linux-gcc-4.4.3.tar.gz â€“C / å†ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼š 1$ sudo vim /etc/ environment æŠŠå·¥å…·é“¾ç›®å½•æ·»åŠ åˆ°æœ€åï¼Œå†…å®¹å¦‚ä¸‹ï¼š 1PATH=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/opt/FriendlyARM/toolschain/4.4.3/bin&quot; é‡å¯Ubuntuï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤æ£€æµ‹æ˜¯å¦æ­£å¸¸ï¼š 1$ arm-linux-gcc â€“v è‡³æ­¤ï¼Œå¼€å‘ç¯å¢ƒä»¥åŸºæœ¬æ­å»ºå®Œæˆã€‚ æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"é©±åŠ¨ç›¸å…³","slug":"é©±åŠ¨ç›¸å…³","permalink":"http://yoursite.com/tags/é©±åŠ¨ç›¸å…³/"},{"name":"ç¯å¢ƒæ­å»º","slug":"ç¯å¢ƒæ­å»º","permalink":"http://yoursite.com/tags/ç¯å¢ƒæ­å»º/"}]},{"title":"è®¾å¤‡é©±åŠ¨æ¨¡å‹","date":"2017-03-18T15:44:00.000Z","path":"2017/03/18/è®¾å¤‡é©±åŠ¨æ¨¡å‹/","text":"æœ€è¿‘åœ¨çœ‹è®¾å¤‡é©±åŠ¨æ¨¡å‹ï¼Œè®°å½•ä¸‹åˆ†æçš„ç»“æ„ã€‚ è®¾å¤‡é©±åŠ¨æ¨¡å‹æä¾›äº†ç¡¬ä»¶çš„æŠ½è±¡ï¼Œå†…æ ¸å¯ä»¥ä½¿ç”¨è¯¥æŠ½è±¡å®Œæˆå¾ˆå¤šç¡¬ä»¶é‡å¤çš„å·¥ä½œï¼Œè¿™æ ·å¾ˆå¤šé‡å¤çš„ä»£ç å°±ä¸éœ€è¦é‡å¤ç¼–å†™å’Œè°ƒè¯•äº†ã€‚è¿™äº›æŠ½è±¡åŒ…æ‹¬ï¼šç”µæºç®¡ç†ã€å³æ’å³ç”¨è®¾å¤‡çš„æ”¯æŒã€ä¸ç”¨æˆ·ç©ºé—´çš„é€šä¿¡ã€‚ 1.sysfsæ–‡ä»¶ç³»ç»Ÿ sysfsæ–‡ä»¶ç³»ç»Ÿæ˜¯Linuxä¼—å¤šæ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªï¼Œåœ¨Linuxä¸­æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿéƒ½è¦è‡ªå·±çš„ç‰¹æ®Šçš„ç”¨é€”ã€‚Liunxè®¾å¤‡é©±åŠ¨æ¨¡å‹ç”±å¤§é‡çš„æ•°æ®ç»“æ„å’Œç®—æ³•ç»„æˆï¼Œæ•°æ®ç»“æ„ä¹‹é—´é€šè¿‡æŒ‡é’ˆç›¸äº’å…³è”ï¼Œæ„æˆæ ‘å½¢æˆ–è€…ç½‘çŠ¶å…³ç³»ã€‚æ˜¾ç¤ºè¿™ç§å…³ç³»æœ€å¥½çš„åˆ©ç”¨æ ‘å½¢ç»“æ„çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒæ—¶è¿˜è¦æ˜¾ç¤ºå†…æ ¸ä¸­ä¸€äº›å…³äºè®¾å¤‡ã€é©±åŠ¨å’Œé©±åŠ¨çš„ä¿¡æ¯ï¼Œå› æ­¤å†…æ ¸å¼€å‘è€…åˆ›é€ sysfsè¿™ç§æ–°æ–‡ä»¶ç³»ç»Ÿæ¥å®ç°ä¸Šè¿°çš„è¦æ±‚ã€‚ sysfsæ˜¯ä¸€ä¸ªåªå­˜åœ¨äºå†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå†…æ ¸é€šè¿‡è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿå°†ç³»ç»Ÿä¿¡æ¯å¯¼å‡ºåˆ°ç”¨æˆ·ç©ºé—´ï¼ŒåŒæ—¶ç”¨æˆ·ç©ºé—´çš„æ•°æ®ä¹Ÿèƒ½é€šè¿‡å®ƒä¼ åˆ°å†…æ ¸ä¸­ï¼Œå®ç°è®¾ç½®é©±åŠ¨ç¨‹åºçš„çŠ¶æ€å’Œå±æ€§ã€‚ sysfsæ–‡ä»¶ç³»ç»Ÿæ˜¯å†…æ ¸å¯¹è±¡ï¼ˆkobjectï¼‰ã€å±æ€§ï¼ˆkobj_typeï¼‰åŠå®ƒä»¬äº’ç›¸å…³ç³»çš„ä¸€ç§è¡¨ç°æœºåˆ¶ã€‚å†…æ ¸ä¸sysfsçš„å…³ç³»å¦‚ä¸‹ï¼š Linuxå†…æ ¸ä¸­çš„ç»“æ„ sysfsä¸­çš„ç»“æ„ kobject ç›®å½• kobj_type å±æ€§æ–‡ä»¶ å¯¹è±¡é—´çš„å…³ç³» ç¬¦å·é“¾æ¥ 2.æ ¸å¿ƒæ•°æ®ç»“æ„ è®¾å¤‡é©±åŠ¨æ¨¡å¼ç”±kobjectã€ksetã€subsystemè¿™ä¸‰ä¸ªæ ¸å¿ƒæ•°æ®ç»“æ„ç»„æˆã€‚ 2.1 kobject åœ¨Linuxç³»ç»Ÿä¸­ï¼Œkobjectç»“æ„ä½“æ˜¯ç»„æˆè®¾å¤‡é©±åŠ¨æ¨¡å‹çš„åŸºæœ¬ç»“æ„ï¼Œæä¾›æœ€åŸºæœ¬çš„è®¾å¤‡å¯¹è±¡ç®¡ç†èƒ½åŠ›ï¼Œæ¯ä¸ªåœ¨å†…æ ¸æ³¨å†Œçš„kobjectå¯¹è±¡éƒ½å¯¹åº”sysfsæ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªç›®å½•ã€‚ kobjectç»“æ„ä½“ï¼š1234567891011121314struct kobject &#123; const char *name; /* å¯¹åº”sysfsçš„ç›®å½•å */ struct list_head entry; /* kobjetctåŒå‘é“¾è¡¨ ,æŒ‡å‘ä¸‹ä¸€ä¸ªkobjectç»“æ„*/ struct kobject *parent; /* æŒ‡å‘ksetä¸­çš„kobjectï¼Œç›¸å½“äºæŒ‡å‘çˆ¶ç›®å½• */ struct kset *kset; /*æŒ‡å‘æ‰€å±çš„kset */ struct kobj_type *ktype; /*æŒ‡å‘kobjectçš„ç±»å‹æè¿°ç¬¦*/ struct sysfs_dirent *sd; /*å¯¹åº”çš„sysfsæ–‡ä»¶ç›®å½•*/ struct kref kref; /*kobjectå¼•ç”¨è®¡æ•°ï¼Œä¸º0é‡Šæ”¾*/ unsigned int state_initialized:1; /*kobjectæ˜¯å¦å·²åˆå§‹åŒ–ï¼Œ1åˆ0æœª*/ unsigned int state_in_sysfs:1 ; /*kobjectæ˜¯å¦æ³¨å†Œåˆ°sysfs*/ unsigned int state_add_uevent_sent:1; unsigned int state_remove_uevent_sent:1; unsigned int uevent_suppress:1;&#125;; kobjectæ“ä½œå‡½æ•°ï¼š 2.2 kset kobjecté€šè¿‡ksetç»„ç»‡å±‚æ¬¡åŒ–ï¼Œkestæ˜¯æ‹¥æœ‰ç›¸åŒç±»å‹çš„kobjectçš„é›†åˆã€‚ ksetç»“æ„ä½“ï¼š123456struct kset &#123; struct list_head list; /* è¿æ¥æ‰€åŒ…å«çš„kobjectå¯¹è±¡çš„é“¾è¡¨å¤´éƒ¨ */ spinlock_t list_lock; /* æ·»åŠ /åˆ é™¤kobjectæ—¶ä½¿ç”¨çš„è‡ªæ—‹é” */ struct kobject kobj; /*æ‰€æœ‰å±äºè¯¥ksetçš„kobjectçš„parentå‡æŒ‡å‘è¿™ */ const struct kset_uevent_ops *uevent_ops; /* çƒ­æ‹”æ’äº‹ä»¶å‡½æ•°é›† */&#125;; ksetæ“ä½œå‡½æ•°ï¼š kestå’Œkobjectå…³ç³»ï¼š 2.3 æ³¨å†Œkobjectåˆ°sysfsä¸­çš„å®ä¾‹[kobject_test.c]link123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293/* ç›®çš„ï¼šåœ¨/sysç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªåä¸ºkobject_testçš„ç›®å½•åï¼Œ å¹¶åœ¨è¯¥ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªkobject_test_attrçš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸ºå±æ€§æ–‡ä»¶ï¼› åŠŸèƒ½ï¼škoject_test_show()å‡½æ•°æ˜¾ç¤ºå±æ€§çš„å€¼ï¼› kobject_test_store()å‡½æ•°å‘å±æ€§ä¸­å†™å…¥ä¸€ä¸ªå€¼ï¼›*/#include &lt;linux/device.h&gt;#include &lt;linux/module.h&gt;#include &lt;linux/kernel.h&gt;#include &lt;linux/init.h&gt;#include &lt;linux/string.h&gt;#include &lt;linux/sysfs.h&gt;#include &lt;linux/stat.h&gt;/*å£°æ˜é‡Šæ”¾kobjectç»“æ„ä½“å‡½æ•°*/void kobject_test_release(struct kobject *kobject);/*è¯»å±æ€§çš„å‡½æ•°*/ssize_t kobject_test_show(struct kobject *kobject, struct attribute *attr, char *buf);/*å†™å±æ€§çš„å‡½æ•°*/ssize_t kobject_test_store(struct kobject *kobject, struct attribute *attr, const char *buf, size_t count);/*å®šä¹‰äº†ä¸€ä¸ªåä¸ºkobject_testï¼Œå¯ä»¥è¯»å†™çš„å±æ€§*/struct attribute test_attr = &#123; .name = \"kobject_test_attr\", .mode = S_IRWXUGO,&#125;;/*è¯¥objectåªæœ‰ä¸€ä¸ªå±æ€§*/static struct attribute *def_attrs[] = &#123; &amp;test_attr, NULL,&#125;;/*æ“ä½œå‡½æ•°*/struct sysfs_ops obj_test_sysops = &#123; .show = kobject_test_show, .store = kobject_test_store,&#125;;/*kobjectå±æ€§*/struct kobj_type ktype = &#123; .release = kobject_test_release, .sysfs_ops = &amp;obj_test_sysops, .default_attrs = def_attrs,&#125;; /*é‡Šæ”¾kobjectç»“æ„ä½“å‡½æ•°*/void kobject_test_release(struct kobject *kobject)&#123; printk(\"kobject_test: kobject_test_release(). \\n\");&#125;/*è¯¥å‡½æ•°ç”¨äºè¯»å–ä¸€ä¸ªå±æ€§çš„åå­—*/ssize_t kobject_test_show(struct kobject *kobject, struct attribute *attr, char *buf)&#123; printk(\"call kobject_test_show(). \\n\"); printk(\"attrname:%s.\\n\", attr-&gt;name); sprintf(buf, \"%s\\n\", attr-&gt;name); return strlen(attr-&gt;name)+2;&#125;/*è¯¥å‡½æ•°ç”¨äºå†™å…¥ä¸€ä¸ªå±æ€§çš„å€¼*/ssize_t kobject_test_store(struct kobject *kobject, struct attribute *attr, const char *buf, size_t count)&#123; printk(\"call kobject_test_store(). \\n\"); printk(\"write: %s\\n\", buf); strcpy(attr-&gt;name, buf); return count;&#125;/*å…¥å£å‡½æ•°*/struct kobject kobj;static int kobject_test_init()&#123; printk(\"kobject test_init().\\n\"); kobject_init_and_add(&amp;kobj, &amp;ktype, NULL, \"kobject_test\"); return 0;&#125;/*å‡ºå£å‡½æ•°*/static int kobject_test_exit()&#123; printk(\"kobject test exit.\\n\"); kobject_del(&amp;kobj); return 0;&#125;module_init(kobject_test_init);module_exit(kobject_test_exit);MODULE_AUTHOR(\"hceng\");MODULE_LICENSE(\"Dual BSD/GPL\"); [kobject_app.c]link123456789101112131415161718192021222324252627#include &lt;sys/types.h&gt;#include &lt;sys/stat.h&gt;#include &lt;fcntl.h&gt;#include &lt;stdio.h&gt;#include &lt;poll.h&gt;#include &lt;signal.h&gt;#include &lt;sys/types.h&gt;#include &lt;unistd.h&gt;#include &lt;fcntl.h&gt;/* kobject_test */int fd;int main(int argc, char **argv)&#123; fd = open(\"/dev/kobject_test\", O_RDWR); if (fd &lt; 0) &#123; printf(\"can't open!\\n\"); return -1; &#125; return 0;&#125; æµ‹è¯•ç»“æœï¼š è°ƒç”¨å…³ç³»ï¼š 3.ä¸‰å¤§ç»„ä»¶ è®¾å¤‡é©±åŠ¨æ¨¡å‹ä¸­æœ‰ä¸‰ä¸ªé‡è¦çš„ç»„ä»¶ï¼šæ€»çº¿ï¼ˆbus_typeï¼‰ã€è®¾å¤‡ï¼ˆdeviceï¼‰ã€é©±åŠ¨ï¼ˆdriverï¼‰,ä¸‰è€…å…³ç³»å¦‚ä¸‹ï¼š bus_typeé€šè¿‡æ‰«æè®¾å¤‡é“¾è¡¨å’Œé©±åŠ¨é“¾è¡¨ï¼Œä½¿ç”¨machæ–¹æ³•æŸ¥æ‰¾åŒ¹é…çš„è®¾å¤‡å’Œé©±åŠ¨ï¼Œç„¶åå°†struct deviceä¸­çš„*driverè®¾ç½®ä¸ºåŒ¹é…çš„é©±åŠ¨ï¼› å°†struct device_driverä¸­çš„deviceè®¾ç½®ä¸ºåŒ¹é…çš„è®¾å¤‡ï¼Œè¿™å°±å®Œæˆäº†å°†æ€»çº¿ã€è®¾å¤‡å’Œé©±åŠ¨3è€…ä¹‹é—´çš„å…³è”ï¼› bus_typeåªæœ‰å¾ˆå°‘çš„æˆå‘˜å¿…é¡»æä¾›åˆå§‹åŒ–ï¼Œå¤§éƒ¨åˆ†ç”±è®¾å¤‡æ¨¡å‹æ ¸å¿ƒæ§åˆ¶ï¼› å†…æ ¸æä¾›è®¸å¤šå‡½æ•°å®ç°bus_typeçš„æ³¨å†Œæ³¨é”€ç­‰æ“ä½œï¼Œæ–°æ³¨å†Œçš„æ€»çº¿å¯ä»¥å†/sys/busç›®å½•ä¸‹çœ‹åˆ°ï¼› 3.1æ€»çº¿ æ€»çº¿æ•°æ®ç»“æ„bus_typeï¼š1234567891011121314151617181920212223struct bus_type &#123; const char *name; /* æ€»çº¿ç±»å‹å */ struct bus_attribute *bus_attrs; /* æ€»çº¿çš„å±æ€§ã€æ–¹æ³• */ struct device_attribute *dev_attrs; /* è®¾å¤‡å±æ€§,ä¸ºæ¯ä¸ªåŠ å…¥æ€»çº¿çš„è®¾å¤‡å»ºç«‹å±æ€§é“¾è¡¨ */ struct driver_attribute *drv_attrs; /* é©±åŠ¨å±æ€§,ä¸ºæ¯ä¸ªåŠ å…¥æ€»çº¿çš„é©±åŠ¨å»ºç«‹å±æ€§é“¾è¡¨ */ /* é©±åŠ¨ä¸è®¾å¤‡åŒ¹é…å‡½æ•°:å½“ä¸€ä¸ªæ–°è®¾å¤‡æˆ–è€…é©±åŠ¨è¢«æ·»åŠ åˆ°è¿™ä¸ªæ€»çº¿æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨ä¸€æ¬¡æˆ–å¤šæ¬¡ï¼Œ è‹¥æŒ‡å®šçš„é©±åŠ¨ç¨‹åºèƒ½å¤Ÿå¤„ç†æŒ‡å®šçš„è®¾å¤‡ï¼Œåˆ™è¿”å›éé›¶å€¼ã€‚ å¿…é¡»åœ¨æ€»çº¿å±‚ä½¿ç”¨è¿™ä¸ªå‡½æ•°, å› ä¸ºé‚£é‡Œå­˜åœ¨æ­£ç¡®çš„é€»è¾‘ï¼Œæ ¸å¿ƒå†…æ ¸ä¸çŸ¥é“å¦‚ä½•ä¸ºæ¯ä¸ªæ€»çº¿ç±»å‹åŒ¹é…è®¾å¤‡å’Œé©±åŠ¨ç¨‹åº */ int (*match)(struct device *dev, struct device_driver *drv); /*åœ¨ä¸ºç”¨æˆ·ç©ºé—´äº§ç”Ÿçƒ­æ’æ‹”äº‹ä»¶ä¹‹å‰ï¼Œè¿™ä¸ªæ–¹æ³•å…è®¸æ€»çº¿æ·»åŠ ç¯å¢ƒå˜é‡ï¼ˆå‚æ•°å’Œ kset çš„ueventæ–¹æ³•ç›¸åŒï¼‰*/ int (*uevent)(struct device *dev, struct kobj_uevent_env *env); int (*probe)(struct device *dev); int (*remove)(struct device *dev); /* è®¾å¤‡ç§»é™¤è°ƒç”¨æ“ä½œ */ void (*shutdown)(struct device *dev); int (*suspend)(struct device *dev, pm_message_t state); int (*resume)(struct device *dev); const struct dev_pm_ops *pm; /*ç”µæºç®¡ç†ç›¸å…³æ“ä½œç¬¦*/ struct subsys_private *p; /* ä¸€ä¸ªå¾ˆé‡è¦çš„åŸŸï¼ŒåŒ…å«äº†deviceé“¾è¡¨å’Œdriversé“¾è¡¨ */&#125;; ç›¸å…³æ“ä½œå‡½æ•°ï¼š 3.2è®¾å¤‡ è®¾å¤‡æ•°æ®ç»“æ„deviceï¼š12345678910111213141516171819202122232425262728293031323334353637struct device &#123; struct device *parent; /* çˆ¶è®¾å¤‡ï¼Œæ€»çº¿è®¾å¤‡æŒ‡å®šä¸ºNULL */ struct device_private *p; /* åŒ…å«è®¾å¤‡é“¾è¡¨ï¼Œdriver_dataï¼ˆé©±åŠ¨ç¨‹åºè¦ä½¿ç”¨æ•°æ®ï¼‰ç­‰ä¿¡æ¯ */ struct kobject kobj; const char *init_name; /* åˆå§‹é»˜è®¤çš„è®¾å¤‡å,ä½†@device_addè°ƒç”¨ä¹‹ååˆé‡æ–°è®¾ä¸ºNULL */ struct device_type *type; struct mutex mutex; /* mutex to synchronize calls to its driver */ struct bus_type *bus; /* type of bus device is on */ struct device_driver *driver; /* which driver has allocated this device */ void *platform_data; /* Platform specific data, device core doesn't touch it */ struct dev_pm_info power; #ifdef CONFIG_NUMA int numa_node; /* NUMA node this device is close to */ #endif u64 *dma_mask; /* dma mask (if dma'able device) *///Like dma_mask, but for alloc_coherent mappings as not all hardware supports 64 bit addresses //for consistentallocations such descriptors. u64 coherent_dma_mask; struct device_dma_parameters *dma_parms; struct list_head dma_pools; /* dma pools (if dma'ble) */ struct dma_coherent_mem *dma_mem; /* internal for coherent mem override */ /* arch specific additions */ struct dev_archdata archdata; #ifdef CONFIG_OF struct device_node *of_node; #endif dev_t devt; /* dev_t, creates the sysfs \"dev\" è®¾å¤‡å· */ spinlock_t devres_lock; struct list_head devres_head; struct klist_node knode_class; struct class *class; const struct attribute_group **groups; /* optional groups */ void (*release)(struct device *dev); &#125;; 3.2é©±åŠ¨ é©±åŠ¨æ•°æ®ç»“æ„driverÂ·ï¼š1234567891011121314151617181920struct device_driver &#123; const char *name; /* é©±åŠ¨åç§°,åœ¨sysfsä¸­ä»¥æ–‡ä»¶å¤¹åå‡ºç° */ struct bus_type *bus; /* é©±åŠ¨å±äºçš„æ€»çº¿ï¼Œæ€»çº¿ä¸Šå¯ä»¥æœ‰å¾ˆå¤šè®¾å¤‡ */ struct module *owner; /* è®¾å¤‡é©±åŠ¨è‡ªèº«æ¨¡å— */ const char *mod_name; /* é©±åŠ¨æ¨¡å—åå­— */ bool suppress_bind_attrs; /* disables bind/unbind via sysfs */ const struct of_device_id *of_match_table; /*æ£€æµ‹è®¾å¤‡æ–¹æ³•ï¼Œå¹¶æ£€æµ‹è®¾å¤‡é©±åŠ¨å¯ä»¥æ§åˆ¶é‚£äº›è®¾å¤‡*/ int (*probe) (struct device *dev); int (*remove) (struct device *dev); /*ç§»é™¤è®¾å¤‡æ—¶è°ƒç”¨çš„æ–¹æ³•*/ void (*shutdown) (struct device *dev); /*å…³é—­è®¾å¤‡æ—¶è°ƒç”¨çš„æ–¹æ³•*/ int (*suspend) (struct device *dev, pm_message_t state); /*å¤„äºä½åŠŸè€—æ—¶è°ƒç”¨çš„æ–¹æ³•*/ int (*resume) (struct device *dev); /*æ¢å¤æ­£å¸¸çŠ¶æ€æ—¶è°ƒç”¨çš„æ–¹æ³•*/ const struct attribute_group **groups; /*å±æ€§ç»„*/ const struct dev_pm_ops *pm; /*ç”¨äºç”µæºç®¡ç†*/ struct driver_private *p; /* å®šä¹‰device_driverä¸­çš„ç§æœ‰æ•°æ®ç±»å‹ */ &#125;; æœ€åä¿®æ”¹æ—¶é—´ï¼š2017/4/8 19:55:59 æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"Linuxé©±åŠ¨","slug":"Linuxé©±åŠ¨","permalink":"http://yoursite.com/tags/Linuxé©±åŠ¨/"},{"name":"é©±åŠ¨ç›¸å…³","slug":"é©±åŠ¨ç›¸å…³","permalink":"http://yoursite.com/tags/é©±åŠ¨ç›¸å…³/"}]},{"title":"Linuxå¸¸ç”¨å‘½ä»¤","date":"2017-03-12T15:14:00.000Z","path":"2017/03/12/Linuxå¸¸ç”¨å‘½ä»¤/","text":"æœ¬æ–‡ä¸»è¦æ±‡æ€»ä¸€äº›å¸¸ç”¨ä¸”ä¸å¤ªç†Ÿç»ƒçš„Liunxå‘½ä»¤ï¼Œä¸å®šæœŸæ›´æ–°ã€‚ 1. tarä½œç”¨ï¼šæ‰“åŒ…ï¼ˆæ‹†åŒ…ï¼‰/å‹ç¼©ï¼ˆè§£å‹ï¼‰æ–‡ä»¶ï¼› è¯­æ³•ï¼štar [ä¸»é€‰é¡¹+è¾…é€‰é¡¹] æ–‡ä»¶æˆ–ç›®å½• ä¸»é€‰é¡¹ï¼š c ï¼šæ‰“åŒ…æ–‡ä»¶ï¼› x ï¼šæ‹†åŒ…æ–‡ä»¶ï¼› t ï¼šåˆ—å‡ºåŒ…/å‹ç¼©æ–‡ä»¶é‡Œæœ‰å“ªäº›æ–‡ä»¶ã€‚è¾…é€‰é¡¹ï¼š z ï¼šå…·æœ‰ gzip å±æ€§ï¼›æ ¼å¼ä¸ºxx.tar.gzæˆ–xx. tgzï¼› j ï¼šå…·æœ‰ bzip2 å±æ€§ï¼›æ ¼å¼ä¸ºxx.tar.bz2ï¼› v ï¼šæ˜¾ç¤ºå‹ç¼©æ–‡ä»¶è¿‡ç¨‹ï¼› f ï¼šåœ¨å…¶åå¿…é¡»æ˜¯æ–‡ä»¶åï¼› - -exclude xxxï¼šæ‰“åŒ…é™¤xxxæ–‡ä»¶ä¹‹å¤–çš„æ–‡ä»¶ï¼›ç¤ºä¾‹ï¼š1234567$ tar cf test.tar test #æ‰“åŒ…testæ–‡ä»¶/æ–‡ä»¶å¤¹ä¸ºtest.tar;$ tar xf test.tar #æ‹†åŒ…test.tarï¼›$ tar czf test.tar.gz test #å‹ç¼©testæ–‡ä»¶/æ–‡ä»¶å¤¹ä¸ºtest.tar.gzï¼›$ tar xzf test.tar.gz #è§£å‹test.tar.gzï¼›$ tar cjf test.bzip2 test #å‹ç¼©testæ–‡ä»¶/æ–‡ä»¶å¤¹ä¸ºtest.bzip2ï¼›$ tar xjf test.bzip2 #è§£å‹test.bzip2ï¼›$ tar cf test.tar --exclude test.txt test #æ‰“åŒ…testæ–‡ä»¶å¤¹é‡Œé™¤test.txtä¹‹å¤–çš„ä¸ºtest.tar 2. grepä½œç”¨ï¼šæŸ¥æ‰¾å­—ç¬¦ä¸²ï¼› è¯­æ³•ï¼šgrep [é€‰é¡¹] â€˜æœå¯»å­—ç¬¦ä¸²â€™ æ–‡ä»¶å é€‰é¡¹ï¼š -c ï¼šè®¡ç®—æ‰¾åˆ° â€˜æœå¯»å­—ç¬¦ä¸²â€™ çš„æ¬¡æ•°; -i ï¼šå¿½ç•¥å¤§å°å†™; -n ï¼šé¡ºä¾¿è¾“å‡ºè¡Œå·; -v ï¼šåå‘é€‰æ‹©ï¼Œå³æ˜¾ç¤ºå‡ºæ²¡æœ‰ â€˜æœå¯»å­—ç¬¦ä¸²â€™ å†…å®¹çš„é‚£ä¸€è¡Œ;ç¤ºä¾‹ï¼š1$ grep -n &apos;test&apos; test.txt #æœç´¢test.txtä¸­å«testçš„è¡Œï¼Œä¸”æ˜¾ç¤ºå¯¹åº”è¡Œå·ï¼› 3. findä½œç”¨ï¼šé€‰é¡¹è¾ƒå¤šï¼Œè¿™é‡Œæš‚ä»…ä½¿ç”¨nameé€‰é¡¹æŸ¥æ‰¾æ–‡ä»¶ï¼› è¯­æ³•ï¼šfind è·¯å¾„ -name â€œæ–‡ä»¶åâ€ç¤ºä¾‹ï¼š1$ find -name &quot;test&quot; #åœ¨å½“å‰æ–‡ä»¶ä¸‹æ‰¾testæ–‡ä»¶ï¼› 4. ifconfigä½œç”¨ï¼šç½‘å¡é…ç½®ï¼› è¯­æ³•ï¼šifconfig [ç½‘ç»œè®¾å¤‡] [å‚æ•°]â€ç¤ºä¾‹ï¼š12345678#è®¾ç½®ç½‘å¡1çš„åœ°å€ 192.168.1.44ï¼Œæ©ç ä¸º255.255.255.0ï¼ˆå³é»˜è®¤ï¼‰ï¼›$ ifconfig eth0 192.168.1.44 netmask 255.255.255.0#æ†ç»‘ç½‘å¡1çš„ç¬¬äºŒä¸ªåœ°å€ä¸º 192.168.1.x$ ifconfig eth0:x 192.168.1.x#æ‰“å¼€ç½‘å¡1$ ifconfig eth0 up#å…³é—­ç½‘å¡1$ ifconfig eth0 down 5. mountä½œç”¨ï¼šç›®å‰åªç”¨æ¥æŒ‚è½½NFSï¼› è¯­æ³•ï¼šmount -t nfs æœåŠ¡å™¨ip:æŒ‚è½½ç›®å½• æŒ‚è½½åˆ°æœ¬åœ°å“ªé‡Œâ€ç¤ºä¾‹ï¼š12#æŠŠä¸»æœº(192.168.1.44)çš„/work/hceng/nfs_rootfsæŒ‚è½½åˆ°æœ¬åœ°/tmpç›®å½•ä¸‹ï¼›$ mount -t nfs 192.168.1.44:/work/hceng/nfs_rootfs /tmp 6. æŸ¥çœ‹Linuxç‰ˆæœ¬ä¿¡æ¯ç¤ºä¾‹ï¼š1234$ uname -a #æ˜¾ç¤ºç”µè„‘ä»¥åŠæ“ä½œç³»ç»Ÿçš„ç›¸å…³ä¿¡ï¼›$ cat /proc/version #æ­£åœ¨è¿è¡Œçš„å†…æ ¸ç‰ˆæœ¬ï¼›$ cat /etc/issue #æ˜¾ç¤ºçš„æ˜¯å‘è¡Œç‰ˆæœ¬ä¿¡æ¯ï¼›$ lsb_release -a #åˆ—å‡ºæ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯ï¼› 7. å…³é—­é˜²ç«å¢™ç¤ºä¾‹ï¼š12$ ufw disable #å…³é—­ubuntuçš„é˜²ç«å¢™ ï¼›$ ufw enable #å¼€å¯é˜²ç«å¢™ï¼› 7. sourceä½œç”¨ï¼šå…é‡å¯æ›´æ–°ç¯å¢ƒå˜é‡ï¼›ç¤ºä¾‹ï¼š1$ source /etc/environment æœ€åä¿®æ”¹æ—¶é—´ï¼š2017/3/31 19:57:49 æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"é©±åŠ¨ç›¸å…³","slug":"é©±åŠ¨ç›¸å…³","permalink":"http://yoursite.com/tags/é©±åŠ¨ç›¸å…³/"},{"name":"LinuxåŸºç¡€","slug":"LinuxåŸºç¡€","permalink":"http://yoursite.com/tags/LinuxåŸºç¡€/"}]},{"title":"Makefileå°ç»“","date":"2017-03-11T09:44:00.000Z","path":"2017/03/11/Makefileå°ç»“/","text":"æœ¬æ–‡ä¸»è¦æ˜¯è®°å½•ä¸€äº›é‡åˆ°çš„MakefileçŸ¥è¯†ã€‚ Makefileä»¥éŸ¦ä¸œå±±è€å¸ˆç¬¬ä¸€æœŸè£¸æ¿è§†é¢‘ä¸­çš„ ç¬¬8è¯¾LCDå®éªŒçš„é…å¥—ä»£ç lcd_3.5_4.3 ä¸­çš„Makefileä¸ºä¾‹ï¼Œè¯¥å·¥ç¨‹æœ‰ä¸¤ä¸ªMakefile,åˆ†åˆ«ä½äºæ ¹ç›®å½•å’Œlibç›®å½•ä¸­ï¼š[æ ¹ç›®å½•Makefile]123456789101112131415161718192021222324252627282930313233CC = arm-linux-gccLD = arm-linux-ldAR = arm-linux-arOBJCOPY = arm-linux-objcopyOBJDUMP = arm-linux-objdumpINCLUDEDIR := $(shell pwd)/includeCFLAGS := -Wall -O2CPPFLAGS := -nostdinc -I$(INCLUDEDIR)export CC LD AR OBJCOPY OBJDUMP INCLUDEDIR CFLAGS CPPFLAGSobjs := head.o init.o nand.o interrupt.o serial.o lcddrv.o/ framebuffer.o lcdlib.o main.o lib libc.alcd.bin: $(objs) $&#123;LD&#125; -Tlcd.lds -o lcd_elf $^ $&#123;OBJCOPY&#125; -O binary -S lcd_elf $@ $&#123;OBJDUMP&#125; -D -m arm lcd_elf &gt; lcd.dis.PHONY : lib/libc.alib/libc.a: cd lib; make; cd .. %.o:%.c $&#123;CC&#125; $(CPPFLAGS) $(CFLAGS) -c -o $@ $&lt;%.o:%.S $&#123;CC&#125; $(CPPFLAGS) $(CFLAGS) -c -o $@ $&lt;clean: make clean -C lib rm -f lcd.bin lcd_elf lcd.dis *.o ä¸»Makefileæ€»é¢†å…¨å±€çš„å°±è¿™å¥:1lcd.bin: $(objs)è¦ç”Ÿæˆlcd.binï¼Œä¾èµ–äºobjsåˆ—ä¸¾çš„ä¸€å †æ–‡ä»¶ï¼šhead.o init.o nand.o interrupt.o serial.o lcddrv.o framebuffer.o lcdlib.o main.o lib libc.aï¼Œæ‰€ä»¥è¦å…ˆæ‰¾åˆ°è¿™äº›æ–‡ä»¶ï¼Œå‡ ä¸ª.oï¼Œè¿˜æœ‰ä¸€ä¸ª.aã€‚ .oç›®æ ‡æ–‡ä»¶æ€ä¹ˆç”Ÿæˆï¼Ÿ%.o:%.cå’Œ%.o:%.Sæ˜¯ç”Ÿæˆè§„åˆ™ï¼Œå°±æ˜¯ä¾èµ–äº.cæˆ–.Sæ–‡ä»¶ï¼Œä½¿ç”¨äº¤å‰ç¼–è¯‘å‘½ä»¤ç”Ÿæˆã€‚ .aç›®æ ‡æ–‡ä»¶æ€ä¹ˆç”Ÿæˆï¼Ÿ.aæ˜¯åº“æ–‡ä»¶ï¼Œåˆ°libå­ç›®å½•é‡Œå»æ‰¾ï¼Œåœ¨å­ç›®å½•é‡Œç”¨makeå‘½ä»¤ç”Ÿæˆã€‚ æ³¨:é“¾æ¥ï¼šå°†å¤š.oæ–‡ä»¶ï¼Œæˆ–è€….oæ–‡ä»¶å’Œåº“æ–‡ä»¶é“¾æ¥æˆä¸ºå¯è¢«æ“ä½œç³»ç»Ÿæ‰§è¡Œçš„å¯æ‰§è¡Œç¨‹åºï¼ˆLinuxç¯å¢ƒä¸‹ï¼Œå¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼ä¸ºâ€œELFâ€æ ¼å¼ï¼‰ã€‚é“¾æ¥å™¨ä¸æ£€æŸ¥å‡½æ•°æ‰€åœ¨çš„æºæ–‡ä»¶ï¼Œåªæ£€æŸ¥æ‰€æœ‰.oæ–‡ä»¶ä¸­çš„å®šä¹‰çš„ç¬¦å·ã€‚å°†.oæ–‡ä»¶ä¸­ä½¿ç”¨çš„å‡½æ•°å’Œå…¶å®ƒ.oæˆ–è€…åº“æ–‡ä»¶ä¸­çš„ç›¸å…³ç¬¦å·è¿›è¡Œåˆå¹¶ï¼Œå¯¹æ‰€æœ‰æ–‡ä»¶ä¸­çš„ç¬¦å·è¿›è¡Œé‡æ–°å®‰æ’ï¼ˆé‡å®šä½ï¼‰ï¼Œå¹¶é“¾æ¥ç³»ç»Ÿç›¸å…³æ–‡ä»¶ï¼ˆç¨‹åºå¯åŠ¨æ–‡ä»¶ç­‰ï¼‰æœ€ç»ˆç”Ÿæˆå¯æ‰§è¡Œç¨‹åºã€‚é“¾æ¥è¿‡ç¨‹ä½¿ç”¨GNU çš„â€œldâ€å·¥å…·ã€‚é™æ€åº“ï¼šåˆç§°ä¸ºæ–‡æ¡£æ–‡ä»¶ï¼ˆArchive Fileï¼‰ã€‚å®ƒæ˜¯å¤šä¸ª.oæ–‡ä»¶çš„é›†åˆã€‚Linuxä¸­é™æ€åº“æ–‡ä»¶çš„åç¼€ä¸ºâ€œ.aâ€ã€‚é™æ€åº“ä¸­çš„å„ä¸ªæˆå‘˜ï¼ˆ.oæ–‡ä»¶ï¼‰æ²¡æœ‰ç‰¹æ®Šçš„å­˜åœ¨æ ¼å¼ï¼Œä»…ä»…æ˜¯ä¸€ä¸ª.oæ–‡ä»¶çš„é›†åˆã€‚ä½¿ç”¨â€œarâ€å·¥å…·ç»´æŠ¤å’Œç®¡ç†é™æ€åº“ã€‚å…±äº«åº“ï¼šä¹Ÿæ˜¯å¤šä¸ª.oæ–‡ä»¶çš„é›†åˆï¼Œä½†æ˜¯è¿™äº›.oæ–‡ä»¶æ—¶æœ‰ç¼–è¯‘å™¨æŒ‰ç…§ä¸€ç§ç‰¹æ®Šçš„æ–¹å¼ç”Ÿæˆï¼ˆLinuxä¸­ï¼Œå…±äº«åº“æ–‡ä»¶æ ¼å¼é€šå¸¸ä¸ºâ€œELFâ€æ ¼å¼ã€‚å…±äº«åº“å·²ç»å…·å¤‡äº†å¯æ‰§è¡Œæ¡ä»¶ï¼‰ã€‚æ¨¡å—ä¸­å„ä¸ªæˆå‘˜çš„åœ°å€ï¼ˆå˜é‡å¼•ç”¨å’Œå‡½æ•°è°ƒç”¨ï¼‰éƒ½æ˜¯ç›¸å¯¹åœ°å€ã€‚ä½¿ç”¨æ­¤å…±äº«åº“çš„ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œå…±äº«åº“è¢«åŠ¨æ€åŠ è½½åˆ°å†…å­˜å¹¶å’Œä¸»ç¨‹åºåœ¨å†…å­˜ä¸­è¿›è¡Œè¿æ¥ã€‚å¤šä¸ªå¯æ‰§è¡Œç¨‹åºå¯å…±äº«åº“æ–‡ä»¶çš„ä»£ç æ®µï¼ˆå¤šä¸ªç¨‹åºå¯ä»¥å…±äº«çš„ä½¿ç”¨åº“ä¸­çš„æŸä¸€ä¸ªæ¨¡å—ï¼Œå…±äº«ä»£ç ï¼Œä¸å…±äº«æ•°æ®ï¼‰ã€‚å¦å¤–å…±äº«åº“çš„æˆå‘˜å¯¹è±¡å¯è¢«æ‰§è¡Œï¼ˆç”±libdl.soæä¾›æ”¯æŒï¼‰ã€‚ ä¸‹é¢è¿›è¡Œåˆ†æï¼š ç¬¬ä¸€è‡³äº”è¡Œï¼š12345CC = arm-linux-gccLD = arm-linux-ldAR = arm-linux-arOBJCOPY = arm-linux-objcopyOBJDUMP = arm-linux-objdump ä½œç”¨ï¼šå°†å³è¾¹å·¥å…·é“¾åèµ‹å€¼ç»™å·¦è¾¹å˜é‡ï¼Œä¸ºäº†ç®€åŒ–ä¹¦å†™ï¼› åˆ†æï¼š arm-linux-gccï¼šç¼–è¯‘.cæˆ–.så¤´çš„Cæ–‡ä»¶æˆ–æ±‡ç¼–ç¨‹åºï¼› arm-linux-ldï¼šè¿æ¥å™¨ï¼ŒæŠŠå¤šä¸ª.oæ–‡ä»¶æˆ–åº“æ–‡ä»¶è¿æ¥æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼› arm-linux-arï¼šåº“ç®¡ç†å™¨ï¼ŒæŠŠå¤šä¸ª.oæ–‡ä»¶åˆå¹¶æˆä¸€ä¸ª.oæ–‡ä»¶æˆ–é™æ€åº“æ–‡ä»¶ï¼ˆ.aæ–‡ä»¶ï¼‰ï¼› arm-linux-objcopyï¼šè½¬æ¢å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼ï¼› arm-linux-objdumpï¼šç”Ÿæˆåæ±‡ç¼–ï¼› ç¬¬ä¸ƒè¡Œï¼š1INCLUDEDIR := $(shell pwd)/include ä½œç”¨ï¼šå°†shellå‘½ä»¤å’Œincludeç»„æˆçš„è·¯å¾„ç«‹å³èµ‹å€¼ç»™å·¦è¾¹å˜é‡ï¼Œä¸ºäº†ç®€åŒ–ä¹¦å†™ï¼› åˆ†æï¼šMakefileä¸­è°ƒç”¨shellå‘½ä»¤ï¼š$(shell å‘½ä»¤)ï¼› â€˜ = â€™ä¸â€˜ := â€™çš„åŒºåˆ«æ³¨ï¼š - â€œ = â€ï¼šmakeä¼šå°†æ•´ä¸ªMakefileå±•å¼€åï¼Œå†å†³å®šå˜é‡çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå˜é‡çš„å€¼å°†ä¼šæ˜¯æ•´ä¸ª,Makefileä¸­æœ€åè¢«æŒ‡å®šçš„å€¼ã€‚çœ‹ä¾‹å­ï¼š 123x = fooy = $(x) barx = xyz åœ¨ä¸Šä¾‹ä¸­ï¼Œyçš„å€¼å°†ä¼šæ˜¯ xyz bar ï¼Œè€Œä¸æ˜¯ foo bar ã€‚- â€œ := â€è¡¨ç¤ºå˜é‡çš„å€¼å†³å®šäºå®ƒåœ¨makefileä¸­çš„ä½ç½®ï¼Œè€Œä¸æ˜¯æ•´ä¸ªmakefileå±•å¼€åçš„æœ€ç»ˆå€¼ã€‚ 123x := fooy := $(x) barx := xyz åœ¨ä¸Šä¾‹ä¸­ï¼Œyçš„å€¼å°†ä¼šæ˜¯ foo bar ï¼Œè€Œä¸æ˜¯ xyz bar äº†ã€‚ ç¬¬å…«è¡Œï¼š1CFLAGS := -Wall -O2 ä½œç”¨ï¼šå°†gccçš„ç¼–è¯‘å‚æ•°èµ‹å€¼ç»™å·¦è¾¹å˜é‡ï¼Œä¸ºäº†ç®€åŒ–ä¹¦å†™ï¼› åˆ†æï¼š-Wallæ˜¾ç¤ºæ‰€æœ‰ç¼–è¯‘é”™è¯¯æˆ–è­¦å‘Šï¼›-O2ä¼˜åŒ–é€‰é¡¹ï¼Œç¼–è¯‘æ—¶ä½¿ç”¨2çº§ä¼˜åŒ– ç¬¬ä¹è¡Œï¼š1CPPFLAGS := -nostdinc -I$(INCLUDEDIR) ä½œç”¨ï¼šå°†gccç¼–è¯‘è·¯å¾„å‚æ•°èµ‹å€¼ç»™å·¦è¾¹å˜é‡ï¼Œä¸ºäº†ç®€åŒ–ä¹¦å†™ï¼› åˆ†æï¼š-nostdincå¿½ç•¥ç³»ç»Ÿåº“ç›®å½•ï¼ˆè¿™é‡Œæˆ‘ä»¬è‡ªå®šä¹‰äº†printfç­‰ç³»ç»Ÿå‡½æ•°ï¼Œä¸èƒ½å†åŒ…å«ç³»ç»Ÿæ–‡ä»¶é‡Œçš„ç›¸å…³å‡½æ•°ï¼‰ï¼›-IæŒ‡å®šæœç´¢è·¯å¾„ï¼› ç¬¬åä¸€è¡Œï¼š1export CC LD AR OBJCOPY OBJDUMP INCLUDEDIR CFLAGS CPPFLAGS ä½œç”¨ï¼šå°†å˜é‡ä¼ é€’åˆ°ä¸‹çº§Makefileï¼Œç±»ä¼¼äºå®ï¼› åˆ†æï¼šæœ¬æ–‡ä»¶ä¸­æŒ‡çš„æ˜¯ç”Ÿæˆlib/libc.aåº“æ–‡ä»¶æ—¶çš„Makefileï¼› ç¬¬åä¸‰è¡Œï¼š12objs := head.o init.o nand.o interrupt.o serial.o lcddrv.o/ framebuffer.o lcdlib.o main.o lib libc.a ä½œç”¨ï¼šå®šä¹‰å˜é‡objsï¼ŒåŒ…å«äº†ç”Ÿæˆç›®æ ‡æ–‡ä»¶æ‰€éœ€çš„æ–‡ä»¶ï¼Œä¸ºäº†ç®€åŒ–ä¹¦å†™ï¼› åˆ†æï¼šä¸€è¡Œä»£ç å†™ä¸å®Œï¼Œä½¿ç”¨/ç¬¦å·å¯ç»§ç»­åœ¨ä¸‹è¡Œå†™ï¼› ç¬¬åå…­è¡Œï¼š1lcd.bin: $(objs) ä½œç”¨ï¼šå®šä¹‰ç”Ÿæˆç›®æ ‡lcd.binï¼Œä¾èµ–äºobjså¯¹è±¡ï¼› åˆ†æï¼šæ‰§è¡Œè¿™æ¡å‘½ä»¤æ—¶ï¼Œå…ˆç”Ÿæˆæ‰€æœ‰ä¾èµ–æ–‡ä»¶ï¼Œç„¶åä¾æ¬¡æ‰§è¡Œåé¢ä¸‰æ¡å‘½ä»¤ï¼› ç¬¬åä¸ƒè¡Œï¼š1$&#123;LD&#125; -Tlcd.lds -o lcd_elf $^ ä½œç”¨ï¼šæ ¹æ®é“¾æ¥è„šæœ¬lcd.ldsé“¾æ¥ï¼Œè¾“å‡ºç›®çš„æ–‡ä»¶lcd_elf,ä¾èµ–å…¨éƒ¨æ–‡ä»¶ï¼› åˆ†æï¼š-TæŒ‡å®šé“¾æ¥è„šæœ¬ï¼›$^è¡¨ç¤ºå…¨éƒ¨ä¾èµ–æ–‡ä»¶ï¼› ç¬¬åå…«è¡Œï¼š1$&#123;OBJCOPY&#125; -O binary -S lcd_elf $@ ä½œç”¨ï¼šå°†lcd_elfæ–‡ä»¶è½¬æ¢æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼› åˆ†æï¼š-Oè¡¨ç¤ºè¾“å‡ºæ ¼å¼;-Sè¡¨ç¤ºä¸ä»æºæ–‡ä»¶ä¸­å¤åˆ¶é‡å®šä½ä¿¡æ¯å’Œç¬¦å·ä¿¡æ¯åˆ°ç›®æ ‡æ–‡ä»¶ä¸­ï¼›$@è¡¨ç¤ºå…¨éƒ¨ç›®æ ‡æ–‡ä»¶ï¼› ç¬¬åä¹è¡Œï¼š1$&#123;OBJDUMP&#125; -D -m arm lcd_elf &gt; lcd.dis ä½œç”¨ï¼šå°†lcd_elfæ–‡ä»¶åæ±‡ç¼–ä¸ºlcd.disæ–‡ä»¶ï¼› åˆ†æï¼š-måé¢è·Ÿçš„æ˜¯cpuæ„æ¶;&gt;è¡¨ç¤ºå°†è¿™ä¸ªç¨‹åºçš„åæ±‡ç¼–ç¨‹åºå†™å…¥åˆ°led.disè¿™ä¸ªæ–‡ä»¶ä¸­,åœ¨ç»ˆç«¯ä¸­ä¸æ˜¾ç¤ºå‡ºæ¥ï¼› ç¬¬äºŒåä¸€è¡Œï¼š1.PHONY : lib/libc.a ä½œç”¨ï¼š.PHONYä¼ªç›®æ ‡ï¼Œä¸è¦ç®¡lib/libc.aæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œéƒ½æ‰§è¡Œåé¢çš„æŒ‡ä»¤ï¼› åˆ†æï¼šé€šå¸¸ä¸ºäº†é¿å…ä¼ªç›®æ ‡å’Œæ–‡ä»¶é‡åçš„è¿™ç§æƒ…å†µï¼Œä½¿ç”¨ç‰¹æ®Šçš„è®°â€œ.PHONYâ€æ¥æ˜¾ç¤ºåœ°æŒ‡æ˜ä¸€ä¸ªç›®æ ‡æ˜¯â€œä¼ªç›®æ ‡â€ï¼› ç¬¬äºŒåäºŒã€äºŒåä¸‰è¡Œï¼š12lib/libc.a: cd lib; make; cd .. ä½œç”¨ï¼šæ‰§è¡Œlibæ–‡ä»¶å¤¹çš„Makefileï¼Œä»è€Œç”Ÿæˆlibc.aï¼› åˆ†æï¼šæ‰§è¡ŒshellæŒ‡ä»¤ï¼Œè¿›å…¥libç›®å½•ï¼Œmakeï¼Œé€€å‡ºï¼› ç¬¬äºŒåäº”è‡³äºŒåä¹è¡Œï¼š1234%.o:%.c $&#123;CC&#125; $(CPPFLAGS) $(CFLAGS) -c -o $@ $&lt;%.o:%.S $&#123;CC&#125; $(CPPFLAGS) $(CFLAGS) -c -o $@ $&lt; ä½œç”¨ï¼šä¾èµ–æ‰€æœ‰çš„.cå’Œ.Sæ–‡ä»¶ï¼Œç”Ÿæˆæ‰€æœ‰çš„.oæ–‡ä»¶ï¼› åˆ†æï¼š%é€šé…ç¬¦ï¼›-cç¼–è¯‘ä¸é“¾æ¥;$@è¡¨ç¤ºç›®æ ‡æ–‡ä»¶;$&lt;è¡¨ç¤ºç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶; ç¬¬ä¸‰åä¸€è‡³ä¸‰åä¸‰è¡Œï¼š1234%.o:%.Sclean: make clean -C lib rm -f lcd.bin lcd_elf lcd.dis *.o ä½œç”¨ï¼šæ¸…ç†æ‰€æœ‰ç”Ÿæˆæ–‡ä»¶ï¼› åˆ†æï¼š-C libå³æ¸…ç†åŒ…æ‹¬libæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆçš„æ–‡ä»¶; ä¸‹é¢æ˜¯libç›®å½•Makefile: [libç›®å½•Makefile]123456789101112131415objs := div64.o lib1funcs.o ctype.o muldi3.o printf.o string.o/vsprintf.olibc.a: $(objs) $&#123;AR&#125; -r -o $@ $^ %.o:%.c $&#123;CC&#125; $(CPPFLAGS) $(CFLAGS) -c -o $@ $&lt;%.o:%.S $&#123;CC&#125; $(CPPFLAGS) $(CFLAGS) -c -o $@ $&lt;clean: rm -f libc.a *.o ç¬¬ä¸€ã€äºŒè¡Œï¼š12objs := div64.o lib1funcs.o ctype.o muldi3.o printf.o string.o/vsprintf.o ä½œç”¨ï¼šå®šä¹‰å˜é‡objsï¼ŒåŒ…å«äº†ç”Ÿæˆç›®æ ‡æ–‡ä»¶æ‰€éœ€çš„æ–‡ä»¶ï¼Œä¸ºäº†ç®€åŒ–ä¹¦å†™ï¼› åˆ†æï¼šä¸€è¡Œä»£ç å†™ä¸å®Œï¼Œä½¿ç”¨/ç¬¦å·å¯ç»§ç»­åœ¨ä¸‹è¡Œå†™ï¼› ç¬¬å››ã€äº”è¡Œï¼š12libc.a: $(objs) $&#123;AR&#125; -r -o $@ $^ ä½œç”¨ï¼šä½¿ç”¨åº“ç®¡ç†å™¨ç”Ÿæˆlib.aï¼› åˆ†æï¼š$@è¡¨ç¤ºç›®æ ‡æ–‡ä»¶;$^æ‰€æœ‰ä¾èµ–æ–‡ä»¶ï¼› ç¬¬ä¸ƒè‡³åä¸€è¡Œï¼š1234%.o:%.c $&#123;CC&#125; $(CPPFLAGS) $(CFLAGS) -c -o $@ $&lt;%.o:%.S $&#123;CC&#125; $(CPPFLAGS) $(CFLAGS) -c -o $@ $&lt; ä½œç”¨ï¼šä¾èµ–æ‰€æœ‰çš„.cå’Œ.Sæ–‡ä»¶ï¼Œç”Ÿæˆæ‰€æœ‰çš„.oæ–‡ä»¶ï¼› åˆ†æï¼š%é€šé…ç¬¦ï¼›-cç¼–è¯‘ä¸é“¾æ¥;$@è¡¨ç¤ºç›®æ ‡æ–‡ä»¶;$&lt;è¡¨ç¤ºç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶; ç¬¬åä¸‰ã€åå››è¡Œï¼š123%.o:%.Sclean: rm -f libc.a *.o ä½œç”¨ï¼šæ¸…ç†æ‰€æœ‰ç”Ÿæˆæ–‡ä»¶ï¼› åˆ†æï¼š-få¼ºåˆ¶åˆ é™¤; å‚è€ƒåšæ–‡ï¼šsekon LCDå®éªŒå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šMakefile æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"é©±åŠ¨ç›¸å…³","slug":"é©±åŠ¨ç›¸å…³","permalink":"http://yoursite.com/tags/é©±åŠ¨ç›¸å…³/"},{"name":"Makefile","slug":"Makefile","permalink":"http://yoursite.com/tags/Makefile/"}]},{"title":"æ±‡ç¼–æŒ‡ä»¤å°ç»“","date":"2017-03-10T03:55:00.000Z","path":"2017/03/10/æ±‡ç¼–æŒ‡ä»¤å°ç»“/","text":"æœ¬æ–‡ä¸»è¦æ˜¯è®°å½•ä¸€äº›é‡åˆ°çš„ARMæ±‡ç¼–çŸ¥è¯†ã€‚ æ±‡ç¼–ä»£ç ä»¥éŸ¦ä¸œå±±è€å¸ˆçš„ ç¬¬7ç« nand flashå®éªŒé…å¥—ä»£ç 13th_link_4096 ä¸­çš„start.Sä¸ºä¾‹ï¼š[start.S]12345678910111213141516171819202122232425262728293031323334353637383940414243.globl _start_start:/* ç¡¬ä»¶ç›¸å…³çš„è®¾ç½® : æŠŠå¤–è®¾çš„åŸºåœ°å€å‘Šè¯‰CPU*/ /* Peri port setup */ ldr r0, =0x70000000 orr r0, r0, #0x13 mcr p15,0,r0,c15,c2,4 @ 256M(0x70000000-0x7fffffff) /* å…³çœ‹é—¨ç‹— *//* å¾€WTCON(0x7E004000)å†™0 */ ldr r0, =0x7E004000 mov r1, #0 str r1, [r0]/* é‡å®šä½ */ adr r0, _start /* _startå½“å‰æŒ‡ä»¤åœ°å€ */ ldr r1, =_start /* _startçš„ç¼–è¯‘åœ°å€ */ ldr r2, =bss_start cmp r0, r1 beq clean_bsscopy_loop: ldr r3, [r0], #4 str r3, [r1], #4 cmp r1, r2 bne copy_loop /* æ¸…BSSæ®µ */clean_bss: ldr r0, =bss_start ldr r1, =bss_end mov r2, #0clean_loop: str r2, [r0], #4 cmp r0, r1 bne clean_loop /* è®¾ç½®æ ˆ */ ldr sp, =8*1024 ldr pc, =main /* é‡å®šä½å®Œå, ä½¿ç”¨ä½ç½®ç›¸å…³çš„æŒ‡ä»¤è·³è½¬ */ bl mainhalt: b halt ç¬¬å…­è¡Œï¼š1ldr r0, =0x70000000 æ ¼å¼ï¼šldr&emsp;ç›®çš„å¯„å­˜å™¨&emsp;&lt;å­˜å‚¨å™¨åœ°å€&gt; ä½œç”¨ï¼šå°† å­˜å‚¨å™¨åœ°å€ æ‰€æŒ‡åœ°å€å¤„è¿ç»­çš„4ä¸ªå­—èŠ‚ï¼ˆ1ä¸ªå­—ï¼‰çš„æ•°æ®ä¼ é€åˆ°ç›®çš„å¯„å­˜å™¨ä¸­ã€‚ ç¬¬ä¸ƒè¡Œï¼š1orr r0, r0, #0x13 æ ¼å¼ï¼šorr&emsp;ç›®çš„å¯„å­˜å™¨ï¼Œ&emsp;æ“ä½œæ•° 1ï¼Œ&emsp;æ“ä½œæ•° 2 ä½œç”¨ï¼šå¸¸ç”¨äºè®¾ç½®æ“ä½œæ•°1 çš„æŸäº›ä½ï¼Œåœ¨ä¸¤ä¸ªæ“ä½œæ•°ä¸Šè¿›è¡Œé€»è¾‘æˆ–è¿ç®—ï¼Œå¹¶æŠŠç»“æœæ”¾ç½®åˆ°ç›®çš„å¯„å­˜å™¨ä¸­ã€‚æ“ä½œæ•°1 åº”æ˜¯ä¸€ä¸ªå¯„å­˜å™¨ï¼Œæ“ä½œæ•°2 å¯ä»¥æ˜¯ä¸€ä¸ªå¯„å­˜å™¨ã€è¢«ç§»ä½çš„å¯„å­˜å™¨æˆ–ä¸€ä¸ªç«‹å³æ•°ã€‚ ç¬¬å…«è¡Œï¼š1mcr p15,0,r0,c15,c2,4 æ ¼å¼ï¼šmcr&emsp;åå¤„ç†å™¨ç¼–ç ï¼Œ&emsp;åå¤„ç†å™¨æ“ä½œç 1ï¼Œ&emsp;æºå¯„å­˜å™¨ï¼Œ&emsp;ç›®çš„å¯„å­˜å™¨1ï¼Œ&emsp;ç›®çš„å¯„å­˜å™¨2ï¼Œ&emsp;åå¤„ç†å™¨æ“ä½œç 2 ä½œç”¨ï¼šå°†ARMå¤„ç†å™¨å¯„å­˜å™¨ä¸­çš„æ•°æ®ä¼ é€åˆ°åå¤„ç†å™¨å¯„å­˜å™¨ä¸­,è‹¥åå¤„ç†å™¨ä¸èƒ½æˆåŠŸå®Œæˆæ“ä½œï¼Œåˆ™äº§ç”Ÿæœªå®šä¹‰æŒ‡ä»¤å¼‚å¸¸ã€‚å…¶ä¸­åå¤„ç†å™¨æ“ä½œç 1 å’Œåå¤„ç†å™¨æ“ä½œç 2 ä¸ºåå¤„ç†å™¨å°†è¦æ‰§è¡Œçš„æ“ä½œï¼Œæºå¯„å­˜å™¨ä¸ºARMå¤„ç†å™¨çš„å¯„å­˜å™¨ï¼Œç›®çš„å¯„å­˜å™¨1å’Œç›®çš„å¯„å­˜å™¨2å‡ä¸ºåå¤„ç†å™¨çš„å¯„å­˜å™¨ã€‚ ç¬¬åå››è¡Œï¼š1str r1, [r0] æ ¼å¼ï¼šstr&emsp;æºå¯„å­˜å™¨&emsp;&lt;å­˜å‚¨å™¨åœ°å€&gt; ä½œç”¨ï¼šç”¨äºä»æºå¯„å­˜å™¨ä¸­å°†ä¸€ä¸ª32ä½çš„å­—æ•°æ®ä¼ é€åˆ°å­˜å‚¨å™¨ä¸­ã€‚åœ¨ARMæ¶æ„ä¸‹, æ•°æ®ä»å†…å­˜åˆ°CPUä¹‹é—´çš„ç§»åŠ¨åªèƒ½é€šè¿‡ldr/stræŒ‡ä»¤æ¥å®Œæˆã€‚è€Œmovåªèƒ½åœ¨å¯„å­˜å™¨ä¹‹é—´ç§»åŠ¨æ•°æ®,æˆ–è€…æŠŠç«‹å³æ•°ç§»åŠ¨åˆ°å¯„å­˜å™¨ä¸­,å¹¶ä¸”æ•°æ®çš„é•¿åº¦ä¸èƒ½è¶…è¿‡8ä½ã€‚ ç¬¬åä¸ƒè¡Œï¼š1adr r0, _start æ ¼å¼ï¼šadr&emsp;ç›®çš„å¯„å­˜å™¨&emsp;ç¨‹åºç›¸å¯¹çš„è¡¨è¾¾å¼ ä½œç”¨ï¼šå¯å°†ä¸€ä¸ªç«‹å³å€¼ä¸pcå€¼ç›¸åŠ ï¼Œå¹¶å°†ç»“æœå†™å…¥ç›®æ ‡å¯„å­˜å™¨ã€‚adrå¯ç”Ÿæˆä¸ä½ç½®æ— å…³çš„ä»£ç ï¼Œå› ä¸ºåœ°å€ç›¸å¯¹äºç¨‹åºæˆ–å¯„å­˜å™¨ã€‚è¯¦è§ARMæŒ‡ä»¤adrã€‚ ç¬¬äºŒåè¡Œï¼š1cmp r0, r1 æ ¼å¼ï¼šcmp&emsp;æ“ä½œæ•°1ï¼Œ&emsp;æ“ä½œæ•°2 ä½œç”¨ï¼šç”¨äºæŠŠä¸€ä¸ªå¯„å­˜å™¨çš„å†…å®¹å’Œå¦ä¸€ä¸ªå¯„å­˜å™¨çš„å†…å®¹æˆ–ç«‹å³æ•°è¿›è¡Œæ¯”è¾ƒï¼ŒåŒæ—¶æ›´æ–°CPSRä¸­æ¡ä»¶æ ‡å¿—ä½çš„å€¼ã€‚è¯¥æŒ‡ä»¤è¿›è¡Œä¸€æ¬¡å‡æ³•è¿ç®—ï¼Œä½†ä¸å­˜å‚¨ç»“æœï¼Œåªæ›´æ”¹æ¡ä»¶æ ‡å¿—ä½ã€‚æ ‡å¿—ä½è¡¨ç¤ºçš„æ˜¯æ“ä½œæ•°1ä¸æ“ä½œæ•°2çš„å…³ç³»(å¤§ã€å°ã€ç›¸ç­‰)ï¼Œä¾‹å¦‚ï¼Œå½“æ“ä½œæ•°1å¤§äºæ“ä½œæ“ä½œæ•°2ï¼Œåˆ™æ­¤åçš„æœ‰GT åç¼€çš„æŒ‡ä»¤å°†å¯ä»¥æ‰§è¡Œã€‚ CPSRæ³¨ï¼š Zæ ‡å¿—ï¼šæ˜¯å¦ä¸º0ï¼›å¦‚æ¯”è¾ƒæŒ‡ä»¤äº§ç”Ÿç›¸ç­‰çš„ç»“æœã€è®¡ç®—ç»“æœä¸º0ï¼› Næ ‡å¿—ï¼šæ˜¯å¦ä¸ºè´Ÿï¼›å¦‚æœæŒ‡ä»¤çš„ç»“æœè¢«è®¤ä¸ºæ˜¯æœ‰ç¬¦å·æ•°ï¼Œè€Œå®ƒçš„ç¬¬31ä½ä¸º1ï¼Œé‚£å°±ä¼šè¢«è®¾ç½®ä¸º1ï¼› Cæ ‡å¿—ï¼šæ˜¯å¦æœ‰äº§ç”Ÿè¿›ä½/å€Ÿä½ï¼Œä»¥åŠè¿›è¡Œç§»ä½æ“ä½œæ—¶ä½œç§»å‡ºä½ä½¿ç”¨ï¼› Væ ‡å¿—ï¼šæœ‰ç¬¦å·æ•°è¿›è¡Œè¿ç®—ï¼Œç»“æœæ˜¯å¦æœ‰æº¢å‡ºã€‚ ç¬¬äºŒåä¸€è¡Œï¼š1beq clean_bss æ ¼å¼ï¼šbeq&emsp;æ ‡ç­¾ ä½œç”¨ï¼šæ•°æ®è·³è½¬æŒ‡ä»¤ï¼Œæ ‡å¿—å¯„å­˜å™¨ä¸­Zæ ‡å¿—ä½ç­‰äºé›¶æ—¶, è·³è½¬åˆ°beqåæ ‡ç­¾å¤„ã€‚ ç¬¬äºŒåå…­è¡Œï¼š1bne copy_loop æ ¼å¼ï¼šbne&emsp;æ ‡ç­¾ ä½œç”¨ï¼šæ•°æ®è·³è½¬æŒ‡ä»¤ï¼Œæ ‡å¿—å¯„å­˜å™¨ä¸­Zæ ‡å¿—ä½ä¸ç­‰äºé›¶æ—¶, è·³è½¬åˆ°bneåæ ‡ç­¾å¤„ã€‚ ç¬¬å››åä¸€è¡Œï¼š1bl main æ ¼å¼ï¼šbl&emsp;å­ç¨‹åºå ä½œç”¨ï¼šbæˆ–blæŒ‡ä»¤å¼•èµ·å¤„ç†å™¨è½¬ç§»åˆ°å­ç¨‹åºåå¤„å¼€å§‹æ‰§è¡Œã€‚ä¸¤è€…çš„ä¸åŒä¹‹å¤„åœ¨äºblæŒ‡ä»¤åœ¨è½¬ç§»åˆ°å­ç¨‹åºæ‰§è¡Œä¹‹å‰ï¼Œå°†å…¶ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€æ‹·è´åˆ°R14ï¼ˆLR,é“¾æ¥å¯„å­˜å™¨ï¼‰ã€‚ç”±äºblæŒ‡ä»¤ä¿å­˜äº†ä¸‹æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œå› æ­¤ä½¿ç”¨æŒ‡ä»¤â€œmov pc, lrâ€å³å¯å®ç°å­ç¨‹åºçš„è¿”å›ã€‚è€ŒbæŒ‡ä»¤åˆ™æ— æ³•å®ç°å­ç¨‹åºçš„è¿”å›ï¼Œåªèƒ½å®ç°å•çº¯çš„è·³è½¬ã€‚ ARMå¤„ç†å™¨æ§åˆ¶ç¨‹åºæ‰§è¡Œæ–¹å¼æ³¨ï¼š æµæ°´æ–¹å¼æ‰§è¡Œç¨‹åºï¼šPCçš„å€¼æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œå³æ¯æ‰§è¡Œä¸€æ¡æŒ‡ä»¤PCéƒ½åŠ ä¸€ä¸ªå­—çš„åç§»ã€‚ é€šè¿‡è·³è½¬æŒ‡ä»¤æ¥æ§åˆ¶ç¨‹åºæ‰§è¡Œ:b-è·³è½¬åˆ°æŒ‡å®šçš„æŒ‡ä»¤å¤„æ‰§è¡Œ;bl-è·³è½¬æ‰§è¡Œï¼Œä¿å­˜å­ç¨‹åºåœ°å€å¹¶è¿”å›;bx-è·³è½¬æ‰§è¡Œå¹¶åˆ‡æ¢åˆ°ThumbçŠ¶æ€;blx-ä¸‰ç§æ–¹å¼ç»„åˆã€‚ æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"é©±åŠ¨ç›¸å…³","slug":"é©±åŠ¨ç›¸å…³","permalink":"http://yoursite.com/tags/é©±åŠ¨ç›¸å…³/"},{"name":"æ±‡ç¼–","slug":"æ±‡ç¼–","permalink":"http://yoursite.com/tags/æ±‡ç¼–/"}]},{"title":"GitHub+Hexoåšå®¢æ­å»ºåŠä¼˜åŒ–","date":"2017-03-06T11:26:00.000Z","path":"2017/03/06/GitHub+Hexoæ­å»ºåŠä¼˜åŒ–/","text":"æœ¬æ–‡ä¸»è¦æ˜¯è®°å½•æœ¬åšå®¢çš„æ­å»ºå’Œä¼˜åŒ–ã€‚ ä¸ºä»€ä¹ˆåšç‹¬ç«‹åšå®¢ï¼Ÿæˆ‘æƒ³å¤§æ¦‚å°±æ˜¯æ¿€åŠ±è‡ªå·±å»æŒç»­å­¦ä¹ å’Œæ€è€ƒã€‚ é¦–å…ˆè¯´ä¸‹æœ¬åšå®¢æ­å»ºçš„å¤§è‡´æµç¨‹:1.æœ‰ä¸€ä¸ªGitHubè´¦å·ï¼ŒåŒæ—¶é…ç½®GitHub Pagesï¼›2.å®‰è£…ã€é…ç½®Hexoï¼›3.é…ç½®åšå®¢ã€Markdownå†™æ–‡ç« ï¼›4.ç»‘å®šè‡ªå·±åŸŸåï¼ˆå¯é€‰ï¼‰ï¼›5.ä¼˜åŒ–æ—¥å¸¸æ“ä½œï¼ˆå¯é€‰ï¼‰ï¼› 1.Github Pages Github Pagesæ˜¯GitHubæä¾›çš„å…è´¹é™æ€ç«™ç‚¹ï¼› åˆ›å»ºGithub Pagesåï¼Œåœ¨é‡Œé¢å­˜æ”¾ç½‘é¡µæºç ï¼Œç„¶ååœ¨å¯¹åº”ç½‘å€å°±å¯çœ‹åˆ°å¯¹åº”ç½‘é¡µæ•ˆæœï¼› ä½¿ç”¨GitHubè´¦å·åˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œä½†æ˜¯è¿™ä¸ªä»“åº“æ˜¯æœ‰è§„åˆ™çš„ï¼Œå…¶æ ¼å¼å¿…é¡»ä¸ºï¼šyourusername.github.ioï¼› æ³¨ï¼š yourusernameå¿…é¡»æ˜¯è‡ªå·±çš„GitHubè´¦å·åï¼› ç±»å‹åªèƒ½é€‰Publicï¼› 2.å®‰è£…ã€é…ç½®Hexo Hexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚Hexo ä½¿ç”¨ Markdownï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚1ã€å®‰è£… Node.js;2ã€ä¸‹è½½Cmderä»£æ›¿Windowsè‡ªå¸¦cmd;3ã€å®‰è£… Git;4ã€æ·»åŠ æœ¬æœºå¯†é’¥åˆ°GitHub;5ã€å®‰è£…å®Œæˆåï¼Œåœ¨å¼€å§‹èœå•é‡Œæ‰¾åˆ°â€œGitâ€-&gt;â€œGit Bashâ€ï¼Œåœ¨Gitä¸Šè®¾ç½®usernameå’Œemailï¼›å…¶ä¸­3-5æ­¥åœ¨å‰ä¸€ç¯‡åšæ–‡Gitæ—¥å¸¸ä½¿ç”¨å°ç»“ä¸­å·²è®¾ç½®è¿‡äº†ï¼Œæ— éœ€å†è®¾ç½®ã€‚6ã€å®‰è£… Hexoï¼šä½¿ç”¨ npm å®‰è£… Hexoã€‚1$ npm install -g hexo-cliè‡³æ­¤ï¼Œå·²ç»å®‰è£…å®ŒHexo,åç»­è¿›è¡Œç›¸å…³é…ç½®ã€‚7ã€åœ¨ç”µè„‘ä¸Šé€‰ä¸€ä¸ªç›˜ï¼Œå»ºä¸ªæ–‡ä»¶å¤¹å­˜æ”¾åšå®¢æ•°æ®ï¼Œä¾‹æˆ‘çš„ï¼šE:\\blogï¼›ç„¶åæ‰“å¼€cmderï¼Œè¾“å…¥:12$ e: &amp; cd blog #è¿›å…¥æ‰€å»ºæ–‡ä»¶å¤¹$ hexo init blog #åˆå§‹åŒ–blogæˆåŠŸåˆå§‹åŒ–blogåå°†å‡ºç°ï¼š1INFO Start blogging with Hexo!8ã€æœ€åå†ç”Ÿæˆé™æ€ç½‘é¡µï¼Œå³å¯çœ‹åˆ°ç½‘é¡µæ¨¡æ¿ï¼š12$ hexo generate # å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨$ hexo server # åœ¨æµè§ˆå™¨è¾“å…¥ http://localhost:4000/å°±å¯ä»¥çœ‹è§ç½‘é¡µå’Œæ¨¡æ¿äº†å®Œæˆåï¼Œå°†ä¼šçœ‹åˆ°å¦‚ä¸‹æç¤ºï¼š12INFO Start processingINFO Hexo is running at http://localhost:4000/. Press Ctrl+C to stop.æ­¤æ—¶ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥http://localhost:4000/å°±å¯ä»¥çœ‹è§é»˜è®¤çš„ç½‘é¡µå’Œæ¨¡æ¿äº†ã€‚ 3.é…ç½®åšå®¢ã€å‘è¡¨æ–‡ç«  åœ¨blogç›®å½•ä¸‹ï¼Œç”¨Sublime Text(ä½¿ç”¨å®ƒçš„åŸå› æ˜¯é»˜è®¤æ˜¯UTF-8ç¼–ç ï¼Œä¸­æ–‡ä¸ä¼šä¹±ç )æ‰“å¼€_config.ymlæ–‡ä»¶ï¼Œä¿®æ”¹å‚æ•°ä¿¡æ¯ï¼› æ³¨ï¼šåœ¨æ¯ä¸ªå‚æ•°çš„â€ï¼šâ€åéƒ½è¦åŠ ä¸€ä¸ªç©ºæ ¼ä¿®æ”¹ç½‘ç«™ç›¸å…³ä¿¡æ¯; 3.1ä¿®æ”¹ç½‘ç«™ç›¸å…³ä¿¡æ¯ï¼š1234567# Sitetitle: é»„æˆçš„åšå®¢subtitle: Linux/Androidé©±åŠ¨ description: ç”Ÿå‘½ä¸æ¯ã€æŠ˜è…¾ä¸æ­¢author: hcenglanguage: zh-CNtimezone: Asia/Shenzhen 3.2ä¿®æ”¹é…ç½®éƒ¨ç½²ç›¸å…³ä¿¡æ¯ï¼š123456789# Deployment## Docs: https://hexo.io/docs/deployment.htmldeploy:- type: git repo: 'git@github.com:hceng/hceng.github.io.git' branch: master- type: git repo: 'git@git.coding.net:hceng/hceng.git' branch: coding-pages è¿™é‡Œç”±äºæˆ‘åŒæ—¶æäº¤åˆ°äº†GitHubå’ŒCoding,ç”¨äºæµ‹è¯•ç™¾åº¦æ”¶å½•ï¼Œæ‰€ä»¥æœ‰ä¸¤ä¸ªï¼Œå†™ä¸€ä¸ªä¹Ÿæ²¡äº‹ã€‚ æ³¨:å¦‚æœåœ¨æ‰§è¡Œ hexo deploy å,å‡ºç° error deployer not found:github(git) çš„é”™è¯¯ï¼Œæ‰§è¡Œï¼š 1$ npm install hexo-deployer-git --save 3.3ä¿®æ”¹ä¸»é¢˜ï¼š ä¸ºäº†è®©åšå®¢æ›´åŠ ç¾è§‚å’Œç¬¦åˆè‡ªå·±éœ€æ±‚ï¼Œå¯ä»¥ä¿®æ”¹Hexoä¸»é¢˜æ¥æ»¡è¶³è‡ªå·±éœ€æ±‚ã€‚Hexo å®‰è£…ä¸»é¢˜çš„æ–¹å¼éå¸¸ç®€å•ï¼Œåªéœ€è¦å°†ä¸»é¢˜æ–‡ä»¶æ”¾ç½®äºç«™ç‚¹ç›®å½•çš„ themes ç›®å½•ä¸‹ï¼Œç„¶åä¿®æ”¹ä¸‹é…ç½®æ–‡ä»¶å³å¯ã€‚ Hexo æœ‰ä¸¤ä»½ä¸»è¦çš„é…ç½®æ–‡ä»¶ï¼ˆ_config.ymlï¼‰ï¼Œä¸€ä»½ä½äºç«™ç‚¹æ ¹ç›®å½•ä¸‹ï¼Œå¦ä¸€ä»½ä½äºä¸»é¢˜ç›®å½•ä¸‹ã€‚ä¸ºäº†æè¿°æ–¹ä¾¿ï¼Œåœ¨ä»¥ä¸‹è¯´æ˜ä¸­ï¼Œå°†å‰è€…ç§°ä¸º ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼Œåè€…ç§°ä¸º ä¸»é¢˜é…ç½®æ–‡ä»¶ã€‚ ä¸‹è½½hexo-theme-yiliaä¸»é¢˜,è§£å‹æ”¾å…¥themesæ–‡ä»¶å¤¹ä¸‹ï¼Œå¦‚ï¼šE:\\blog\\blog\\themesï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œæœ€åå†ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶é‡Œçš„theme:1234# Extensions## Plugins: https://hexo.io/plugins/## Themes: https://hexo.io/themes/theme: hexo-theme-yilia åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶é‡Œï¼Œä¿®æ”¹å¤´åƒã€é¢œè‰²ã€æ ‡ç­¾ç­‰ï¼Œéƒ½æœ‰ç›¸åº”çš„æ³¨é‡Šå†™å¾—éå¸¸æ¸…æ¥šï¼ŒæŒ‰éœ€ä¿®æ”¹ã€‚ 3.4å‘è¡¨æ–‡ç« ï¼š åœ¨Cmderä¸­è¾“å…¥ï¼š12$ hexo new \"blog tags\"INFO Created: E:\\blog\\blog\\source\\_posts\\blog-tags.md æ ¹æ®æç¤ºå¾—è·¯å¾„ï¼Œå³å¯æ‰¾åˆ°æ–°å»ºå¾—æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä½¿ç”¨Markdownè¯­æ³•ï¼Œä¸‹è½½MarkdownPad2è¿›è¡Œç¼–è¾‘ã€‚å…ˆä¿®æ”¹ç›¸å…³çš„æ–‡ç« ä¿¡æ¯ï¼š123456---title: blog tagstags: - éšç¬”--- æœ¬æ–‡ä¸»è¦æ˜¯æ€»ç»“blogé¢„è®¡çš„æ ‡ç­¾ï¼Œå¹¶ä¸å®šæ—¶æ›´æ–°ã€‚ å¯ä¿®æ”¹æ ‡é¢˜ã€æ ‡ç­¾ï¼ˆæœ¬æœ‰æ—¥æœŸçš„ä¿®æ”¹é€‰é¡¹ï¼Œä½†æœ‰æ—¥æœŸå°±ä¸èƒ½æ˜¾ç¤ºæ–‡ç« ï¼Œæ€€ç–‘æ˜¯ä¸»é¢˜æˆ–è€…å…¶å®ƒåœ°æ–¹å¹²æ‰°äº†ï¼Œæ–‡ç« æ—¥æœŸå°±æ˜¯æ–‡ä»¶åˆ›å»ºæ—¥æœŸï¼‰ã€‚ç„¶åç®€å•è¯´ä¸‹Markdownè¯­æ³•ï¼š 3.4.1æ ‡é¢˜å’Œå¼•ç”¨ è¡Œé¦–æ’å…¥ 1 åˆ° 6 ä¸ª # ï¼Œå¯¹åº”åˆ°æ ‡é¢˜ 1 åˆ° 6 çº§æ ‡é¢˜ï¼š 123# ä¸€çº§æ ‡é¢˜## äºŒçº§æ ‡é¢˜## ä¸‰æ ‡é¢˜ æ•ˆæœï¼šè§æœ¬æ–‡ï¼ˆå½±å“ç›®å½•æ•ˆæœï¼Œå°±ä¸ç¤ºä¾‹äº†ï¼‰ã€‚ åŒºå—å¼•ç”¨åˆ™ä½¿ç”¨ â€˜&gt;â€™ è§’æ‹¬å·æ¥è¡¨ç¤ºï¼š 1&gt; è¿™æ˜¯å¼•ç”¨ æ•ˆæœï¼š è¿™æ˜¯å¼•ç”¨ 3.4.2åˆ—è¡¨å’Œå¼ºè°ƒ åˆ—è¡¨åˆ†æœ‰åºçš„1ã€2ã€3å’Œæ— åºçš„Â·ï¼š12- åˆ—è¡¨1- åˆ—è¡¨2 æ•ˆæœï¼š åˆ—è¡¨1 åˆ—è¡¨2 å¼ºè°ƒæœ‰åŠ ç²—å’Œæ–œä½“ï¼Œç”¨â€*â€æ¥è¡¨ç¤ºï¼š 12**åŠ ç²—***æ–œä½“* æ•ˆæœï¼šåŠ ç²—æ–œä½“ 3.4.3è¶…é“¾æ¥å’Œå›¾ç‰‡ åœ¨æ–¹æ‹¬å·â€[]â€å†™è¦æ˜¾ç¤ºæ ‡ï¼Œåœ¨å°æ‹¬å·â€()â€å†™é“¾æ¥ï¼š1[hceng blog](http://hceng.cn/)æ•ˆæœï¼šhceng blog åœ¨æ–‡ç« å¦‚æœéœ€è¦åŠ å…¥å›¾ç‰‡ï¼Œå…ˆéœ€è¦æŠŠå›¾ç‰‡ä¼ åˆ°åºŠå›¾ç½‘ç«™ï¼Œç”Ÿæˆé“¾æ¥åæ’å…¥ä½¿ç”¨ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š1![](å›¾ç‰‡ç½‘å€) 3.4.4åŠ å…¥ä»£ç  Markdownæ”¯æŒæ’å…¥ä»£ç ï¼Œä½¿ç”¨å•å¼•å·â€`â€œæ¥æ ‡æ³¨,æ³¨æ„æ˜¯è‹±æ–‡è¾“å…¥æ³•ä¸‹ï¼Œå·¦ä¸Šè§’é‚£ä¸ªæŒ‰é”®ï¼š1`hello`æ•ˆæœï¼šhello è¿™ç§æ–¹å¼æ„Ÿè§‰ä¸å¤Ÿé†’ç›®ï¼Œè€Œä¸”ä¸æ”¯æŒè¯­æ³•é«˜äº®ï¼Œæ‰€ä»¥æˆ‘ä¸€èˆ¬ä½¿ç”¨Codeblockï¼Œè¯­æ³•è§ç½‘ç«™ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š123456#include &lt;stdio.h&gt;int main(void)&#123; printf(\"hello,world!\"); return 0;&#125; 4.ç»‘å®šè‡ªå·±åŸŸåï¼ˆå¯é€‰ï¼‰ å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œé»˜è®¤åŸŸåæ˜¯GitHubæä¾›çš„äºŒçº§åŸŸåï¼šyoursname.github.io,ä¸‹é¢å¼€å§‹ç»‘å®šè‡ªå·±çš„åŸŸåï¼š 4.1è´­ä¹°åŸŸå æ¨èGoDaddyæˆ–ä¸‡ç½‘ï¼› æˆ‘æ˜¯åœ¨ä¸‡ç½‘ä¹°çš„ï¼Œé¦–æ¨ä¹°.comï¼Œå…¶æ¬¡.meã€.topã€.cnç³»åˆ—ï¼Œæ ¹æ®è‡ªå·±å–œå¥½æ¥ï¼Œå„æœ‰ç‰¹è‰²ä¼˜ç¼ºç‚¹ï¼› ç„¶åç»§ç»­äº¤å®åè®¤è¯ã€å®¡æ ¸ï¼Œè¿˜æ˜¯æ¯”è¾ƒå¿«ï¼›4.2ç»‘å®šåŸŸå ä¿è¯ä¸Šè¿°å·¥ä½œå®Œæˆï¼ŒåŸŸåå¯ç”¨ï¼› ä¿®æ”¹DNSï¼Œåˆ†åˆ«ä¿®æ”¹ä¸ºï¼šf1g1ns1.dnspod.netå’Œf1g1ns2.dnspod.net æœ¬åœ°ç«™ç‚¹ç›®å½•é‡Œçš„sourceç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªCNAMEæ–‡ä»¶ï¼Œé‡Œé¢å†™ä¸Šç½‘å€ï¼› æ³¨:CNAMEä¸è¦æœ‰ä»»ä½•åç¼€ï¼›ç½‘å€ä¸è¦å†™wwwæˆ–httpï¼š//,ç›´æ¥å†™hceng.cnè¿™ç§ï¼› æ³¨å†ŒDNSpodï¼Œç„¶åæ·»åŠ åŸŸåï¼Œæ·»åŠ è®°å½•ï¼š å‚è€ƒçº¢çº¿éƒ¨åˆ†å¡«å†™ï¼Œä¸€ä¸ªä¸»æœºçºªå½•æ˜¯@ï¼Œè®°å½•ç±»å‹æ˜¯CNAMEï¼Œçº¿è·¯ç±»å‹å¡«é»˜è®¤ï¼ˆå›¾ç‰‡ä¸­æ˜¯æˆ‘æµ‹è¯•ç™¾åº¦æŠ“å–ç”¨çš„ï¼‰ï¼Œè®°å½•å€¼å†™å¯¹åº”çš„GitHub Pagesçš„åœ°å€ï¼›å¦ä¸€ä¸ªä¸»æœºçºªå½•å¡«wwwï¼Œå…¶å®ƒå’Œä¸Šé¢çš„ä¸€æ ·ã€‚ æœ€åæŠŠæœ¬åœ°çš„Hexoç”Ÿæˆä¸€ä¸‹ï¼Œå†æäº¤åˆ°Github pagesä¸Šï¼› 5.ä¼˜åŒ–æ—¥å¸¸æ“ä½œï¼ˆå¯é€‰ï¼‰5.1hexoå‘½ä»¤ç®€å†™ï¼š12345$ hexo n â€œæ–°æ–‡ç« â€ == hexo new â€œæ–°æ–‡ç« â€ #æ–°å»ºæ–‡ç« $ hexo c == hexo clear #æ¸…ç†é™æ€æ–‡ä»¶$ hexo g == hexo generate #ç”Ÿæˆé™æ€æ–‡ä»¶$ hexo s == hexo server #å¯åŠ¨æœ¬åœ°é¢„è§ˆ$ hexo d == hexo deploy #ä¸Šä¼ éƒ¨ç½² 5.2æ·»åŠ ç‰ˆæƒä¿¡æ¯ï¼š1.åœ¨åšå®¢æ ¹ç›®å½•ä¸‹ï¼ˆå’Œ source åŒçº§ï¼‰ï¼Œæ–°å»ºä¸€ä¸ªåä¸º scripts çš„æ–‡ä»¶å¤¹ï¼›2.åœ¨ scripts æ–‡ä»¶å¤¹å†…, æ–°å»ºä¸€ä¸ª AddTail.js è„šæœ¬æ–‡ä»¶ï¼Œè„šæœ¬å…·ä½“å†…å®¹è¯¦è§ä¸‹æ–‡ï¼›3.åœ¨åšå®¢æ ¹ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ª tail.md æ–‡ä»¶ï¼Œé‡Œé¢å†™æƒ³è¦å±•ç¤ºçš„ç‰ˆæœ¬è¯´æ˜å†…å®¹;AddTail.js è„šæœ¬æ–‡ä»¶ï¼š1234567891011121314151617181920212223242526272829303132333435// Filename: AddTail.js// Author: Colin// Date: 2016/06/02// Based on the script by KUANG Qi: http://kuangqi.me/tricks/append-a-copyright-info-after-every-post/// Add a tail to every post from tail.md// Great for adding copyright infovar fs = require('fs');hexo.extend.filter.register('before_post_render', function(data)&#123; if(data.copyright == false) return data; // Add seperate line data.content += '\\n___\\n'; // Try to read tail.md try &#123; var file_content = fs.readFileSync('tail.md'); if(file_content &amp;&amp; data.content.length &gt; 50) &#123; data.content += file_content; &#125; &#125; catch (err) &#123; if (err.code !== 'ENOENT') throw err; // No process for ENOENT error &#125; // æ·»åŠ å…·ä½“æ–‡ç« é“¾æ¥, ä¸éœ€è¦å»æ‰å³å¯ //var permalink = '\\næœ¬æ–‡é“¾æ¥ï¼š' + data.permalink; //data.content += permalink; return data;&#125;);tail.md æ–‡ä»¶ï¼šå»Creative Commonsæ ¹æ®è‡ªå·±éœ€æ±‚ï¼Œç”Ÿæˆåˆé€‚çš„è®¸å¯ï¼Œç„¶åå¤åˆ¶åˆ°tail.md æ–‡ä»¶ä¸­ï¼› å‚è€ƒåšå®¢ï¼šå¦‚ä½•æ·»åŠ ç‰ˆæƒä¿¡æ¯ 5.3è‡ªåŠ¨æ·»åŠ ç›®å½•ï¼š ä¿®æ”¹ä¸»é¢˜çš„ejsæ–‡ä»¶ æ‰“å¼€æ–‡ä»¶ï¼šthemes/ä½ çš„ä¸»é¢˜/layout/_partial/article.ejs åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ‰¾åˆ°&lt;%- post.content %&gt;ï¼Œå¹¶åœ¨è¿™ä¹‹å‰åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š1234567&lt;!-- Table of Contents --&gt;&lt;% if (!index &amp;&amp; post.toc)&#123; %&gt;&lt;div id=\"toc\" class=\"toc-article\"&gt;&lt;strong class=\"toc-title\"&gt;æ–‡ç« ç›®å½•&lt;/strong&gt;&lt;%- toc(post.content, &#123;list_number: false&#125;) %&gt;&lt;/div&gt;&lt;% &#125; %&gt; è¿™é‡Œifè¯­å¥ä¸­æœ‰ä¸¤ä¸ªæ¡ä»¶ï¼Œ!indexæ˜¯ä¸ºäº†ä¸åœ¨é¦–é¡µçš„æ–‡ç« æ‘˜è¦ä¸­ç”Ÿæˆç›®å½•ï¼Œpost.tocç¡®ä¿äº†åªåœ¨æ˜¾å¼åœ°æ ‡è®°äº†toc: trueçš„æ–‡ç« ä¸­ç”Ÿæˆç›®å½•ã€‚è‹¥è¿™ä¸¤ä¸ªæ¡ä»¶æ»¡è¶³ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªç›®å½•çš„divã€‚ç¬¬äº”è¡Œè¡¨ç¤ºä¸è‡ªåŠ¨ç”Ÿæˆæ ‡å·ï¼Œä¸ç„¶åŠ ä¸Šè‡ªå·±çš„æ ‡å·ä¼šæœ‰ä¸¤ä¸ªã€‚ ä¸ºéœ€è¦çš„æ–‡ç« æ·»åŠ æ ‡è®° 5.4æ·»åŠ è®¿é—®äººæ•°ç»Ÿè®¡ï¼š å®‰è£…è„šæœ¬ï¼š æ‰“å¼€themes/ä½ çš„ä¸»é¢˜/layout/_partial/footer.ejsæ·»åŠ ä¸‹é¢è„šæœ¬ï¼š12&lt;script async src=\"//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js\"&gt;&lt;/script&gt; åœ¨éœ€è¦çš„ä½ç½®æ·»åŠ æ·»åŠ æ˜¾ç¤ºï¼š è¿™é‡Œæˆ‘ç”¨çš„Yiliaçš„ä¸»é¢˜ï¼Œä¸è’œå­å®˜æ–¹ç»™çš„ä¾‹å­æ²¡æœ‰æˆåŠŸï¼Œè¿™é‡Œè‡ªå·±éœ€æ±‚æ˜¯åœ¨åº•éƒ¨ä¸­é—´æ˜¾ç¤ºç»Ÿè®¡é‡ï¼Œäºæ˜¯åœ¨footer.ejsä¸­é—´æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š123&lt;div class=\"footer-centre\"&gt; &amp;hearts; Total view my blog &lt;span id=\"busuanzi_value_site_pv\"&gt;&lt;/span&gt; times&lt;/div&gt; è¿™é‡Œæˆ‘æµè§ˆé‡æ•°æ®æ˜¯+2çš„å¢åŠ ï¼Œè¿˜æ— è§£ä¸­ã€‚ã€‚ï¼ˆå·²è§£å†³ï¼‰å‚è€ƒé“¾æ¥ï¼šä¸è’œå­5.5è„šæœ¬è‡ªåŠ¨åŒ–ï¼š æ¯æ¬¡å‘å¸ƒæ–‡ç« å¤§è‡´åˆ†ä¸ºæ¸…ç†é™æ€æ–‡ä»¶ã€ç”Ÿæˆé™æ€æ–‡ä»¶ã€å¯åŠ¨æœ¬åœ°é¢„è§ˆæˆ–ä¸Šä¼ éƒ¨ç½²ï¼Œè¿ç»­è¿™ä¹ˆå¤šå‘½ä»¤ä½•ä¸åˆæˆä¸€ä¸ªï¼Œäºæ˜¯åœ¨windowsä¸‹ï¼Œå¯æ–°å»ºå‡ ä¸ªæ‰¹å¤„ç†è„šæœ¬:[make1.bat]12#ç”Ÿæˆæœ€æ–°æœ¬åœ°é¢„è§ˆhexo clean &amp; hexo g &amp;hexo s [make2.bat]12#å‘å¸ƒç”Ÿæˆæœ€æ–°åšå®¢hexo clean &amp; hexo g &amp; hexo d [make3.bat]123#å‘æˆæœ€æ–°åšå®¢å¹¶ä¸Šä¼ æºç åˆ°Codingç§æœ‰åº“ï¼Œä»¥ä¾¿åœ¨å…¶å®ƒç”µè„‘ä¸Šç¼–è¾‘hexo clean &amp; hexo g &amp; hexo d &amp; git add -A &amp; git commit -m &quot;from make3&quot; &amp; \\git push origin master åœ¨Cmderä¸­ï¼Œè¾“å…¥å¯¹åº”çš„makeN,å³å¯è‡ªåŠ¨å®Œæˆä¸€ç³»åˆ—å‘½ä»¤ã€‚5.6æäº¤æœç´¢å¼•æ“ï¼ˆç™¾åº¦+è°·æ­Œ+å¿…åº”ï¼‰ï¼šç¨³å®šæµ‹è¯•æµ‹è¯•é˜¶æ®µã€‚å¾…å®Œå–„ã€‚1site:hceng.cn æœ€åä¿®æ”¹æ—¶é—´ï¼š2017/3/31 20:42:06 æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"Git","slug":"Git","permalink":"http://yoursite.com/tags/Git/"},{"name":"Hexo","slug":"Hexo","permalink":"http://yoursite.com/tags/Hexo/"}]},{"title":"Gitæ—¥å¸¸ä½¿ç”¨å°ç»“","date":"2017-03-02T06:14:00.000Z","path":"2017/03/02/Gitæ—¥å¸¸ä½¿ç”¨å°ç»“/","text":"æœ¬æ–‡ä¸»è¦æ˜¯è®°å½•ä¸€äº›Gitçš„é…ç½®å’Œå‘½ä»¤ã€‚å…³äºä»£ç æ‰˜ç®¡ï¼Œæˆ‘ç›®å‰ä¸»è¦ä½¿ç”¨ä¸¤ä¸ªï¼š GitHubï¼šä¸»è¦ç”¨äºæ‰˜ç®¡å…¬å¼€ä»£ç å’Œåˆ©ç”¨GitHub Pagesæ­å»ºæœ¬åšå®¢ï¼› Codingï¼šä¸»è¦ç”¨äºåŒæ­¥GitHubä»£ç å’Œæ‰˜ç®¡ç§äººä»£ç ï¼›ä¸‹é¢çºªå½•ä¸‹Gitçš„å®‰è£…ã€é…ç½®ã€ä½¿ç”¨ã€‚ 1.å®‰è£…GitWindowsï¼šgit-for-windowsysGitMac OS:ä»AppStoreå®‰è£…Xcode,é€‰æ‹©èœå•â€œXcodeâ€-&gt;â€œPreferencesâ€ï¼Œæ‰¾åˆ°â€œDownloadsâ€ï¼Œé€‰æ‹©â€œCommand Line Toolsâ€ï¼Œç‚¹â€œInstallâ€ã€‚Linux:1$ sudo apt-get install git 2.åˆ›å»ºæœ¬åœ°ä»“åº“å¹¶ä¸Šä¼ 2.1åœ¨æœ¬åœ°åˆ›å»ºä»“åº“ ç¬¬ä¸€æ¬¡æ‰“å¼€Gitæ—¶,é¦–å…ˆè¦åœ¨Gitä¸Šè®¾ç½®usernameå’Œemailï¼›12$ git config --global user.name &quot;hceng&quot; #ä¸æ³¨å†Œçš„è´¦å·é‚®ç®±ä¸€è‡´ï¼›$ git config --global user.email &quot;huangcheng.job@foxmail.com&quot; åœ¨å‘½ä»¤è¡Œé‡Œ(è¿™é‡Œä½¿ç”¨Cmderè½¯ä»¶)å…ˆè¿›å…¥æ¬²ä½œä¸ºä»“åº“çš„æ–‡ä»¶å¤¹ï¼ˆå¦‚ï¼šE:/blogæ–‡ä»¶å¤¹ï¼‰ï¼Œç„¶ååˆå§‹åŒ–â€”â€”åˆ›å»ºæœ¬åœ°ä»“åº“:12$ e: &amp; cd blog #è¿›å…¥Eç›˜çš„blogæ–‡ä»¶å¤¹ï¼›$ git init #åˆå§‹åŒ–å½“å‰æ–‡ä»¶å¤¹ä½œä¸ºä»“åº“ï¼ˆç”Ÿæˆ.gitæ–‡ä»¶å¤¹ï¼‰ï¼› è¿™æ—¶ç”Ÿæˆä¸€ä¸ªâ€.gitâ€ç›®å½•ï¼Œè¯¥ç›®å½•æ˜¯Gitæ¥è·Ÿè¸ªç®¡ç†ç‰ˆæœ¬ï¼Œä¸€èˆ¬æƒ…å†µå‹¿åŠ¨ï¼›2.2æ·»åŠ æ–‡ä»¶åˆ°æœ¬åœ°ä»“åº“12$ touch readme.txt #åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼›$ git add readme.txt #å°†å½“å‰æ›´æ”¹æˆ–è€…æ–°å¢çš„æ–‡ä»¶åŠ å…¥åˆ°ä¸´æ—¶ç©ºé—´ä¸­ï¼› æ³¨ï¼š add å‘½ä»¤åªæ˜¯æŠŠæ–‡ä»¶æ·»åŠ åˆ°ä¸€ä¸ªä¸´æ—¶ç©ºé—´é‡Œï¼Œéœ€è¦æ‰§è¡Œç¬¬3 æ­¥çš„commit å‘½ä»¤æ‰ä¼šæ­£å¼æäº¤åˆ°ä»“åº“ä¸­ï¼› å¦‚æœæ–‡ä»¶å¤ªå¤šï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸€æ¬¡æ€§æäº¤æ‰€æœ‰æ–‡ä»¶(.gitignore æ–‡ä»¶æŒ‡å®šçš„é™¤å¤–)ï¼›1$ git add -A å¯ä»¥åœ¨å½“å‰ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªåä¸ºâ€œ.gitignoreâ€çš„æ–‡ä»¶ï¼Œå®ƒé‡Œé¢çš„å†…å®¹ç”¨æ¥è¡¨ç¤ºæŸç±»/æŸä¸ªæ–‡ä»¶å°†ä¸ä¼šè¢«æäº¤åˆ°ä»“åº“ã€‚ 2.3æäº¤æ–‡ä»¶åˆ°æœ¬åœ°ä»“åº“æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè¿™ä¼šæŠŠä¸´æ—¶ç©ºé—´çš„å†…å®¹å­˜å…¥æœ¬åœ°ä»“åº“ï¼Œå¹¶æ·»åŠ æ³¨é‡Šï¼š1$ git commit -m &quot;blog, add 1 files&quot; å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹è®°å½•ï¼š1$ git log --pretty=onelineå¾—åˆ°ç±»ä¼¼ä¿¡æ¯ï¼Œå‰é¢ä¸ºç‰ˆæœ¬å·ï¼Œåé¢ä¸ºæ³¨é‡Šï¼š112ewdqe2q... blog, add 1 fileså¯ä»¥ç»™æŸä¸ªç‰ˆæœ¬å·æ‰“ä¸Šä¸€ä¸ªæ ‡ç­¾ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š1$ git tag v1 12ewå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å·²æœ‰çš„æ ‡ç­¾ï¼š1$ git tag 2.4æäº¤æ–‡ä»¶åˆ°GitHub/Codingç¬¬ä¸€æ¬¡æäº¤å‰ï¼Œéœ€è¦å°†æœ¬æœºå¯†é’¥ä¸Šä¼ åˆ°GitHub/Codingï¼›2.4.1.åˆ›å»ºSSH Keyï¼šåœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰.ssh ç›®å½•ï¼Œå¦‚æœæœ‰ï¼Œå†çœ‹çœ‹è¿™ä¸ªç›®å½•ä¸‹æœ‰æ²¡æœ‰id_rsa å’Œid_rsa.pub è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦‚æœå·²ç»æœ‰äº†ï¼Œå¯ç›´æ¥è·³åˆ°ä¸‹ä¸€æ­¥ã€‚å¦‚æœæ²¡æœ‰ï¼Œæ‰“å¼€Git Bashï¼Œåˆ›å»ºSSH Keyï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š1$ ssh-keygen -t rsa -C &quot;huangcheng.job@foxmail.com&quot;ç„¶åä¸€è·¯å›è½¦ï¼Œä½¿ç”¨é»˜è®¤å€¼å³å¯ã€‚è¿™æ ·åœ¨ç”¨æˆ·ä¸»ç›®å½•é‡Œå°±ä¼šç”Ÿæˆ.ssh ç›®å½•ï¼Œé‡Œé¢æœ‰id_rsa å’Œid_rsa.pub ä¸¤ä¸ªæ–‡ä»¶ï¼Œå®ƒä»¬æ˜¯SSH Key çš„ç§˜é’¥å¯¹ã€‚id_rsa æ˜¯ç§é’¥ï¼Œä¸èƒ½æ³„éœ²å‡ºå»ï¼›id_rsa.pub æ˜¯å…¬é’¥ï¼Œå¯ä»¥æ”¾å¿ƒåœ°å‘Šè¯‰ä»»ä½•äººã€‚ 2.4.2.åœ¨GitHub é‡Œæ·»åŠ SSH Keyï¼šç”µè„‘ç™»é™†GitHub,åœ¨è‡ªå·±è´¦æˆ·çš„â€Settingsâ€-â€œSSH Keyâ€ä¸­æ·»åŠ id_rsa.pub æ–‡ä»¶çš„å†…å®¹ï¼›2.4.3.åˆ›å»ºä¸€ä¸ªä»“åº“å¦‚:git_hexo,ç¬¬ä¸€æ¬¡ä¸Šä¼ éœ€è¦æŒ‡å®šGitHub/Codingä»“åº“ï¼Œå¦‚Codingçš„git_hexoï¼š1$ git remote add origin https://git.coding.net/hceng/git_hexo.gitç„¶åæ ¹æ®æç¤ºè¾“å…¥è´¦å·ã€å¯†ç ï¼Œæœ€åæ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤æäº¤è‡³GitHub/Codingï¼›12$ git push -u origin master$ git push origin --tags 2.5ä»¥åå¦‚æœä¿®æ”¹æ–‡ä»¶åå†æ¬¡æäº¤12345$ git add â€“A # æ·»åŠ ä¿®æ”¹æ–‡ä»¶åˆ°ä¸´æ—¶ç©ºé—´ï¼›$ git commit -m &quot;blog, git use&quot; # æ·»åŠ æœ¬åœ°ä»“åº“å’Œæ·»åŠ å¤‡æ³¨ï¼›$ git tag v2 # æ‰“æ ‡ç­¾ï¼›$ git push origin master # ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„masterï¼›$ git push origin --tags # ä¸Šä¼ æ ‡ç­¾åˆ°æœåŠ¡å™¨ï¼› 3.Git è·å–GitHub/Codingæºç  æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯ä»¥å¤åˆ¶ä»–äººpublicä»£ç ï¼Œè¿™ç§°ä¸ºâ€œå…‹éš†â€ï¼š1$ git clone https://github.com/hceng/hceng.github.io å½“æºç ä½œè€…å†æ¬¡ä¿®æ”¹äº†æºç åï¼Œå¯ä»¥è¿›å…¥å¯¹åº”ç›®å½•ï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å†æ¬¡è·å¾—æœ€æ–°çš„ï¼š1$ git pull origin æŸ¥çœ‹ä¿¡æ¯çºªå½•ï¼š1$ git log --pretty=oneline æŸ¥çœ‹æ ‡ç­¾ï¼š1$ git tag è·å¾—æŒ‡å®šç‰ˆæœ¬çš„æºç ï¼š123$ git checkout &lt;commit id&gt;æˆ–$ git checkout &lt;tag_name&gt; 4.åˆ†æ”¯ç®¡ç†4.1æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ï¼š1$ git branch --all # æœ¬åœ°ä¸»åˆ†æ”¯ï¼šmasterï¼›è¿œç¨‹ä¸»åˆ†æ”¯ï¼šorigin/masterï¼› 4.2åˆ›å»ºæœ¬åœ°åˆ†æ”¯ï¼š12$ git branch bak # åˆ›å»ºæœ¬åœ°åˆ†æ”¯ï¼›$ git branch # æŸ¥çœ‹æœ¬åˆ†æ”¯ï¼›&quot;*&quot;å·è¡¨ç¤ºå½“å‰æ‰€åœ¨åˆ†æ”¯ï¼› 4.3å‘å¸ƒæ–°åˆ†æ”¯ï¼šå³ï¼šå°†æœ¬åœ°æ–°å»ºçš„bakåˆ†æ”¯åŒæ­¥åˆ°è¿œç¨‹æœåŠ¡å™¨GitHub/Coding;12$ git push origin bak # è¿™æ ·è¿œç¨‹ä»“åº“ä¹Ÿæœ‰ä¸€ä¸ªbakåˆ†æ”¯äº†ï¼›$ git checkout bak # åˆ‡æ¢åˆ°bakåˆ†æ”¯æ“ä½œï¼›ç¬¬ä¸€ç§æƒ…å†µï¼šbakåˆ†æ”¯å¼€å‘å®Œæˆï¼Œåˆå¹¶åˆ°ä¸»åˆ†æ”¯ï¼š12345$ git checkout master # åˆ‡æ¢åˆ°ä¸»åˆ†æ”¯ï¼›$ git merge bak # æŠŠbakåˆ†æ”¯çš„æ›´æ”¹å’Œmasteråˆå¹¶ï¼›$ git push # æäº¤ä¸»åˆ†æ”¯ä»£ç è¿œç¨‹ï¼›$ git checkout bak # åˆ‡æ¢åˆ°bakè¿œç¨‹åˆ†æ”¯ï¼›$ git push # æäº¤bakåˆ†æ”¯åˆ°è¿œç¨‹ï¼› ç¬¬äºŒç§æƒ…å†µï¼šbakåˆ†æ”¯æ²¡å¼€å‘å®Œï¼Œæ¨é€ä¿å­˜ï¼Œä¸‹æ¬¡å†å¼€å‘ï¼š123$ git add -A # æ·»åŠ ä¿®æ”¹æ–‡ä»¶åˆ°ä¸´æ—¶ç©ºé—´ï¼›$ git commit -m &quot;bak branch&quot; # æäº¤æœ¬åœ°bakåˆ†æ”¯ä»“åº“ï¼›$ git push # æäº¤bakåˆ†æ”¯åˆ°è¿œç¨‹ï¼› 4.4åˆ é™¤åˆ†æ”¯ï¼š12345# åˆ é™¤è¿œç¨‹bakåˆ†æ”¯ï¼Œå±é™©å‘½ä»¤ï¼›$ git push origin :bak # ä¸‹é¢ä¸¤æ¡æ˜¯åˆ é™¤æœ¬åœ°åˆ†æ”¯;$ git checkout master # åˆ‡æ¢åˆ°masteråˆ†æ”¯$ git branch -d bak # åˆ é™¤æœ¬åœ°devåˆ†æ”¯ å‚è€ƒï¼š 5.å…¶å®ƒå¸¸ç”¨æŒ‡ä»¤12345678910 $ git status #æŸ¥çœ‹ä»“åº“çŠ¶æ€; $ git diff XX #æŸ¥çœ‹XXæ–‡ä»¶ä¿®æ”¹äº†é‚£äº›å†…å®¹;$ git log #æŸ¥çœ‹å†å²è®°å½•;$ git reflog #æŸ¥çœ‹å†å²è®°å½•(å«å›é€€çºªå½•)ï¼›$ git reset â€“hard HEAD^ #å›é€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬; $ git reset â€“hard HEAD~ #å›é€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬;$ git reset â€“hard HEAD~100 #å›é€€åˆ°100ä¸ªç‰ˆæœ¬;$ git checkout â€“ XX #æŠŠXXæ–‡ä»¶åœ¨å·¥ä½œåŒºçš„ä¿®æ”¹å…¨éƒ¨æ’¤é”€ï¼› $ git rm XX #åˆ é™¤XXæ–‡ä»¶ï¼› å‚è€ƒèµ„æ–™ï¼šéŸ¦ä¸œå±±Androidç³»ç»Ÿè§†é¢‘ä½¿ç”¨æ‰‹å†Œ20160303 æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"Git","slug":"Git","permalink":"http://yoursite.com/tags/Git/"}]},{"title":"SkillTree","date":"2017-03-01T00:00:00.000Z","path":"2017/03/01/SkillTree/","text":"My SkillTree. SkillTree æœ¬æ–‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è½¬è½½è¯·æ³¨æ˜æ¥è‡ªhcengâ€™s blogï¼Œå¹¶ä¿æŒè½¬è½½åæ–‡ç« å†…å®¹çš„å®Œæ•´ã€‚æœ¬äººä¿ç•™æ‰€æœ‰ç‰ˆæƒç›¸å…³æƒåˆ©ã€‚","tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"http://yoursite.com/tags/éšç¬”/"}]}]